[{"filePath":"C:\\Users\\nithi\\OneDrive\\Documents\\Brototype\\Takecare\\frontend\\src\\components\\Doctor\\RecentAppointmentModal.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":162,"column":105,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":162,"endColumn":108,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9644,9647],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9644,9647],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":163,"column":103,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":163,"endColumn":106,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9772,9775],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9772,9775],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useEffect, useState } from 'react';\r\nimport { Dialog, DialogContent } from '../ui/dialog';\r\nimport { Button } from '../ui/button';\r\nimport { Loader2, Calendar, Clock, FileText, Pill, Video, MessageSquare, X, User } from 'lucide-react';\r\nimport { appointmentService } from '../../services/appointmentService';\r\nimport { prescriptionService } from '../../services/prescriptionService';\r\nimport { toast } from 'sonner';\r\nimport type { PopulatedAppointment } from '../../types/appointment.types';\r\nimport type { Prescription, Medicine } from '../../types/prescription.types';\r\n\r\ninterface RecentAppointmentModalProps {\r\n    isOpen: boolean;\r\n    onClose: () => void;\r\n    appointmentId: string | null;\r\n    role?: 'doctor' | 'patient';\r\n}\r\n\r\nconst RecentAppointmentModal: React.FC<RecentAppointmentModalProps> = ({ isOpen, onClose, appointmentId, role = 'doctor' }) => {\r\n    const [appointment, setAppointment] = useState<PopulatedAppointment | null>(null);\r\n    const [prescription, setPrescription] = useState<Prescription | null>(null);\r\n    const [loading, setLoading] = useState(false);\r\n\r\n    useEffect(() => {\r\n        if (isOpen && appointmentId) {\r\n            fetchDetails();\r\n        } else {\r\n            setAppointment(null);\r\n            setPrescription(null);\r\n        }\r\n    }, [isOpen, appointmentId]);\r\n\r\n    const fetchDetails = async () => {\r\n        setLoading(true);\r\n        try {\r\n            const aptResponse = await appointmentService.getAppointmentById(appointmentId!);\r\n            if (aptResponse.success) {\r\n                setAppointment(aptResponse.data);\r\n\r\n                if (aptResponse.data.status === 'completed') {\r\n                    const prescResponse = await prescriptionService.getPrescriptionByAppointment(appointmentId!);\r\n                    if (prescResponse.success) {\r\n                        setPrescription(prescResponse.data);\r\n                    }\r\n                }\r\n            } else {\r\n                toast.error(\"Failed to fetch appointment details\");\r\n                onClose();\r\n            }\r\n        } catch (error) {\r\n            console.error(\"Error fetching details:\", error);\r\n            toast.info(\"prescription not provided\");\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    if (!isOpen) return null;\r\n\r\n    const getStatusColor = (status: string) => {\r\n        switch (status) {\r\n            case 'pending': return 'bg-blue-100/50 text-blue-700 border-blue-200';\r\n            case 'confirmed': return 'bg-emerald-100/50 text-emerald-700 border-emerald-200';\r\n            case 'completed': return 'bg-green-100/50 text-green-700 border-green-200';\r\n            case 'cancelled': return 'bg-red-100/50 text-red-700 border-red-200';\r\n            case 'rejected': return 'bg-red-100/50 text-red-700 border-red-200';\r\n            default: return 'bg-gray-100/50 text-gray-700 border-gray-200';\r\n        }\r\n    };\r\n\r\n    return (\r\n        <Dialog open={isOpen} onOpenChange={(open) => !open && onClose()}>\r\n            <DialogContent className=\"sm:max-w-2xl bg-white border-0 shadow-2xl p-0 overflow-hidden max-h-[90vh] flex flex-col\">\r\n                <div className=\"bg-[#00A1B0] p-6 text-white relative overflow-hidden shrink-0\">\r\n                    <div className=\"absolute top-0 right-0 w-32 h-32 bg-white/10 rounded-full -mr-10 -mt-10 blur-2xl\"></div>\r\n                    <div className=\"relative z-10 flex justify-between items-start\">\r\n                        <div>\r\n                            <h2 className=\"text-xl font-bold\">Appointment Details</h2>\r\n                            <p className=\"text-white/80 text-sm mt-1\">\r\n                                {loading ? 'Loading details...' : `ID: #${appointment?.customId || appointment?._id?.slice(-8)}`}\r\n                            </p>\r\n                        </div>\r\n                        <Button\r\n                            onClick={onClose}\r\n                            variant=\"ghost\"\r\n                            className=\"bg-white/20 hover:bg-white/30 text-white rounded-full p-2 h-auto\"\r\n                        >\r\n                            <X size={18} />\r\n                        </Button>\r\n                    </div>\r\n                </div>\r\n\r\n                <div className=\"flex-1 overflow-y-auto p-6 space-y-6\">\r\n                    {loading ? (\r\n                        <div className=\"flex flex-col items-center justify-center py-12\">\r\n                            <Loader2 className=\"w-8 h-8 text-[#00A1B0] animate-spin mb-3\" />\r\n                            <p className=\"text-gray-500 text-sm\">Retrieving information...</p>\r\n                        </div>\r\n                    ) : appointment ? (\r\n                        <>\r\n                            {/* Key Stats Grid */}\r\n                            <div className=\"grid grid-cols-2 gap-4\">\r\n                                <div className=\"p-4 bg-gray-50 rounded-xl border border-gray-100 space-y-1\">\r\n                                    <div className=\"flex items-center gap-2 text-gray-400 text-xs font-bold uppercase tracking-wider\">\r\n                                        <Calendar size={12} /> Date\r\n                                    </div>\r\n                                    <p className=\"font-semibold text-gray-800\">\r\n                                        {new Date(appointment.appointmentDate).toLocaleDateString(undefined, {\r\n                                            weekday: 'long',\r\n                                            year: 'numeric',\r\n                                            month: 'long',\r\n                                            day: 'numeric'\r\n                                        })}\r\n                                    </p>\r\n                                </div>\r\n                                <div className=\"p-4 bg-gray-50 rounded-xl border border-gray-100 space-y-1\">\r\n                                    <div className=\"flex items-center gap-2 text-gray-400 text-xs font-bold uppercase tracking-wider\">\r\n                                        <Clock size={12} /> Time\r\n                                    </div>\r\n                                    <p className=\"font-semibold text-gray-800\">{appointment.appointmentTime}</p>\r\n                                </div>\r\n                                <div className=\"p-4 bg-gray-50 rounded-xl border border-gray-100 space-y-1\">\r\n                                    <div className=\"flex items-center gap-2 text-gray-400 text-xs font-bold uppercase tracking-wider\">\r\n                                        {appointment.appointmentType === 'video' ? <Video size={12} /> : <MessageSquare size={12} />} Type\r\n                                    </div>\r\n                                    <p className=\"font-semibold text-gray-800 capitalize\">\r\n                                        {appointment.appointmentType === 'video' ? 'Video Consultation' : 'Chat Consultation'}\r\n                                    </p>\r\n                                </div>\r\n                                <div className={`p-4 rounded-xl border space-y-1 ${getStatusColor(appointment.status)}`}>\r\n                                    <div className=\"flex items-center gap-2 opacity-70 text-xs font-bold uppercase tracking-wider\">\r\n                                        Status\r\n                                    </div>\r\n                                    <p className=\"font-bold capitalize\">{appointment.status}</p>\r\n                                </div>\r\n                            </div>\r\n\r\n                            {/* Payment & Reason */}\r\n                            <div className=\"space-y-4\">\r\n                                <div className=\"flex items-start gap-3 p-4 bg-white border border-gray-100 rounded-xl shadow-sm\">\r\n                                    <div className=\"p-2 bg-blue-50 text-blue-500 rounded-lg\">\r\n                                        <FileText size={18} />\r\n                                    </div>\r\n                                    <div>\r\n                                        <p className=\"text-xs font-bold text-gray-400 uppercase tracking-wider mb-1\">Reason for Visit</p>\r\n                                        <p className=\"text-gray-700 text-sm leading-relaxed\">\r\n                                            {appointment.reason || \"No reason provided.\"}\r\n                                        </p>\r\n                                    </div>\r\n                                </div>\r\n\r\n                                <div className=\"flex items-center gap-4 text-sm\">\r\n                                    <div className=\"flex items-center gap-2 px-3 py-1.5 bg-gray-50 rounded-lg border border-gray-100\">\r\n                                        <span className='text-gray-400' >Γé╣</span>\r\n                                        <span className=\"text-gray-500\">Fees:</span>\r\n                                        <span className=\"font-semibold text-gray-800\">Γé╣{appointment.consultationFees}</span>\r\n                                    </div>\r\n                                    <div className=\"flex items-center gap-2 px-3 py-1.5 bg-gray-50 rounded-lg border border-gray-100\">\r\n                                        <User size={14} className=\"text-gray-400\" />\r\n                                        <span className=\"text-gray-500\">{role === 'doctor' ? 'Patient:' : 'Doctor:'}</span>\r\n                                        <span className=\"font-semibold text-gray-800\">\r\n                                            {role === 'doctor'\r\n                                                ? (appointment.patientName || (appointment.patientId as any)?.name || \"Patient\")\r\n                                                : (appointment.doctorName || (appointment.doctorId as any)?.name || \"Doctor\")}\r\n                                        </span>\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n\r\n                            {/* Prescription Section */}\r\n                            {appointment.status === 'completed' && (\r\n                                <div className=\"pt-4 border-t border-gray-100\">\r\n                                    <div className=\"flex items-center gap-2 mb-4\">\r\n                                        <div className=\"p-1.5 bg-purple-50 text-purple-600 rounded-lg\">\r\n                                            <Pill size={16} />\r\n                                        </div>\r\n                                        <h3 className=\"font-bold text-gray-800\">Prescription Details</h3>\r\n                                    </div>\r\n\r\n                                    {prescription ? (\r\n                                        <div className=\"space-y-4\">\r\n                                            {prescription.medicines && prescription.medicines.length > 0 ? (\r\n                                                <div className=\"overflow-hidden rounded-xl border border-gray-100 shadow-sm\">\r\n                                                    <table className=\"w-full text-sm text-left\">\r\n                                                        <thead className=\"bg-gray-50 text-gray-500 font-medium\">\r\n                                                            <tr>\r\n                                                                <th className=\"px-4 py-3\">Medicine</th>\r\n                                                                <th className=\"px-4 py-3\">Dosage</th>\r\n                                                                <th className=\"px-4 py-3\">Freq</th>\r\n                                                                <th className=\"px-4 py-3 text-right\">Days</th>\r\n                                                            </tr>\r\n                                                        </thead>\r\n                                                        <tbody className=\"divide-y divide-gray-50\">\r\n                                                            {prescription.medicines.map((med: Medicine, i: number) => (\r\n                                                                <tr key={i}>\r\n                                                                    <td className=\"px-4 py-3 font-medium text-gray-800\">{med.name}</td>\r\n                                                                    <td className=\"px-4 py-3 text-gray-600\">{med.dosage}</td>\r\n                                                                    <td className=\"px-4 py-3 text-gray-600\">{med.frequency}</td>\r\n                                                                    <td className=\"px-4 py-3 text-gray-600 text-right\">{med.duration}</td>\r\n                                                                </tr>\r\n                                                            ))}\r\n                                                        </tbody>\r\n                                                    </table>\r\n                                                </div>\r\n                                            ) : (\r\n                                                <p className=\"text-sm text-gray-500 italic\">No medicines prescribed.</p>\r\n                                            )}\r\n\r\n                                            {prescription.instructions && (\r\n                                                <div className=\"p-3 bg-amber-50 rounded-lg border border-amber-100 text-amber-800 text-sm\">\r\n                                                    <strong>Note:</strong> {prescription.instructions}\r\n                                                </div>\r\n                                            )}\r\n                                        </div>\r\n                                    ) : (\r\n                                        <div className=\"text-center py-6 bg-gray-50 rounded-xl border border-dashed border-gray-200\">\r\n                                            <p className=\"text-gray-400 text-sm\">No prescription record found for this appointment.</p>\r\n                                        </div>\r\n                                    )}\r\n                                </div>\r\n                            )}\r\n                        </>\r\n                    ) : (\r\n                        <div className=\"text-center py-10 text-gray-400\">\r\n                            Failed to load appointment details.\r\n                        </div>\r\n                    )}\r\n                </div>\r\n\r\n                <div className=\"p-4 bg-gray-50 border-t border-gray-100 flex justify-end\">\r\n                    <Button onClick={onClose} variant=\"secondary\">Close Details</Button>\r\n                </div>\r\n            </DialogContent>\r\n        </Dialog>\r\n    );\r\n};\r\n\r\nexport default RecentAppointmentModal;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\nithi\\OneDrive\\Documents\\Brototype\\Takecare\\frontend\\src\\components\\Patient\\PrescriptionViewModal.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":29,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":29,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1303,1306],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1303,1306],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useEffect, useState, useCallback } from 'react';\r\nimport { motion, AnimatePresence } from 'framer-motion';\r\nimport { X, Printer, Pill, Calendar, User, Stethoscope, FlaskConical, FileText, Clock } from 'lucide-react';\r\nimport { prescriptionService } from '../../services/prescriptionService';\r\nimport { API_BASE_URL } from '../../utils/constants';\r\nimport type { Prescription, Medicine } from '../../types/prescription.types';\r\n\r\ninterface PrescriptionViewModalProps {\r\n    isOpen: boolean;\r\n    onClose: () => void;\r\n    appointmentId: string;\r\n}\r\n\r\nconst PrescriptionViewModal: React.FC<PrescriptionViewModalProps> = ({ isOpen, onClose, appointmentId }) => {\r\n    const [prescription, setPrescription] = useState<Prescription | null>(null);\r\n    const [loading, setLoading] = useState(true);\r\n    const [error, setError] = useState('');\r\n\r\n    const fetchPrescription = useCallback(async () => {\r\n        try {\r\n            setLoading(true);\r\n            setError('');\r\n            const response = await prescriptionService.getPrescriptionByAppointment(appointmentId);\r\n            if (response.success && response.data) {\r\n                setPrescription(response.data);\r\n            } else {\r\n                setError('Prescription not found');\r\n            }\r\n        } catch (err: any) {\r\n            console.error(err);\r\n            setError(err.response?.data?.message || 'Failed to load prescription');\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    }, [appointmentId]);\r\n\r\n    useEffect(() => {\r\n        if (isOpen && appointmentId) {\r\n            fetchPrescription();\r\n        }\r\n    }, [isOpen, appointmentId, fetchPrescription]);\r\n\r\n    const handlePrint = () => {\r\n        window.print();\r\n    };\r\n\r\n    const formatDate = (dateStr: string) => {\r\n        if (!dateStr) return 'N/A';\r\n        return new Date(dateStr).toLocaleDateString('en-IN', {\r\n            day: '2-digit',\r\n            month: 'short',\r\n            year: 'numeric'\r\n        });\r\n    };\r\n\r\n    const getImageUrl = (imagePath: string | null | undefined) => {\r\n        if (!imagePath) return undefined;\r\n        if (imagePath.startsWith('http')) return imagePath;\r\n        const cleanPath = imagePath.replace(/\\\\/g, '/');\r\n        return `${API_BASE_URL}/${cleanPath}`;\r\n    };\r\n\r\n    if (!isOpen) return null;\r\n\r\n    return (\r\n        <AnimatePresence>\r\n            <div className=\"fixed inset-0 z-50 flex items-center justify-center p-0 md:p-4 bg-black/60 backdrop-blur-sm print:bg-white print:p-0 print:block print:static print-page\">\r\n                <style dangerouslySetInnerHTML={{\r\n                    __html: `\r\n                    @media print {\r\n                        @page { margin: 1cm; size: auto; }\r\n                        \r\n                        /* Hide entire page content */\r\n                        body {\r\n                            visibility: hidden !important;\r\n                            background: white !important;\r\n                        }\r\n\r\n                        /* Target ONLY the modal and its children to be visible */\r\n                        .print-page,\r\n                        .print-page-inner,\r\n                        .print-page-inner * {\r\n                            visibility: visible !important;\r\n                        }\r\n\r\n                        /* Position the modal at the top of the physical page */\r\n                        .print-page {\r\n                            position: absolute !important;\r\n                            left: 0 !important;\r\n                            top: 0 !important;\r\n                            width: 100% !important;\r\n                            height: auto !important;\r\n                            display: block !important;\r\n                            background: white !important;\r\n                            margin: 0 !important;\r\n                            padding: 0 !important;\r\n                        }\r\n\r\n                        .print-page-inner {\r\n                            width: 100% !important;\r\n                            max-width: none !important;\r\n                            box-shadow: none !important;\r\n                            border: none !important;\r\n                            background: white !important;\r\n                            opacity: 1 !important;\r\n                            transform: none !important;\r\n                            margin: 0 !important;\r\n                            display: block !important;\r\n                        }\r\n\r\n                        /* Ensure scrollable containers don't clip content */\r\n                        div {\r\n                            overflow: visible !important;\r\n                            height: auto !important;\r\n                            max-height: none !important;\r\n                        }\r\n\r\n                        /* Hide UI buttons and unnecessary overlays */\r\n                        button, .print\\\\:hidden, .print-hidden {\r\n                            display: none !important;\r\n                            visibility: hidden !important;\r\n                        }\r\n\r\n                        /* Layout fixes for clinical sheet */\r\n                        .print-grid { \r\n                            display: grid !important; \r\n                            grid-template-columns: repeat(2, 1fr) !important; \r\n                            gap: 1.5rem !important; \r\n                        }\r\n                        \r\n                        table { width: 100% !important; border-collapse: collapse !important; }\r\n                        th, td { border-bottom: 1px solid #eee !important; }\r\n\r\n                        /* Force background colors/images to print */\r\n                        * { \r\n                            -webkit-print-color-adjust: exact !important; \r\n                            print-color-adjust: exact !important; \r\n                            color-adjust: exact !important;\r\n                        }\r\n\r\n                        .bg-\\\\[\\\\#00A1B0\\\\] { \r\n                            background-color: #00A1B0 !important; \r\n                            print-color-adjust: exact !important; \r\n                        }\r\n                    }\r\n                `}} />\r\n                <motion.div\r\n                    initial={{ opacity: 0, scale: 0.95, y: 20 }}\r\n                    animate={{ opacity: 1, scale: 1, y: 0 }}\r\n                    exit={{ opacity: 0, scale: 0.95, y: 20 }}\r\n                    transition={{ duration: 0.2 }}\r\n                    className=\"bg-white rounded-2xl shadow-2xl w-full max-w-4xl max-h-[95vh] overflow-hidden flex flex-col print:shadow-none print:w-full print:max-w-none print:max-h-none print:rounded-none print:static print:block print:m-0 print-page-inner\"\r\n                >\r\n                    {/* Professional Toolbar */}\r\n                    <div className=\"flex items-center justify-between px-6 py-4 border-b border-gray-100 bg-white print:hidden\">\r\n                        <div className=\"flex items-center gap-3\">\r\n                            <div className=\"w-10 h-10 rounded-xl bg-teal-50 flex items-center justify-center\">\r\n                                <Stethoscope className=\"w-5 h-5 text-[#00A1B0]\" />\r\n                            </div>\r\n                            <div>\r\n                                <h2 className=\"text-lg font-bold text-gray-800\">Medical Prescription</h2>\r\n                                <div className=\"flex items-center gap-1.5 text-[10px] text-emerald-600 font-bold uppercase tracking-wider\">\r\n                                    <div className=\"w-1.5 h-1.5 rounded-full bg-emerald-500 animate-pulse shadow-[0_0_5px_rgba(16,185,129,0.5)]\"></div>\r\n                                    Digital Record Verified\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                        <div className=\"flex items-center gap-2\">\r\n                            <button\r\n                                onClick={handlePrint}\r\n                                className=\"flex items-center gap-2 px-4 py-2 bg-[#00A1B0] hover:bg-[#008f9c] text-white rounded-xl text-sm font-bold transition-all shadow-lg shadow-[#00A1B0]/20 active:scale-95\"\r\n                            >\r\n                                <Printer className=\"w-4 h-4\" /> Print PDF\r\n                            </button>\r\n                            <button\r\n                                onClick={onClose}\r\n                                className=\"p-2.5 hover:bg-gray-100 rounded-xl transition-colors text-gray-400\"\r\n                            >\r\n                                <X className=\"w-5 h-5\" />\r\n                            </button>\r\n                        </div>\r\n                    </div>\r\n\r\n                    <div\r\n                        className=\"flex-1 overflow-y-auto custom-scrollbar bg-gray-100/50 p-4 md:p-8 print:bg-white print:p-0\"\r\n                        data-lenis-prevent\r\n                    >\r\n                        {loading ? (\r\n                            <div className=\"flex flex-col items-center justify-center py-20 bg-white rounded-2xl shadow-sm border border-gray-100 min-h-[500px]\">\r\n                                <div className=\"w-12 h-12 border-4 border-[#00A1B0]/20 border-t-[#00A1B0] rounded-full animate-spin mb-4\" />\r\n                                <p className=\"text-gray-500 font-bold tracking-tight\">Retrieving Medical Record...</p>\r\n                            </div>\r\n                        ) : error ? (\r\n                            <div className=\"flex flex-col items-center justify-center py-20 bg-white rounded-2xl shadow-sm border border-gray-100 min-h-[500px]\">\r\n                                <div className=\"w-20 h-20 rounded-full bg-red-50 flex items-center justify-center mb-6\">\r\n                                    <FileText className=\"w-10 h-10 text-red-400\" />\r\n                                </div>\r\n                                <h3 className=\"text-xl font-bold text-gray-800 mb-2 font-mono\">wait for the doctor to issue a prescription</h3>\r\n                                <p className=\"text-gray-400 text-sm max-w-xs text-center\">{error}</p>\r\n                            </div>\r\n                        ) : prescription ? (\r\n                            /* THE CLINICAL SHEET */\r\n                            <div className=\"relative bg-white rounded-xl shadow-xl border border-gray-200 overflow-hidden print:shadow-none print:border-none print:rounded-none max-w-3xl mx-auto min-h-[1000px]\">\r\n\r\n                                {/* Subtle Watermark */}\r\n                                {/* Subtle Watermark */}\r\n                                <div className=\"absolute inset-0 pointer-events-none flex items-center justify-center select-none overflow-hidden z-0\">\r\n                                    <img\r\n                                        src={'/doctor.png'}\r\n                                        alt=\"Watermark\"\r\n                                        className=\"w-[500px] h-[500px] object-contain opacity-10 \"\r\n                                    />\r\n                                </div>\r\n\r\n                                {/* Clinical Header */}\r\n                                <div className=\"relative bg-[#00A1B0] px-8 py-10 overflow-hidden\">\r\n                                    {/* Decorator background */}\r\n                                    <div className=\"absolute top-0 right-0 w-64 h-64 bg-white/10 rounded-full -mr-20 -mt-20 blur-3xl\"></div>\r\n                                    <div className=\"absolute bottom-0 left-0 w-32 h-32 bg-black/10 rounded-full -ml-10 -mb-10 blur-2xl\"></div>\r\n\r\n                                    <div className=\"relative flex flex-col md:flex-row justify-between items-center gap-6\">\r\n                                        <div className=\"flex items-center gap-6\">\r\n                                            <div className=\"w-20 h-20 rounded-2xl bg-white p-1 shadow-2xl relative\">\r\n                                                <div className=\"absolute -top-2 -right-2 w-6 h-6 bg-emerald-500 rounded-full border-2 border-white flex items-center justify-center\">\r\n                                                    <div className=\"w-2 h-2 rounded-full bg-white animate-pulse\"></div>\r\n                                                </div>\r\n                                                <img\r\n                                                    src={getImageUrl(prescription.doctor?.profileImage) || '/doctor.png'}\r\n                                                    alt=\"Doctor\"\r\n                                                    className=\"w-full h-full object-cover rounded-xl\"\r\n                                                />\r\n                                            </div>\r\n                                            <div className=\"text-white text-center md:text-left\">\r\n                                                <h1 className=\"text-3xl font-black tracking-tight leading-none mb-1\">\r\n                                                    Dr. {prescription.doctor?.name || 'Doctor'}\r\n                                                </h1>\r\n                                                <div className=\"flex flex-wrap justify-center md:justify-start items-center gap-3 text-sm font-bold text-white/90\">\r\n                                                    <span className=\"bg-white/20 px-3 py-1 rounded-lg backdrop-blur-sm border border-white/20\">\r\n                                                        {prescription.doctor?.specialty || 'Medical Specialist'}\r\n                                                    </span>\r\n                                                    <span className=\"opacity-60\">Reg No: {prescription.doctor?.registrationNumber || 'XXXXX'}</span>\r\n                                                </div>\r\n                                            </div>\r\n                                        </div>\r\n\r\n                                        <div className=\"text-center md:text-right\">\r\n                                            <div className=\"text-6xl font-black text-white/20 leading-none select-none mb-2\">Γä₧</div>\r\n                                            <div className=\"bg-white/20 backdrop-blur-md px-4 py-2 rounded-xl border border-white/20 inline-block\">\r\n                                                <p className=\"text-[10px] text-white/60 font-black uppercase tracking-[0.2em] mb-0.5 leading-none\">Record ID</p>\r\n                                                <p className=\"text-lg font-black text-white leading-none\">\r\n                                                    #{prescription.appointmentCustomId || prescription.id?.slice(-8).toUpperCase()}\r\n                                                </p>\r\n                                            </div>\r\n                                        </div>\r\n                                    </div>\r\n                                </div>\r\n\r\n                                {/* Vital Info Bar */}\r\n                                <div className=\"bg-gray-50 border-b border-gray-100 px-8 py-5 grid grid-cols-2 lg:grid-cols-4 gap-6 print-grid\">\r\n                                    <div className=\"space-y-1\">\r\n                                        <p className=\"text-[9px] text-gray-400 font-black uppercase tracking-widest\">Consult Date</p>\r\n                                        <div className=\"flex items-center gap-2 text-gray-800\">\r\n                                            <Calendar className=\"w-3.5 h-3.5 text-[#00A1B0]\" />\r\n                                            <span className=\"text-sm font-bold\">{formatDate(prescription.createdAt)}</span>\r\n                                        </div>\r\n                                    </div>\r\n                                    <div className=\"space-y-1\">\r\n                                        <p className=\"text-[9px] text-gray-400 font-black uppercase tracking-widest\">Consult Time</p>\r\n                                        <div className=\"flex items-center gap-2 text-gray-800\">\r\n                                            <Clock className=\"w-3.5 h-3.5 text-[#00A1B0]\" />\r\n                                            <span className=\"text-sm font-bold\">\r\n                                                {prescription.createdAt ? new Date(prescription.createdAt).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' }) : 'N/A'}\r\n                                            </span>\r\n                                        </div>\r\n                                    </div>\r\n                                    <div className=\"space-y-1\">\r\n                                        <p className=\"text-[9px] text-gray-400 font-black uppercase tracking-widest\">Patient Name</p>\r\n                                        <div className=\"flex items-center gap-2 text-gray-800\">\r\n                                            <User className=\"w-3.5 h-3.5 text-[#00A1B0]\" />\r\n                                            <span className=\"text-sm font-bold truncate\">{prescription.patient?.name}</span>\r\n                                        </div>\r\n                                    </div>\r\n                                    <div className=\"space-y-1\">\r\n                                        <p className=\"text-[9px] text-gray-400 font-black uppercase tracking-widest\">Demographics</p>\r\n                                        <div className=\"flex items-center gap-2 text-gray-800 font-bold text-sm\">\r\n                                            <span className=\"bg-gray-200 px-2 py-0.5 rounded text-[10px] uppercase\">{prescription.patient?.gender || 'N/A'}</span>\r\n                                            <span>{prescription.patient?.age || 'N/A'} Years</span>\r\n                                        </div>\r\n                                    </div>\r\n                                </div>\r\n\r\n                                <div className=\"p-8 space-y-10\">\r\n\r\n                                    {/* Diagnosis & Findings */}\r\n                                    <div className=\"space-y-4\">\r\n                                        <div className=\"flex items-center gap-3 border-b-2 border-gray-50 pb-2\">\r\n                                            <div className=\"w-8 h-8 rounded-lg bg-teal-50 flex items-center justify-center\">\r\n                                                <Stethoscope className=\"w-4 h-4 text-[#00A1B0]\" />\r\n                                            </div>\r\n                                            <h3 className=\"text-xs font-black text-gray-800 uppercase tracking-[0.2em]\">Clinical Diagnosis</h3>\r\n                                        </div>\r\n                                        <div className=\"bg-gray-50/50 rounded-2xl p-6 border border-gray-100\">\r\n                                            <p className=\"text-gray-700 text-lg font-medium italic leading-relaxed\">\r\n                                                ΓÇ£{prescription.diagnosis || 'General clinical assessment and management provided.'}ΓÇ¥\r\n                                            </p>\r\n                                        </div>\r\n                                    </div>\r\n\r\n                                    {/* Medical Prescription Table */}\r\n                                    <div className=\"space-y-4\">\r\n                                        <div className=\"flex items-center gap-3 border-b-2 border-gray-50 pb-2\">\r\n                                            <div className=\"w-8 h-8 rounded-lg bg-blue-50 flex items-center justify-center\">\r\n                                                <Pill className=\"w-4 h-4 text-blue-500\" />\r\n                                            </div>\r\n                                            <h3 className=\"text-xs font-black text-gray-800 uppercase tracking-[0.2em]\">Medical Prescription (Rx)</h3>\r\n                                            <span className=\"ml-auto text-[10px] font-black bg-blue-100 text-blue-600 px-3 py-1 rounded-full uppercase\">\r\n                                                {prescription.medicines?.length || 0} ITEMS\r\n                                            </span>\r\n                                        </div>\r\n\r\n                                        <div className=\"rounded-2xl border border-gray-100 overflow-hidden shadow-sm\">\r\n                                            <table className=\"w-full text-left\">\r\n                                                <thead>\r\n                                                    <tr className=\"bg-gray-50 border-b border-gray-100\">\r\n                                                        <th className=\"px-6 py-4 text-[10px] font-black text-gray-400 uppercase tracking-widest\">Medicine Name</th>\r\n                                                        <th className=\"px-6 py-4 text-[10px] font-black text-gray-400 uppercase tracking-widest\">Dosage</th>\r\n                                                        <th className=\"px-6 py-4 text-[10px] font-black text-gray-400 uppercase tracking-widest\">Frequency</th>\r\n                                                        <th className=\"px-6 py-4 text-[10px] font-black text-gray-400 uppercase tracking-widest\">Duration</th>\r\n                                                    </tr>\r\n                                                </thead>\r\n                                                <tbody className=\"divide-y divide-gray-50\">\r\n                                                    {prescription?.medicines?.map((med: Medicine, idx: number) => (\r\n                                                        <tr key={idx} className=\"hover:bg-gray-50/50 transition-colors\">\r\n                                                            <td className=\"px-6 py-5\">\r\n                                                                <div className=\"font-bold text-gray-900\">{med.name}</div>\r\n                                                                {med.instructions && <div className=\"text-[10px] text-gray-400 font-medium mt-1 italic uppercase tracking-tighter\">Note: {med.instructions}</div>}\r\n                                                            </td>\r\n                                                            <td className=\"px-6 py-5\">\r\n                                                                <span className=\"bg-teal-50 text-[#00A1B0] px-2 py-1 rounded text-xs font-black uppercase\">{med.dosage}</span>\r\n                                                            </td>\r\n                                                            <td className=\"px-6 py-5\">\r\n                                                                <span className=\"text-gray-600 font-bold text-sm tracking-widest\">{med.frequency}</span>\r\n                                                            </td>\r\n                                                            <td className=\"px-6 py-5\">\r\n                                                                <span className=\"font-bold text-gray-800 text-sm whitespace-nowrap\">{med.duration}</span>\r\n                                                            </td>\r\n                                                        </tr>\r\n                                                    ))}\r\n                                                </tbody>\r\n                                            </table>\r\n                                        </div>\r\n                                    </div>\r\n\r\n                                    {/* Tests and Notes Grid */}\r\n                                    <div className=\"grid grid-cols-1 md:grid-cols-2 gap-8 print:grid-cols-2\">\r\n                                        {/* Lab Investigations */}\r\n                                        {prescription.labTests && prescription.labTests.length > 0 && (\r\n                                            <div className=\"space-y-4\">\r\n                                                <div className=\"flex items-center gap-3 border-b-2 border-gray-50 pb-2\">\r\n                                                    <div className=\"w-8 h-8 rounded-lg bg-purple-50 flex items-center justify-center\">\r\n                                                        <FlaskConical className=\"w-4 h-4 text-purple-500\" />\r\n                                                    </div>\r\n                                                    <h3 className=\"text-xs font-black text-gray-800 uppercase tracking-[0.2em]\">Lab Testing</h3>\r\n                                                </div>\r\n                                                <div className=\"space-y-2\">\r\n                                                    {prescription.labTests.map((test: string, i: number) => (\r\n                                                        <div key={i} className=\"flex items-center gap-3 p-3 bg-purple-50/30 rounded-xl border border-purple-100 group\">\r\n                                                            <div className=\"w-6 h-6 rounded-lg bg-purple-100 flex items-center justify-center text-[10px] font-black text-purple-600\">0{i + 1}</div>\r\n                                                            <span className=\"text-sm font-bold text-gray-700\">{test}</span>\r\n                                                        </div>\r\n                                                    ))}\r\n                                                </div>\r\n                                            </div>\r\n                                        )}\r\n\r\n                                        {/* General Advice */}\r\n                                        <div className=\"space-y-4\">\r\n                                            <div className=\"flex items-center gap-3 border-b-2 border-gray-50 pb-2\">\r\n                                                <div className=\"w-8 h-8 rounded-lg bg-amber-50 flex items-center justify-center\">\r\n                                                    <FileText className=\"w-4 h-4 text-amber-500\" />\r\n                                                </div>\r\n                                                <h3 className=\"text-xs font-black text-gray-800 uppercase tracking-[0.2em]\">Medical Advice</h3>\r\n                                            </div>\r\n                                            <div className=\"p-4 bg-amber-50/30 rounded-2xl border border-amber-100 h-full\">\r\n                                                <p className=\"text-sm font-medium text-gray-600 leading-relaxed italic\">\r\n                                                    {prescription.instructions || 'Continue current medications, maintain healthy hydration, and monitor symptoms daily. Contact clinic if condition changes significantly.'}\r\n                                                </p>\r\n                                            </div>\r\n                                        </div>\r\n                                    </div>\r\n\r\n                                    {/* Final Section with Follow-up & Seal */}\r\n                                    <div className=\"pt-10 flex flex-col md:flex-row justify-between items-end gap-10\">\r\n                                        {/* Follow Up Card */}\r\n                                        {prescription.followUpDate && (\r\n                                            <div className=\"w-full md:w-auto p-5 bg-gradient-to-br from-gray-900 to-gray-800 rounded-2xl text-white shadow-xl\">\r\n                                                <p className=\"text-[9px] font-black uppercase tracking-[0.3em] opacity-50 mb-3\">Next Required Visit</p>\r\n                                                <div className=\"flex items-center gap-4\">\r\n                                                    <div className=\"w-12 h-12 rounded-xl bg-white/10 flex flex-col items-center justify-center border border-white/10\">\r\n                                                        <span className=\"text-[10px] font-black uppercase leading-none opacity-60\">\r\n                                                            {new Date(prescription.followUpDate).toLocaleDateString([], { month: 'short' })}\r\n                                                        </span>\r\n                                                        <span className=\"text-lg font-black leading-none mt-1\">\r\n                                                            {new Date(prescription.followUpDate).getDate()}\r\n                                                        </span>\r\n                                                    </div>\r\n                                                    <div>\r\n                                                        <p className=\"text-lg font-black tracking-tight\">{formatDate(prescription.followUpDate)}</p>\r\n                                                        <p className=\"text-[10px] font-medium opacity-60\">Scheduled Check-up</p>\r\n                                                    </div>\r\n                                                </div>\r\n                                            </div>\r\n                                        )}\r\n\r\n                                        {/* Authorized Signature Area */}\r\n                                        <div className=\"text-center print-signature-area\">\r\n                                            <div className=\"inline-block relative\">\r\n                                                {/* Digital Seal Watermark */}\r\n                                                <div className=\"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-32 h-32 border-4 border-emerald-500/10 rounded-full flex items-center justify-center rotate-12 -z-10 select-none\">\r\n                                                    <span className=\"text-[8px] font-black text-emerald-500/20 text-center uppercase\">DIGITALLY SIGNED<br />TAKECARE VERIFIED</span>\r\n                                                </div>\r\n\r\n                                                <div className=\"min-h-[100px] flex items-center justify-center px-4\">\r\n                                                    {prescription.doctorSignature ? (\r\n                                                        <img\r\n                                                            src={prescription.doctorSignature}\r\n                                                            alt=\"Signature\"\r\n                                                            className=\"h-20 w-auto object-contain transition-all hover:scale-105\"\r\n                                                        />\r\n                                                    ) : (\r\n                                                        <div className=\"font-handwriting text-5xl text-gray-300 opacity-20 select-none\">\r\n                                                            {prescription.doctor?.name}\r\n                                                        </div>\r\n                                                    )}\r\n                                                </div>\r\n                                                <div className=\"mt-2 border-t-2 border-gray-900 pt-3\">\r\n                                                    <p className=\"text-sm font-black text-gray-900 uppercase tracking-tighter\">Dr. {prescription.doctor?.name}</p>\r\n                                                    <p className=\"text-[9px] font-black text-gray-400 uppercase tracking-widest mt-0.5\">Authorized Signature</p>\r\n                                                </div>\r\n                                            </div>\r\n                                        </div>\r\n                                    </div>\r\n                                </div>\r\n\r\n                                {/* Micro-footer */}\r\n                                <div className=\"mt-auto px-8 py-6 bg-gray-50 border-t border-gray-100 flex flex-col md:flex-row justify-between items-center gap-4\">\r\n                                    <div className=\"flex items-center gap-3\">\r\n                                        <div className=\"w-8 h-8 rounded bg-[#00A1B0] flex items-center justify-center font-black text-white text-xs\">TC</div>\r\n                                        <div>\r\n                                            <p className=\"text-[10px] font-black text-gray-800 uppercase tracking-tight\">Verified Digital Record</p>\r\n                                            <p className=\"text-[9px] text-gray-400 font-medium\">Blockchain Secured Electronic Health Record</p>\r\n                                        </div>\r\n                                    </div>\r\n                                    <div className=\"text-right flex flex-col items-center md:items-end\">\r\n                                        <p className=\"text-[9px] text-gray-400 font-black uppercase tracking-widest\">Doc Generated On</p>\r\n                                        <p className=\"text-[10px] font-bold text-gray-600\">\r\n                                            {new Date(prescription.createdAt).toLocaleString()}\r\n                                        </p>\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n                        ) : null}\r\n                    </div>\r\n                </motion.div>\r\n            </div>\r\n        </AnimatePresence>\r\n    );\r\n};\r\n\r\nexport default PrescriptionViewModal;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\nithi\\OneDrive\\Documents\\Brototype\\Takecare\\frontend\\src\\components\\common\\ChangePassword.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":29,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":29,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[924,927],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[924,927],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":47,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":47,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1552,1555],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1552,1555],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState } from \"react\";\r\nimport { useForm } from \"react-hook-form\";\r\nimport { toast } from \"sonner\";\r\nimport { FaLock, FaEye, FaEyeSlash } from \"react-icons/fa\";\r\nimport authService from \"../../services/authService\";\r\nimport Input from \"../Input\";\r\nimport Button from \"../Button\";\r\n\r\ninterface ChangePasswordProps {\r\n    role: \"user\" | \"doctor\";\r\n}\r\n\r\nconst ChangePassword: React.FC<ChangePasswordProps> = ({ role }) => {\r\n    const [showOldPassword, setShowOldPassword] = useState(false);\r\n    const [showNewPassword, setShowNewPassword] = useState(false);\r\n    const [showConfirmPassword, setShowConfirmPassword] = useState(false);\r\n    const [loading, setLoading] = useState(false);\r\n\r\n    const {\r\n        register,\r\n        handleSubmit,\r\n        formState: { errors, isValid },\r\n        watch,\r\n        reset\r\n    } = useForm({\r\n        mode: \"onChange\",\r\n    });\r\n\r\n    const onSubmit = async (data: any) => {\r\n        setLoading(true);\r\n        try {\r\n            const response = await authService.changePassword(\r\n                {\r\n                    oldPassword: data.oldPassword,\r\n                    newPassword: data.newPassword,\r\n                    confirmPassword: data.confirmPassword,\r\n                },\r\n                role\r\n            );\r\n\r\n            if (response.success) {\r\n                toast.success(\"Password changed successfully\");\r\n                reset();\r\n            } else {\r\n                toast.error(response.message || \"Failed to change password\");\r\n            }\r\n        } catch (error: any) {\r\n            toast.error(error.message || \"An unexpected error occurred\");\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    const newPassword = watch(\"newPassword\");\r\n\r\n    return (\r\n        <div className=\"w-full max-w-2xl mx-auto\">\r\n            <div className=\"bg-white rounded-2xl shadow-xl p-8 md:p-10 border border-gray-100\">\r\n                <div className=\"flex flex-col items-center mb-8 text-center\">\r\n                    <div className=\"w-16 h-16 bg-[#00A1B0]/10 rounded-full flex items-center justify-center mb-4 text-[#00A1B0]\">\r\n                        <FaLock className=\"text-2xl\" />\r\n                    </div>\r\n                    <h2 className=\"text-3xl font-bold text-gray-800\">Change Password</h2>\r\n                    <p className=\"text-gray-500 mt-2\">Secure your account with a strong password</p>\r\n                </div>\r\n\r\n                <form onSubmit={handleSubmit(onSubmit)} className=\"space-y-6\">\r\n                    {/* Old Password */}\r\n                    <div className=\"relative group\">\r\n                        <Input\r\n                            label=\"Current Password\"\r\n                            type={showOldPassword ? \"text\" : \"password\"}\r\n                            placeholder=\"Enter your current password\"\r\n                            error={errors.oldPassword?.message as string}\r\n                            {...register(\"oldPassword\", {\r\n                                required: \"Current password is required\",\r\n                            })}\r\n                            className=\"pr-12\"\r\n                        />\r\n                        <button\r\n                            type=\"button\"\r\n                            onClick={() => setShowOldPassword(!showOldPassword)}\r\n                            className=\"absolute right-4 top-[44px] text-gray-400 hover:text-[#00A1B0] transition-colors duration-200 z-10 p-1\"\r\n                        >\r\n                            {showOldPassword ? <FaEyeSlash size={18} /> : <FaEye size={18} />}\r\n                        </button>\r\n                    </div>\r\n\r\n                    {/* New Password */}\r\n                    <div className=\"relative group\">\r\n                        <Input\r\n                            label=\"New Password\"\r\n                            type={showNewPassword ? \"text\" : \"password\"}\r\n                            placeholder=\"Enter new password\"\r\n                            error={errors.newPassword?.message as string}\r\n                            {...register(\"newPassword\", {\r\n                                required: \"New password is required\",\r\n                                minLength: {\r\n                                    value: 6,\r\n                                    message: \"Password must be at least 6 characters\",\r\n                                },\r\n                                pattern: {\r\n                                    value: /^(?=.*[A-Z])(?=.*\\d).{6,}$/,\r\n                                    message:\r\n                                        \"Password must include at least one uppercase letter and one number\",\r\n                                },\r\n                            })}\r\n                            className=\"pr-12\"\r\n                        />\r\n                        <button\r\n                            type=\"button\"\r\n                            onClick={() => setShowNewPassword(!showNewPassword)}\r\n                            className=\"absolute right-4 top-[44px] text-gray-400 hover:text-[#00A1B0] transition-colors duration-200 z-10 p-1\"\r\n                        >\r\n                            {showNewPassword ? <FaEyeSlash size={18} /> : <FaEye size={18} />}\r\n                        </button>\r\n                    </div>\r\n\r\n                    {/* Confirm Password */}\r\n                    <div className=\"relative group\">\r\n                        <Input\r\n                            label=\"Confirm New Password\"\r\n                            type={showConfirmPassword ? \"text\" : \"password\"}\r\n                            placeholder=\"Confirm new password\"\r\n                            error={errors.confirmPassword?.message as string}\r\n                            {...register(\"confirmPassword\", {\r\n                                required: \"Please confirm your password\",\r\n                                validate: (value) =>\r\n                                    value === newPassword || \"Passwords do not match\",\r\n                            })}\r\n                            className=\"pr-12\"\r\n                        />\r\n                        <button\r\n                            type=\"button\"\r\n                            onClick={() => setShowConfirmPassword(!showConfirmPassword)}\r\n                            className=\"absolute right-4 top-[44px] text-gray-400 hover:text-[#00A1B0] transition-colors duration-200 z-10 p-1\"\r\n                        >\r\n                            {showConfirmPassword ? <FaEyeSlash size={18} /> : <FaEye size={18} />}\r\n                        </button>\r\n                    </div>\r\n\r\n                    <div className=\"pt-6\">\r\n                        <Button\r\n                            type=\"submit\"\r\n                            loading={loading}\r\n                            disabled={!isValid || loading}\r\n                            className=\"w-full py-3 text-lg font-medium shadow-lg hover:shadow-xl transition-all duration-300 bg-[#00A1B0] hover:bg-[#008f9c] text-white\"\r\n                        >\r\n                            Update Password\r\n                        </Button>\r\n                    </div>\r\n                </form>\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default ChangePassword;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\nithi\\OneDrive\\Documents\\Brototype\\Takecare\\frontend\\src\\components\\common\\ImageCropper.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":28,"column":64,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":28,"endColumn":67,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[800,803],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[800,803],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":38,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":38,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1040,1043],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1040,1043],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":38,"column":72,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":38,"endColumn":75,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1064,1067],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1064,1067],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useCallback } from \"react\";\r\nimport Cropper from \"react-easy-crop\";\r\nimport { getCroppedImg } from \"../../utils/cropImage\";\r\nimport {\r\n    Dialog,\r\n    DialogContent,\r\n    DialogHeader,\r\n    DialogTitle,\r\n} from \"../ui/dialog\";\r\nimport { Button } from \"../ui/button\";\r\nimport { ZoomIn, ZoomOut, Move } from \"lucide-react\";\r\n\r\ninterface ImageCropperProps {\r\n    image: string;\r\n    onCropComplete: (croppedImage: Blob) => void;\r\n    onCancel: () => void;\r\n    aspect?: number;\r\n}\r\n\r\nconst ImageCropper: React.FC<ImageCropperProps> = ({\r\n    image,\r\n    onCropComplete,\r\n    onCancel,\r\n    aspect = 3 / 4,\r\n}) => {\r\n    const [crop, setCrop] = useState({ x: 0, y: 0 });\r\n    const [zoom, setZoom] = useState(1);\r\n    const [croppedAreaPixels, setCroppedAreaPixels] = useState<any>(null);\r\n\r\n    const onCropChange = (crop: { x: number; y: number }) => {\r\n        setCrop(crop);\r\n    };\r\n\r\n    const onZoomChange = (zoom: number) => {\r\n        setZoom(zoom);\r\n    };\r\n\r\n    const onCropAreaComplete = useCallback((_: any, clippedAreaPixels: any) => {\r\n        setCroppedAreaPixels(clippedAreaPixels);\r\n    }, []);\r\n\r\n    const handleCrop = async () => {\r\n        try {\r\n            const croppedImage = await getCroppedImg(image, croppedAreaPixels);\r\n            if (croppedImage) {\r\n                onCropComplete(croppedImage);\r\n            }\r\n        } catch (e) {\r\n            console.error(e);\r\n        }\r\n    };\r\n\r\n    return (\r\n        <Dialog open={true} onOpenChange={(open) => !open && onCancel()}>\r\n            <DialogContent className=\"sm:max-w-[500px] p-0 overflow-hidden bg-white border-none shadow-2xl rounded-3xl\">\r\n                <DialogHeader className=\"px-6 py-4 bg-white border-b border-gray-50\">\r\n                    <DialogTitle className=\"text-lg font-semibold text-gray-800 flex items-center gap-2\">\r\n                        Adjust Profile Photo\r\n                    </DialogTitle>\r\n                    <p className=\"text-[11px] text-gray-400 flex items-center gap-1 mt-0.5\">\r\n                        <Move size={10} /> Drag to position and use slider to zoom\r\n                    </p>\r\n                </DialogHeader>\r\n\r\n                <div className=\"relative w-full h-[380px] bg-[#f8fafc]\">\r\n                    <Cropper\r\n                        image={image}\r\n                        crop={crop}\r\n                        zoom={zoom}\r\n                        aspect={aspect}\r\n                        onCropChange={onCropChange}\r\n                        onZoomChange={onZoomChange}\r\n                        onCropComplete={onCropAreaComplete}\r\n                        classes={{\r\n                            containerClassName: \"rounded-none\",\r\n                            cropAreaClassName: \"border-2 border-white shadow-[0_0_0_9999px_rgba(0,0,0,0.6)]\"\r\n                        }}\r\n                    />\r\n                </div>\r\n\r\n                <div className=\"p-6 bg-white\">\r\n                    <div className=\"flex flex-col gap-6\">\r\n                        <div className=\"space-y-4\">\r\n                            <div className=\"flex items-center justify-between\">\r\n                                <span className=\"text-[10px] font-black uppercase tracking-widest text-[#00A1B0] bg-[#00A1B0]/5 px-2 py-1 rounded\">\r\n                                    3:4 Professional Aspect\r\n                                </span>\r\n                                <span className=\"text-[10px] font-bold text-gray-400\">\r\n                                    {Math.round(zoom * 100)}% Scale\r\n                                </span>\r\n                            </div>\r\n\r\n                            <div className=\"flex items-center gap-3\">\r\n                                <ZoomOut size={16} className=\"text-gray-300\" />\r\n                                <input\r\n                                    type=\"range\"\r\n                                    value={zoom}\r\n                                    min={1}\r\n                                    max={3}\r\n                                    step={0.05}\r\n                                    onChange={(e) => setZoom(Number(e.target.value))}\r\n                                    className=\"flex-1 h-1 bg-gray-100 rounded-full appearance-none cursor-pointer accent-[#00A1B0]\"\r\n                                />\r\n                                <ZoomIn size={16} className=\"text-gray-300\" />\r\n                            </div>\r\n                        </div>\r\n\r\n                        <div className=\"flex gap-4 pt-2\">\r\n                            <Button\r\n                                variant=\"ghost\"\r\n                                onClick={onCancel}\r\n                                className=\"flex-1 h-11 text-gray-500 hover:text-gray-800 hover:bg-gray-50 font-medium rounded-xl\"\r\n                            >\r\n                                Discard\r\n                            </Button>\r\n                            <Button\r\n                                onClick={handleCrop}\r\n                                className=\"flex-[1.5] h-11 bg-[#00A1B0] hover:bg-[#008f9c] text-white font-bold rounded-xl shadow-lg shadow-[#00A1B0]/15 transition-all active:scale-[0.98]\"\r\n                            >\r\n                                Apply Changes\r\n                            </Button>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </DialogContent>\r\n        </Dialog>\r\n    );\r\n};\r\n\r\nexport default ImageCropper;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\nithi\\OneDrive\\Documents\\Brototype\\Takecare\\frontend\\src\\components\\common\\RescheduleModal.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":46,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":46,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1815,1818],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1815,1818],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":47,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":47,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1868,1871],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1868,1871],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useEffect, useState } from 'react';\r\nimport { Card, CardContent, CardDescription, CardFooter, CardHeader, CardTitle } from '../ui/card';\r\nimport { Button } from '../ui/button';\r\nimport { FaCalendarAlt } from 'react-icons/fa';\r\nimport doctorService from '../../services/doctorService';\r\nimport { toast } from 'sonner';\r\nimport type { Slot } from '../../types/appointment.types';\r\n\r\ninterface RescheduleModalProps {\r\n    isOpen: boolean;\r\n    onClose: () => void;\r\n    onConfirm: (slot: Slot, date: Date) => Promise<void>;\r\n    doctorId: string;\r\n    doctorName: string;\r\n    currentDate?: Date;\r\n}\r\n\r\nconst RescheduleModal: React.FC<RescheduleModalProps> = ({ isOpen, onClose, onConfirm, doctorId, doctorName, currentDate }) => {\r\n    const [startDate, setStartDate] = useState(currentDate || new Date());\r\n    const [selectedDay, setSelectedDay] = useState<Date>(currentDate || new Date());\r\n    const [availableSlots, setAvailableSlots] = useState<Slot[]>([]);\r\n    const [loadingSlots, setLoadingSlots] = useState(false);\r\n    const [selectedSlot, setSelectedSlot] = useState<Slot | null>(null);\r\n    const [submitting, setSubmitting] = useState(false);\r\n\r\n    const formatDate = (date: Date) => {\r\n        return {\r\n            day: date.toLocaleDateString('en-US', { weekday: 'long' }),\r\n            date: date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' }),\r\n            fullDate: date\r\n        };\r\n    };\r\n\r\n    const generateDays = (start: Date) => {\r\n        const daysArr = [];\r\n        for (let i = 0; i < 7; i++) {\r\n            const d = new Date(start);\r\n            d.setDate(start.getDate() + i);\r\n            daysArr.push(formatDate(d));\r\n        }\r\n        return daysArr;\r\n    };\r\n\r\n    const days = generateDays(startDate);\r\n\r\n    const groupSlotsByTime = (slots: any[]) => {\r\n        const grouped: { [key: string]: any[] } = {};\r\n        slots.forEach(slot => {\r\n            const hour = parseInt(slot.startTime.split(':')[0]);\r\n            let period = 'Evening';\r\n            if (hour < 12) period = 'Morning';\r\n            else if (hour < 17) period = 'Afternoon';\r\n\r\n            if (!grouped[period]) grouped[period] = [];\r\n            grouped[period].push(slot);\r\n        });\r\n        return grouped;\r\n    };\r\n\r\n    const groupedSlots = groupSlotsByTime(availableSlots);\r\n\r\n    const formatTimeTo12h = (timeStr: string) => {\r\n        if (!timeStr) return 'N/A';\r\n\r\n        return timeStr.split('-').map(part => {\r\n            const [hours, minutes] = part.trim().split(':');\r\n            let h = parseInt(hours);\r\n            const m = minutes || '00';\r\n            const ampm = h >= 12 ? 'PM' : 'AM';\r\n            h = h % 12;\r\n            h = h ? h : 12;\r\n            return `${h}:${m} ${ampm}`;\r\n        }).join(' - ');\r\n    };\r\n\r\n    useEffect(() => {\r\n        const fetchSlots = async () => {\r\n            if (!isOpen || !doctorId || !selectedDay) return;\r\n\r\n            setLoadingSlots(true);\r\n            try {\r\n                const year = selectedDay.getFullYear();\r\n                const month = String(selectedDay.getMonth() + 1).padStart(2, '0');\r\n                const day = String(selectedDay.getDate()).padStart(2, '0');\r\n                const dateStr = `${year}-${month}-${day}`;\r\n\r\n                const response = await doctorService.getAvailableSlots(doctorId, dateStr);\r\n                if (response?.success) {\r\n                    let slots = response.data || [];\r\n\r\n             \r\n                    const now = new Date();\r\n                    const isToday = selectedDay.toDateString() === now.toDateString();\r\n\r\n                    if (isToday) {\r\n                        slots = slots.filter((slot: Slot) => {\r\n                            const [hours, minutes] = slot.startTime.split(':').map(Number);\r\n                            const slotDate = new Date();\r\n                            slotDate.setHours(hours, minutes, 0, 0);\r\n                            return slotDate > now;\r\n                        });\r\n                    }\r\n\r\n                    setAvailableSlots(slots);\r\n                }\r\n            } catch (err) {\r\n                console.error(\"Failed to fetch slots:\", err);\r\n                toast.error(\"Failed to load available slots\");\r\n            } finally {\r\n                setLoadingSlots(false);\r\n            }\r\n        };\r\n\r\n        fetchSlots();\r\n    }, [isOpen, selectedDay, doctorId]);\r\n\r\n    const handleConfirm = async () => {\r\n        if (!selectedSlot || !selectedDay) return;\r\n        setSubmitting(true);\r\n        try {\r\n            await onConfirm(selectedSlot, selectedDay);\r\n            onClose();\r\n        } catch (error) {\r\n            console.error(\"Error confirming reschedule:\", error);\r\n        } finally {\r\n            setSubmitting(false);\r\n        }\r\n    };\r\n\r\n    if (!isOpen) return null;\r\n\r\n    return (\r\n        <div className=\"fixed inset-0 z-50 flex items-center justify-center\">\r\n            <div\r\n                className=\"fixed inset-0 bg-black/50 backdrop-blur-sm\"\r\n                onClick={() => {\r\n                    if (!submitting) onClose();\r\n                }}\r\n            />\r\n\r\n            <div className=\"relative z-50 w-full max-w-2xl mx-4\">\r\n                <Card className=\"max-h-[90vh] overflow-y-auto\">\r\n                    <CardHeader>\r\n                        <CardTitle className=\"flex items-center gap-2\">\r\n                            <FaCalendarAlt className=\"text-[#00A1B0]\" />\r\n                            Reschedule Appointment\r\n                        </CardTitle>\r\n                        <CardDescription>\r\n                            Select a new date and time for your appointment with {doctorName}.\r\n                        </CardDescription>\r\n                    </CardHeader>\r\n\r\n                    <CardContent className=\"space-y-6\">\r\n                        {/* Date Selection - Horizontal Strip */}\r\n                        <div className=\"space-y-4\">\r\n                            <div className=\"flex items-center justify-between\">\r\n                                <label className=\"text-sm font-semibold text-gray-700\">Select Date</label>\r\n                                <input\r\n                                    type=\"date\"\r\n                                    min={new Date().toISOString().split('T')[0]}\r\n                                    value={startDate.toISOString().split('T')[0]}\r\n                                    onChange={(e) => {\r\n                                        const d = new Date(e.target.value);\r\n                                        if (!isNaN(d.getTime())) {\r\n                                            setStartDate(d);\r\n                                            setSelectedDay(d);\r\n                                            setSelectedSlot(null);\r\n                                        }\r\n                                    }}\r\n                                    className=\"text-xs border-gray-200 rounded p-1 focus:ring-[#00A1B0]\"\r\n                                />\r\n                            </div>\r\n\r\n                            <div className=\"bg-gray-50/50 rounded-xl p-4 border border-gray-100\">\r\n                                <div className=\"grid grid-cols-7 gap-2\">\r\n                                    {days.map((item, index) => {\r\n                                        const isSelected = selectedDay.toDateString() === item.fullDate.toDateString();\r\n                                        return (\r\n                                            <div\r\n                                                key={index}\r\n                                                className={`cursor-pointer group text-center p-2 rounded-lg transition-all ${isSelected ? 'bg-white shadow-sm' : 'hover:bg-white/50'\r\n                                                    }`}\r\n                                                onClick={() => {\r\n                                                    setSelectedDay(item.fullDate);\r\n                                                    setSelectedSlot(null);\r\n                                                }}\r\n                                            >\r\n                                                <h4 className={`font-bold text-[10px] uppercase mb-1 transition-colors ${isSelected ? 'text-[#00A1B0]' : 'text-gray-400 group-hover:text-[#00A1B0]'}`}>\r\n                                                    {item.day.slice(0, 3)}\r\n                                                </h4>\r\n                                                <p className={`text-xs font-semibold transition-colors ${isSelected ? 'text-gray-800' : 'text-gray-500 group-hover:text-gray-800'}`}>\r\n                                                    {item.fullDate.getDate()}\r\n                                                </p>\r\n                                                <div className={`h-1 mx-auto mt-1 rounded-full transition-all duration-300 ${isSelected ? 'w-4 bg-[#00A1B0]' : 'w-0'}`}></div>\r\n                                            </div>\r\n                                        );\r\n                                    })}\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n\r\n                        {/* Slot Selection */}\r\n                        <div className=\"space-y-4\">\r\n                            <label className=\"text-sm font-semibold text-gray-700\">Available Slots</label>\r\n                            {loadingSlots ? (\r\n                                <div className=\"flex justify-center py-12\">\r\n                                    <div className=\"animate-spin rounded-full h-10 w-10 border-t-2 border-[#00A1B0]\"></div>\r\n                                </div>\r\n                            ) : availableSlots.length === 0 ? (\r\n                                <div className=\"text-center py-10 bg-gray-50 rounded-xl border border-dashed border-gray-200\">\r\n                                    <p className=\"text-gray-500 text-sm\">No slots available for this date.</p>\r\n                                </div>\r\n                            ) : (\r\n                                <div className=\"space-y-6\">\r\n                                    {Object.entries(groupedSlots).map(([period, slots]) => (\r\n                                        <div key={period} className=\"space-y-3\">\r\n                                            <h4 className=\"text-[#002f33] font-bold text-xs uppercase tracking-wider\">{period}</h4>\r\n                                            <div className=\"flex flex-wrap gap-3\">\r\n                                                {slots.map((slot, index) => {\r\n                                                    const slotKey = slot.slotId || slot.customId || `${slot.startTime}-${slot.endTime}`;\r\n                                                    const isSelected = selectedSlot && (selectedSlot.slotId || selectedSlot.customId || `${selectedSlot.startTime}-${selectedSlot.endTime}`) === slotKey;\r\n                                                    const isAvailable = slot.isAvailable !== false && slot.available !== false;\r\n\r\n                                                    return (\r\n                                                        <button\r\n                                                            key={index}\r\n                                                            type=\"button\"\r\n                                                            disabled={!isAvailable}\r\n                                                            onClick={() => setSelectedSlot(slot)}\r\n                                                            className={`px-4 py-2.5 rounded-md text-xs font-semibold transition-all min-w-[100px] border ${isSelected\r\n                                                                ? 'bg-[#00A1B0] text-white border-[#00A1B0] shadow-md transform scale-105'\r\n                                                                : !isAvailable\r\n                                                                    ? 'bg-red-500 bg-opacity-10 text-red-500 border-red-200 cursor-not-allowed opacity-60'\r\n                                                                    : 'bg-gray-50 text-gray-600 border-gray-200 hover:border-[#00A1B0] hover:bg-white hover:text-[#00A1B0] group-hover:shadow-sm'\r\n                                                                }`}\r\n                                                        >\r\n                                                            {formatTimeTo12h(slot.startTime)} - {formatTimeTo12h(slot.endTime)}\r\n                                                        </button>\r\n                                                    );\r\n                                                })}\r\n                                            </div>\r\n                                        </div>\r\n                                    ))}\r\n                                </div>\r\n                            )}\r\n                        </div>\r\n                    </CardContent>\r\n\r\n                    <CardFooter className=\"justify-end gap-3 border-t pt-6\">\r\n                        <Button\r\n                            variant=\"secondary\"\r\n                            onClick={onClose}\r\n                            disabled={submitting}\r\n                        >\r\n                            Cancel\r\n                        </Button>\r\n                        <Button\r\n                            onClick={handleConfirm}\r\n                            disabled={submitting || !selectedSlot}\r\n                            className=\"bg-[#00A1B0] hover:bg-[#008f9c] text-white\"\r\n                        >\r\n                            {submitting ? 'Rescheduling...' : 'Confirm Reschedule'}\r\n                        </Button>\r\n                    </CardFooter>\r\n                </Card>\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default RescheduleModal;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\nithi\\OneDrive\\Documents\\Brototype\\Takecare\\frontend\\src\\components\\reviews\\ReviewsList.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":74,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":74,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2534,2537],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2534,2537],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":86,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":86,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3025,3028],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3025,3028],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":102,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":102,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3537,3540],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3537,3540],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect, useCallback } from 'react';\r\nimport ReviewCard from './ReviewCard';\r\nimport ReviewForm from './ReviewForm';\r\nimport { Button } from '../ui/button';\r\nimport { Plus, MessageSquare, Star } from 'lucide-react';\r\nimport { toast } from 'sonner';\r\nimport { reviewService } from '../../services/reviewService';\r\nimport { useSelector } from 'react-redux';\r\nimport { selectCurrentUser } from '../../redux/user/userSlice';\r\nimport AlertDialog from '../../components/common/AlertDialog';\r\n\r\ninterface ReviewsListProps {\r\n    doctorId: string;\r\n    isCompletedAppointment?: boolean;\r\n    appointmentId?: string;\r\n}\r\n\r\ninterface Review {\r\n    id: string;\r\n    _id: string;\r\n    patientId: {\r\n        id?: string;\r\n        _id?: string;\r\n        name: string;\r\n        profileImage?: string;\r\n    };\r\n    rating: number;\r\n    comment: string;\r\n    createdAt: string;\r\n    isOwnReview?: boolean;\r\n}\r\n\r\nconst ReviewsList: React.FC<ReviewsListProps> = ({ doctorId, isCompletedAppointment, appointmentId }) => {\r\n    const [reviews, setReviews] = useState<Review[]>([]);\r\n    const [isLoading, setIsLoading] = useState(true);\r\n    const [isFormOpen, setIsFormOpen] = useState(false);\r\n    const [editingReview, setEditingReview] = useState<Review | null>(null);\r\n    const [deleteDialogOpen, setDeleteDialogOpen] = useState(false);\r\n    const [reviewToDelete, setReviewToDelete] = useState<string | null>(null);\r\n    const user = useSelector(selectCurrentUser);\r\n    const currentUserId = user?.id || user?._id;\r\n\r\n    const fetchReviews = useCallback(async () => {\r\n        setIsLoading(true);\r\n        try {\r\n            const data = await reviewService.getDoctorReviews(doctorId);\r\n            setReviews(data || []);\r\n            setIsLoading(false);\r\n        } catch (error) {\r\n            console.error(\"Failed to load reviews:\", error);\r\n            setIsLoading(false);\r\n        }\r\n    }, [doctorId]);\r\n\r\n    useEffect(() => {\r\n        if (doctorId) {\r\n            fetchReviews();\r\n        }\r\n    }, [doctorId, fetchReviews]);\r\n\r\n    const handleAddReview = async (data: { rating: number; comment: string }) => {\r\n        if (!appointmentId) {\r\n            toast.error(\"Appointment reference missing\");\r\n            return;\r\n        }\r\n        try {\r\n            await reviewService.addReview({\r\n                ...data,\r\n                appointmentId,\r\n                doctorId\r\n            });\r\n            toast.success(\"Review added successfully!\");\r\n            fetchReviews();\r\n        } catch (error: any) {\r\n            toast.error(error.response?.data?.message || \"Failed to add review\");\r\n        }\r\n    };\r\n\r\n    const handleEditReview = async (data: { rating: number; comment: string }) => {\r\n        if (!editingReview) return;\r\n        try {\r\n            await reviewService.updateReview(editingReview.id || editingReview._id, data);\r\n            toast.success(\"Review updated successfully!\");\r\n            setEditingReview(null);\r\n            fetchReviews();\r\n        } catch (error: any) {\r\n            toast.error(error.response?.data?.message || \"Failed to update review\");\r\n        }\r\n    };\r\n\r\n    const handleDeleteClick = (id: string) => {\r\n        setReviewToDelete(id);\r\n        setDeleteDialogOpen(true);\r\n    };\r\n\r\n    const confirmDelete = async () => {\r\n        if (!reviewToDelete) return;\r\n        try {\r\n            await reviewService.deleteReview(reviewToDelete);\r\n            toast.success(\"Review deleted successfully!\");\r\n            fetchReviews();\r\n        } catch (error: any) {\r\n            toast.error(error.response?.data?.message || \"Failed to delete review\");\r\n        } finally {\r\n            setDeleteDialogOpen(false);\r\n            setReviewToDelete(null);\r\n        }\r\n    };\r\n\r\n    const stats = {\r\n        average: reviews.length > 0\r\n            ? (reviews.reduce((acc, r) => acc + r.rating, 0) / reviews.length).toFixed(1)\r\n            : \"0.0\",\r\n        total: reviews.length,\r\n        distribution: [5, 4, 3, 2, 1].map(star => {\r\n            if (reviews.length === 0) return 0;\r\n            const count = reviews.filter(r => Math.round(r.rating) === star).length;\r\n            return Math.round((count / reviews.length) * 100);\r\n        })\r\n    };\r\n\r\n    return (\r\n        <div className=\"space-y-8\">\r\n            {/* Review Header & Actions */}\r\n            <div className=\"flex flex-col md:flex-row justify-between items-start md:items-center gap-4\">\r\n                <div>\r\n                    <h3 className=\"text-xl font-bold text-gray-800 flex items-center gap-2\">\r\n                        Patient Feedback\r\n                        <span className=\"text-sm font-normal text-gray-400\">({stats.total} reviews)</span>\r\n                    </h3>\r\n                </div>\r\n\r\n                {isCompletedAppointment && (\r\n                    <Button\r\n                        onClick={() => setIsFormOpen(true)}\r\n                        className=\"bg-[#00A1B0] hover:bg-[#008f9c] text-white rounded-full px-6 flex items-center gap-2 shadow-lg shadow-cyan-100 transition-all hover:scale-105\"\r\n                    >\r\n                        <Plus size={18} />\r\n                        Write a Review\r\n                    </Button>\r\n                )}\r\n            </div>\r\n\r\n            {/* Stats Section */}\r\n            <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-8 p-8 bg-gray-50 rounded-2xl border border-gray-100\">\r\n                <div className=\"flex flex-col items-center justify-center text-center space-y-2 lg:border-r border-gray-200\">\r\n                    <span className=\"text-5xl font-black text-[#00A1B0]\">{stats.average}</span>\r\n                    <div className=\"flex text-yellow-400 gap-1\">\r\n                        {[1, 2, 3, 4, 5].map(i => <Star key={i} size={18} fill={i <= Math.round(Number(stats.average)) ? \"currentColor\" : \"none\"} />)}\r\n                    </div>\r\n                    <p className=\"text-sm text-gray-500 font-medium\">Doctor Rating</p>\r\n                </div>\r\n\r\n                <div className=\"lg:col-span-2 space-y-3\">\r\n                    {[5, 4, 3, 2, 1].map((star, idx) => (\r\n                        <div key={star} className=\"flex items-center gap-4\">\r\n                            <span className=\"text-sm font-bold text-gray-600 w-12\">{star} Star</span>\r\n                            <div className=\"flex-1 h-2 bg-gray-200 rounded-full overflow-hidden\">\r\n                                <div\r\n                                    className=\"h-full bg-yellow-400 rounded-full\"\r\n                                    style={{ width: `${stats.distribution[idx]}%` }}\r\n                                />\r\n                            </div>\r\n                            <span className=\"text-sm font-medium text-gray-400 w-12\">{stats.distribution[idx]}%</span>\r\n                        </div>\r\n                    ))}\r\n                </div>\r\n            </div>\r\n\r\n            {/* Reviews Grid */}\r\n            <div className=\"grid grid-cols-1 gap-6\">\r\n                {isLoading ? (\r\n                    Array.from({ length: 3 }).map((_, i) => (\r\n                        <div key={i} className=\"h-40 bg-gray-50 animate-pulse rounded-2xl border border-gray-100\" />\r\n                    ))\r\n                ) : reviews.length === 0 ? (\r\n                    <div className=\"text-center py-20 bg-gray-50 rounded-2xl border-2 border-dashed border-gray-200\">\r\n                        <div className=\"p-4 bg-white rounded-full w-fit mx-auto shadow-sm mb-4\">\r\n                            <MessageSquare className=\"h-8 w-8 text-gray-300\" />\r\n                        </div>\r\n                        <h4 className=\"text-gray-900 font-bold\">No reviews yet</h4>\r\n                        <p className=\"text-gray-500 text-sm\">Be the first to share your experience!</p>\r\n                    </div>\r\n                ) : (\r\n                    reviews.map((review) => (\r\n                        <ReviewCard\r\n                            key={review.id || review._id}\r\n                            review={{\r\n                                ...review,\r\n                                id: review.id || review._id,\r\n                                isOwnReview: (() => {\r\n                                    const reviewPatId = typeof review.patientId === 'object'\r\n                                        ? (review.patientId._id || review.patientId.id)\r\n                                        : review.patientId;\r\n                                    return String(reviewPatId) === String(currentUserId);\r\n                                })()\r\n                            }}\r\n                            onEdit={() => {\r\n                                setEditingReview(review);\r\n                                setIsFormOpen(true);\r\n                            }}\r\n                            onDelete={() => handleDeleteClick(review.id || review._id)}\r\n                        />\r\n                    ))\r\n                )}\r\n            </div>\r\n\r\n            {/* Review Form Modal */}\r\n            <ReviewForm\r\n                isOpen={isFormOpen}\r\n                onClose={() => {\r\n                    setIsFormOpen(false);\r\n                    setEditingReview(null);\r\n                }}\r\n                onSubmit={editingReview ? handleEditReview : handleAddReview}\r\n                initialData={editingReview ? { rating: editingReview.rating, comment: editingReview.comment } : undefined}\r\n                title={editingReview ? \"Edit Your Feedback\" : \"Add Your Feedback\"}\r\n            />\r\n\r\n            {/* Delete Confirmation Dialog */}\r\n            <AlertDialog\r\n                open={deleteDialogOpen}\r\n                onOpenChange={setDeleteDialogOpen}\r\n                title=\"Delete Review\"\r\n                description=\"Are you sure you want to delete this review? This action cannot be undone.\"\r\n                onConfirm={confirmDelete}\r\n                confirmText=\"Delete\"\r\n                cancelText=\"Cancel\"\r\n                variant=\"destructive\"\r\n            />\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default ReviewsList;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\nithi\\OneDrive\\Documents\\Brototype\\Takecare\\frontend\\src\\components\\ui\\badge.tsx","messages":[{"ruleId":"react-refresh/only-export-components","severity":2,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":36,"column":17,"nodeType":"Identifier","messageId":"namedExport","endLine":36,"endColumn":30}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import * as React from \"react\"\r\nimport { cva, type VariantProps } from \"class-variance-authority\"\r\n\r\nimport { cn } from \"../../lib/utils\"\r\n\r\nconst badgeVariants = cva(\r\n    \"inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2\",\r\n    {\r\n        variants: {\r\n            variant: {\r\n                default:\r\n                    \"border-transparent bg-primary text-primary-foreground hover:bg-primary/80\",\r\n                secondary:\r\n                    \"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80\",\r\n                destructive:\r\n                    \"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80\",\r\n                outline: \"text-foreground\",\r\n            },\r\n        },\r\n        defaultVariants: {\r\n            variant: \"default\",\r\n        },\r\n    }\r\n)\r\n\r\nexport interface BadgeProps\r\n    extends React.HTMLAttributes<HTMLDivElement>,\r\n    VariantProps<typeof badgeVariants> { }\r\n\r\nfunction Badge({ className, variant, ...props }: BadgeProps) {\r\n    return (\r\n        <div className={cn(badgeVariants({ variant }), className)} {...props} />\r\n    )\r\n}\r\n\r\nexport { Badge, badgeVariants }\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\nithi\\OneDrive\\Documents\\Brototype\\Takecare\\frontend\\src\\components\\ui\\button.tsx","messages":[{"ruleId":"react-refresh/only-export-components","severity":2,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":8,"column":10,"nodeType":"Identifier","messageId":"namedExport","endLine":8,"endColumn":24}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import * as React from \"react\"\r\nimport { Slot } from \"@radix-ui/react-slot\"\r\nimport { type VariantProps } from \"class-variance-authority\"\r\n\r\nimport { cn } from \"@/lib/utils\"\r\nimport { buttonVariants } from \"./buttonVariants\"\r\n\r\nexport { buttonVariants }\r\n\r\nexport interface ButtonProps\r\n  extends React.ButtonHTMLAttributes<HTMLButtonElement>,\r\n  VariantProps<typeof buttonVariants> {\r\n  asChild?: boolean\r\n}\r\n\r\nconst Button = React.forwardRef<HTMLButtonElement, ButtonProps>(\r\n  ({ className, variant, size, asChild = false, ...props }, ref) => {\r\n    const Comp = asChild ? Slot : \"button\"\r\n    return (\r\n      <Comp\r\n        className={cn(buttonVariants({ variant, size, className }))}\r\n        ref={ref}\r\n        {...props}\r\n      />\r\n    )\r\n  }\r\n)\r\nButton.displayName = \"Button\"\r\n\r\nexport { Button }\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\nithi\\OneDrive\\Documents\\Brototype\\Takecare\\frontend\\src\\components\\ui\\sidebar.tsx","messages":[{"ruleId":"react-refresh/only-export-components","severity":2,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":764,"column":3,"nodeType":"Identifier","messageId":"namedExport","endLine":764,"endColumn":13}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { PanelLeft } from \"lucide-react\"\n\nimport { useIsMobile } from \"@/hooks/use-mobile\"\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\nimport { Input } from \"@/components/ui/input\"\nimport { Separator } from \"@/components/ui/separator\"\nimport {\n  Sheet,\n  SheetContent,\n  SheetDescription,\n  SheetHeader,\n  SheetTitle,\n} from \"@/components/ui/sheet\"\nimport { Skeleton } from \"@/components/ui/skeleton\"\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipProvider,\n  TooltipTrigger,\n} from \"@/components/ui/tooltip\"\n\nconst SIDEBAR_COOKIE_NAME = \"sidebar_state\"\nconst SIDEBAR_COOKIE_MAX_AGE = 60 * 60 * 24 * 7\nconst SIDEBAR_WIDTH = \"16rem\"\nconst SIDEBAR_WIDTH_MOBILE = \"18rem\"\nconst SIDEBAR_WIDTH_ICON = \"3rem\"\nconst SIDEBAR_KEYBOARD_SHORTCUT = \"b\"\n\ntype SidebarContextProps = {\n  state: \"expanded\" | \"collapsed\"\n  open: boolean\n  setOpen: (open: boolean) => void\n  openMobile: boolean\n  setOpenMobile: (open: boolean) => void\n  isMobile: boolean\n  toggleSidebar: () => void\n}\n\nconst SidebarContext = React.createContext<SidebarContextProps | null>(null)\n\nfunction useSidebar() {\n  const context = React.useContext(SidebarContext)\n  if (!context) {\n    throw new Error(\"useSidebar must be used within a SidebarProvider.\")\n  }\n\n  return context\n}\n\nconst SidebarProvider = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    defaultOpen?: boolean\n    open?: boolean\n    onOpenChange?: (open: boolean) => void\n  }\n>(\n  (\n    {\n      defaultOpen = true,\n      open: openProp,\n      onOpenChange: setOpenProp,\n      className,\n      style,\n      children,\n      ...props\n    },\n    ref\n  ) => {\n    const isMobile = useIsMobile()\n    const [openMobile, setOpenMobile] = React.useState(false)\n\n\n    const [_open, _setOpen] = React.useState(defaultOpen)\n    const open = openProp ?? _open\n    const setOpen = React.useCallback(\n      (value: boolean | ((value: boolean) => boolean)) => {\n        const openState = typeof value === \"function\" ? value(open) : value\n        if (setOpenProp) {\n          setOpenProp(openState)\n        } else {\n          _setOpen(openState)\n        }\n\n        document.cookie = `${SIDEBAR_COOKIE_NAME}=${openState}; path=/; max-age=${SIDEBAR_COOKIE_MAX_AGE}`\n      },\n      [setOpenProp, open]\n    )\n\n    const toggleSidebar = React.useCallback(() => {\n      return isMobile\n        ? setOpenMobile((open) => !open)\n        : setOpen((open) => !open)\n    }, [isMobile, setOpen, setOpenMobile])\n\n    React.useEffect(() => {\n      const handleKeyDown = (event: KeyboardEvent) => {\n        if (\n          event.key === SIDEBAR_KEYBOARD_SHORTCUT &&\n          (event.metaKey || event.ctrlKey)\n        ) {\n          event.preventDefault()\n          toggleSidebar()\n        }\n      }\n\n      window.addEventListener(\"keydown\", handleKeyDown)\n      return () => window.removeEventListener(\"keydown\", handleKeyDown)\n    }, [toggleSidebar])\n\n\n    const state = open ? \"expanded\" : \"collapsed\"\n\n    const contextValue = React.useMemo<SidebarContextProps>(\n      () => ({\n        state,\n        open,\n        setOpen,\n        isMobile,\n        openMobile,\n        setOpenMobile,\n        toggleSidebar,\n      }),\n      [state, open, setOpen, isMobile, openMobile, setOpenMobile, toggleSidebar]\n    )\n\n    return (\n      <SidebarContext.Provider value={contextValue}>\n        <TooltipProvider delayDuration={0}>\n          <div\n            style={\n              {\n                \"--sidebar-width\": SIDEBAR_WIDTH,\n                \"--sidebar-width-icon\": SIDEBAR_WIDTH_ICON,\n                ...style,\n              } as React.CSSProperties\n            }\n            className={cn(\n              \"group/sidebar-wrapper flex min-h-svh w-full has-[[data-variant=inset]]:bg-sidebar\",\n              className\n            )}\n            ref={ref}\n            {...props}\n          >\n            {children}\n          </div>\n        </TooltipProvider>\n      </SidebarContext.Provider>\n    )\n  }\n)\nSidebarProvider.displayName = \"SidebarProvider\"\n\nconst Sidebar = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    side?: \"left\" | \"right\"\n    variant?: \"sidebar\" | \"floating\" | \"inset\"\n    collapsible?: \"offcanvas\" | \"icon\" | \"none\"\n  }\n>(\n  (\n    {\n      side = \"left\",\n      variant = \"sidebar\",\n      collapsible = \"offcanvas\",\n      className,\n      children,\n      ...props\n    },\n    ref\n  ) => {\n    const { isMobile, state, openMobile, setOpenMobile } = useSidebar()\n\n    if (collapsible === \"none\") {\n      return (\n        <div\n          className={cn(\n            \"flex h-full w-[--sidebar-width] flex-col bg-sidebar text-sidebar-foreground\",\n            className\n          )}\n          ref={ref}\n          {...props}\n        >\n          {children}\n        </div>\n      )\n    }\n\n    if (isMobile) {\n      return (\n        <Sheet open={openMobile} onOpenChange={setOpenMobile} {...props}>\n          <SheetContent\n            data-sidebar=\"sidebar\"\n            data-mobile=\"true\"\n            className=\"w-[--sidebar-width] bg-sidebar p-0 text-sidebar-foreground [&>button]:hidden\"\n            style={\n              {\n                \"--sidebar-width\": SIDEBAR_WIDTH_MOBILE,\n              } as React.CSSProperties\n            }\n            side={side}\n          >\n            <SheetHeader className=\"sr-only\">\n              <SheetTitle>Sidebar</SheetTitle>\n              <SheetDescription>Displays the mobile sidebar.</SheetDescription>\n            </SheetHeader>\n            <div className=\"flex h-full w-full flex-col\">{children}</div>\n          </SheetContent>\n        </Sheet>\n      )\n    }\n\n    return (\n      <div\n        ref={ref}\n        className=\"group peer hidden text-sidebar-foreground md:block\"\n        data-state={state}\n        data-collapsible={state === \"collapsed\" ? collapsible : \"\"}\n        data-variant={variant}\n        data-side={side}\n      >\n        {/* This is what handles the sidebar gap on desktop */}\n        <div\n          className={cn(\n            \"relative w-[--sidebar-width] bg-transparent transition-[width] duration-200 ease-linear\",\n            \"group-data-[collapsible=offcanvas]:w-0\",\n            \"group-data-[side=right]:rotate-180\",\n            variant === \"floating\" || variant === \"inset\"\n              ? \"group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)_+_theme(spacing.4))]\"\n              : \"group-data-[collapsible=icon]:w-[--sidebar-width-icon]\"\n          )}\n        />\n        <div\n          className={cn(\n            \"fixed inset-y-0 z-10 hidden h-svh w-[--sidebar-width] transition-[left,right,width] duration-200 ease-linear md:flex\",\n            side === \"left\"\n              ? \"left-0 group-data-[collapsible=offcanvas]:left-[calc(var(--sidebar-width)*-1)]\"\n              : \"right-0 group-data-[collapsible=offcanvas]:right-[calc(var(--sidebar-width)*-1)]\",\n\n            variant === \"floating\" || variant === \"inset\"\n              ? \"p-2 group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)_+_theme(spacing.4)_+2px)]\"\n              : \"group-data-[collapsible=icon]:w-[--sidebar-width-icon] group-data-[side=left]:border-r group-data-[side=right]:border-l\",\n            className\n          )}\n          {...props}\n        >\n          <div\n            data-sidebar=\"sidebar\"\n            className=\"flex h-full w-full flex-col bg-sidebar group-data-[variant=floating]:rounded-lg group-data-[variant=floating]:border group-data-[variant=floating]:border-sidebar-border group-data-[variant=floating]:shadow\"\n          >\n            {children}\n          </div>\n        </div>\n      </div>\n    )\n  }\n)\nSidebar.displayName = \"Sidebar\"\n\nconst SidebarTrigger = React.forwardRef<\n  React.ElementRef<typeof Button>,\n  React.ComponentProps<typeof Button>\n>(({ className, onClick, ...props }, ref) => {\n  const { toggleSidebar } = useSidebar()\n\n  return (\n    <Button\n      ref={ref}\n      data-sidebar=\"trigger\"\n      variant=\"ghost\"\n      size=\"icon\"\n      className={cn(\"h-7 w-7\", className)}\n      onClick={(event) => {\n        onClick?.(event)\n        toggleSidebar()\n      }}\n      {...props}\n    >\n      <PanelLeft />\n      <span className=\"sr-only\">Toggle Sidebar</span>\n    </Button>\n  )\n})\nSidebarTrigger.displayName = \"SidebarTrigger\"\n\nconst SidebarRail = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<\"button\">\n>(({ className, ...props }, ref) => {\n  const { toggleSidebar } = useSidebar()\n\n  return (\n    <button\n      ref={ref}\n      data-sidebar=\"rail\"\n      aria-label=\"Toggle Sidebar\"\n      tabIndex={-1}\n      onClick={toggleSidebar}\n      title=\"Toggle Sidebar\"\n      className={cn(\n        \"absolute inset-y-0 z-20 hidden w-4 -translate-x-1/2 transition-all ease-linear after:absolute after:inset-y-0 after:left-1/2 after:w-[2px] hover:after:bg-sidebar-border group-data-[side=left]:-right-4 group-data-[side=right]:left-0 sm:flex\",\n        \"[[data-side=left]_&]:cursor-w-resize [[data-side=right]_&]:cursor-e-resize\",\n        \"[[data-side=left][data-state=collapsed]_&]:cursor-e-resize [[data-side=right][data-state=collapsed]_&]:cursor-w-resize\",\n        \"group-data-[collapsible=offcanvas]:translate-x-0 group-data-[collapsible=offcanvas]:after:left-full group-data-[collapsible=offcanvas]:hover:bg-sidebar\",\n        \"[[data-side=left][data-collapsible=offcanvas]_&]:-right-2\",\n        \"[[data-side=right][data-collapsible=offcanvas]_&]:-left-2\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarRail.displayName = \"SidebarRail\"\n\nconst SidebarInset = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"main\">\n>(({ className, ...props }, ref) => {\n  return (\n    <main\n      ref={ref}\n      className={cn(\n        \"relative flex w-full flex-1 flex-col bg-background\",\n        \"md:peer-data-[variant=inset]:m-2 md:peer-data-[state=collapsed]:peer-data-[variant=inset]:ml-2 md:peer-data-[variant=inset]:ml-0 md:peer-data-[variant=inset]:rounded-xl md:peer-data-[variant=inset]:shadow\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarInset.displayName = \"SidebarInset\"\n\nconst SidebarInput = React.forwardRef<\n  React.ElementRef<typeof Input>,\n  React.ComponentProps<typeof Input>\n>(({ className, ...props }, ref) => {\n  return (\n    <Input\n      ref={ref}\n      data-sidebar=\"input\"\n      className={cn(\n        \"h-8 w-full bg-background shadow-none focus-visible:ring-2 focus-visible:ring-sidebar-ring\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarInput.displayName = \"SidebarInput\"\n\nconst SidebarHeader = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => {\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"header\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  )\n})\nSidebarHeader.displayName = \"SidebarHeader\"\n\nconst SidebarFooter = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => {\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"footer\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  )\n})\nSidebarFooter.displayName = \"SidebarFooter\"\n\nconst SidebarSeparator = React.forwardRef<\n  React.ElementRef<typeof Separator>,\n  React.ComponentProps<typeof Separator>\n>(({ className, ...props }, ref) => {\n  return (\n    <Separator\n      ref={ref}\n      data-sidebar=\"separator\"\n      className={cn(\"mx-2 w-auto bg-sidebar-border\", className)}\n      {...props}\n    />\n  )\n})\nSidebarSeparator.displayName = \"SidebarSeparator\"\n\nconst SidebarContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => {\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"content\"\n      className={cn(\n        \"flex min-h-0 flex-1 flex-col gap-2 overflow-auto group-data-[collapsible=icon]:overflow-hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarContent.displayName = \"SidebarContent\"\n\nconst SidebarGroup = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => {\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"group\"\n      className={cn(\"relative flex w-full min-w-0 flex-col p-2\", className)}\n      {...props}\n    />\n  )\n})\nSidebarGroup.displayName = \"SidebarGroup\"\n\nconst SidebarGroupLabel = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & { asChild?: boolean }\n>(({ className, asChild = false, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"div\"\n\n  return (\n    <Comp\n      ref={ref}\n      data-sidebar=\"group-label\"\n      className={cn(\n        \"flex h-8 shrink-0 items-center rounded-md px-2 text-xs font-medium text-sidebar-foreground/70 outline-none ring-sidebar-ring transition-[margin,opacity] duration-200 ease-linear focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        \"group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarGroupLabel.displayName = \"SidebarGroupLabel\"\n\nconst SidebarGroupAction = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<\"button\"> & { asChild?: boolean }\n>(({ className, asChild = false, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      ref={ref}\n      data-sidebar=\"group-action\"\n      className={cn(\n        \"absolute right-3 top-3.5 flex aspect-square w-5 items-center justify-center rounded-md p-0 text-sidebar-foreground outline-none ring-sidebar-ring transition-transform hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n\n        \"after:absolute after:-inset-2 after:md:hidden\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarGroupAction.displayName = \"SidebarGroupAction\"\n\nconst SidebarGroupContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    data-sidebar=\"group-content\"\n    className={cn(\"w-full text-sm\", className)}\n    {...props}\n  />\n))\nSidebarGroupContent.displayName = \"SidebarGroupContent\"\n\nconst SidebarMenu = React.forwardRef<\n  HTMLUListElement,\n  React.ComponentProps<\"ul\">\n>(({ className, ...props }, ref) => (\n  <ul\n    ref={ref}\n    data-sidebar=\"menu\"\n    className={cn(\"flex w-full min-w-0 flex-col gap-1\", className)}\n    {...props}\n  />\n))\nSidebarMenu.displayName = \"SidebarMenu\"\n\nconst SidebarMenuItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentProps<\"li\">\n>(({ className, ...props }, ref) => (\n  <li\n    ref={ref}\n    data-sidebar=\"menu-item\"\n    className={cn(\"group/menu-item relative\", className)}\n    {...props}\n  />\n))\nSidebarMenuItem.displayName = \"SidebarMenuItem\"\n\nconst sidebarMenuButtonVariants = cva(\n  \"peer/menu-button flex w-full items-center gap-2 overflow-hidden rounded-md p-2 text-left text-sm outline-none ring-sidebar-ring transition-[width,height,padding] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 group-has-[[data-sidebar=menu-action]]/menu-item:pr-8 aria-disabled:pointer-events-none aria-disabled:opacity-50 data-[active=true]:bg-sidebar-accent data-[active=true]:font-medium data-[active=true]:text-sidebar-accent-foreground data-[state=open]:hover:bg-sidebar-accent data-[state=open]:hover:text-sidebar-accent-foreground group-data-[collapsible=icon]:!size-8 group-data-[collapsible=icon]:!p-2 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0\",\n  {\n    variants: {\n      variant: {\n        default: \"hover:bg-sidebar-accent hover:text-sidebar-accent-foreground\",\n        outline:\n          \"bg-background shadow-[0_0_0_1px_hsl(var(--sidebar-border))] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground hover:shadow-[0_0_0_1px_hsl(var(--sidebar-accent))]\",\n      },\n      size: {\n        default: \"h-8 text-sm\",\n        sm: \"h-7 text-xs\",\n        lg: \"h-12 text-sm group-data-[collapsible=icon]:!p-0\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nconst SidebarMenuButton = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<\"button\"> & {\n    asChild?: boolean\n    isActive?: boolean\n    tooltip?: string | React.ComponentProps<typeof TooltipContent>\n  } & VariantProps<typeof sidebarMenuButtonVariants>\n>(\n  (\n    {\n      asChild = false,\n      isActive = false,\n      variant = \"default\",\n      size = \"default\",\n      tooltip,\n      className,\n      ...props\n    },\n    ref\n  ) => {\n    const Comp = asChild ? Slot : \"button\"\n    const { isMobile, state } = useSidebar()\n\n    const button = (\n      <Comp\n        ref={ref}\n        data-sidebar=\"menu-button\"\n        data-size={size}\n        data-active={isActive}\n        className={cn(sidebarMenuButtonVariants({ variant, size }), className)}\n        {...props}\n      />\n    )\n\n    if (!tooltip) {\n      return button\n    }\n\n    if (typeof tooltip === \"string\") {\n      tooltip = {\n        children: tooltip,\n      }\n    }\n\n    return (\n      <Tooltip>\n        <TooltipTrigger asChild>{button}</TooltipTrigger>\n        <TooltipContent\n          side=\"right\"\n          align=\"center\"\n          hidden={state !== \"collapsed\" || isMobile}\n          {...tooltip}\n        />\n      </Tooltip>\n    )\n  }\n)\nSidebarMenuButton.displayName = \"SidebarMenuButton\"\n\nconst SidebarMenuAction = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<\"button\"> & {\n    asChild?: boolean\n    showOnHover?: boolean\n  }\n>(({ className, asChild = false, showOnHover = false, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      ref={ref}\n      data-sidebar=\"menu-action\"\n      className={cn(\n        \"absolute right-1 top-1.5 flex aspect-square w-5 items-center justify-center rounded-md p-0 text-sidebar-foreground outline-none ring-sidebar-ring transition-transform hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 peer-hover/menu-button:text-sidebar-accent-foreground [&>svg]:size-4 [&>svg]:shrink-0\",\n        \"after:absolute after:-inset-2 after:md:hidden\",\n        \"peer-data-[size=sm]/menu-button:top-1\",\n        \"peer-data-[size=default]/menu-button:top-1.5\",\n        \"peer-data-[size=lg]/menu-button:top-2.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        showOnHover &&\n        \"group-focus-within/menu-item:opacity-100 group-hover/menu-item:opacity-100 data-[state=open]:opacity-100 peer-data-[active=true]/menu-button:text-sidebar-accent-foreground md:opacity-0\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarMenuAction.displayName = \"SidebarMenuAction\"\n\nconst SidebarMenuBadge = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    data-sidebar=\"menu-badge\"\n    className={cn(\n      \"pointer-events-none absolute right-1 flex h-5 min-w-5 select-none items-center justify-center rounded-md px-1 text-xs font-medium tabular-nums text-sidebar-foreground\",\n      \"peer-hover/menu-button:text-sidebar-accent-foreground peer-data-[active=true]/menu-button:text-sidebar-accent-foreground\",\n      \"peer-data-[size=sm]/menu-button:top-1\",\n      \"peer-data-[size=default]/menu-button:top-1.5\",\n      \"peer-data-[size=lg]/menu-button:top-2.5\",\n      \"group-data-[collapsible=icon]:hidden\",\n      className\n    )}\n    {...props}\n  />\n))\nSidebarMenuBadge.displayName = \"SidebarMenuBadge\"\n\nconst SidebarMenuSkeleton = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    showIcon?: boolean\n  }\n>(({ className, showIcon = false, ...props }, ref) => {\n  const width = React.useMemo(() => {\n    return `${Math.floor(Math.random() * 40) + 50}%`\n  }, [])\n\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"menu-skeleton\"\n      className={cn(\"flex h-8 items-center gap-2 rounded-md px-2\", className)}\n      {...props}\n    >\n      {showIcon && (\n        <Skeleton\n          className=\"size-4 rounded-md\"\n          data-sidebar=\"menu-skeleton-icon\"\n        />\n      )}\n      <Skeleton\n        className=\"h-4 max-w-[--skeleton-width] flex-1\"\n        data-sidebar=\"menu-skeleton-text\"\n        style={\n          {\n            \"--skeleton-width\": width,\n          } as React.CSSProperties\n        }\n      />\n    </div>\n  )\n})\nSidebarMenuSkeleton.displayName = \"SidebarMenuSkeleton\"\n\nconst SidebarMenuSub = React.forwardRef<\n  HTMLUListElement,\n  React.ComponentProps<\"ul\">\n>(({ className, ...props }, ref) => (\n  <ul\n    ref={ref}\n    data-sidebar=\"menu-sub\"\n    className={cn(\n      \"mx-3.5 flex min-w-0 translate-x-px flex-col gap-1 border-l border-sidebar-border px-2.5 py-0.5\",\n      \"group-data-[collapsible=icon]:hidden\",\n      className\n    )}\n    {...props}\n  />\n))\nSidebarMenuSub.displayName = \"SidebarMenuSub\"\n\nconst SidebarMenuSubItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentProps<\"li\">\n>(({ ...props }, ref) => <li ref={ref} {...props} />)\nSidebarMenuSubItem.displayName = \"SidebarMenuSubItem\"\n\nconst SidebarMenuSubButton = React.forwardRef<\n  HTMLAnchorElement,\n  React.ComponentProps<\"a\"> & {\n    asChild?: boolean\n    size?: \"sm\" | \"md\"\n    isActive?: boolean\n  }\n>(({ asChild = false, size = \"md\", isActive, className, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"a\"\n\n  return (\n    <Comp\n      ref={ref}\n      data-sidebar=\"menu-sub-button\"\n      data-size={size}\n      data-active={isActive}\n      className={cn(\n        \"flex h-7 min-w-0 -translate-x-px items-center gap-2 overflow-hidden rounded-md px-2 text-sidebar-foreground outline-none ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 aria-disabled:pointer-events-none aria-disabled:opacity-50 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0 [&>svg]:text-sidebar-accent-foreground\",\n        \"data-[active=true]:bg-sidebar-accent data-[active=true]:text-sidebar-accent-foreground\",\n        size === \"sm\" && \"text-xs\",\n        size === \"md\" && \"text-sm\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarMenuSubButton.displayName = \"SidebarMenuSubButton\"\n\n\nexport {\n  Sidebar,\n  SidebarContent,\n  SidebarFooter,\n  SidebarGroup,\n  SidebarGroupAction,\n  SidebarGroupContent,\n  SidebarGroupLabel,\n  SidebarHeader,\n  SidebarInput,\n  SidebarInset,\n  SidebarMenu,\n  SidebarMenuAction,\n  SidebarMenuBadge,\n  SidebarMenuButton,\n  SidebarMenuItem,\n  SidebarMenuSkeleton,\n  SidebarMenuSub,\n  SidebarMenuSubButton,\n  SidebarMenuSubItem,\n  SidebarProvider,\n  SidebarRail,\n  SidebarSeparator,\n  SidebarTrigger,\n  useSidebar,\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\nithi\\OneDrive\\Documents\\Brototype\\Takecare\\frontend\\src\\context\\SocketContext.tsx","messages":[{"ruleId":"react-refresh/only-export-components","severity":2,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":30,"column":14,"nodeType":"Identifier","messageId":"namedExport","endLine":30,"endColumn":23}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { createContext, useContext, useEffect, useState } from 'react';\r\nimport { io, Socket } from 'socket.io-client';\r\nimport { useSelector } from 'react-redux';\r\nimport { selectCurrentUser } from '../redux/user/userSlice';\r\nimport { toast } from 'sonner';\r\nimport ReminderModal from '../components/common/ReminderModal';\r\n\r\ninterface SocketContextType {\r\n    socket: Socket | null;\r\n    onlineUsers: string[];\r\n}\r\n\r\ninterface ReminderData {\r\n    title: string;\r\n    message: string;\r\n    customId: string;\r\n    type?: string;\r\n    appointmentId?: string;\r\n}\r\n\r\ninterface NotificationData {\r\n    title: string;\r\n    message: string;\r\n    type?: 'success' | 'error' | 'warning' | 'info';\r\n}\r\n\r\nconst SocketContext = createContext<SocketContextType | undefined>(undefined);\r\n\r\n\r\nexport const useSocket = () => {\r\n    const context = useContext(SocketContext);\r\n    if (!context) {\r\n        throw new Error('useSocket must be used within a SocketProvider');\r\n    }\r\n    return context;\r\n};\r\n\r\nexport const SocketProvider: React.FC<{ children: React.ReactNode }> = ({ children }) => {\r\n    const [socket, setSocket] = useState<Socket | null>(null);\r\n    const [onlineUsers, setOnlineUsers] = useState<string[]>([]);\r\n    const [reminderData, setReminderData] = useState<ReminderData | null>(null);\r\n    const [isReminderOpen, setIsReminderOpen] = useState(false);\r\n    const user = useSelector(selectCurrentUser);\r\n\r\n    const userId = user?.id || user?._id;\r\n    const userRole = user?.role;\r\n\r\n    useEffect(() => {\r\n        if (userId) {\r\n            const socketUrl = \"https://api.nithin.site\";\r\n            console.log(`[SOCKET] Connecting to: ${socketUrl} with userId: ${userId}`);\r\n\r\n\r\n            fetch(`${socketUrl}/`)\r\n                .then(res => {\r\n                    console.log(`[SOCKET] Backend Health Check: ${res.status}`);\r\n                    if (!res.ok) console.warn(\"[SOCKET] Backend returned non-200 status on root.\");\r\n                })\r\n                .catch(err => {\r\n                    console.error(\"[SOCKET] Backend Unreachable:\", err);\r\n                    toast.error(`Cannot reach Backend at ${socketUrl}. Is it running?`);\r\n                });\r\n\r\n            const newSocket = io(socketUrl, {\r\n                withCredentials: true,\r\n                transports: ['polling', 'websocket'],\r\n                reconnection: true,\r\n                reconnectionAttempts: 10,\r\n                reconnectionDelay: 1000,\r\n                timeout: 20000,\r\n                path: '/socket.io'\r\n            });\r\n\r\n            setSocket(newSocket);\r\n\r\n            newSocket.on('connect', () => {\r\n                console.log(\"[SOCKET] Connected successfully. Socket ID:\", newSocket.id);\r\n                newSocket.emit('join', userId);\r\n            });\r\n\r\n            newSocket.on('online-users', (users: string[]) => {\r\n                setOnlineUsers(users);\r\n            });\r\n\r\n            newSocket.on('user-status', ({ userId: statusUserId, status }: { userId: string, status: 'online' | 'offline' }) => {\r\n                setOnlineUsers(prev => {\r\n                    if (status === 'online') {\r\n                        if (prev.includes(statusUserId)) return prev;\r\n                        return [...prev, statusUserId];\r\n                    } else {\r\n                        return prev.filter(id => id !== statusUserId);\r\n                    }\r\n                });\r\n            });\r\n\r\n            newSocket.on('connect_error', (err) => {\r\n                console.error(\"[SOCKET] Connection Error:\", err.message);\r\n                toast.error(`Socket Connection Failed: ${err.message}`, {\r\n                    description: `Target: ${socketUrl}`,\r\n                    id: \"socket-error-toast\",\r\n                    duration: 5000,\r\n                });\r\n            });\r\n\r\n            newSocket.on('disconnect', (reason) => {\r\n                console.warn(\"Socket Disconnected:\", reason);\r\n                setOnlineUsers([]);\r\n            });\r\n\r\n            const playNotificationSound = () => {\r\n                const audio = new Audio('/notificationSound.mp3');\r\n                audio.play().catch(err => console.debug(\"Autoplay prevented or error playing sound:\", err));\r\n            };\r\n\r\n            newSocket.on('appointment-reminder', (data: ReminderData) => {\r\n                playNotificationSound();\r\n                setReminderData(data);\r\n                setIsReminderOpen(true);\r\n            });\r\n\r\n\r\n            newSocket.on('notification', (notification: NotificationData) => {\r\n                const relevantKeywords = [\r\n                    'appointment', 'reschedule', 'consultation', 'payment',\r\n                    'wallet', 'refund', 'earnings', 'confirmed', 'rejected', 'cancelled', 'request'\r\n                ];\r\n\r\n                const titleLower = notification.title?.toLowerCase() || '';\r\n                const messageLower = notification.message?.toLowerCase() || '';\r\n\r\n                const isRelevant = relevantKeywords.some(keyword =>\r\n                    titleLower.includes(keyword) || messageLower.includes(keyword)\r\n                );\r\n\r\n                if (isRelevant) {\r\n                    playNotificationSound();\r\n                }\r\n\r\n                const toastOptions = {\r\n                    description: notification.message,\r\n                };\r\n\r\n                switch (notification.type) {\r\n                    case 'success':\r\n                        toast.success(notification.title, toastOptions);\r\n                        break;\r\n                    case 'error':\r\n                        toast.error(notification.title, toastOptions);\r\n                        break;\r\n                    case 'warning':\r\n                        toast.warning(notification.title, toastOptions);\r\n                        break;\r\n                    case 'info':\r\n                    default:\r\n                        toast.info(notification.title, toastOptions);\r\n                        break;\r\n                }\r\n            });\r\n            return () => {\r\n                newSocket.disconnect();\r\n            };\r\n        } else {\r\n            if (socket) {\r\n                socket.disconnect();\r\n                setSocket(null);\r\n            }\r\n        }\r\n    }, [userId, userRole]);\r\n\r\n    return (\r\n        <SocketContext.Provider value={{ socket, onlineUsers }}>\r\n            {children}\r\n            <ReminderModal\r\n                isOpen={isReminderOpen}\r\n                onClose={() => setIsReminderOpen(false)}\r\n                data={reminderData}\r\n                onAction={() => {\r\n                    if (reminderData?.appointmentId) {\r\n                        const path = userRole === 'doctor'\r\n                            ? `/doctor/appointments/${reminderData.appointmentId}`\r\n                            : `/patient/appointments/${reminderData.appointmentId}`;\r\n                        window.location.href = path;\r\n                    }\r\n                    setIsReminderOpen(false);\r\n                }}\r\n            />\r\n        </SocketContext.Provider>\r\n    );\r\n};\r\n\r\nexport default SocketProvider;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\nithi\\OneDrive\\Documents\\Brototype\\Takecare\\frontend\\src\\context\\VideoCallContext.tsx","messages":[{"ruleId":"react-refresh/only-export-components","severity":2,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":32,"column":14,"nodeType":"Identifier","messageId":"namedExport","endLine":32,"endColumn":26}],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":14,"column":11,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":14,"endColumn":14,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[559,562],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[559,562],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":17,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":17,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[671,674],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[671,674],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":25,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":25,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[950,953],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[950,953],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":66,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":66,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2212,2215],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2212,2215],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":67,"column":54,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":67,"endColumn":57,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2276,2279],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2276,2279],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":83,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":83,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3092,3095],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3092,3095],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":201,"column":58,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":201,"endColumn":61,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7089,7092],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7089,7092],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/* eslint-disable @typescript-eslint/no-explicit-any */\r\nimport React, { createContext, useContext, useState, useRef, useEffect, useCallback } from 'react';\r\nimport { useSocket } from './SocketContext';\r\nimport { useSelector } from 'react-redux';\r\nimport { selectCurrentUser } from '../redux/user/userSlice';\r\nimport { toast } from 'sonner';\r\n\r\ninterface VideoCallContextType {\r\n    callAccepted: boolean;\r\n    callEnded: boolean;\r\n    stream: MediaStream | undefined;\r\n    name: string;\r\n    setName: React.Dispatch<React.SetStateAction<string>>;\r\n    call: any;\r\n    me: string;\r\n    callUser: (id: string, isRejoin?: boolean) => void;\r\n    answerCall: (incomingData?: any) => void;\r\n    leaveCall: () => void;\r\n    myVideo: React.RefObject<HTMLVideoElement | null>;\r\n    userVideo: React.RefObject<HTMLVideoElement | null>;\r\n    isMuted: boolean;\r\n    isCamOff: boolean;\r\n    toggleMute: () => void;\r\n    toggleCam: () => void;\r\n    incomingCall: any;\r\n    connectionState: RTCIceConnectionState;\r\n}\r\n\r\nconst VideoCallContext = createContext<VideoCallContextType | undefined>(undefined);\r\n\r\n\r\nexport const useVideoCall = () => {\r\n    const context = useContext(VideoCallContext);\r\n    if (!context) {\r\n        throw new Error('useVideoCall must be used within a VideoCallProvider');\r\n    }\r\n    return context;\r\n};\r\n\r\n\r\nconst ICE_SERVERS = {\r\n    iceServers: [\r\n        { urls: 'stun:stun.l.google.com:19302' },\r\n        { urls: 'stun:stun1.l.google.com:19302' },\r\n        { urls: 'stun:stun2.l.google.com:19302' },\r\n        {\r\n            urls: 'turn:openrelay.metered.ca:80',\r\n            username: 'openrelayproject',\r\n            credential: 'openrelayproject'\r\n        },\r\n        {\r\n            urls: 'turn:openrelay.metered.ca:443',\r\n            username: 'openrelayproject',\r\n            credential: 'openrelayproject'\r\n        },\r\n        {\r\n            urls: 'turn:openrelay.metered.ca:443?transport=tcp',\r\n            username: 'openrelayproject',\r\n            credential: 'openrelayproject'\r\n        }\r\n    ]\r\n};\r\n\r\nexport const VideoCallProvider: React.FC<{ children: React.ReactNode }> = ({ children }) => {\r\n    const [stream, setStream] = useState<MediaStream>();\r\n    const [call] = useState<any>({});\r\n    const [incomingCall, setIncomingCall] = useState<any>(null);\r\n    const [callAccepted, setCallAccepted] = useState(false);\r\n    const [callEnded, setCallEnded] = useState(false);\r\n    const [targetUserId, setTargetUserId] = useState<string | null>(null);\r\n    const [name, setName] = useState('');\r\n    const [isMuted, setIsMuted] = useState(false);\r\n    const [isCamOff, setIsCamOff] = useState(false);\r\n    const [connectionState, setConnectionState] = useState<RTCIceConnectionState>('new');\r\n\r\n    const myVideo = useRef<HTMLVideoElement>(null);\r\n    const userVideo = useRef<HTMLVideoElement>(null);\r\n    const connectionRef = useRef<RTCPeerConnection | null>(null);\r\n    const iceCandidatesQueue = useRef<RTCIceCandidateInit[]>([]);\r\n\r\n    const { socket } = useSocket();\r\n    const user = useSelector(selectCurrentUser);\r\n    const me = user?.id || (user as any)?._id;\r\n\r\n\r\n    useEffect(() => {\r\n        if (socket && me) {\r\n            console.log(\"VideoCallContext: Joining socket room\", me);\r\n            socket.emit(\"join\", me);\r\n        }\r\n    }, [socket, me]);\r\n\r\n    useEffect(() => {\r\n        let currentStream: MediaStream | null = null;\r\n        navigator.mediaDevices.getUserMedia({ video: true, audio: true })\r\n            .then((s) => {\r\n                currentStream = s;\r\n                setStream(s);\r\n                if (myVideo.current) {\r\n                    myVideo.current.srcObject = s;\r\n                }\r\n            })\r\n            .catch((err) => {\r\n                console.error(\"Failed to get media stream:\", err);\r\n                toast.error(\"Could not access camera/microphone\");\r\n            });\r\n\r\n        return () => {\r\n            if (currentStream) {\r\n                currentStream.getTracks().forEach(track => track.stop());\r\n            }\r\n        };\r\n    }, []);\r\n\r\n    const createPeerConnection = useCallback((targetId: string) => {\r\n        if (connectionRef.current) {\r\n            console.log(\"Closing existing peer connection before creating new one\");\r\n            connectionRef.current.close();\r\n            connectionRef.current = null;\r\n        }\r\n\r\n        const peer = new RTCPeerConnection(ICE_SERVERS);\r\n\r\n        if (stream) {\r\n            console.log(\"Adding tracks to peer connection from stream:\", stream.id);\r\n            stream.getTracks().forEach(track => peer.addTrack(track, stream));\r\n        } else {\r\n            console.warn(\"createPeerConnection: stream is not available yet!\");\r\n        }\r\n\r\n\r\n        peer.ontrack = (event) => {\r\n            console.log(\"Received remote track:\", event.streams[0].id);\r\n            if (userVideo.current) {\r\n                userVideo.current.srcObject = event.streams[0];\r\n            }\r\n        };\r\n\r\n        peer.oniceconnectionstatechange = () => {\r\n            console.log(\"ICE Connection State Change:\", peer.iceConnectionState);\r\n            setConnectionState(peer.iceConnectionState);\r\n        };\r\n\r\n\r\n        peer.onicecandidate = (event) => {\r\n            if (event.candidate) {\r\n                socket?.emit(\"ice-candidate\", {\r\n                    to: targetId,\r\n                    candidate: event.candidate\r\n                });\r\n            }\r\n        };\r\n\r\n        connectionRef.current = peer;\r\n        return peer;\r\n    }, [stream, socket]);\r\n\r\n    const processIceQueue = useCallback(async () => {\r\n        if (!connectionRef.current || !connectionRef.current.remoteDescription) return;\r\n\r\n        console.log(`Processing ${iceCandidatesQueue.current.length} queued ICE candidates`);\r\n        while (iceCandidatesQueue.current.length > 0) {\r\n            const candidate = iceCandidatesQueue.current.shift();\r\n            if (candidate) {\r\n                try {\r\n                    await connectionRef.current.addIceCandidate(new RTCIceCandidate(candidate));\r\n                } catch (e) {\r\n                    console.error(\"Error adding queued ice candidate:\", e);\r\n                }\r\n            }\r\n        }\r\n    }, []);\r\n\r\n    const callUser = async (id: string, isRejoin: boolean = false) => {\r\n        console.log(`Attempting to call user: ${id}${isRejoin ? ' (REJOIN)' : ''}`);\r\n        setCallEnded(false);\r\n        setCallAccepted(false);\r\n\r\n        if (!socket) {\r\n            console.error(\"Cannot call: Socket is not initialized\");\r\n            toast.error(\"Connection lost. Please refresh.\");\r\n            return;\r\n        }\r\n\r\n        const peer = createPeerConnection(id);\r\n        setTargetUserId(id);\r\n\r\n        const offer = await peer.createOffer();\r\n        await peer.setLocalDescription(offer);\r\n\r\n        console.log(\"Emitting call-user signal to:\", id);\r\n        socket.emit(\"call-user\", {\r\n            userToCall: id,\r\n            signalData: offer,\r\n            from: me,\r\n            name: user?.name,\r\n            isRejoin\r\n        });\r\n    };\r\n\r\n    const answerCall = useCallback(async (incomingData?: any) => {\r\n        setCallEnded(false);\r\n        setCallAccepted(true);\r\n        const isEvent = incomingData && (incomingData.nativeEvent || incomingData.target);\r\n        const callToAnswer = (incomingData && !isEvent) ? incomingData : incomingCall;\r\n\r\n        if (!callToAnswer) {\r\n            console.error(\"answerCall: No call data available\");\r\n            return;\r\n        }\r\n\r\n        setIncomingCall(null);\r\n        setTargetUserId(callToAnswer.from);\r\n\r\n        const peer = createPeerConnection(callToAnswer.from);\r\n\r\n        await peer.setRemoteDescription(new RTCSessionDescription(callToAnswer.signal));\r\n        const answer = await peer.createAnswer();\r\n        await peer.setLocalDescription(answer);\r\n\r\n        socket?.emit(\"answer-call\", {\r\n            signal: answer,\r\n            to: callToAnswer.from\r\n        });\r\n\r\n        processIceQueue();\r\n    }, [incomingCall, createPeerConnection, socket, processIceQueue]);\r\n\r\n    const leaveCall = () => {\r\n        setCallEnded(true);\r\n\r\n        if (connectionRef.current) {\r\n            connectionRef.current.close();\r\n            connectionRef.current = null;\r\n        }\r\n\r\n        const tId = incomingCall?.from || targetUserId;\r\n        console.log(\"leaveCall: Emitting end-call to:\", tId);\r\n\r\n        if (tId) {\r\n            socket?.emit(\"end-call\", { to: tId });\r\n        }\r\n    };\r\n\r\n    const toggleMute = () => {\r\n        if (stream) {\r\n            stream.getAudioTracks().forEach(track => track.enabled = !track.enabled);\r\n            setIsMuted(!isMuted);\r\n        }\r\n    };\r\n\r\n    const toggleCam = () => {\r\n        if (stream) {\r\n            stream.getVideoTracks().forEach(track => track.enabled = !track.enabled);\r\n            setIsCamOff(!isCamOff);\r\n        }\r\n    };\r\n\r\n    useEffect(() => {\r\n        if (!socket) return;\r\n\r\n        socket.on('call-user', ({ from, name: callerName, signal, isRejoin }) => {\r\n            console.log(\"Incoming call from:\", callerName, \"isRejoin:\", isRejoin);\r\n            const callData = { isReceivingCall: true, from, name: callerName, signal, isRejoin };\r\n            setIncomingCall(callData);\r\n        });\r\n\r\n        socket.on('call-accepted', async (signal) => {\r\n            console.log(\"Call accepted, setting remote description\");\r\n            setCallAccepted(true);\r\n            try {\r\n                if (connectionRef.current) {\r\n                    await connectionRef.current.setRemoteDescription(new RTCSessionDescription(signal));\r\n                    processIceQueue();\r\n                }\r\n            } catch (error) {\r\n                console.error(\"Error setting remote description:\", error);\r\n            }\r\n        });\r\n\r\n        socket.on('ice-candidate', async (candidate) => {\r\n            if (!candidate) return;\r\n\r\n            if (connectionRef.current && connectionRef.current.remoteDescription) {\r\n                try {\r\n                    await connectionRef.current.addIceCandidate(new RTCIceCandidate(candidate));\r\n                } catch (error) {\r\n                    console.error(\"Error adding ice candidate:\", error);\r\n                }\r\n            } else {\r\n                console.log(\"Queuing ICE candidate (PC or RemoteDesc not ready)\");\r\n                iceCandidatesQueue.current.push(candidate);\r\n            }\r\n        });\r\n\r\n        socket.on('call-ended', () => {\r\n            setCallEnded(true);\r\n            setCallAccepted(false);\r\n            setIncomingCall(null);\r\n            if (connectionRef.current) {\r\n                connectionRef.current.close();\r\n            }\r\n            connectionRef.current = null;\r\n            toast.info(\"Call ended\");\r\n        });\r\n\r\n        return () => {\r\n            socket.off('call-user');\r\n            socket.off('call-accepted');\r\n            socket.off('ice-candidate');\r\n            socket.off('call-ended');\r\n        };\r\n    }, [socket, answerCall]);\r\n\r\n    useEffect(() => {\r\n        if (incomingCall?.isRejoin && stream && socket) {\r\n            answerCall(incomingCall);\r\n        }\r\n    }, [incomingCall, stream, socket, answerCall]);\r\n\r\n    return (\r\n        <VideoCallContext.Provider value={{\r\n            call,\r\n            callAccepted,\r\n            myVideo,\r\n            userVideo,\r\n            stream,\r\n            name,\r\n            setName,\r\n            callEnded,\r\n            me,\r\n            callUser,\r\n            leaveCall,\r\n            answerCall,\r\n            isMuted,\r\n            isCamOff,\r\n            toggleMute,\r\n            toggleCam,\r\n            incomingCall,\r\n            connectionState\r\n        }}>\r\n            {children}\r\n        </VideoCallContext.Provider>\r\n    );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\nithi\\OneDrive\\Documents\\Brototype\\Takecare\\frontend\\src\\hooks\\useCallRejoin.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":44,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":44,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1666,1669],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1666,1669],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect, useCallback } from 'react';\r\nimport callService, { type RejoinStatus } from '../services/callService';\r\nimport { toast } from 'sonner';\r\n\r\nexport const useCallRejoin = (appointmentId: string | undefined) => {\r\n    const [rejoinStatus, setRejoinStatus] = useState<RejoinStatus>({\r\n        canRejoin: false,\r\n        session: null\r\n    });\r\n    const [isCheckingRejoin, setIsCheckingRejoin] = useState(false);\r\n    const [isRejoining, setIsRejoining] = useState(false);\r\n\r\n    const checkCanRejoin = useCallback(async () => {\r\n        if (!appointmentId) return;\r\n\r\n        setIsCheckingRejoin(true);\r\n        try {\r\n            const response = await callService.getCallStatus(appointmentId);\r\n            setRejoinStatus(response.data);\r\n\r\n            if (response.data.canRejoin) {\r\n                console.log('Can rejoin call:', response.data.session);\r\n            }\r\n        } catch (error) {\r\n            console.error('Error checking rejoin status:', error);\r\n            setRejoinStatus({ canRejoin: false, session: null });\r\n        } finally {\r\n            setIsCheckingRejoin(false);\r\n        }\r\n    }, [appointmentId]);\r\n\r\n    const rejoinCall = useCallback(async () => {\r\n        if (!appointmentId || !rejoinStatus.canRejoin) {\r\n            toast.error('Cannot rejoin call');\r\n            return null;\r\n        }\r\n\r\n        setIsRejoining(true);\r\n        try {\r\n            const response = await callService.rejoinCall(appointmentId);\r\n            toast.success('Rejoined call successfully!');\r\n            setRejoinStatus({ canRejoin: false, session: null });\r\n            return response.data;\r\n        } catch (error: any) {\r\n            console.error('Error rejoining call:', error);\r\n            toast.error(error.response?.data?.message || 'Failed to rejoin call');\r\n            return null;\r\n        } finally {\r\n            setIsRejoining(false);\r\n        }\r\n    }, [appointmentId, rejoinStatus.canRejoin]);\r\n\r\n    const calculateExpiresIn = useCallback(() => {\r\n        if (!rejoinStatus.session?.canRejoinUntil) return 0;\r\n\r\n        const expiryTime = new Date(rejoinStatus.session.canRejoinUntil).getTime();\r\n        const now = new Date().getTime();\r\n        const diffMs = expiryTime - now;\r\n        const diffMinutes = Math.ceil(diffMs / 60000);\r\n\r\n        return Math.max(0, diffMinutes);\r\n    }, [rejoinStatus.session?.canRejoinUntil]);\r\n\r\n    // Check rejoin status on mount\r\n    useEffect(() => {\r\n        checkCanRejoin();\r\n    }, [checkCanRejoin]);\r\n\r\n    // Auto-refresh rejoin status every 10 seconds if can rejoin\r\n    useEffect(() => {\r\n        if (!rejoinStatus.canRejoin) return;\r\n\r\n        const interval = setInterval(() => {\r\n            checkCanRejoin();\r\n        }, 10000);\r\n\r\n        return () => clearInterval(interval);\r\n    }, [rejoinStatus.canRejoin, checkCanRejoin]);\r\n\r\n    return {\r\n        canRejoin: rejoinStatus.canRejoin,\r\n        callSession: rejoinStatus.session,\r\n        isCheckingRejoin,\r\n        isRejoining,\r\n        expiresInMinutes: calculateExpiresIn(),\r\n        rejoinCall,\r\n        checkCanRejoin,\r\n    };\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\nithi\\OneDrive\\Documents\\Brototype\\Takecare\\frontend\\src\\hooks\\useSessionState.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":9,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":9,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[443,446],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[443,446],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":48,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":48,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1822,1825],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1822,1825],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":70,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":70,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2814,2817],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2814,2817],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect, useMemo, useCallback } from 'react';\r\nimport { useSocket } from '../context/SocketContext';\r\nimport { SESSION_STATUS, isSessionActive, isSessionLocked, canExtendSession } from '../utils/constants';\r\nimport type { SessionStatus } from '../utils/constants';\r\nimport type { SessionUIState } from '../types/session.types';\r\n\r\ninterface UseSessionStateProps {\r\n    appointmentId: string | undefined;\r\n    appointment: any;\r\n    isDoctor: boolean;\r\n}\r\n\r\ninterface UseSessionStateReturn extends SessionUIState {\r\n    sessionStatus: SessionStatus;\r\n    isTimeOver: boolean;\r\n    extensionCount: number;\r\n    isPostConsultationWindowOpen: boolean;\r\n    updateSessionStatus: (status: SessionStatus) => Promise<void>;\r\n}\r\n\r\nexport const useSessionState = ({\r\n    appointmentId,\r\n    appointment,\r\n    isDoctor\r\n}: UseSessionStateProps): UseSessionStateReturn => {\r\n    const { socket } = useSocket();\r\n    const [sessionStatus, setSessionStatus] = useState<SessionStatus>(SESSION_STATUS.ACTIVE);\r\n    const [isTimeOver, setIsTimeOver] = useState(false);\r\n    const [extensionCount, setExtensionCount] = useState(0);\r\n\r\n    const isPostConsultationWindowOpen = useMemo(() => {\r\n        if (!appointment?.postConsultationChatWindow) return false;\r\n        const { isActive, expiresAt } = appointment.postConsultationChatWindow;\r\n        if (!isActive || !expiresAt) return false;\r\n        return new Date(expiresAt) > new Date();\r\n    }, [appointment]);\r\n\r\n    useEffect(() => {\r\n        if (appointment?.sessionStatus) {\r\n            setSessionStatus(appointment.sessionStatus);\r\n            setExtensionCount(appointment.extensionCount || 0);\r\n        }\r\n    }, [appointment]);\r\n\r\n    useEffect(() => {\r\n        if (!socket || !appointmentId) return;\r\n\r\n        const handleSessionStatusUpdate = (data: any) => {\r\n            const matchId = appointment?._id || appointmentId;\r\n            const matchCustomId = appointment?.customId;\r\n\r\n            const isMatch =\r\n                data.appointmentId === matchId ||\r\n                String(data.appointmentId) === String(matchId) ||\r\n                (data.customId && matchCustomId && data.customId === matchCustomId) ||\r\n                (data.customId && data.customId === appointmentId) ||\r\n                (data.appointmentId === appointmentId);\r\n\r\n            if (isMatch) {\r\n                setSessionStatus(data.status || data.sessionState?.status);\r\n                if (data.extensionCount !== undefined) {\r\n                    setExtensionCount(data.extensionCount);\r\n                }\r\n                if (data.status === SESSION_STATUS.ACTIVE || data.status === SESSION_STATUS.CONTINUED_BY_DOCTOR) {\r\n                    setIsTimeOver(false);\r\n                }\r\n            }\r\n        };\r\n\r\n        const handleSessionEnded = (data: any) => {\r\n            if (data.appointmentId === (appointment?._id || appointmentId)) {\r\n                setSessionStatus(SESSION_STATUS.ENDED);\r\n                setIsTimeOver(false);\r\n            }\r\n        };\r\n\r\n        socket.on('session-status-updated', handleSessionStatusUpdate);\r\n        socket.on('session-ended', handleSessionEnded);\r\n\r\n        return () => {\r\n            socket.off('session-status-updated', handleSessionStatusUpdate);\r\n            socket.off('session-ended', handleSessionEnded);\r\n        };\r\n    }, [socket, appointmentId, appointment]);\r\n\r\n    const updateSessionStatus = useCallback(async (status: SessionStatus) => {\r\n        if (!appointmentId) return;\r\n        try {\r\n            const { appointmentService } = await import('../services/appointmentService');\r\n            await appointmentService.updateSessionStatus(appointmentId, status);\r\n        } catch (error) {\r\n            console.error('Failed to update session status', error);\r\n        }\r\n    }, [appointmentId]);\r\n\r\n    const canSendMessage = useMemo(() => {\r\n        if (isPostConsultationWindowOpen) return true;\r\n        if (appointment?.TEST_NEEDED) return true;\r\n        if (sessionStatus === SESSION_STATUS.TEST_NEEDED) return true;\r\n        return isSessionActive(sessionStatus);\r\n    }, [sessionStatus, isPostConsultationWindowOpen, appointment]);\r\n\r\n    const canExtend = useMemo(() => {\r\n        return isDoctor && canExtendSession(sessionStatus);\r\n    }, [isDoctor, sessionStatus]);\r\n\r\n    const isLocked = useMemo(() => {\r\n        if (isPostConsultationWindowOpen) return false;\r\n        if (appointment?.TEST_NEEDED) return false;\r\n        if (sessionStatus === SESSION_STATUS.TEST_NEEDED) return false;\r\n        return isSessionLocked(sessionStatus);\r\n    }, [sessionStatus, isPostConsultationWindowOpen, appointment]);\r\n\r\n    const showWaitingModal = useMemo(() => {\r\n        return !isDoctor &&\r\n            isTimeOver &&\r\n            !isPostConsultationWindowOpen &&\r\n            sessionStatus !== SESSION_STATUS.CONTINUED_BY_DOCTOR &&\r\n            sessionStatus !== SESSION_STATUS.ENDED;\r\n    }, [isDoctor, isTimeOver, isPostConsultationWindowOpen, sessionStatus]);\r\n\r\n    const showExtensionModal = useMemo(() => {\r\n        return isDoctor &&\r\n            isTimeOver &&\r\n            sessionStatus === SESSION_STATUS.WAITING_FOR_DOCTOR;\r\n    }, [isDoctor, isTimeOver, sessionStatus]);\r\n\r\n    const showTimeWarning = useMemo(() => {\r\n        return isTimeOver &&\r\n            sessionStatus !== SESSION_STATUS.CONTINUED_BY_DOCTOR &&\r\n            sessionStatus !== SESSION_STATUS.ENDED &&\r\n            !isPostConsultationWindowOpen;\r\n    }, [isTimeOver, sessionStatus, isPostConsultationWindowOpen]);\r\n\r\n    const lockedMessage = useMemo(() => {\r\n        if (!isLocked) return undefined;\r\n\r\n        if (sessionStatus === SESSION_STATUS.ENDED) {\r\n            return 'This consultation has ended. No further messages can be sent.';\r\n        }\r\n\r\n        if (sessionStatus === SESSION_STATUS.WAITING_FOR_DOCTOR) {\r\n            return isDoctor\r\n                ? 'Session time expired. Please extend or end the session.'\r\n                : 'Waiting for doctor to extend or end the session...';\r\n        }\r\n\r\n        return 'This session is currently locked.';\r\n    }, [isLocked, sessionStatus, isDoctor]);\r\n\r\n    return {\r\n        sessionStatus,\r\n        isTimeOver,\r\n        extensionCount,\r\n        isPostConsultationWindowOpen,\r\n        updateSessionStatus,\r\n        canSendMessage,\r\n        canExtend,\r\n        isLocked,\r\n        showWaitingModal,\r\n        showExtensionModal,\r\n        showTimeWarning,\r\n        lockedMessage\r\n    };\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\nithi\\OneDrive\\Documents\\Brototype\\Takecare\\frontend\\src\\pages\\admin\\AdminAppointmentDetailsPage.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":64,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":64,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1885,1888],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1885,1888],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":86,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":86,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2732,2735],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2732,2735],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":129,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":129,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4212,4215],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4212,4215],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":139,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":139,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4452,4455],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4452,4455],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useEffect, useState } from \"react\";\r\nimport { useNavigate, useParams } from \"react-router-dom\";\r\nimport { toast } from \"sonner\";\r\nimport { motion, AnimatePresence } from \"framer-motion\";\r\nimport {\r\n  ArrowLeft,\r\n  Calendar,\r\n  Clock,\r\n  CreditCard,\r\n  Mail,\r\n  Phone,\r\n  Stethoscope,\r\n  User,\r\n  BadgeIndianRupee,\r\n  ShieldCheck,\r\n  X,\r\n} from \"lucide-react\";\r\nimport Sidebar from \"../../components/admin/Sidebar\";\r\nimport TopNav from \"../../components/admin/TopNav\";\r\nimport { appointmentService } from \"../../services/appointmentService\";\r\nimport { Button } from \"../../components/ui/button\";\r\nimport {\r\n  Dialog,\r\n  DialogBody,\r\n  DialogContent,\r\n  DialogDescription,\r\n  DialogFooter,\r\n  DialogHeader,\r\n  DialogTitle,\r\n} from \"../../components/ui/dialog\";\r\nimport { Textarea } from \"../../components/ui/textarea\";\r\nimport { Skeleton } from \"../../components/ui/skeleton\";\r\n\r\nconst getInitials = (name: string) =>\r\n  name\r\n    .split(\" \")\r\n    .filter(Boolean)\r\n    .map((s) => s[0])\r\n    .join(\"\")\r\n    .slice(0, 2)\r\n    .toUpperCase();\r\n\r\nconst getStatusStyles = (status: string) => {\r\n  const s = String(status || \"\").toLowerCase();\r\n  if (s === \"confirmed\") return \"bg-green-100 text-green-700\";\r\n  if (s === \"completed\") return \"bg-blue-100 text-blue-700\";\r\n  if (s === \"cancelled\") return \"bg-gray-200 text-gray-700\";\r\n  if (s === \"rejected\") return \"bg-red-100 text-red-700\";\r\n  return \"bg-yellow-100 text-yellow-700\";\r\n};\r\n\r\nconst formatStatus = (status: string) => {\r\n  const s = String(status || \"\");\r\n  if (!s) return \"Pending\";\r\n  return s.charAt(0).toUpperCase() + s.slice(1);\r\n};\r\n\r\nconst AdminAppointmentDetailsPage: React.FC = () => {\r\n  const { appointmentId } = useParams<{ appointmentId: string }>();\r\n\r\n  const navigate = useNavigate();\r\n  const [sidebarOpen, setSidebarOpen] = useState(false);\r\n\r\n  const [appointment, setAppointment] = useState<any>(null);\r\n  const [loading, setLoading] = useState(false);\r\n  const [cancelReason, setCancelReason] = useState(\"\");\r\n  const [cancelDialogOpen, setCancelDialogOpen] = useState(false);\r\n  const [cancelling, setCancelling] = useState(false);\r\n\r\n  useEffect(() => {\r\n    const fetchDetails = async () => {\r\n      if (!appointmentId) {\r\n        toast.error(\"Missing appointment id\");\r\n        return;\r\n      }\r\n      setLoading(true);\r\n      try {\r\n        const res = await appointmentService.getAppointmentById(appointmentId);\r\n        const payload = res?.data?.appointment ?? res?.data ?? res?.appointment;\r\n        if (!res?.success || !payload) {\r\n          toast.error(res?.message || \"Failed to fetch appointment details\");\r\n          setAppointment(null);\r\n          return;\r\n        }\r\n        setAppointment(payload);\r\n      } catch (e: any) {\r\n        toast.error(e?.response?.data?.message || e?.message || \"Error fetching appointment details\");\r\n        setAppointment(null);\r\n      } finally {\r\n        setLoading(false);\r\n      }\r\n    };\r\n\r\n    fetchDetails();\r\n  }, [appointmentId]);\r\n\r\n  const doctor = appointment?.doctorId ?? appointment?.doctor;\r\n  const doctorUser = doctor?.userId ?? doctor?.user ?? doctor;\r\n  const patient = appointment?.patientId ?? appointment?.patient;\r\n  const patientUser = patient?.userId ?? patient?.user ?? patient;\r\n\r\n  const appointmentDisplayId =\r\n    appointment?.customId ||\r\n    appointment?.id ||\r\n    appointment?._id ||\r\n    appointmentId ||\r\n    \"-\";\r\n\r\n  const canCancel = !!appointment && String(appointment?.status || \"\").toLowerCase() !== \"cancelled\" && String(appointment?.status || \"\").toLowerCase() !== \"completed\";\r\n  const cancelTargetId = String(\r\n    appointment?._id ?? appointment?.id ?? appointmentId ?? appointment?.customId ?? \"\"\r\n  );\r\n\r\n  async function handleCancel(id: string) {\r\n    if (!cancelReason.trim()) {\r\n      toast.error(\"Please enter a cancellation reason\");\r\n      return;\r\n    }\r\n\r\n    try {\r\n      setCancelling(true);\r\n      const res = await appointmentService.cancelAppointment(id, cancelReason.trim());\r\n      if (res?.success === false) {\r\n        toast.error(res?.message || \"Failed to cancel appointment\");\r\n        return;\r\n      }\r\n\r\n      toast.success(res?.message || \"Appointment cancelled\");\r\n      setAppointment((prev: any) =>\r\n        prev\r\n          ? {\r\n            ...prev,\r\n            status: \"cancelled\",\r\n            cancellationReason: cancelReason.trim(),\r\n          }\r\n          : prev\r\n      );\r\n      setCancelDialogOpen(false);\r\n    } catch (e: any) {\r\n      toast.error(\r\n        e?.response?.data?.message || e?.message || \"Error cancelling appointment\"\r\n      );\r\n    } finally {\r\n      setCancelling(false);\r\n    }\r\n  }\r\n\r\n  return (\r\n    <div className=\"flex min-h-screen bg-gray-50\">\r\n\r\n\r\n      <Dialog\r\n        open={cancelDialogOpen}\r\n        onOpenChange={(open) => {\r\n          setCancelDialogOpen(open);\r\n          if (!open) setCancelReason(\"\");\r\n        }}\r\n      >\r\n        <DialogContent className=\"max-w-lg\">\r\n          <DialogHeader className=\"flex flex-row items-start justify-between gap-4\">\r\n            <div className=\"space-y-1.5\">\r\n              <DialogTitle>Cancel appointment</DialogTitle>\r\n              <DialogDescription>\r\n                Please provide a reason for cancelling this appointment.\r\n              </DialogDescription>\r\n            </div>\r\n            <button\r\n              type=\"button\"\r\n              onClick={() => setCancelDialogOpen(false)}\r\n              className=\"w-9 h-9 rounded-full bg-gray-100 text-gray-700 flex items-center justify-center hover:bg-gray-200 transition-colors\"\r\n              title=\"Close\"\r\n            >\r\n              <X size={18} />\r\n            </button>\r\n          </DialogHeader>\r\n\r\n          <DialogBody>\r\n            <label className=\"block text-sm font-semibold text-gray-900 mb-2\">\r\n              Cancellation reason\r\n            </label>\r\n            <Textarea\r\n              value={cancelReason}\r\n              onChange={(e) => setCancelReason(e.target.value)}\r\n              rows={4}\r\n              placeholder=\"Enter reason...\"\r\n            />\r\n          </DialogBody>\r\n\r\n          <DialogFooter>\r\n            <Button\r\n              type=\"button\"\r\n              variant=\"outline\"\r\n              onClick={() => setCancelDialogOpen(false)}\r\n              disabled={cancelling}\r\n            >\r\n              Close\r\n            </Button>\r\n            <Button\r\n              type=\"button\"\r\n              onClick={() => handleCancel(cancelTargetId)}\r\n              disabled={cancelling || !cancelTargetId || !cancelReason.trim()}\r\n              className=\"bg-red-500 text-white hover:bg-red-600\"\r\n            >\r\n              {cancelling ? \"Cancelling...\" : \"Confirm cancel\"}\r\n            </Button>\r\n          </DialogFooter>\r\n        </DialogContent>\r\n      </Dialog>\r\n\r\n      {/* Sidebar - Desktop */}\r\n      <div className=\"hidden lg:block w-64 fixed inset-y-0 left-0 z-50\">\r\n        <Sidebar />\r\n      </div>\r\n\r\n      {/* Sidebar - Mobile Overlay */}\r\n      <AnimatePresence>\r\n        {sidebarOpen && (\r\n          <div className=\"fixed inset-0 z-[60] lg:hidden\">\r\n            {/* Backdrop */}\r\n            <motion.div\r\n              initial={{ opacity: 0 }}\r\n              animate={{ opacity: 1 }}\r\n              exit={{ opacity: 0 }}\r\n              onClick={() => setSidebarOpen(false)}\r\n              className=\"absolute inset-0 bg-slate-900/40 backdrop-blur-sm\"\r\n            />\r\n            {/* Sidebar Content */}\r\n            <motion.div\r\n              initial={{ x: -256 }}\r\n              animate={{ x: 0 }}\r\n              exit={{ x: -256 }}\r\n              transition={{ type: \"spring\", damping: 25, stiffness: 200 }}\r\n              className=\"absolute left-0 top-0 h-full w-64 bg-white shadow-2xl\"\r\n            >\r\n              <Sidebar onMobileClose={() => setSidebarOpen(false)} />\r\n            </motion.div>\r\n          </div>\r\n        )}\r\n      </AnimatePresence>\r\n\r\n      <div className=\"flex-1 flex flex-col lg:pl-64 min-w-0\">\r\n        <TopNav onMenuClick={() => setSidebarOpen(true)} />\r\n\r\n        <main className=\"flex-1 px-3 sm:px-4 md:px-6 lg:px-8 py-4 sm:py-5 md:py-6\">\r\n          <div className=\"w-full max-w-7xl mx-auto\">\r\n            <div className=\"bg-gradient-to-r from-[#e0f7fa] to-[#f0f9ff] rounded-xl border border-gray-100 p-6 sm:p-8 md:p-10\">\r\n              <h1 className=\"text-2xl sm:text-3xl font-bold text-[#002f33] text-center\">\r\n                Appointment Details\r\n              </h1>\r\n            </div>\r\n\r\n            <div className=\"mt-5 sm:mt-6\">\r\n              <button\r\n                type=\"button\"\r\n                onClick={() => navigate(-1)}\r\n                className=\"inline-flex items-center gap-2 text-gray-600 hover:text-[#00A1B0] transition-colors\"\r\n              >\r\n                <ArrowLeft size={18} />\r\n                <span className=\"font-semibold\">Back</span>\r\n              </button>\r\n            </div>\r\n\r\n            {loading ? (\r\n              <div className=\"mt-5 sm:mt-6 space-y-6\">\r\n                <div className=\"bg-white rounded-2xl border border-gray-100 shadow-sm overflow-hidden p-5 sm:p-6\">\r\n                  <div className=\"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 mb-6\">\r\n                    <div className=\"flex items-center gap-3\">\r\n                      <Skeleton className=\"w-10 h-10 rounded-xl\" />\r\n                      <div className=\"space-y-1\">\r\n                        <Skeleton className=\"h-3 w-20\" />\r\n                        <Skeleton className=\"h-4 w-40\" />\r\n                      </div>\r\n                    </div>\r\n                    <div className=\"flex items-center gap-2\">\r\n                      <Skeleton className=\"h-6 w-24 rounded-full\" />\r\n                      <Skeleton className=\"h-6 w-24 rounded-full\" />\r\n                    </div>\r\n                  </div>\r\n                  <div className=\"grid grid-cols-1 lg:grid-cols-12 gap-5\">\r\n                    <div className=\"lg:col-span-4\"><Skeleton className=\"h-64 w-full rounded-2xl border border-gray-100\" /></div>\r\n                    <div className=\"lg:col-span-4\"><Skeleton className=\"h-64 w-full rounded-2xl border border-gray-100\" /></div>\r\n                    <div className=\"lg:col-span-4\"><Skeleton className=\"h-64 w-full rounded-2xl border border-gray-100\" /></div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            ) : appointment ? (\r\n              <div className=\"mt-5 sm:mt-6 grid grid-cols-1 lg:grid-cols-12 gap-6\">\r\n                <div className=\"lg:col-span-12\">\r\n                  <div className=\"bg-white rounded-2xl border border-gray-100 shadow-sm overflow-hidden\">\r\n                    <div className=\"p-5 sm:p-6 border-b border-gray-100 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3\">\r\n                      <div className=\"flex items-center gap-3\">\r\n                        <div className=\"w-10 h-10 rounded-xl bg-[#00A1B0]/10 text-[#00A1B0] flex items-center justify-center font-bold flex-shrink-0\">\r\n                          #\r\n                        </div>\r\n                        <div className=\"min-w-0\">\r\n                          <div className=\"text-sm text-gray-500\">Appointment ID</div>\r\n                          <div className=\"font-semibold text-gray-900 truncate font-mono\">{appointmentDisplayId}</div>\r\n                        </div>\r\n                      </div>\r\n\r\n                      <div className=\"flex items-center gap-2\">\r\n                        <span\r\n                          className={`px-3 py-1 rounded-full text-xs font-semibold ${getStatusStyles(\r\n                            appointment?.status\r\n                          )}`}\r\n                        >\r\n                          {formatStatus(appointment?.status)}\r\n                        </span>\r\n                        <span className=\"px-3 py-1 rounded-full text-xs font-semibold bg-[#00A1B0]/10 text-[#00A1B0]\">\r\n                          {String(appointment?.appointmentType || appointment?.type || \"\").toLowerCase() === \"video\" ? \"Video call\" : \"Chat\"}\r\n                        </span>\r\n                      </div>\r\n                    </div>\r\n\r\n                    <div className=\"p-5 sm:p-6\">\r\n                      <div className=\"grid grid-cols-1 lg:grid-cols-12 gap-5\">\r\n                        <div className=\"lg:col-span-4\">\r\n                          <div className=\"rounded-2xl border border-gray-100 p-4 sm:p-5 h-full\">\r\n                            <div className=\"flex items-center justify-between mb-4\">\r\n                              <div className=\"text-sm font-semibold text-gray-900 flex items-center gap-2\">\r\n                                <Stethoscope size={16} className=\"text-[#00A1B0]\" />\r\n                                Doctor\r\n                              </div>\r\n                              <span className=\"text-xs font-semibold text-gray-400\">#{doctor?.customId}</span>\r\n                            </div>\r\n\r\n                            <div className=\"flex items-center gap-4\">\r\n                              {doctorUser?.profileImage ? (\r\n                                <img\r\n                                  src={doctorUser.profileImage}\r\n                                  alt={doctorUser?.name || \"Doctor\"}\r\n                                  className=\"w-14 h-14 rounded-full aspect-square object-cover border border-gray-200 flex-shrink-0\"\r\n                                />\r\n                              ) : (\r\n                                <div className=\"w-14 h-14 rounded-2xl bg-gradient-to-br from-cyan-400 to-teal-500 text-white flex items-center justify-center font-bold\">\r\n                                  {getInitials(doctorUser?.name || \"-\")}\r\n                                </div>\r\n                              )}\r\n\r\n                              <div className=\"min-w-0\">\r\n                                <div className=\"font-semibold text-gray-900 truncate\">\r\n                                  {doctorUser?.name || \"-\"}\r\n                                </div>\r\n                                <div className=\"text-xs text-gray-500 truncate\">\r\n                                  {doctor?.specialty || doctorUser?.specialty || \"Doctor\"}\r\n                                </div>\r\n                              </div>\r\n                            </div>\r\n\r\n                            <div className=\"mt-4 space-y-2 text-sm\">\r\n                              <div className=\"flex items-center gap-2 text-gray-600\">\r\n                                <Mail size={14} className=\"text-gray-400\" />\r\n                                <span className=\"truncate\">{doctorUser?.email || \"-\"}</span>\r\n                              </div>\r\n                              <div className=\"flex items-center gap-2 text-gray-600\">\r\n                                <Phone size={14} className=\"text-gray-400\" />\r\n                                <span className=\"truncate\">{doctorUser?.phone || \"-\"}</span>\r\n                              </div>\r\n                            </div>\r\n                          </div>\r\n                        </div>\r\n\r\n                        <div className=\"lg:col-span-4\">\r\n                          <div className=\"rounded-2xl border border-gray-100 p-4 sm:p-5 h-full\">\r\n                            <div className=\"text-sm font-semibold text-gray-900 mb-4 flex items-center gap-2\">\r\n                              <ShieldCheck size={16} className=\"text-[#00A1B0]\" />\r\n                              Appointment Info\r\n                            </div>\r\n\r\n                            <div className=\"grid grid-cols-2 gap-3 text-sm\">\r\n                              <div className=\"rounded-xl bg-gray-50 border border-gray-100 p-3\">\r\n                                <div className=\"text-xs text-gray-500 mb-1 flex items-center gap-2\">\r\n                                  <Calendar size={14} className=\"text-gray-400\" />\r\n                                  Date\r\n                                </div>\r\n                                <div className=\"font-semibold text-gray-900\">\r\n                                  {appointment?.appointmentDate\r\n                                    ? new Date(appointment.appointmentDate).toLocaleDateString(undefined, {\r\n                                      day: \"2-digit\",\r\n                                      month: \"short\",\r\n                                      year: \"numeric\",\r\n                                    })\r\n                                    : \"-\"}\r\n                                </div>\r\n                              </div>\r\n\r\n                              <div className=\"rounded-xl bg-gray-50 border border-gray-100 p-3\">\r\n                                <div className=\"text-xs text-gray-500 mb-1 flex items-center gap-2\">\r\n                                  <Clock size={14} className=\"text-gray-400\" />\r\n                                  Time\r\n                                </div>\r\n                                <div className=\"font-semibold text-gray-900\">{appointment?.appointmentTime || appointment?.time || \"-\"}</div>\r\n                              </div>\r\n\r\n                              <div className=\"rounded-xl bg-gray-50 border border-gray-100 p-3\">\r\n                                <div className=\"text-xs text-gray-500 mb-1\">Department</div>\r\n                                <div className=\"font-semibold text-gray-900\">{doctor?.specialty}</div>\r\n                              </div>\r\n\r\n                              <div className=\"rounded-xl bg-gray-50 border border-gray-100 p-3\">\r\n                                <div className=\"text-xs text-gray-500 mb-1\">Visit Type</div>\r\n                                <div className=\"font-semibold text-gray-900\">{appointment?.appointmentType || \"-\"}</div>\r\n                              </div>\r\n\r\n                              <div className=\"rounded-xl bg-gray-50 border border-gray-100 p-3\">\r\n                                <div className=\"text-xs text-gray-500 mb-1 flex items-center gap-2\">\r\n                                  <BadgeIndianRupee size={14} className=\"text-gray-400\" />\r\n                                  Price\r\n                                </div>\r\n                                <div className=\"font-semibold text-gray-900\">Γé╣{appointment?.consultationFees ?? appointment?.fees ?? 0}</div>\r\n                              </div>\r\n\r\n                              <div className=\"rounded-xl bg-gray-50 border border-gray-100 p-3\">\r\n                                <div className=\"text-xs text-gray-500 mb-1 flex items-center gap-2\">\r\n                                  <CreditCard size={14} className=\"text-gray-400\" />\r\n                                  Payment\r\n                                </div>\r\n                                <div className=\"font-semibold text-gray-900 capitalize\">\r\n                                  {appointment?.paymentStatus || appointment?.payment?.status || \"-\"}\r\n                                </div>\r\n                              </div>\r\n                            </div>\r\n\r\n                            <div className=\"mt-4\">\r\n                              <Button\r\n                                type=\"button\"\r\n                                onClick={() => {\r\n                                  setCancelReason(\"\");\r\n                                  setCancelDialogOpen(true);\r\n                                }}\r\n                                disabled={!canCancel}\r\n                                className=\"w-full bg-red-500 text-white hover:bg-red-600\"\r\n                              >\r\n                                Cancel\r\n                              </Button>\r\n                            </div>\r\n                          </div>\r\n                        </div>\r\n\r\n                        <div className=\"lg:col-span-4\">\r\n                          <div className=\"rounded-2xl border border-gray-100 p-4 sm:p-5 h-full\">\r\n                            <div className=\"flex items-center justify-between mb-4\">\r\n                              <div className=\"text-sm font-semibold text-gray-900 flex items-center gap-2\">\r\n                                <User size={16} className=\"text-[#00A1B0]\" />\r\n                                Patient\r\n                              </div>\r\n                              <span className=\"text-xs font-semibold text-gray-400\">#{patient?.customId || patient?.id || patient?._id || \"-\"}</span>\r\n                            </div>\r\n\r\n                            <div className=\"flex items-center gap-4\">\r\n                              {patientUser?.profileImage ? (\r\n                                <img\r\n                                  src={patientUser.profileImage}\r\n                                  alt={patientUser?.name || \"Patient\"}\r\n                                  className=\"w-14 h-14 rounded-full aspect-square object-cover border border-gray-200 flex-shrink-0\"\r\n                                />\r\n                              ) : (\r\n                                <div className=\"w-14 h-14 rounded-2xl bg-gradient-to-br from-yellow-400 to-orange-500 text-white flex items-center justify-center font-bold\">\r\n                                  {getInitials(patientUser?.name || \"-\")}\r\n                                </div>\r\n                              )}\r\n\r\n                              <div className=\"min-w-0\">\r\n                                <div className=\"font-semibold text-gray-900 truncate\">\r\n                                  {patientUser?.name || \"-\"}\r\n                                </div>\r\n                                <div className=\"text-xs text-gray-500 truncate\">\r\n                                  {\"Patient\"}\r\n                                </div>\r\n                              </div>\r\n                            </div>\r\n\r\n                            <div className=\"mt-4 space-y-2 text-sm\">\r\n                              <div className=\"flex items-center gap-2 text-gray-600\">\r\n                                <Mail size={14} className=\"text-gray-400\" />\r\n                                <span className=\"truncate\">{patientUser?.email || \"-\"}</span>\r\n                              </div>\r\n                              <div className=\"flex items-center gap-2 text-gray-600\">\r\n                                <Phone size={14} className=\"text-gray-400\" />\r\n                                <span className=\"truncate\">{patientUser?.phone || \"-\"}</span>\r\n                              </div>\r\n                            </div>\r\n                          </div>\r\n                        </div>\r\n                      </div>\r\n\r\n                      <div className=\"mt-5 grid grid-cols-1 md:grid-cols-3 gap-3\">\r\n                        <div className=\"rounded-xl border border-gray-100 bg-gray-50 p-4\">\r\n                          <div className=\"text-xs text-gray-500 mb-1\">Appointment Date & Time</div>\r\n                          <div className=\"font-semibold text-gray-900\">\r\n                            {appointment?.appointmentDate\r\n                              ? new Date(appointment.appointmentDate).toLocaleDateString(undefined, {\r\n                                day: \"2-digit\",\r\n                                month: \"short\",\r\n                                year: \"numeric\",\r\n                              })\r\n                              : \"-\"}\r\n                            {\" ┬╖ \"}\r\n                            {appointment?.appointmentTime || appointment?.time || \"-\"}\r\n                          </div>\r\n                        </div>\r\n                        <div className=\"rounded-xl border border-gray-100 bg-gray-50 p-4\">\r\n                          <div className=\"text-xs text-gray-500 mb-1\">Type of Appointment</div>\r\n                          <div className=\"font-semibold text-gray-900 capitalize\">\r\n                            {appointment?.appointmentType || appointment?.type || \"-\"}\r\n                          </div>\r\n                        </div>\r\n                        <div className=\"rounded-xl border border-gray-100 bg-gray-50 p-4\">\r\n                          <div className=\"text-xs text-gray-500 mb-1\">Department</div>\r\n                          <div className=\"font-semibold text-gray-900\">{doctor?.specialty || appointment?.department || \"-\"}</div>\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            ) : (\r\n              <div className=\"mt-6 text-center text-gray-500\">No appointment details found.</div>\r\n            )}\r\n          </div>\r\n        </main>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default AdminAppointmentDetailsPage;\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\nithi\\OneDrive\\Documents\\Brototype\\Takecare\\frontend\\src\\pages\\admin\\AppointmentsListPage.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":112,"column":22,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":112,"endColumn":25,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3347,3350],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3347,3350],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":124,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":124,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3849,3852],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3849,3852],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useEffect, useMemo, useState, useCallback } from \"react\";\r\nimport { toast } from \"sonner\";\r\nimport Sidebar from \"../../components/admin/Sidebar\";\r\nimport TopNav from \"../../components/admin/TopNav\";\r\nimport { appointmentService } from \"../../services/appointmentService\";\r\nimport { ChevronLeft, ChevronRight, Eye } from \"lucide-react\";\r\nimport { useNavigate } from \"react-router-dom\";\r\nimport { motion, AnimatePresence } from \"framer-motion\";\r\n\r\ntype Gender = \"male\" | \"female\" | \"other\";\r\n\r\ninterface PopulatedUser {\r\n  id?: string;\r\n  customId?: string;\r\n  name?: string;\r\n  email?: string;\r\n  phone?: string;\r\n  profileImage?: string | null;\r\n  gender?: Gender | null;\r\n  dob?: string | null;\r\n}\r\n\r\ninterface PopulatedDoctor {\r\n  id?: string;\r\n  customId?: string;\r\n  specialty?: string;\r\n  userId?: {\r\n    name?: string;\r\n    email?: string;\r\n    phone?: string;\r\n    profileImage?: string | null;\r\n  } | null;\r\n}\r\n\r\ninterface Appointment {\r\n  id?: string;\r\n  customId?: string;\r\n  patientId?: PopulatedUser | null;\r\n  doctorId?: PopulatedDoctor | null;\r\n  appointmentDate?: string;\r\n  appointmentTime?: string;\r\n  consultationFees?: number;\r\n  status?: string;\r\n}\r\n\r\nconst calcAge = (dob?: string | null): number | null => {\r\n  if (!dob) return null;\r\n  const d = new Date(dob);\r\n  if (Number.isNaN(d.getTime())) return null;\r\n  const diff = Date.now() - d.getTime();\r\n  const ageDt = new Date(diff);\r\n  return Math.abs(ageDt.getUTCFullYear() - 1970);\r\n};\r\n\r\nconst getInitials = (name?: string) => {\r\n  if (!name) return \"??\";\r\n  return name\r\n    .split(\" \")\r\n    .filter(Boolean)\r\n    .map((s) => s[0])\r\n    .join(\"\")\r\n    .slice(0, 2)\r\n    .toUpperCase();\r\n};\r\n\r\nconst getStatusBadgeClasses = (status?: string) => {\r\n  const s = (status || \"\").toLowerCase();\r\n  if (s === \"confirmed\") return \"bg-green-100 text-green-700\";\r\n  if (s === \"completed\") return \"bg-blue-100 text-blue-700\";\r\n  if (s === \"cancelled\") return \"bg-gray-200 text-gray-700\";\r\n  if (s === \"rejected\") return \"bg-red-100 text-red-700\";\r\n  return \"bg-yellow-100 text-yellow-700\";\r\n};\r\n\r\nconst formatStatus = (status?: string) => {\r\n  if (!status) return \"Pending\";\r\n  return status.charAt(0).toUpperCase() + status.slice(1);\r\n};\r\n\r\nconst AdminAppointmentsListPage: React.FC = () => {\r\n  const [appointments, setAppointments] = useState<Appointment[]>([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [page, setPage] = useState(1);\r\n  const [totalPages, setTotalPages] = useState(1);\r\n  const [sidebarOpen, setSidebarOpen] = useState(false);\r\n  const [search, setSearch] = useState(\"\");\r\n  const [status, setStatus] = useState(\"all\");\r\n  const [debouncedSearch, setDebouncedSearch] = useState(\"\");\r\n  const limit = 5;\r\n  const navigate = useNavigate();\r\n\r\n  useEffect(() => {\r\n    const timer = setTimeout(() => {\r\n      setDebouncedSearch(search);\r\n      setPage(1);\r\n    }, 500);\r\n    return () => clearTimeout(timer);\r\n  }, [search]);\r\n\r\n  const navigateToAppointmentDetails = (apt: Appointment) => {\r\n    const appointmentId = apt.id || apt.customId;\r\n    if (!appointmentId) {\r\n      toast.error(\"Missing appointment id\");\r\n      return;\r\n    }\r\n    navigate(`/admin/appointment/${appointmentId}`);\r\n  };\r\n\r\n  const fetchAppointments = useCallback(async (currentPage: number) => {\r\n    setLoading(true);\r\n    try {\r\n      const filters: any = {};\r\n      if (debouncedSearch) filters.search = debouncedSearch;\r\n      if (status !== \"all\") filters.status = status;\r\n\r\n      const res = await appointmentService.getAllAppointments(currentPage, limit, filters);\r\n      if (res?.success && res?.data) {\r\n        const data = res.data;\r\n        setAppointments(data.appointments || []);\r\n        setTotalPages(data.totalPages || 1);\r\n      } else {\r\n        toast.error(res?.message || \"Failed to fetch appointments\");\r\n      }\r\n    } catch (e: any) {\r\n      toast.error(e?.response?.data?.message || e?.message || \"Error fetching appointments\");\r\n    }\r\n    setLoading(false);\r\n  }, [debouncedSearch, status, limit]);\r\n\r\n\r\n  useEffect(() => {\r\n    fetchAppointments(page);\r\n  }, [page, fetchAppointments]);\r\n\r\n  const pagesToShow = useMemo(() => {\r\n    const items: number[] = [];\r\n    const start = Math.max(1, page - 2);\r\n    const end = Math.min(totalPages, page + 2);\r\n    for (let p = start; p <= end; p++) items.push(p);\r\n    return items;\r\n  }, [page, totalPages]);\r\n\r\n  const formatDate = (value?: string) => {\r\n    if (!value) return \"-\";\r\n    const d = new Date(value);\r\n    if (Number.isNaN(d.getTime())) return \"-\";\r\n    return d.toLocaleDateString(undefined, {\r\n      day: \"2-digit\",\r\n      month: \"short\",\r\n      year: \"numeric\",\r\n    });\r\n  };\r\n\r\n  return (\r\n    <div className=\"flex min-h-screen bg-gray-50 no-scrollbar\">\r\n      {/* Sidebar - Desktop */}\r\n      <div className=\"hidden lg:block w-64 fixed inset-y-0 left-0 z-50\">\r\n        <Sidebar />\r\n      </div>\r\n\r\n      {/* Sidebar - Mobile Overlay */}\r\n      <AnimatePresence>\r\n        {sidebarOpen && (\r\n          <div className=\"fixed inset-0 z-[60] lg:hidden\">\r\n            {/* Backdrop */}\r\n            <motion.div\r\n              initial={{ opacity: 0 }}\r\n              animate={{ opacity: 1 }}\r\n              exit={{ opacity: 0 }}\r\n              onClick={() => setSidebarOpen(false)}\r\n              className=\"absolute inset-0 bg-slate-900/40 backdrop-blur-sm\"\r\n            />\r\n            {/* Sidebar Content */}\r\n            <motion.div\r\n              initial={{ x: -256 }}\r\n              animate={{ x: 0 }}\r\n              exit={{ x: -256 }}\r\n              transition={{ type: \"spring\", damping: 25, stiffness: 200 }}\r\n              className=\"absolute left-0 top-0 h-full w-64 bg-white shadow-2xl\"\r\n            >\r\n              <Sidebar onMobileClose={() => setSidebarOpen(false)} />\r\n            </motion.div>\r\n          </div>\r\n        )}\r\n      </AnimatePresence>\r\n\r\n      <div className=\"flex-1 flex flex-col lg:pl-64 min-w-0\">\r\n        <TopNav onMenuClick={() => setSidebarOpen(true)} />\r\n\r\n        <main className=\"flex-1 px-3 sm:px-4 md:px-6 lg:px-8 py-4 sm:py-5 md:py-6\">\r\n          <div className=\"w-full max-w-7xl mx-auto\">\r\n\r\n            {/* Header */}\r\n            <div className=\"bg-white rounded-xl shadow-sm border border-gray-100 p-6 mb-6\">\r\n              <div className=\"flex flex-col md:flex-row md:items-center justify-between gap-4\">\r\n                <div>\r\n                  <h1 className=\"text-2xl font-bold text-gray-800\">Appointments</h1>\r\n                  <p className=\"text-sm text-gray-500\">Manage all patient appointments</p>\r\n                </div>\r\n\r\n                <div className=\"flex flex-col sm:flex-row gap-3\">\r\n                  <input\r\n                    type=\"text\"\r\n                    placeholder=\"Search patient, doctor...\"\r\n                    value={search}\r\n                    onChange={(e) => setSearch(e.target.value)}\r\n                    className=\"w-full sm:w-64 pl-4 pr-10 py-2 border rounded-lg focus:ring-2 focus:ring-cyan-400 focus:outline-none text-sm\"\r\n                  />\r\n\r\n                  <select\r\n                    value={status}\r\n                    onChange={(e) => {\r\n                      setStatus(e.target.value);\r\n                      setPage(1);\r\n                    }}\r\n                    className=\"px-4 py-2 border rounded-lg focus:ring-2 focus:ring-cyan-400 focus:outline-none text-sm bg-white\"\r\n                  >\r\n                    <option value=\"all\">All Status</option>\r\n                    <option value=\"pending\">Pending</option>\r\n                    <option value=\"confirmed\">Confirmed</option>\r\n                    <option value=\"completed\">Completed</option>\r\n                    <option value=\"cancelled\">Cancelled</option>\r\n                    <option value=\"rejected\">Rejected</option>\r\n                  </select>\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n            <div className=\"bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden\">\r\n              {loading ? (\r\n                <div className=\"p-12 text-center text-gray-500\">Loading appointments...</div>\r\n              ) : appointments.length === 0 ? (\r\n                <div className=\"p-12 text-center text-gray-500\">No appointments found.</div>\r\n              ) : (\r\n                <>\r\n                  <div className=\"lg:hidden p-3 sm:p-4 space-y-3\">\r\n                    {appointments.map((apt, idx) => {\r\n                      const patient = apt.patientId || null;\r\n                      const doctor = apt.doctorId || null;\r\n\r\n                      const patientName = patient?.name || \"-\";\r\n                      const patientEmail = patient?.email || \"-\";\r\n                      const age = calcAge(patient?.dob);\r\n                      const gender = patient?.gender ? String(patient.gender) : \"-\";\r\n                      const department = doctor?.specialty || \"-\";\r\n                      const doctorName = doctor?.userId?.name || \"-\";\r\n                      const fees = typeof apt.consultationFees === \"number\" ? `Γé╣${apt.consultationFees}` : \"-\";\r\n                      const statusLabel = formatStatus(apt.status);\r\n                      const serial = (page - 1) * limit + (idx + 1);\r\n\r\n                      return (\r\n                        <div\r\n                          key={apt.id || apt.customId || idx}\r\n                          className=\"border border-gray-100 rounded-xl p-4 shadow-sm\"\r\n                        >\r\n                          <div className=\"flex items-start justify-between gap-4\">\r\n                            <div className=\"flex items-center gap-3 min-w-0\">\r\n                              {patient?.profileImage ? (\r\n                                <img\r\n                                  src={patient.profileImage}\r\n                                  alt={patientName}\r\n                                  className=\"w-10 h-10 rounded-full object-cover border border-gray-200 flex-shrink-0 aspect-square\"\r\n                                />\r\n                              ) : (\r\n                                <div className=\"w-10 h-10 rounded-full bg-gradient-to-br from-cyan-400 to-teal-500 text-white flex items-center justify-center font-bold text-xs flex-shrink-0 aspect-square\">\r\n                                  {getInitials(patientName)}\r\n                                </div>\r\n                              )}\r\n                              <div className=\"min-w-0\">\r\n                                <div className=\"flex items-center gap-2\">\r\n                                  <span className=\"text-xs font-semibold text-gray-400\">#{serial}</span>\r\n                                  <h3 className=\"font-semibold text-gray-800 text-sm truncate\">{patientName}</h3>\r\n                                </div>\r\n                                <p className=\"text-xs text-gray-500 truncate\">{patientEmail}</p>\r\n                              </div>\r\n                            </div>\r\n\r\n                            <div className=\"flex items-center gap-2 flex-shrink-0\">\r\n                              <button\r\n                                type=\"button\"\r\n                                onClick={() => navigateToAppointmentDetails(apt)}\r\n                                className=\"w-9 h-9 rounded-full bg-cyan-100 text-cyan-700 flex items-center justify-center hover:bg-cyan-200 transition-colors\"\r\n                                title=\"View details\"\r\n                              >\r\n                                <Eye size={16} />\r\n                              </button>\r\n                            </div>\r\n                          </div>\r\n\r\n                          <div className=\"mt-3 flex items-center justify-between\">\r\n                            <span className=\"text-xs text-gray-500\">Status</span>\r\n                            <span\r\n                              className={`px-3 py-1 rounded-full text-xs font-semibold ${getStatusBadgeClasses(\r\n                                apt.status\r\n                              )}`}\r\n                            >\r\n                              {statusLabel}\r\n                            </span>\r\n                          </div>\r\n\r\n                          <div className=\"mt-4 grid grid-cols-2 gap-x-4 gap-y-2 text-sm\">\r\n                            <div className=\"text-xs text-gray-500\">Age</div>\r\n                            <div className=\"text-xs text-gray-800 text-right\">{age ?? \"-\"}</div>\r\n\r\n                            <div className=\"text-xs text-gray-500\">Gender</div>\r\n                            <div className=\"text-xs text-gray-800 text-right capitalize\">{gender}</div>\r\n\r\n                            <div className=\"text-xs text-gray-500\">Department</div>\r\n                            <div className=\"text-xs text-gray-800 text-right\">{department}</div>\r\n\r\n                            <div className=\"text-xs text-gray-500\">Date</div>\r\n                            <div className=\"text-xs text-gray-800 text-right\">{formatDate(apt.appointmentDate)}</div>\r\n\r\n                            <div className=\"text-xs text-gray-500\">Time</div>\r\n                            <div className=\"text-xs text-gray-800 text-right\">{apt.appointmentTime || \"-\"}</div>\r\n\r\n                            <div className=\"text-xs text-gray-500\">Doctor</div>\r\n                            <div className=\"text-xs text-gray-800 text-right\">{doctorName}</div>\r\n\r\n                            <div className=\"text-xs text-gray-500\">Fees</div>\r\n                            <div className=\"text-xs text-gray-800 text-right\">{fees}</div>\r\n                          </div>\r\n                        </div>\r\n                      );\r\n                    })}\r\n                  </div>\r\n\r\n                  <div className=\"hidden lg:block overflow-x-auto no-scrollbar\">\r\n                    <table className=\"w-full text-left border-collapse table-fixed\">\r\n                      <thead>\r\n                        <tr className=\"bg-gray-50 border-b border-gray-100 text-[10px] uppercase text-gray-500 font-semibold\">\r\n                          <th className=\"px-3 py-4 w-[40px]\">#</th>\r\n                          <th className=\"px-3 py-4 w-[180px]\">Patient</th>\r\n                          <th className=\"px-3 py-4 w-[50px]\">Age</th>\r\n                          <th className=\"px-3 py-4 w-[70px]\">Gender</th>\r\n                          <th className=\"px-3 py-4 w-[100px]\">Date</th>\r\n                          <th className=\"px-3 py-4 w-[90px]\">Time</th>\r\n                          <th className=\"px-3 py-4 w-[160px]\">Doctor</th>\r\n                          <th className=\"px-3 py-4 w-[70px]\">Fees</th>\r\n                          <th className=\"px-3 py-4 w-[110px]\">Status</th>\r\n                          <th className=\"px-3 py-4 w-[60px] text-center\">Details</th>\r\n                        </tr>\r\n                      </thead>\r\n\r\n                      <tbody className=\"divide-y divide-gray-50\">\r\n                        {appointments.map((apt, idx) => {\r\n                          const patient = apt.patientId || null;\r\n                          const doctor = apt.doctorId || null;\r\n\r\n                          const patientName = patient?.name || \"-\";\r\n                          const patientEmail = patient?.email || \"-\";\r\n                          const age = calcAge(patient?.dob);\r\n                          const gender = patient?.gender ? String(patient.gender) : \"-\";\r\n                          const department = doctor?.specialty || \"-\";\r\n                          const doctorName = doctor?.userId?.name || \"-\";\r\n                          const fees =\r\n                            typeof apt.consultationFees === \"number\" ? `Γé╣${apt.consultationFees}` : \"-\";\r\n                          const statusLabel = formatStatus(apt.status);\r\n\r\n                          return (\r\n                            <tr key={apt.id || apt.customId || idx} className=\"hover:bg-gray-50 transition-colors\">\r\n                              <td className=\"px-3 py-4 text-xs text-gray-600\">\r\n                                {(page - 1) * limit + (idx + 1)}\r\n                              </td>\r\n\r\n                              <td className=\"px-3 py-4\">\r\n                                <div className=\"flex items-center gap-2\">\r\n                                  {patient?.profileImage ? (\r\n                                    <img\r\n                                      src={patient.profileImage}\r\n                                      alt={patientName}\r\n                                      className=\"w-8 h-8 rounded-full object-cover border border-gray-200 flex-shrink-0 aspect-square\"\r\n                                    />\r\n                                  ) : (\r\n                                    <div className=\"w-8 h-8 rounded-full bg-gradient-to-br from-cyan-400 to-teal-500 text-white flex items-center justify-center font-bold text-[10px] flex-shrink-0 aspect-square\">\r\n                                      {getInitials(patientName)}\r\n                                    </div>\r\n                                  )}\r\n                                  <div className=\"min-w-0\">\r\n                                    <p className=\"font-medium text-gray-800 text-xs truncate\">{patientName}</p>\r\n                                    <p className=\"text-[10px] text-gray-500 truncate\">{patientEmail}</p>\r\n                                  </div>\r\n                                </div>\r\n                              </td>\r\n\r\n                              <td className=\"px-3 py-4 text-xs text-gray-600\">{age ?? \"-\"}</td>\r\n                              <td className=\"px-3 py-4 text-xs text-gray-600 capitalize\">{gender}</td>\r\n                              <td className=\"px-3 py-4 text-xs text-gray-600\">{formatDate(apt.appointmentDate)}</td>\r\n                              <td className=\"px-3 py-4 text-xs text-gray-600\">{apt.appointmentTime || \"-\"}</td>\r\n\r\n                              <td className=\"px-3 py-4\">\r\n                                <div className=\"flex items-center gap-2\">\r\n                                  {doctor?.userId?.profileImage ? (\r\n                                    <img\r\n                                      src={doctor.userId.profileImage}\r\n                                      alt={doctorName}\r\n                                      className=\"w-8 h-8 rounded-full object-cover border border-gray-200 flex-shrink-0 aspect-square\"\r\n                                    />\r\n                                  ) : (\r\n                                    <div className=\"w-8 h-8 rounded-full bg-gray-200 text-gray-700 flex items-center justify-center font-bold text-[10px] flex-shrink-0 aspect-square\">\r\n                                      {getInitials(doctorName)}\r\n                                    </div>\r\n                                  )}\r\n                                  <div className=\"min-w-0\">\r\n                                    <p className=\"font-medium text-gray-800 text-xs truncate\">{doctorName}</p>\r\n                                    <p className=\"text-[10px] text-gray-500 truncate\">{department}</p>\r\n                                  </div>\r\n                                </div>\r\n                              </td>\r\n\r\n                              <td className=\"px-3 py-4 text-xs text-gray-600\">{fees}</td>\r\n\r\n                              <td className=\"px-3 py-4\">\r\n                                <span\r\n                                  className={`px-3 py-1 rounded-full text-[10px] font-semibold ${getStatusBadgeClasses(\r\n                                    apt.status\r\n                                  )}`}\r\n                                >\r\n                                  {statusLabel}\r\n                                </span>\r\n                              </td>\r\n\r\n                              <td className=\"px-3 py-4\">\r\n                                <div className=\"flex items-center justify-center gap-2\">\r\n                                  <button\r\n                                    type=\"button\"\r\n                                    onClick={() => navigateToAppointmentDetails(apt)}\r\n                                    className=\"w-7 h-7 rounded-full bg-cyan-100 text-cyan-700 flex items-center justify-center hover:bg-cyan-200 transition-colors\"\r\n                                    title=\"View details\"\r\n                                  >\r\n                                    <Eye size={14} />\r\n                                  </button>\r\n\r\n\r\n                                </div>\r\n                              </td>\r\n                            </tr>\r\n                          );\r\n                        })}\r\n                      </tbody>\r\n                    </table>\r\n                  </div>\r\n                </>\r\n              )}\r\n\r\n              {!loading && totalPages > 1 && (\r\n                <div className=\"px-4 sm:px-6 py-4 border-t border-gray-100 bg-white flex items-center justify-center\">\r\n                  <div className=\"flex items-center gap-1.5 sm:gap-2 flex-wrap justify-center\">\r\n                    <button\r\n                      type=\"button\"\r\n                      onClick={() => setPage((p) => Math.max(1, p - 1))}\r\n                      disabled={page === 1}\r\n                      className={`w-7 h-7 sm:w-8 sm:h-8 rounded-full flex items-center justify-center border transition-colors ${page === 1\r\n                        ? \"bg-gray-100 text-gray-400 border-gray-200 cursor-not-allowed\"\r\n                        : \"bg-white text-[#00A1B0] border-[#00A1B0] hover:bg-[#00A1B0] hover:text-white\"\r\n                        }`}\r\n                      title=\"Previous\"\r\n                    >\r\n                      <ChevronLeft size={16} />\r\n                    </button>\r\n\r\n                    {pagesToShow.map((p) => (\r\n                      <button\r\n                        key={p}\r\n                        type=\"button\"\r\n                        onClick={() => setPage(p)}\r\n                        className={`w-7 h-7 sm:w-8 sm:h-8 rounded-full text-xs sm:text-sm font-semibold transition-colors ${p === page\r\n                          ? \"bg-gradient-to-r from-cyan-400 to-teal-500 text-white shadow\"\r\n                          : \"bg-white text-[#00A1B0] border border-[#00A1B0] hover:bg-[#00A1B0] hover:text-white\"\r\n                          }`}\r\n                        title={`Page ${p}`}\r\n                      >\r\n                        {p}\r\n                      </button>\r\n                    ))}\r\n\r\n                    <button\r\n                      type=\"button\"\r\n                      onClick={() => setPage((p) => Math.min(totalPages, p + 1))}\r\n                      disabled={page === totalPages}\r\n                      className={`w-7 h-7 sm:w-8 sm:h-8 rounded-full flex items-center justify-center border transition-colors ${page === totalPages\r\n                        ? \"bg-gray-100 text-gray-400 border-gray-200 cursor-not-allowed\"\r\n                        : \"bg-white text-[#00A1B0] border-[#00A1B0] hover:bg-[#00A1B0] hover:text-white\"\r\n                        }`}\r\n                      title=\"Next\"\r\n                    >\r\n                      <ChevronRight size={16} />\r\n                    </button>\r\n                  </div>\r\n                </div>\r\n              )}\r\n            </div>\r\n          </div>\r\n        </main>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default AdminAppointmentsListPage;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\nithi\\OneDrive\\Documents\\Brototype\\Takecare\\frontend\\src\\pages\\admin\\ContactMessages.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":40,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":40,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1507,1510],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1507,1510],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":70,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":70,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2462,2465],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2462,2465],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useEffect, useState } from \"react\";\r\nimport { motion, AnimatePresence } from \"framer-motion\";\r\nimport Sidebar from \"../../components/admin/Sidebar\";\r\nimport TopNav from \"../../components/admin/TopNav\";\r\nimport { Mail, Clock, User, Phone, MessageSquare } from \"lucide-react\";\r\nimport { contactService } from \"../../services/contactService\";\r\nimport { toast } from \"sonner\";\r\n\r\ninterface ContactSubmission {\r\n    _id: string;\r\n    name: string;\r\n    email: string;\r\n    phone?: string;\r\n    subject: string;\r\n    message: string;\r\n    status: 'pending' | 'responded' | 'closed';\r\n    createdAt: string;\r\n}\r\n\r\nconst ContactMessages: React.FC = () => {\r\n    const [submissions, setSubmissions] = useState<ContactSubmission[]>([]);\r\n    const [loading, setLoading] = useState(true);\r\n    const [sidebarOpen, setSidebarOpen] = useState(false);\r\n\r\n    // Reply Modal State\r\n    const [replyModalOpen, setReplyModalOpen] = useState(false);\r\n    const [selectedMsg, setSelectedMsg] = useState<ContactSubmission | null>(null);\r\n    const [replyText, setReplyText] = useState(\"\");\r\n    const [isSending, setIsSending] = useState(false);\r\n\r\n    const fetchSubmissions = async () => {\r\n        setLoading(true);\r\n        try {\r\n            const res = await contactService.getAllSubmissions();\r\n            if (res.success) {\r\n                setSubmissions(res.data);\r\n            } else {\r\n                toast.error(res.message || \"Failed to fetch messages\");\r\n            }\r\n        } catch (error: any) {\r\n            toast.error(error.message || \"Error fetching messages\");\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    useEffect(() => {\r\n        fetchSubmissions();\r\n    }, []);\r\n\r\n    const handleReplyClick = (msg: ContactSubmission) => {\r\n        setSelectedMsg(msg);\r\n        setReplyText(\"\");\r\n        setReplyModalOpen(true);\r\n    };\r\n\r\n    const handleSendReply = async () => {\r\n        if (!selectedMsg || !replyText.trim()) return;\r\n\r\n        setIsSending(true);\r\n        try {\r\n            const res = await contactService.replyToMessage(selectedMsg._id, replyText);\r\n            if (res.success) {\r\n                toast.success(\"Reply sent successfully!\");\r\n                setReplyModalOpen(false);\r\n                fetchSubmissions(); // Refresh to show 'responded' status\r\n            } else {\r\n                toast.error(res.message || \"Failed to send reply\");\r\n            }\r\n        } catch (error: any) {\r\n            toast.error(error.message || \"Error sending reply\");\r\n        } finally {\r\n            setIsSending(false);\r\n        }\r\n    };\r\n\r\n    return (\r\n        <div className=\"flex min-h-screen bg-gray-50\">\r\n            {/* Sidebar - Desktop */}\r\n            <div className=\"hidden lg:block w-64 fixed inset-y-0 left-0 z-50\">\r\n                <Sidebar />\r\n            </div>\r\n\r\n            {/* Sidebar - Mobile Overlay */}\r\n            <AnimatePresence>\r\n                {sidebarOpen && (\r\n                    <div className=\"fixed inset-0 z-[60] lg:hidden\">\r\n                        <motion.div\r\n                            initial={{ opacity: 0 }}\r\n                            animate={{ opacity: 1 }}\r\n                            exit={{ opacity: 0 }}\r\n                            onClick={() => setSidebarOpen(false)}\r\n                            className=\"absolute inset-0 bg-slate-900/40 backdrop-blur-sm\"\r\n                        />\r\n                        <motion.div\r\n                            initial={{ x: -256 }}\r\n                            animate={{ x: 0 }}\r\n                            exit={{ x: -256 }}\r\n                            transition={{ type: \"spring\", damping: 25, stiffness: 200 }}\r\n                            className=\"absolute left-0 top-0 h-full w-64 bg-white shadow-2xl\"\r\n                        >\r\n                            <Sidebar onMobileClose={() => setSidebarOpen(false)} />\r\n                        </motion.div>\r\n                    </div>\r\n                )}\r\n            </AnimatePresence>\r\n\r\n            <div className=\"flex-1 flex flex-col lg:pl-64 min-w-0\">\r\n                <TopNav onMenuClick={() => setSidebarOpen(true)} />\r\n\r\n                <main className=\"flex-1 overflow-y-auto px-4 sm:px-6 lg:px-8 py-6 md:py-8\">\r\n                    <div className=\"max-w-5xl mx-auto\">\r\n                        <div className=\"mb-6 md:mb-8\">\r\n                            <h1 className=\"text-2xl md:text-3xl font-bold text-slate-900\">Contact Messages</h1>\r\n                            <p className=\"text-sm md:text-base text-slate-500 mt-1 md:mt-2\">Manage incoming inquiries from the contact form</p>\r\n                        </div>\r\n\r\n                        {loading ? (\r\n                            <div className=\"flex flex-col items-center justify-center py-20 bg-white rounded-2xl border border-slate-100 shadow-sm\">\r\n                                <div className=\"animate-spin rounded-full h-10 w-10 border-b-2 border-cyan-500 mb-4\"></div>\r\n                                <p className=\"text-slate-400 font-medium\">Loading inbox...</p>\r\n                            </div>\r\n                        ) : submissions.length === 0 ? (\r\n                            <div className=\"bg-white rounded-2xl p-12 text-center shadow-sm border border-slate-100\">\r\n                                <div className=\"inline-flex items-center justify-center w-16 h-16 bg-slate-50 rounded-full mb-4\">\r\n                                    <Mail className=\"text-slate-300\" size={32} />\r\n                                </div>\r\n                                <h3 className=\"text-lg font-semibold text-slate-900\">No messages yet</h3>\r\n                                <p className=\"text-slate-500 mt-2\">When users contact you, their messages will appear here.</p>\r\n                            </div>\r\n                        ) : (\r\n                            <div className=\"space-y-4 md:space-y-6\">\r\n                                {submissions.map((msg) => (\r\n                                    <motion.div\r\n                                        key={msg._id}\r\n                                        initial={{ opacity: 0, y: 20 }}\r\n                                        animate={{ opacity: 1, y: 0 }}\r\n                                        className=\"bg-white rounded-2xl p-4 md:p-6 shadow-sm border border-slate-100 hover:shadow-md transition-shadow relative overflow-hidden group\"\r\n                                    >\r\n                                        <div className=\"flex flex-col sm:flex-row sm:items-start justify-between gap-4 mb-4\">\r\n                                            <div className=\"flex items-start gap-3 md:gap-4 min-w-0\">\r\n                                                <div className=\"w-10 h-10 md:w-12 md:h-12 bg-cyan-50 text-cyan-600 rounded-xl flex items-center justify-center flex-shrink-0\">\r\n                                                    <User size={20} className=\"md:w-6 md:h-6\" />\r\n                                                </div>\r\n                                                <div className=\"min-w-0\">\r\n                                                    <h3 className=\"font-bold text-slate-900 text-base md:text-lg truncate\">{msg.name}</h3>\r\n                                                    <div className=\"flex flex-col gap-1 text-sm text-slate-500 mt-1\">\r\n                                                        <span className=\"flex items-center gap-1.5 truncate\">\r\n                                                            <Mail size={12} className=\"text-slate-400\" />\r\n                                                            {msg.email}\r\n                                                        </span>\r\n                                                        {msg.phone && (\r\n                                                            <span className=\"flex items-center gap-1.5\">\r\n                                                                <Phone size={12} className=\"text-slate-400\" />\r\n                                                                {msg.phone}\r\n                                                            </span>\r\n                                                        )}\r\n                                                    </div>\r\n                                                </div>\r\n                                            </div>\r\n                                            <div className=\"flex items-center self-start sm:self-auto gap-2 px-3 py-1 bg-slate-50 text-slate-400 group-hover:text-slate-500 rounded-full text-[11px] font-bold uppercase tracking-wider transition-colors\">\r\n                                                <Clock size={12} />\r\n                                                {new Date(msg.createdAt).toLocaleDateString([], { month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit' })}\r\n                                            </div>\r\n                                        </div>\r\n\r\n                                        <div className=\"bg-slate-50/50 rounded-xl p-4 md:p-5 border border-slate-50 transition-colors group-hover:bg-slate-50\">\r\n                                            <div className=\"flex items-center gap-2 text-slate-900 font-bold mb-2 text-sm md:text-base\">\r\n                                                <MessageSquare size={16} className=\"text-cyan-500\" />\r\n                                                {msg.subject}\r\n                                            </div>\r\n                                            <p className=\"text-sm md:text-base text-slate-600 leading-relaxed whitespace-pre-wrap break-words italic\">\r\n                                                \"{msg.message}\"\r\n                                            </p>\r\n                                        </div>\r\n\r\n                                        <div className=\"mt-4 flex flex-col xs:flex-row items-center justify-between gap-4 pt-2\">\r\n                                            <span className={`px-3 py-1.5 rounded-full text-[10px] font-black uppercase tracking-widest border ${msg.status === 'pending' ? 'bg-amber-50 text-amber-600 border-amber-100' :\r\n                                                msg.status === 'responded' ? 'bg-blue-50 text-blue-600 border-blue-100' :\r\n                                                    'bg-slate-50 text-slate-600 border-slate-100'\r\n                                                }`}>\r\n                                                {msg.status}\r\n                                            </span>\r\n\r\n                                            {msg.status === 'pending' && (\r\n                                                <button\r\n                                                    onClick={() => handleReplyClick(msg)}\r\n                                                    className=\"w-full xs:w-auto px-6 py-2 bg-[#00A1B0] text-white rounded-xl font-bold text-sm hover:bg-[#008a96] transition-all shadow-lg shadow-cyan-500/10 active:scale-95\"\r\n                                                >\r\n                                                    Send Reply\r\n                                                </button>\r\n                                            )}\r\n                                        </div>\r\n                                    </motion.div>\r\n                                ))}\r\n                            </div>\r\n                        )}\r\n                    </div>\r\n                </main>\r\n            </div>\r\n\r\n            {/* Reply Modal */}\r\n            <AnimatePresence>\r\n                {replyModalOpen && (\r\n                    <div className=\"fixed inset-0 z-[100] flex items-center justify-center p-4\">\r\n                        <motion.div\r\n                            initial={{ opacity: 0 }}\r\n                            animate={{ opacity: 1 }}\r\n                            exit={{ opacity: 0 }}\r\n                            onClick={() => setReplyModalOpen(false)}\r\n                            className=\"absolute inset-0 bg-slate-900/60 backdrop-blur-sm\"\r\n                        />\r\n                        <motion.div\r\n                            initial={{ scale: 0.95, opacity: 0 }}\r\n                            animate={{ scale: 1, opacity: 1 }}\r\n                            exit={{ scale: 0.95, opacity: 0 }}\r\n                            className=\"relative w-full max-w-lg bg-white rounded-3xl shadow-2xl overflow-hidden\"\r\n                        >\r\n                            <div className=\"p-6 border-b border-slate-100\">\r\n                                <h3 className=\"text-xl font-bold text-slate-900\">Reply to {selectedMsg?.name}</h3>\r\n                                <p className=\"text-xs font-bold text-slate-400 uppercase tracking-widest mt-1\">Subject: {selectedMsg?.subject}</p>\r\n                            </div>\r\n\r\n                            <div className=\"p-6\">\r\n                                <label className=\"block text-[11px] font-black text-slate-400 uppercase tracking-widest mb-2 px-1\">Your Message</label>\r\n                                <textarea\r\n                                    value={replyText}\r\n                                    onChange={(e) => setReplyText(e.target.value)}\r\n                                    placeholder=\"Type your response here...\"\r\n                                    className=\"w-full h-40 md:h-52 p-4 border border-slate-200 rounded-2xl focus:ring-4 focus:ring-cyan-500/5 focus:border-[#00A1B0] outline-none transition-all resize-none text-slate-700 leading-relaxed shadow-inner\"\r\n                                />\r\n                            </div>\r\n\r\n                            <div className=\"p-6 bg-slate-50/50 flex flex-col-reverse xs:flex-row items-center justify-end gap-3 px-6 py-4\">\r\n                                <button\r\n                                    onClick={() => setReplyModalOpen(false)}\r\n                                    className=\"w-full xs:w-auto px-6 py-2.5 text-slate-500 font-bold hover:text-slate-900 transition-colors text-sm\"\r\n                                >\r\n                                    Cancel Request\r\n                                </button>\r\n                                <button\r\n                                    onClick={handleSendReply}\r\n                                    disabled={!replyText.trim() || isSending}\r\n                                    className=\"w-full xs:w-auto px-10 py-3 bg-[#00A1B0] text-white rounded-2xl font-bold hover:bg-[#008a96] transition-all shadow-xl shadow-cyan-500/20 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2 active:scale-95\"\r\n                                >\r\n                                    {isSending ? (\r\n                                        <>\r\n                                            <div className=\"w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin\" />\r\n                                            Dispatching...\r\n                                        </>\r\n                                    ) : (\r\n                                        <>\r\n                                            <Mail size={18} />\r\n                                            Post Reply\r\n                                        </>\r\n                                    )}\r\n                                </button>\r\n                            </div>\r\n                        </motion.div>\r\n                    </div>\r\n                )}\r\n            </AnimatePresence>\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default ContactMessages;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\nithi\\OneDrive\\Documents\\Brototype\\Takecare\\frontend\\src\\pages\\admin\\ReviewsPage.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'error' is defined but never used.","line":75,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":75,"endColumn":23}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useEffect, useMemo, useState, useCallback } from \"react\";\r\nimport { toast } from \"sonner\";\r\nimport { motion, AnimatePresence } from \"framer-motion\";\r\nimport Sidebar from \"../../components/admin/Sidebar\";\r\nimport TopNav from \"../../components/admin/TopNav\";\r\nimport { Trash2, ChevronLeft, ChevronRight, Star } from \"lucide-react\";\r\nimport adminService from \"../../services/adminService\";\r\nimport AlertDialog from \"../../components/common/AlertDialog\";\r\n\r\ninterface Review {\r\n    _id: string;\r\n    patientId: {\r\n        _id: string;\r\n        name: string;\r\n        email: string;\r\n        profileImage: string;\r\n    };\r\n    doctorId: {\r\n        _id: string;\r\n        specialty: string;\r\n        userId: {\r\n            name: string;\r\n            profileImage: string;\r\n        }\r\n    };\r\n    rating: number;\r\n    comment: string;\r\n    createdAt: string;\r\n}\r\n\r\nconst ReviewsPage: React.FC = () => {\r\n    const [reviews, setReviews] = useState<Review[]>([]);\r\n    const [loading, setLoading] = useState(true);\r\n    const [page, setPage] = useState(1);\r\n    const [totalPages, setTotalPages] = useState(1);\r\n    const [totalReviews, setTotalReviews] = useState(0);\r\n    const [sidebarOpen, setSidebarOpen] = useState(false);\r\n    const [deleteId, setDeleteId] = useState<string | null>(null);\r\n\r\n    const limit = 10;\r\n\r\n    const fetchReviews = useCallback(async (currentPage: number) => {\r\n        setLoading(true);\r\n        try {\r\n            const res = await adminService.getAllReviews(currentPage, limit);\r\n            if (res.success && res.data) {\r\n                setReviews(res.data.reviews || []);\r\n                setTotalPages(res.data.totalPages || 1);\r\n                setTotalReviews(res.data.total || 0);\r\n            } else {\r\n                toast.error(res.message || \"Failed to fetch reviews\");\r\n            }\r\n        } catch (e: unknown) {\r\n            const error = e as { message?: string };\r\n            toast.error(error.message || \"Error fetching reviews\");\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    }, [limit]);\r\n\r\n    useEffect(() => {\r\n        fetchReviews(page);\r\n    }, [page, fetchReviews]);\r\n\r\n    const handleDelete = async () => {\r\n        if (!deleteId) return;\r\n        try {\r\n            const res = await adminService.deleteReview(deleteId);\r\n            if (res.success) {\r\n                toast.success(\"Review deleted successfully\");\r\n                fetchReviews(page);\r\n            } else {\r\n                toast.error(res.message || \"Failed to delete review\");\r\n            }\r\n        } catch (error) {\r\n            toast.error(\"Error deleting review\");\r\n        } finally {\r\n            setDeleteId(null);\r\n        }\r\n    };\r\n\r\n    const pagesToShow = useMemo(() => {\r\n        const items: number[] = [];\r\n        const start = Math.max(1, page - 2);\r\n        const end = Math.min(totalPages, page + 2);\r\n        for (let p = start; p <= end; p++) items.push(p);\r\n        return items;\r\n    }, [page, totalPages]);\r\n\r\n    const getInitials = (name?: string) =>\r\n        name\r\n            ? name\r\n                .split(\" \")\r\n                .map((n) => n[0])\r\n                .join(\"\")\r\n                .slice(0, 2)\r\n                .toUpperCase()\r\n            : \"??\";\r\n\r\n    return (\r\n        <div className=\"flex min-h-screen bg-gray-50 no-scrollbar\">\r\n            {/* Sidebar - Desktop */}\r\n            <div className=\"hidden lg:block w-64 fixed inset-y-0 left-0 z-50\">\r\n                <Sidebar />\r\n            </div>\r\n\r\n            {/* Sidebar - Mobile Overlay */}\r\n            <AnimatePresence>\r\n                {sidebarOpen && (\r\n                    <div className=\"fixed inset-0 z-[60] lg:hidden\">\r\n                        {/* Backdrop */}\r\n                        <motion.div\r\n                            initial={{ opacity: 0 }}\r\n                            animate={{ opacity: 1 }}\r\n                            exit={{ opacity: 0 }}\r\n                            onClick={() => setSidebarOpen(false)}\r\n                            className=\"absolute inset-0 bg-slate-900/40 backdrop-blur-sm\"\r\n                        />\r\n                        {/* Sidebar Content */}\r\n                        <motion.div\r\n                            initial={{ x: -256 }}\r\n                            animate={{ x: 0 }}\r\n                            exit={{ x: -256 }}\r\n                            transition={{ type: \"spring\", damping: 25, stiffness: 200 }}\r\n                            className=\"absolute left-0 top-0 h-full w-64 bg-white shadow-2xl\"\r\n                        >\r\n                            <Sidebar onMobileClose={() => setSidebarOpen(false)} />\r\n                        </motion.div>\r\n                    </div>\r\n                )}\r\n            </AnimatePresence>\r\n\r\n            <div className=\"flex-1 flex flex-col lg:pl-64 min-w-0\">\r\n                <TopNav onMenuClick={() => setSidebarOpen(true)} />\r\n\r\n                <main className=\"flex-1 px-3 sm:px-4 md:px-6 lg:px-8 py-6\">\r\n                    <div className=\"max-w-7xl mx-auto\">\r\n                        {/* Header */}\r\n                        <div className=\"bg-white rounded-xl shadow-sm border border-gray-100 p-6 mb-6\">\r\n                            <div className=\"flex flex-col xl:flex-row xl:items-center justify-between gap-4\">\r\n                                <div>\r\n                                    <h1 className=\"text-2xl font-bold text-gray-800\">Reviews</h1>\r\n                                    <p className=\"text-sm text-gray-500\">Manage patient reviews ({totalReviews})</p>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n\r\n                        {/* Content */}\r\n                        <div className=\"bg-white rounded-xl shadow-sm border overflow-hidden\">\r\n                            {loading ? (\r\n                                <div className=\"p-12 text-center text-gray-500\">\r\n                                    Loading reviews...\r\n                                </div>\r\n                            ) : reviews.length === 0 ? (\r\n                                <div className=\"p-12 text-center text-gray-500\">\r\n                                    No reviews found.\r\n                                </div>\r\n                            ) : (\r\n                                <>\r\n                                    {/* Mobile Cards */}\r\n                                    <div className=\"lg:hidden p-4 space-y-4\">\r\n                                        {reviews.map((review) => (\r\n                                            <div\r\n                                                key={review._id}\r\n                                                className=\"border rounded-xl p-4 shadow-sm\"\r\n                                            >\r\n                                                <div className=\"flex justify-between items-start mb-3\">\r\n                                                    <div className=\"flex items-center gap-3\">\r\n                                                        {review.patientId?.profileImage ? (\r\n                                                            <img src={review.patientId.profileImage} alt={review.patientId.name} className=\"w-10 h-10 rounded-full object-cover\" />\r\n                                                        ) : (\r\n                                                            <div className=\"w-10 h-10 rounded-full bg-cyan-100 text-cyan-700 flex items-center justify-center font-bold text-xs\">\r\n                                                                {getInitials(review.patientId?.name)}\r\n                                                            </div>\r\n                                                        )}\r\n                                                        <div>\r\n                                                            <p className=\"font-semibold text-gray-800\">{review.patientId?.name || \"Unknown Patient\"}</p>\r\n                                                            <p className=\"text-xs text-gray-500\">For Dr. {review.doctorId?.userId?.name || \"Unknown Doctor\"}</p>\r\n                                                        </div>\r\n                                                    </div>\r\n                                                    <div className=\"flex items-center gap-1 bg-yellow-50 px-2 py-1 rounded-lg\">\r\n                                                        <Star size={14} className=\"text-yellow-500 fill-yellow-500\" />\r\n                                                        <span className=\"font-semibold text-sm text-yellow-700\">{review.rating}</span>\r\n                                                    </div>\r\n                                                </div>\r\n\r\n                                                <div className=\"bg-gray-50 p-3 rounded-lg mb-3\">\r\n                                                    <p className=\"text-sm text-gray-600 line-clamp-3 italic\">\"{review.comment}\"</p>\r\n                                                </div>\r\n\r\n                                                <div className=\"flex justify-between items-center mt-2\">\r\n                                                    <span className=\"text-xs text-gray-400\">{new Date(review.createdAt).toLocaleDateString()}</span>\r\n                                                    <button\r\n                                                        onClick={() => setDeleteId(review._id)}\r\n                                                        className=\"p-2 text-red-500 hover:bg-red-50 rounded-lg transition-colors\"\r\n                                                    >\r\n                                                        <Trash2 size={18} />\r\n                                                    </button>\r\n                                                </div>\r\n                                            </div>\r\n                                        ))}\r\n                                    </div>\r\n\r\n                                    {/* Desktop Table */}\r\n                                    <div className=\"hidden lg:block overflow-x-auto no-scrollbar\">\r\n                                        <table className=\"w-full text-left border-collapse table-fixed\">\r\n                                            <thead>\r\n                                                <tr className=\"bg-gray-50 border-b text-[11px] uppercase text-gray-500 font-semibold\">\r\n                                                    <th className=\"px-6 py-4 w-[250px]\">Patient</th>\r\n                                                    <th className=\"px-6 py-4 w-[250px]\">Doctor</th>\r\n                                                    <th className=\"px-6 py-4 w-[120px]\">Rating</th>\r\n                                                    <th className=\"px-6 py-4\">Comment</th>\r\n                                                    <th className=\"px-6 py-4 w-[150px]\">Date</th>\r\n                                                    <th className=\"px-6 py-4 w-[80px] text-center\">Action</th>\r\n                                                </tr>\r\n                                            </thead>\r\n                                            <tbody className=\"divide-y\">\r\n                                                {reviews.map((review) => (\r\n                                                    <tr key={review._id} className=\"hover:bg-gray-50 transition-colors\">\r\n                                                        <td className=\"px-6 py-4\">\r\n                                                            <div className=\"flex items-center gap-3\">\r\n                                                                {review.patientId?.profileImage ? (\r\n                                                                    <img src={review.patientId.profileImage} alt={review.patientId.name} className=\"w-9 h-9 rounded-full object-cover border\" />\r\n                                                                ) : (\r\n                                                                    <div className=\"w-9 h-9 rounded-full bg-gradient-to-br from-cyan-400 to-teal-500 text-white flex items-center justify-center text-xs font-bold\">\r\n                                                                        {getInitials(review.patientId?.name)}\r\n                                                                    </div>\r\n                                                                )}\r\n                                                                <div>\r\n                                                                    <p className=\"font-medium text-gray-800 text-sm\">{review.patientId?.name || \"Unknown\"}</p>\r\n                                                                    <p className=\"text-xs text-gray-500\">{review.patientId?.email}</p>\r\n                                                                </div>\r\n                                                            </div>\r\n                                                        </td>\r\n                                                        <td className=\"px-6 py-4\">\r\n                                                            <div className=\"flex items-center gap-3\">\r\n                                                                {review.doctorId?.userId?.profileImage ? (\r\n                                                                    <img src={review.doctorId.userId.profileImage} alt={review.doctorId.userId.name} className=\"w-8 h-8 rounded-full object-cover border\" />\r\n                                                                ) : (\r\n                                                                    <div className=\"w-8 h-8 rounded-full bg-gray-200 text-gray-600 flex items-center justify-center text-xs font-bold\">\r\n                                                                        {getInitials(review.doctorId?.userId?.name)}\r\n                                                                    </div>\r\n                                                                )}\r\n                                                                <div className=\"min-w-0\">\r\n                                                                    <p className=\"font-medium text-gray-800 text-sm truncate\">Dr. {review.doctorId?.userId?.name || \"Unknown\"}</p>\r\n                                                                    <p className=\"text-xs text-gray-500 truncate\">{review.doctorId?.specialty}</p>\r\n                                                                </div>\r\n                                                            </div>\r\n                                                        </td>\r\n                                                        <td className=\"px-6 py-4\">\r\n                                                            <div className=\"flex items-center gap-1.5\">\r\n                                                                <Star size={16} className=\"text-yellow-400 fill-yellow-400\" />\r\n                                                                <span className=\"font-semibold text-gray-700\">{review.rating}</span>\r\n                                                            </div>\r\n                                                        </td>\r\n                                                        <td className=\"px-6 py-4\">\r\n                                                            <p className=\"text-sm text-gray-600 truncate max-w-[300px]\">\r\n                                                                {review.comment}\r\n                                                            </p>\r\n                                                        </td>\r\n                                                        <td className=\"px-6 py-4 text-sm text-gray-500\">\r\n                                                            {new Date(review.createdAt).toLocaleDateString()}\r\n                                                        </td>\r\n                                                        <td className=\"px-6 py-4 text-center\">\r\n                                                            <button\r\n                                                                onClick={() => setDeleteId(review._id)}\r\n                                                                className=\"w-8 h-8 rounded-full bg-red-50 text-red-500 flex items-center justify-center hover:bg-red-100 transition-colors\"\r\n                                                            >\r\n                                                                <Trash2 size={16} />\r\n                                                            </button>\r\n                                                        </td>\r\n                                                    </tr>\r\n                                                ))}\r\n                                            </tbody>\r\n                                        </table>\r\n                                    </div>\r\n                                </>\r\n                            )}\r\n\r\n                            {/* Pagination */}\r\n                            {!loading && totalPages > 1 && (\r\n                                <div className=\"px-4 py-4 border-t bg-gray-50 flex justify-center\">\r\n                                    <div className=\"flex gap-2\">\r\n                                        <button\r\n                                            disabled={page === 1}\r\n                                            onClick={() => setPage(page - 1)}\r\n                                            className=\"w-8 h-8 rounded-full border flex items-center justify-center disabled:opacity-50 hover:bg-gray-100\"\r\n                                        >\r\n                                            <ChevronLeft size={16} />\r\n                                        </button>\r\n\r\n                                        {pagesToShow.map((p) => (\r\n                                            <button\r\n                                                key={p}\r\n                                                onClick={() => setPage(p)}\r\n                                                className={`w-8 h-8 rounded-full text-sm font-semibold transition-colors ${p === page\r\n                                                    ? \"bg-cyan-500 text-white\"\r\n                                                    : \"border hover:bg-gray-100\"\r\n                                                    }`}\r\n                                            >\r\n                                                {p}\r\n                                            </button>\r\n                                        ))}\r\n\r\n                                        <button\r\n                                            disabled={page === totalPages}\r\n                                            onClick={() => setPage(page + 1)}\r\n                                            className=\"w-8 h-8 rounded-full border flex items-center justify-center disabled:opacity-50 hover:bg-gray-100\"\r\n                                        >\r\n                                            <ChevronRight size={16} />\r\n                                        </button>\r\n                                    </div>\r\n                                </div>\r\n                            )}\r\n                        </div>\r\n                    </div>\r\n                </main>\r\n            </div>\r\n\r\n            <AlertDialog\r\n                open={!!deleteId}\r\n                onOpenChange={() => setDeleteId(null)}\r\n                title=\"Are you sure?\"\r\n                description=\"This action cannot be undone. This will permanently delete the review.\"\r\n                confirmText=\"Delete\"\r\n                cancelText=\"Cancel\"\r\n                onConfirm={handleDelete}\r\n                variant=\"destructive\"\r\n            />\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default ReviewsPage;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\nithi\\OneDrive\\Documents\\Brototype\\Takecare\\frontend\\src\\pages\\admin\\Specialties.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":72,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":72,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2864,2867],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2864,2867],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":92,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":92,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3469,3472],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3469,3472],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":133,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":133,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4748,4751],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4748,4751],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect, useCallback } from 'react';\r\nimport { motion, AnimatePresence } from \"framer-motion\";\r\nimport TopNav from \"../../components/admin/TopNav\";\r\nimport Sidebar from \"../../components/admin/Sidebar\";\r\nimport { FaPlus, FaEdit, FaTrash, FaSearch, FaToggleOn, FaToggleOff, FaTimes } from 'react-icons/fa';\r\nimport { specialtyService } from '../../services/specialtyService';\r\nimport { Button } from '../../components/ui/button';\r\nimport { Input } from '../../components/ui/input';\r\nimport { Skeleton } from '../../components/ui/skeleton';\r\nimport { toast } from 'sonner';\r\nimport AlertDialog from '../../components/common/AlertDialog';\r\n\r\ninterface Specialty {\r\n  _id: string;\r\n  name: string;\r\n  description?: string;\r\n  isActive: boolean;\r\n  createdAt: string;\r\n  updatedAt: string;\r\n}\r\n\r\nconst AdminSpecialties: React.FC = () => {\r\n  const [specialties, setSpecialties] = useState<Specialty[]>([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [search, setSearch] = useState('');\r\n  const [currentPage, setCurrentPage] = useState(1);\r\n  const [totalPages, setTotalPages] = useState(1);\r\n  const [total, setTotal] = useState(0);\r\n  const [limit] = useState(10);\r\n  const [sidebarOpen, setSidebarOpen] = useState(false);\r\n\r\n  // Modal State\r\n  const [isModalOpen, setIsModalOpen] = useState(false);\r\n  const [modalMode, setModalMode] = useState<'add' | 'edit'>('add');\r\n  const [selectedSpecialty, setSelectedSpecialty] = useState<Specialty | null>(null);\r\n  const [formData, setFormData] = useState({ name: '', description: '' });\r\n  const [isSubmitting, setIsSubmitting] = useState(false);\r\n\r\n  // Delete Alert State\r\n  const [deleteAlertOpen, setDeleteAlertOpen] = useState(false);\r\n  const [specialtyToDelete, setSpecialtyToDelete] = useState<{ id: string; name: string } | null>(null);\r\n\r\n  const fetchSpecialties = useCallback(async () => {\r\n    setLoading(true);\r\n    try {\r\n      const response = await specialtyService.getAllSpecialties(currentPage, limit, search);\r\n      if (response.success) {\r\n        setSpecialties(response.data.specialties);\r\n        setTotal(response.data.total);\r\n        setTotalPages(response.data.totalPages);\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Error fetching specialties:\", error);\r\n      toast.error(\"Failed to fetch specialties\");\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  }, [currentPage, limit, search]);\r\n\r\n  useEffect(() => {\r\n    fetchSpecialties();\r\n  }, [fetchSpecialties]);\r\n\r\n  const handleToggleStatus = async (specialty: Specialty) => {\r\n    try {\r\n      const res = await specialtyService.toggleSpecialtyStatus(specialty._id);\r\n      if (res.success) {\r\n        toast.success(`Specialty ${res.data.isActive ? 'activated' : 'deactivated'}`);\r\n        fetchSpecialties();\r\n      }\r\n    } catch (error: unknown) {\r\n      const err = error as any;\r\n      toast.error(err.response?.data?.message || \"Error toggling specialty status\");\r\n    }\r\n  };\r\n\r\n  const handleDeleteClick = (id: string, name: string) => {\r\n    setSpecialtyToDelete({ id, name });\r\n    setDeleteAlertOpen(true);\r\n  };\r\n\r\n  const handleConfirmDelete = async () => {\r\n    if (!specialtyToDelete) return;\r\n\r\n    try {\r\n      const res = await specialtyService.deleteSpecialty(specialtyToDelete.id);\r\n      if (res.success) {\r\n        toast.success(\"Specialty deleted successfully\");\r\n        fetchSpecialties();\r\n      }\r\n    } catch (error: unknown) {\r\n      const err = error as any;\r\n      toast.error(err.response?.data?.message || \"Failed to delete specialty\");\r\n    } finally {\r\n      setSpecialtyToDelete(null);\r\n    }\r\n  };\r\n\r\n  const handleOpenModal = (mode: 'add' | 'edit', specialty?: Specialty) => {\r\n    setModalMode(mode);\r\n    if (mode === 'edit' && specialty) {\r\n      setSelectedSpecialty(specialty);\r\n      setFormData({ name: specialty.name, description: specialty.description || '' });\r\n    } else {\r\n      setSelectedSpecialty(null);\r\n      setFormData({ name: '', description: '' });\r\n    }\r\n    setIsModalOpen(true);\r\n  };\r\n\r\n  const handleSubmit = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    if (!formData.name.trim()) {\r\n      toast.error(\"Specialty name is required\");\r\n      return;\r\n    }\r\n\r\n    setIsSubmitting(true);\r\n    try {\r\n      let res;\r\n      if (modalMode === 'add') {\r\n        res = await specialtyService.createSpecialty(formData);\r\n      } else {\r\n        res = await specialtyService.updateSpecialty(selectedSpecialty!._id, formData);\r\n      }\r\n\r\n      if (res.success) {\r\n        toast.success(`Specialty ${modalMode === 'add' ? 'created' : 'updated'} successfully`);\r\n        setIsModalOpen(false);\r\n        fetchSpecialties();\r\n      }\r\n    } catch (error: unknown) {\r\n      const err = error as any;\r\n      toast.error(err.response?.data?.message || `Failed to ${modalMode} specialty`);\r\n    } finally {\r\n      setIsSubmitting(false);\r\n    }\r\n  };\r\n\r\n  const formatDate = (dateString: string) => {\r\n    return new Date(dateString).toLocaleDateString('en-US', { year: 'numeric', month: 'short', day: 'numeric' });\r\n  };\r\n\r\n  return (\r\n    <div className=\"flex min-h-screen bg-gray-50 no-scrollbar\">\r\n      <div className=\"hidden lg:block w-64 fixed inset-y-0 left-0 z-50\">\r\n        <Sidebar />\r\n      </div>\r\n\r\n      <AnimatePresence>\r\n        {sidebarOpen && (\r\n          <div className=\"fixed inset-0 z-[60] lg:hidden\">\r\n            <motion.div initial={{ opacity: 0 }} animate={{ opacity: 1 }} exit={{ opacity: 0 }} onClick={() => setSidebarOpen(false)} className=\"absolute inset-0 bg-slate-900/40 backdrop-blur-sm\" />\r\n            <motion.div initial={{ x: -256 }} animate={{ x: 0 }} exit={{ x: -256 }} transition={{ type: \"spring\", damping: 25, stiffness: 200 }} className=\"absolute left-0 top-0 h-full w-64 bg-white shadow-2xl\">\r\n              <Sidebar onMobileClose={() => setSidebarOpen(false)} />\r\n            </motion.div>\r\n          </div>\r\n        )}\r\n      </AnimatePresence>\r\n\r\n      <div className=\"flex-1 flex flex-col lg:pl-64 min-w-0\">\r\n        <TopNav onMenuClick={() => setSidebarOpen(true)} />\r\n        <main className=\"flex-1 px-3 sm:px-4 md:px-6 lg:px-8 py-4 sm:py-5 md:py-6\">\r\n          <div className=\"w-full max-w-7xl mx-auto\">\r\n            <div className=\"bg-primary/10 rounded-lg py-6 sm:py-8 md:py-10 mb-6 text-center\">\r\n              <h1 className=\"text-2xl sm:text-3xl font-bold text-primary\">Specialties Management</h1>\r\n              <p className=\"text-gray-500 mt-2\">Manage medical specialties for the platform</p>\r\n            </div>\r\n\r\n            <div className=\"space-y-6\">\r\n              <div className=\"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4\">\r\n                <div className=\"flex items-center gap-3 flex-1 max-w-md\">\r\n                  <div className=\"relative flex-1\">\r\n                    <FaSearch className=\"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400\" />\r\n                    <Input type=\"text\" placeholder=\"Search specialties...\" value={search} onChange={(e) => setSearch(e.target.value)} className=\"pl-10\" />\r\n                  </div>\r\n                </div>\r\n                <Button className=\"flex items-center gap-2 bg-primary hover:bg-primary/90\" onClick={() => handleOpenModal('add')}>\r\n                  <FaPlus /> Add Specialty\r\n                </Button>\r\n              </div>\r\n\r\n              <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6\">\r\n                {[1, 2, 3].map(i => (\r\n                  <div key={i} className=\"bg-white p-6 rounded-2xl shadow-sm border border-gray-100\">\r\n                    <div className=\"flex items-center justify-between\">\r\n                      <div className=\"space-y-2\">\r\n                        <p className=\"text-sm font-medium text-gray-500\">{i === 1 ? 'Total' : i === 2 ? 'Active' : 'Inactive'}</p>\r\n                        {loading ? <Skeleton className=\"h-8 w-12\" /> : <p className=\"text-2xl font-bold text-gray-900 mt-1\">{i === 1 ? total : i === 2 ? specialties.filter(s => s.isActive).length : specialties.filter(s => !s.isActive).length}</p>}\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                ))}\r\n              </div>\r\n\r\n              <div className=\"bg-white rounded-2xl shadow-sm overflow-hidden\">\r\n                <div className=\"overflow-x-auto\">\r\n                  <table className=\"w-full\">\r\n                    <thead className=\"bg-gray-50 border-b border-gray-200\">\r\n                      <tr>\r\n                        <th className=\"px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Name</th>\r\n                        <th className=\"px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Description</th>\r\n                        <th className=\"px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Status</th>\r\n                        <th className=\"px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Created</th>\r\n                        <th className=\"px-6 py-4 text-right text-xs font-medium text-gray-500 uppercase tracking-wider\">Actions</th>\r\n                      </tr>\r\n                    </thead>\r\n                    <tbody className=\"divide-y divide-gray-200\">\r\n                      {loading ? (\r\n                        Array.from({ length: 5 }).map((_, i) => (\r\n                          <tr key={i}>\r\n                            <td className=\"px-6 py-4\"><Skeleton className=\"h-4 w-32\" /></td>\r\n                            <td className=\"px-6 py-4\"><Skeleton className=\"h-4 w-48\" /></td>\r\n                            <td className=\"px-6 py-4\"><Skeleton className=\"h-6 w-16 rounded-full\" /></td>\r\n                            <td className=\"px-6 py-4\"><Skeleton className=\"h-4 w-24\" /></td>\r\n                            <td className=\"px-6 py-4 text-right\"><Skeleton className=\"h-8 w-24 ml-auto\" /></td>\r\n                          </tr>\r\n                        ))\r\n                      ) : specialties.length === 0 ? (\r\n                        <tr><td colSpan={5} className=\"px-6 py-12 text-center text-gray-500\">No specialties found</td></tr>\r\n                      ) : (\r\n                        specialties.map((specialty) => (\r\n                          <tr key={specialty._id} className=\"hover:bg-gray-50\">\r\n                            <td className=\"px-6 py-4\"><div className=\"text-sm font-medium text-gray-900\">{specialty.name}</div></td>\r\n                            <td className=\"px-6 py-4\"><div className=\"text-sm text-gray-500 max-w-xs truncate\" title={specialty.description}>{specialty.description || 'No description'}</div></td>\r\n                            <td className=\"px-6 py-4\"><span className={`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${specialty.isActive ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}`}>{specialty.isActive ? 'Active' : 'Inactive'}</span></td>\r\n                            <td className=\"px-6 py-4 text-sm text-gray-500\">{formatDate(specialty.createdAt)}</td>\r\n                            <td className=\"px-6 py-4 text-right\">\r\n                              <div className=\"flex items-center justify-end gap-2\">\r\n                                <button onClick={() => handleToggleStatus(specialty)} className={`p-2 rounded-lg transition-colors ${specialty.isActive ? 'text-red-600 hover:bg-red-50' : 'text-green-600 hover:bg-green-50'}`} title={specialty.isActive ? 'Deactivate' : 'Activate'}>{specialty.isActive ? <FaToggleOff /> : <FaToggleOn />}</button>\r\n                                <button onClick={() => handleOpenModal('edit', specialty)} className=\"p-2 text-blue-600 hover:bg-blue-50 rounded-lg transition-colors\" title=\"Edit Specialty\"><FaEdit /></button>\r\n                                <button onClick={() => handleDeleteClick(specialty._id, specialty.name)} className=\"p-2 text-red-600 hover:bg-red-50 rounded-lg transition-colors\" title=\"Delete Specialty\"><FaTrash /></button>\r\n                              </div>\r\n                            </td>\r\n                          </tr>\r\n                        ))\r\n                      )}\r\n                    </tbody>\r\n                  </table>\r\n                </div>\r\n\r\n                {totalPages > 1 && (\r\n                  <div className=\"px-6 py-4 border-t border-gray-200 flex items-center justify-between\">\r\n                    <div className=\"text-sm text-gray-700\">Showing {((currentPage - 1) * limit) + 1} to {Math.min(currentPage * limit, total)} of {total} results</div>\r\n                    <div className=\"flex gap-2\">\r\n                      <button onClick={() => setCurrentPage(prev => Math.max(prev - 1, 1))} disabled={currentPage === 1} className=\"px-3 py-1 border border-gray-300 rounded-md text-sm disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-50\">Previous</button>\r\n                      <span className=\"px-3 py-1 text-sm\">Page {currentPage} of {totalPages}</span>\r\n                      <button onClick={() => setCurrentPage(prev => Math.min(prev + 1, totalPages))} disabled={currentPage === totalPages} className=\"px-3 py-1 border border-gray-300 rounded-md text-sm disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-50\">Next</button>\r\n                    </div>\r\n                  </div>\r\n                )}\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </main>\r\n      </div>\r\n\r\n      {/* Delete Confirmation Alert */}\r\n      <AlertDialog\r\n        open={deleteAlertOpen}\r\n        onOpenChange={setDeleteAlertOpen}\r\n        title=\"Delete Specialty\"\r\n        description={`Are you sure you want to delete \"${specialtyToDelete?.name}\"? This action cannot be undone.`}\r\n        confirmText=\"Delete\"\r\n        cancelText=\"Cancel\"\r\n        onConfirm={handleConfirmDelete}\r\n        variant=\"destructive\"\r\n      />\r\n\r\n      {/* Specialty Modal */}\r\n      <AnimatePresence>\r\n        {isModalOpen && (\r\n          <div className=\"fixed inset-0 z-[100] flex items-center justify-center p-4\">\r\n            <motion.div\r\n              initial={{ opacity: 0 }}\r\n              animate={{ opacity: 1 }}\r\n              exit={{ opacity: 0 }}\r\n              onClick={() => setIsModalOpen(false)}\r\n              className=\"absolute inset-0 bg-slate-900/60 backdrop-blur-sm\"\r\n            />\r\n            <motion.div\r\n              initial={{ scale: 0.95, opacity: 0 }}\r\n              animate={{ scale: 1, opacity: 1 }}\r\n              exit={{ scale: 0.95, opacity: 0 }}\r\n              className=\"relative w-full max-w-md bg-white rounded-2xl shadow-2xl overflow-hidden\"\r\n            >\r\n              <div className=\"p-6 border-b border-slate-100 flex items-center justify-between\">\r\n                <h3 className=\"text-xl font-bold text-slate-900\">\r\n                  {modalMode === 'add' ? 'Add New Specialty' : 'Edit Specialty'}\r\n                </h3>\r\n                <button onClick={() => setIsModalOpen(false)} className=\"text-slate-400 hover:text-slate-600 transition-colors\">\r\n                  <FaTimes size={20} />\r\n                </button>\r\n              </div>\r\n\r\n              <form onSubmit={handleSubmit}>\r\n                <div className=\"p-6 space-y-4\">\r\n                  <div>\r\n                    <label className=\"block text-sm font-medium text-slate-700 mb-2\">Specialty Name</label>\r\n                    <Input\r\n                      type=\"text\"\r\n                      value={formData.name}\r\n                      onChange={(e) => setFormData({ ...formData, name: e.target.value })}\r\n                      placeholder=\"e.g. Cardiology\"\r\n                      autoFocus\r\n                    />\r\n                  </div>\r\n                  <div>\r\n                    <label className=\"block text-sm font-medium text-slate-700 mb-2\">Description</label>\r\n                    <textarea\r\n                      value={formData.description}\r\n                      onChange={(e) => setFormData({ ...formData, description: e.target.value })}\r\n                      placeholder=\"Enter description...\"\r\n                      className=\"w-full h-32 p-3 border border-slate-200 rounded-xl focus:ring-2 focus:ring-primary focus:border-transparent outline-none transition-all resize-none text-sm\"\r\n                    />\r\n                  </div>\r\n                </div>\r\n\r\n                <div className=\"p-6 bg-slate-50 flex items-center justify-end gap-3\">\r\n                  <button\r\n                    type=\"button\"\r\n                    onClick={() => setIsModalOpen(false)}\r\n                    className=\"px-6 py-2 text-slate-600 font-semibold hover:text-slate-900 transition-colors\"\r\n                  >\r\n                    Cancel\r\n                  </button>\r\n                  <Button\r\n                    type=\"submit\"\r\n                    disabled={isSubmitting}\r\n                    className=\"px-8\"\r\n                  >\r\n                    {isSubmitting ? (\r\n                      <div className=\"flex items-center gap-2\">\r\n                        <div className=\"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin\" />\r\n                        Saving...\r\n                      </div>\r\n                    ) : (\r\n                      modalMode === 'add' ? 'Create Specialty' : 'Update Specialty'\r\n                    )}\r\n                  </Button>\r\n                </div>\r\n              </form>\r\n            </motion.div>\r\n          </div>\r\n        )}\r\n      </AnimatePresence>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default AdminSpecialties;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\nithi\\OneDrive\\Documents\\Brototype\\Takecare\\frontend\\src\\pages\\admin\\auth\\Login.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":58,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":58,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2307,2310],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2307,2310],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useCallback, useMemo } from \"react\";\r\nimport { useNavigate } from \"react-router-dom\";\r\nimport { useDispatch } from \"react-redux\";\r\nimport authService from \"../../../services/authService\";\r\nimport { setUser } from \"../../../redux/user/userSlice\";\r\nimport Input from \"../../../components/Input\";\r\nimport Button from \"../../../components/Button\";\r\nimport { toast } from \"sonner\";\r\n\r\ninterface FormData { email: string; password: string; }\r\ntype Errors = Partial<Record<keyof FormData, string>>;\r\nconst EMAIL_REGEX = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;\r\n\r\nconst AdminLogin: React.FC = () => {\r\n  const navigate = useNavigate();\r\n  const dispatch = useDispatch();\r\n  const [formData, setFormData] = useState<FormData>({ email: \"\", password: \"\" });\r\n  const [errors, setErrors] = useState<Errors>({});\r\n  const [submitting, setSubmitting] = useState(false);\r\n\r\n  const validate = useCallback((data: FormData): Errors => {\r\n    const e: Errors = {};\r\n    if (!data.email.trim()) e.email = \"Email is required.\";\r\n    else if (!EMAIL_REGEX.test(data.email)) e.email = \"Enter a valid email.\";\r\n    if (!data.password) e.password = \"Password is required.\";\r\n    return e;\r\n  }, []);\r\n\r\n  const formErrors = useMemo(() => validate(formData), [formData, validate]);\r\n  const isValid = useMemo(() => Object.keys(formErrors).length === 0, [formErrors]);\r\n\r\n  const handleChange = useCallback((e: React.ChangeEvent<HTMLInputElement>) => {\r\n    const { name, value } = e.target;\r\n    setFormData((prev) => ({ ...prev, [name]: value }));\r\n    setErrors((prev) => {\r\n      const next = { ...prev }; delete next[name as keyof FormData]; return next;\r\n    });\r\n  }, []);\r\n\r\n  const handleSubmit = useCallback(async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    const validation = validate(formData);\r\n    setErrors(validation);\r\n    if (Object.keys(validation).length > 0) return;\r\n\r\n    try {\r\n      setSubmitting(true);\r\n      const response = await authService.adminLogin({ ...formData, role: \"admin\" });\r\n      if (response.success && response.data?.token) {\r\n\r\n        if (response.data?.user) {\r\n          const user = response.data.user;\r\n\r\n          dispatch(setUser({\r\n            _id: user.id,\r\n            name: user.name,\r\n            email: user.email,\r\n            role: user.role as any,\r\n          }));\r\n        }\r\n        toast.success(\"Admin login successful!\");\r\n        navigate(\"/admin/dashboard\");\r\n      } else {\r\n        toast.error(response.message || \"Login failed.\");\r\n      }\r\n    } catch {\r\n      toast.error(\"Login failed. Please try again.\");\r\n    } finally {\r\n      setSubmitting(false);\r\n    }\r\n  }, [formData, validate, navigate, dispatch]);\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-white flex items-center justify-center p-4\">\r\n      <div className=\"w-full max-w-6xl grid lg:grid-cols-2 gap-8 lg:gap-16 items-center\">\r\n        {/* Illustration */}\r\n        <div className=\"flex justify-center lg:justify-end\">\r\n          <div className=\"relative w-full max-w-sm px-4\">\r\n            <img src=\"/admin profile.png\" alt=\"Admin Illustration\" className=\"w-full h-auto object-contain\" />\r\n          </div>\r\n        </div>\r\n        {/* Form */}\r\n        <div className=\"w-full max-w-md mx-auto lg:mx-0\">\r\n          <div className=\"bg-white rounded-2xl shadow-xl p-8 lg:p-10\">\r\n            <div className=\"mb-8\">\r\n              <h1 className=\"text-3xl font-bold text-gray-800\">Admin Login</h1>\r\n            </div>\r\n            <form onSubmit={handleSubmit} noValidate className=\"space-y-5\" aria-describedby=\"formErrors\">\r\n              {Object.keys(errors).length > 0 && (\r\n                <div id=\"formErrors\" className=\"text-sm text-red-600\">Please fix the highlighted fields.</div>\r\n              )}\r\n              <Input\r\n                label=\"Email\"\r\n                name=\"email\"\r\n                type=\"email\"\r\n                value={formData.email}\r\n                onChange={handleChange}\r\n                error={errors.email}\r\n                disabled={submitting}\r\n              />\r\n              <Input\r\n                label=\"Password\"\r\n                name=\"password\"\r\n                type=\"password\"\r\n                value={formData.password}\r\n                onChange={handleChange}\r\n                error={errors.password}\r\n                disabled={submitting}\r\n              />\r\n              <Button type=\"submit\" loading={submitting} disabled={!isValid || submitting} className=\"w-full py-3 mt-6\">\r\n                {submitting ? \"Logging in...\" : \"Login\"}\r\n              </Button>\r\n            </form>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default AdminLogin;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\nithi\\OneDrive\\Documents\\Brototype\\Takecare\\frontend\\src\\pages\\consultation\\ChatPage.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":842,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":842,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[33249,33252],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[33249,33252],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":895,"column":73,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":895,"endColumn":76,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[35323,35326],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[35323,35326],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":899,"column":86,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":899,"endColumn":89,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[35615,35618],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[35615,35618],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":929,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":929,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[36604,36607],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[36604,36607],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":940,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":940,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[37002,37005],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[37002,37005],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1095,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1095,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[43008,43011],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[43008,43011],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1115,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1115,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[43865,43868],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[43865,43868],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1150,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1150,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[45194,45197],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[45194,45197],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1173,"column":73,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1173,"endColumn":76,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[46046,46049],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[46046,46049],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1220,"column":53,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1220,"endColumn":56,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[48673,48676],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[48673,48676],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1276,"column":110,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1276,"endColumn":113,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[51135,51138],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[51135,51138],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1517,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1517,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[66556,66559],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[66556,66559],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":12,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"∩╗┐import React, { useState, useRef, useEffect } from 'react';\r\nimport { motion, AnimatePresence } from 'framer-motion';\r\nimport {\r\n    Send, Smile, MoreVertical,\r\n    ChevronLeft, Check, CheckCheck,\r\n    Info, Search, Plus, Camera, Paperclip, Mic, Trash2, Pause, Play,\r\n    Menu, ArrowLeft, Lock, MessagesSquare, X, Download, ExternalLink, XCircle, Clock, ClipboardList,\r\n    StickyNote, BookOpen, Loader2\r\n} from 'lucide-react';\r\nimport type { EmojiClickData } from 'emoji-picker-react';\r\nimport EmojiPicker from 'emoji-picker-react';\r\nimport { useParams, useNavigate, useLocation } from 'react-router-dom';\r\nimport { Button } from '../../components/ui/button';\r\nimport { Card, CardHeader } from '../../components/ui/card';\r\nimport { Input } from '../../components/ui/input';\r\nimport Cropper from 'react-easy-crop';\r\nimport { getCroppedImg } from '../../utils/cropImage';\r\nimport {\r\n    Dialog,\r\n    DialogContent,\r\n    DialogHeader,\r\n    DialogTitle,\r\n    DialogFooter,\r\n} from '../../components/ui/dialog';\r\nimport { Skeleton } from '../../components/ui/skeleton';\r\nimport { useSocket } from '../../context/SocketContext';\r\nimport { useSelector } from 'react-redux';\r\nimport { selectCurrentUser } from '../../redux/user/userSlice';\r\nimport { chatService } from '../../services/chatService';\r\nimport type { IMessage } from '../../services/chatService';\r\nimport { appointmentService } from '../../services/appointmentService';\r\n\r\nimport { toast } from 'sonner';\r\nimport { API_BASE_URL, SESSION_STATUS } from '../../utils/constants';\r\nimport type { SessionStatus } from '../../utils/constants';\r\nimport type { Area } from 'react-easy-crop';\r\n\r\n\r\ninterface Patient {\r\n    _id: string;\r\n    name: string;\r\n    customId: string;\r\n    gender: string;\r\n    dob: string;\r\n    bloodGroup: string;\r\n    profileImage: string;\r\n}\r\n\r\ninterface Doctor {\r\n    _id: string;\r\n    userId?: {\r\n        _id: string;\r\n        name: string;\r\n        profileImage: string;\r\n    };\r\n    profileImage: string;\r\n    specialty?: string;\r\n}\r\n\r\ninterface IDoctorNote {\r\n    id: string;\r\n    title: string;\r\n    description: string;\r\n    category?: string;\r\n    dosage?: string;\r\n    frequency?: string;\r\n    duration?: string;\r\n    createdAt: string;\r\n}\r\n\r\ninterface Appointment {\r\n    _id: string;\r\n    patientId?: Patient;\r\n    doctorId?: Doctor;\r\n    appointmentDate?: string | Date;\r\n    appointmentTime?: string;\r\n    status: string;\r\n    TEST_NEEDED?: boolean;\r\n    postConsultationChatWindow?: {\r\n        isActive: boolean;\r\n        expiresAt: string;\r\n    };\r\n    doctorNotes?: IDoctorNote[];\r\n    patient?: Patient;\r\n    customId?: string;\r\n    sessionStatus?: SessionStatus;\r\n    conversationId?: string;\r\n}\r\n\r\ninterface Conversation {\r\n    appointmentId: string;\r\n    conversationId: string;\r\n    realAppointmentId?: string;\r\n    patient?: Patient;\r\n    doctor?: Doctor;\r\n    lastMessage?: {\r\n        content: string;\r\n        createdAt: string;\r\n        senderModel?: string;\r\n        type?: string;\r\n    };\r\n    isOnline?: boolean;\r\n    unreadCount: number;\r\n}\r\n\r\ninterface ActiveChat {\r\n    id: string;\r\n    name: string;\r\n    specialty: string;\r\n    avatar: string;\r\n    online: boolean;\r\n    unread: number;\r\n}\r\n\r\ninterface Message {\r\n    id: string | number;\r\n    sender: 'user' | 'other';\r\n    text: string;\r\n    time: string;\r\n    status: 'sent' | 'delivered' | 'read' | 'sending' | 'failed';\r\n    type: 'text' | 'file' | 'image' | 'system' | 'audio';\r\n    fileName?: string;\r\n    fileSize?: string;\r\n    isDeleted?: boolean;\r\n    isEdited?: boolean;\r\n}\r\n\r\n\r\n\r\n\r\nconst isAudioUrl = (url: string) => {\r\n    return /\\.(mp3|wav|ogg|webm)$/i.test(url) || url.includes('voice-note-');\r\n};\r\n\r\nconst CustomAudioPlayer = ({ src, isUser }: { src: string, isUser: boolean }) => {\r\n    const [isPlaying, setIsPlaying] = useState(false);\r\n    const [progress, setProgress] = useState(0);\r\n    const [duration, setDuration] = useState(0);\r\n    const audioRef = useRef<HTMLAudioElement>(null);\r\n\r\n    const togglePlay = () => {\r\n        if (audioRef.current) {\r\n            if (isPlaying) {\r\n                audioRef.current.pause();\r\n            } else {\r\n                audioRef.current.play();\r\n            }\r\n            setIsPlaying(!isPlaying);\r\n        }\r\n    };\r\n\r\n    useEffect(() => {\r\n        const audio = audioRef.current;\r\n        if (!audio) return;\r\n\r\n        const updateDuration = () => {\r\n            if (audio.duration && !isNaN(audio.duration)) {\r\n                setDuration(audio.duration);\r\n            }\r\n        };\r\n\r\n        const updateTime = () => {\r\n            if (audio.duration) {\r\n                setProgress((audio.currentTime / audio.duration) * 100);\r\n            }\r\n        };\r\n\r\n        const onEnded = () => setIsPlaying(false);\r\n\r\n        audio.addEventListener('loadedmetadata', updateDuration);\r\n        audio.addEventListener('timeupdate', updateTime);\r\n        audio.addEventListener('ended', onEnded);\r\n\r\n        if (audio.readyState >= 1) {\r\n            updateDuration();\r\n        }\r\n\r\n        return () => {\r\n            audio.removeEventListener('loadedmetadata', updateDuration);\r\n            audio.removeEventListener('timeupdate', updateTime);\r\n            audio.removeEventListener('ended', onEnded);\r\n        };\r\n    }, []);\r\n\r\n    const formatTime = (time: number) => {\r\n        if (isNaN(time)) return \"0:00\";\r\n        const min = Math.floor(time / 60);\r\n        const sec = Math.floor(time % 60);\r\n        return `${min}:${sec < 10 ? '0' + sec : sec}`;\r\n    };\r\n\r\n\r\n    const bars = React.useMemo(() => Array.from({ length: 28 }, () => Math.floor(Math.random() * 8) + 2), []);\r\n\r\n    return (\r\n        <div className={`flex items-center gap-3 min-w-[240px] p-2 rounded-2xl transition-all select-none ${isUser\r\n            ? ''\r\n            : 'bg-white border border-slate-100 shadow-sm'\r\n            }`}>\r\n\r\n            <button\r\n                onClick={togglePlay}\r\n                className={`flex items-center justify-center w-10 h-10 rounded-full shadow-sm transition-all active:scale-95 ${isUser\r\n                    ? 'bg-white text-[#00A1B0] hover:bg-white/90'\r\n                    : 'bg-[#00A1B0] text-white hover:bg-[#008f9c] hover:shadow-md hover:shadow-[#00A1B0]/20'\r\n                    }`}\r\n            >\r\n                {isPlaying ? <Pause size={16} fill=\"currentColor\" /> : <Play size={16} fill=\"currentColor\" className=\"ml-1\" />}\r\n            </button>\r\n\r\n            <div className=\"flex-1 flex flex-col justify-center gap-1.5 min-w-0\">\r\n                {/* Visualizer & Progress Track */}\r\n                <div\r\n                    className=\"h-6 flex items-center gap-0.5 cursor-pointer relative group\"\r\n                    onClick={(e) => {\r\n                        const bounds = e.currentTarget.getBoundingClientRect();\r\n                        const percent = Math.min(1, Math.max(0, (e.clientX - bounds.left) / bounds.width));\r\n                        if (audioRef.current && Number.isFinite(audioRef.current.duration)) {\r\n                            audioRef.current.currentTime = percent * audioRef.current.duration;\r\n                        }\r\n                    }}\r\n                >\r\n                    {bars.map((height, i) => {\r\n                        const barPercent = (i / bars.length) * 100;\r\n                        const isActive = barPercent <= progress;\r\n                        return (\r\n                            <div\r\n                                key={i}\r\n                                className={`w-1 rounded-full transition-all duration-300 ${isActive\r\n                                    ? (isUser ? 'bg-white' : 'bg-[#00A1B0]')\r\n                                    : (isUser ? 'bg-white/30' : 'bg-slate-200')\r\n                                    }`}\r\n                                style={{\r\n                                    height: `${isPlaying ? Math.max(3, height + Math.random() * 4) : height}px`,\r\n                                    opacity: isActive ? 1 : 0.6\r\n                                }}\r\n                            />\r\n                        );\r\n                    })}\r\n\r\n                    {/* Invisible slider for smoother seek interaction */}\r\n                    <div className=\"absolute inset-0 w-full h-full opacity-0 z-10 cursor-pointer\" />\r\n                </div>\r\n\r\n                <div className={`flex justify-between text-[10px] font-bold tracking-wider uppercase ${isUser ? 'text-white/80' : 'text-slate-400'}`}>\r\n                    <span>{formatTime(audioRef.current?.currentTime || 0)}</span>\r\n                    <span>{formatTime(duration)}</span>\r\n                </div>\r\n            </div>\r\n            <audio ref={audioRef} src={src} preload=\"metadata\" />\r\n        </div>\r\n    );\r\n};\r\n\r\nconst ChatPage = () => {\r\n    const navigate = useNavigate();\r\n    const location = useLocation();\r\n    const { id } = useParams();\r\n    const isDoctor = location.pathname.startsWith('/doctor');\r\n    const [isSidebarOpen, setIsSidebarOpen] = useState(id === 'default' || window.innerWidth >= 768);\r\n    const [showEmojiPicker, setShowEmojiPicker] = useState(false);\r\n    const [showAttachmentMenu, setShowAttachmentMenu] = useState(false);\r\n    const attachmentMenuRef = useRef<HTMLDivElement>(null);\r\n    const fileInputRef = useRef<HTMLInputElement>(null);\r\n\r\n    // Image Cropping \r\n    const [imageToCrop, setImageToCrop] = useState<string | null>(null);\r\n    const [crop, setCrop] = useState({ x: 0, y: 0 });\r\n    const [zoom, setZoom] = useState(1);\r\n    const [rotation, setRotation] = useState(0);\r\n    const [croppedAreaPixels, setCroppedAreaPixels] = useState<Area | null>(null);\r\n    const [isCropping, setIsCropping] = useState(false);\r\n    const [isUploading, setIsUploading] = useState(false);\r\n    const [aspectRatio, setAspectRatio] = useState(4 / 3);\r\n    const [selectedAspect, setSelectedAspect] = useState('4:3');\r\n\r\n    // Edit/Delete \r\n    const [editingMessageId, setEditingMessageId] = useState<string | number | null>(null);\r\n    const [editingContent, setEditingContent] = useState(\"\");\r\n    const [deleteConfirmMessageId, setDeleteConfirmMessageId] = useState<string | number | null>(null);\r\n    const [showWindUpConfirm, setShowWindUpConfirm] = useState(false);\r\n    const [previewImage, setPreviewImage] = useState<string | null>(null);\r\n    const [showClinicalNotesMobile, setShowClinicalNotesMobile] = useState(false);\r\n\r\n    const attachmentOptions = [\r\n        { id: 'image', label: 'Image', icon: <Camera className=\"h-5 w-5\" />, color: 'bg-rose-500' },\r\n    ];\r\n\r\n    useEffect(() => {\r\n        const handleClickOutside = (event: MouseEvent) => {\r\n            if (attachmentMenuRef.current && !attachmentMenuRef.current.contains(event.target as Node)) {\r\n                setShowAttachmentMenu(false);\r\n            }\r\n        };\r\n        document.addEventListener('mousedown', handleClickOutside);\r\n        return () => document.removeEventListener('mousedown', handleClickOutside);\r\n    }, []);\r\n\r\n    const handleBackToWebsite = () => {\r\n\r\n        navigate(isDoctor ? '/doctor/dashboard' : '/patient/dashboard');\r\n\r\n    };\r\n\r\n    const { socket, onlineUsers } = useSocket();\r\n    const user = useSelector(selectCurrentUser);\r\n    const [appointment, setAppointment] = useState<Appointment | null>(null);\r\n    const [conversations, setConversations] = useState<Conversation[]>([]);\r\n    const [isLoading, setIsLoading] = useState(true);\r\n    const [isConversationsLoading, setIsConversationsLoading] = useState(true);\r\n\r\n    const [activeChat, setActiveChat] = useState<ActiveChat>({\r\n        id: '0',\r\n        name: 'Loading...',\r\n        specialty: '...',\r\n        avatar: 'default',\r\n        online: false,\r\n        unread: 0\r\n    });\r\n\r\n    const [messages, setMessages] = useState<Message[]>([]);\r\n    const [inputValue, setInputValue] = useState(\"\");\r\n    const [currentConversationId, setCurrentConversationId] = useState<string | null>(null);\r\n    const [currentAppointmentId, setCurrentAppointmentId] = useState<string | null>(null);\r\n\r\n    const [noteTitle, setNoteTitle] = useState(\"\");\r\n    const [noteDescription, setNoteDescription] = useState(\"\");\r\n    const [noteCategory, setNoteCategory] = useState<'observation' | 'diagnosis' | 'medicine' | 'lab_test'>(\"observation\");\r\n    const [noteDosage, setNoteDosage] = useState(\"\");\r\n    const [noteFrequency, setNoteFrequency] = useState(\"\");\r\n    const [noteDuration, setNoteDuration] = useState(\"\");\r\n    const [isSavingNote, setIsSavingNote] = useState(false);\r\n\r\n    const handleSaveNote = async () => {\r\n        const appointmentId = currentAppointmentId || id;\r\n        if (!appointmentId || !noteTitle.trim()) {\r\n            toast.error(\"Please provide at least a title\");\r\n            return;\r\n        }\r\n\r\n        if (noteCategory === 'medicine') {\r\n            if (!noteDosage.trim() || !noteFrequency.trim() || !noteDuration.trim()) {\r\n                toast.error(\"Please provide dosage, frequency and duration\");\r\n                return;\r\n            }\r\n        } else {\r\n            if (!noteDescription.trim()) {\r\n                toast.error(\"Please provide a description\");\r\n                return;\r\n            }\r\n        }\r\n\r\n        try {\r\n            setIsSavingNote(true);\r\n            const newNote = {\r\n                id: Date.now().toString(),\r\n                title: noteTitle,\r\n                description: noteDescription,\r\n                category: noteCategory,\r\n                dosage: noteCategory === 'medicine' ? noteDosage : undefined,\r\n                frequency: noteCategory === 'medicine' ? noteFrequency : undefined,\r\n                duration: noteCategory === 'medicine' ? noteDuration : undefined,\r\n                createdAt: new Date().toISOString()\r\n            };\r\n\r\n            const res = await appointmentService.updateDoctorNotes(appointmentId, newNote);\r\n            if (res.success) {\r\n                toast.success(`${noteCategory.replace('_', ' ')} saved successfully`);\r\n                setAppointment((prev) => {\r\n                    if (!prev) return null;\r\n                    return {\r\n                        ...prev,\r\n                        doctorNotes: [...(prev.doctorNotes || []), newNote]\r\n                    };\r\n                });\r\n\r\n                setNoteTitle(\"\");\r\n                setNoteDescription(\"\");\r\n                setNoteDosage(\"\");\r\n                setNoteFrequency(\"\");\r\n                setNoteDuration(\"\");\r\n            }\r\n        } catch (error: unknown) {\r\n            toast.error(error instanceof Error ? error.message : \"Failed to save note\");\r\n        } finally {\r\n            setIsSavingNote(false);\r\n        }\r\n    };\r\n\r\n\r\n\r\n\r\n\r\n    const [isOtherTyping, setIsOtherTyping] = useState(false);\r\n    const [typingRooms, setTypingRooms] = useState<Record<string, boolean>>({});\r\n    const typingTimeoutRef = useRef<number | undefined>(undefined);\r\n    const messagesEndRef = useRef<HTMLDivElement>(null);\r\n\r\n    // Voice Recording \r\n    const [isRecording, setIsRecording] = useState(false);\r\n    const [isPaused, setIsPaused] = useState(false);\r\n    const [recordingTime, setRecordingTime] = useState(0);\r\n    const recordingTimeRef = useRef(0);\r\n    const [audioLevels, setAudioLevels] = useState<number[]>([]);\r\n    const mediaRecorderRef = useRef<MediaRecorder | null>(null);\r\n    const audioChunksRef = useRef<Blob[]>([]);\r\n    const analyzerRef = useRef<AnalyserNode | null>(null);\r\n    const animationFrameRef = useRef<number | null>(null);\r\n    const timerIntervalRef = useRef<number | undefined>(undefined);\r\n\r\n\r\n\r\n    // Session Control \r\n    const [sessionStatus, setSessionStatus] = useState<SessionStatus | \"idle\">(\"idle\");\r\n    const [isTimeOver, setIsTimeOver] = useState(false);\r\n    const [extensionCount, setExtensionCount] = useState(0);\r\n\r\n    const isPostConsultationWindowOpen = React.useMemo(() => {\r\n        if (!appointment?.postConsultationChatWindow) return false;\r\n        const { isActive, expiresAt } = appointment.postConsultationChatWindow;\r\n        if (!isActive || !expiresAt) return false;\r\n        return new Date(expiresAt) > new Date();\r\n    }, [appointment]);\r\n\r\n    const canStartSession = React.useMemo(() => {\r\n        if (!appointment?.appointmentDate) return false;\r\n\r\n        const now = new Date();\r\n        const appDate = new Date(appointment.appointmentDate);\r\n\r\n\r\n        const todayStart = new Date(now.getFullYear(), now.getMonth(), now.getDate());\r\n        const appDateStart = new Date(appDate.getFullYear(), appDate.getMonth(), appDate.getDate());\r\n\r\n\r\n        return appDateStart <= todayStart;\r\n    }, [appointment]);\r\n\r\n    const handleDisableChat = async () => {\r\n        const appointmentId = currentAppointmentId || id;\r\n        if (!appointmentId) return;\r\n        try {\r\n            const res = await appointmentService.disablePostConsultationChat(appointmentId);\r\n            if (res.success) {\r\n                toast.success(\"Chat window closed manually.\");\r\n\r\n                setSessionStatus(SESSION_STATUS.ENDED);\r\n                setAppointment((prev) => {\r\n                    if (!prev) return null;\r\n                    return {\r\n                        ...prev,\r\n                        postConsultationChatWindow: {\r\n                            isActive: false,\r\n                            expiresAt: prev.postConsultationChatWindow?.expiresAt || \"\"\r\n                        }\r\n                    };\r\n                });\r\n            }\r\n        } catch (error: unknown) {\r\n            const errorMessage = error instanceof Error ? error.message : \"Failed to close chat\";\r\n            toast.error(errorMessage);\r\n        }\r\n    };\r\n\r\n    const updateSessionStatus = React.useCallback(async (status: SessionStatus) => {\r\n        const appointmentId = currentAppointmentId || id;\r\n        if (!appointmentId) return;\r\n        try {\r\n            await appointmentService.updateSessionStatus(appointmentId, status);\r\n        } catch (error) {\r\n            console.error(\"Failed to update session status\", error);\r\n            toast.error(\"Failed to update session status\");\r\n        }\r\n    }, [currentAppointmentId, id]);\r\n\r\n\r\n\r\n    useEffect(() => {\r\n        if (!appointment || appointment.status === 'completed' || sessionStatus === SESSION_STATUS.ENDED) return;\r\n\r\n        const checkTime = () => {\r\n\r\n            if (sessionStatus === SESSION_STATUS.CONTINUED_BY_DOCTOR || sessionStatus === SESSION_STATUS.TEST_NEEDED || appointment?.TEST_NEEDED || extensionCount > 0 || isPostConsultationWindowOpen) {\r\n                if (isTimeOver) setIsTimeOver(false);\r\n                return;\r\n            }\r\n\r\n            const now = new Date();\r\n            const timeStr = appointment.appointmentTime;\r\n            if (!timeStr) return;\r\n\r\n            const parts = timeStr.split('-');\r\n            const endTimeStr = parts[1];\r\n            if (!endTimeStr) return;\r\n\r\n            const [hours, minutes] = endTimeStr.trim().split(':');\r\n            const sessionEnd = new Date(appointment.appointmentDate || new Date());\r\n            sessionEnd.setHours(parseInt(hours), parseInt(minutes), 0, 0);\r\n\r\n            if (now > sessionEnd) {\r\n                if (!isTimeOver && !isPostConsultationWindowOpen) {\r\n                    setIsTimeOver(true);\r\n\r\n                    if (sessionStatus !== SESSION_STATUS.WAITING_FOR_DOCTOR && !isDoctor) {\r\n                        updateSessionStatus(SESSION_STATUS.WAITING_FOR_DOCTOR);\r\n                    }\r\n                }\r\n            } else {\r\n                if (isTimeOver) setIsTimeOver(false);\r\n            }\r\n        };\r\n\r\n        const interval = setInterval(checkTime, 1000);\r\n        return () => clearInterval(interval);\r\n    }, [appointment, sessionStatus, isDoctor, isTimeOver, extensionCount, updateSessionStatus, isPostConsultationWindowOpen]);\r\n\r\n    useEffect(() => {\r\n        if (!socket) return;\r\n\r\n        interface SessionStatusData {\r\n            appointmentId: string;\r\n            customId?: string;\r\n            status: SessionStatus;\r\n            extensionCount?: number;\r\n            postConsultationChatWindow?: { isActive: boolean; expiresAt: string };\r\n            TEST_NEEDED?: boolean;\r\n        }\r\n\r\n        const onSessionStatusUpdated = (data: SessionStatusData) => {\r\n            console.log(\"[SOCKET] Session status updated:\", data);\r\n\r\n\r\n            const matchId = appointment?._id || id;\r\n            const matchCustomId = appointment?.customId;\r\n\r\n            const isMatch =\r\n                data.appointmentId === matchId ||\r\n                String(data.appointmentId) === String(matchId) ||\r\n                (data.customId && matchCustomId && data.customId === matchCustomId) ||\r\n                (data.customId && data.customId === id) ||\r\n                (data.appointmentId === id);\r\n\r\n            if (isMatch) {\r\n\r\n\r\n                setSessionStatus(data.status);\r\n                if (data.extensionCount !== undefined) setExtensionCount(data.extensionCount);\r\n\r\n\r\n                if (data.postConsultationChatWindow) {\r\n                    setAppointment((prev) => {\r\n                        if (!prev) return null;\r\n                        const updated = {\r\n                            ...prev,\r\n                            postConsultationChatWindow: data.postConsultationChatWindow,\r\n                            TEST_NEEDED: data.TEST_NEEDED\r\n                        };\r\n                        console.log(\"[CHAT_PAGE] Updated appointment postConsultationChatWindow:\", updated.postConsultationChatWindow);\r\n\r\n\r\n                        return { ...updated };\r\n                    });\r\n\r\n                    if (data.postConsultationChatWindow.isActive) {\r\n                        toast.success(\"Consultation Chat Unlocked for 24 Hours\");\r\n                        setIsTimeOver(false);\r\n\r\n\r\n                        const appointmentId = currentAppointmentId || id;\r\n                        if (appointmentId) {\r\n                            chatService.getAppointment(appointmentId).then((res) => {\r\n                                if (res.data) setAppointment(res.data);\r\n                            }).catch(err => console.error(\"Failed to refresh appointment:\", err));\r\n                        }\r\n                    } else if (data.postConsultationChatWindow.isActive === false) {\r\n                        toast.info(\"Consultation Chat has been closed\");\r\n                    }\r\n                }\r\n\r\n                if (data.status === SESSION_STATUS.ACTIVE) {\r\n                    setIsTimeOver(false);\r\n                }\r\n\r\n                if (data.status === \"ENDED\") {\r\n                    setIsOtherTyping(false);\r\n                    setConversations(prev => prev.map(c => c.appointmentId === data.appointmentId ? { ...c, unreadCount: 0 } : c));\r\n                }\r\n            } else {\r\n                console.warn(\"[SOCKET] Session update received for different appointment:\", data.appointmentId, \"Expected:\", matchId);\r\n            }\r\n\r\n            setConversations((prev: Conversation[]) => prev.map(conv => {\r\n                if (conv.appointmentId === data.appointmentId) {\r\n                    return { ...conv, status: data.status };\r\n                }\r\n                return conv;\r\n            }));\r\n        };\r\n        const onSessionEnded = (data: { appointmentId: string }) => {\r\n            if (data.appointmentId === (appointment?._id || id)) {\r\n                console.log(\"[SOCKET] Session ended for:\", data.appointmentId);\r\n                toast.info(\"Session has been ended.\");\r\n                setSessionStatus(SESSION_STATUS.ENDED);\r\n                setIsOtherTyping(false);\r\n            }\r\n        };\r\n\r\n        socket.on(\"session-status-updated\", onSessionStatusUpdated);\r\n        socket.on(\"session-ended\", onSessionEnded);\r\n\r\n        return () => {\r\n            socket.off(\"session-status-updated\", onSessionStatusUpdated);\r\n            socket.off(\"session-ended\", onSessionEnded);\r\n        };\r\n    }, [socket, appointment, id, isDoctor, navigate]);\r\n\r\n    const getAvatarUrl = (profileImage: string | null | undefined, name: string) => {\r\n        if (profileImage) {\r\n            if (profileImage.startsWith('http')) return profileImage;\r\n            return `${API_BASE_URL}/${profileImage.replace(/\\\\/g, '/')}`;\r\n        }\r\n        return `https://api.dicebear.com/7.x/avataaars/svg?seed=${name}`;\r\n    };\r\n\r\n    useEffect(() => {\r\n        const fetchConversations = async () => {\r\n            if (!user) return;\r\n            setIsConversationsLoading(true);\r\n            try {\r\n                const response = await chatService.getConversations();\r\n                setConversations(response.data || []);\r\n            } catch (error) {\r\n                console.error(\"Failed to fetch conversations\", error);\r\n            } finally {\r\n                setIsConversationsLoading(false);\r\n            }\r\n        };\r\n        fetchConversations();\r\n    }, [user]);\r\n\r\n\r\n    // 4. Socket Synchronization - Dedicated Effect\r\n    useEffect(() => {\r\n        if (!socket || !currentConversationId || !user) return;\r\n\r\n        console.log(\"[SOCKET] Setting up listeners for:\", currentConversationId);\r\n        const convId = currentConversationId;\r\n        const myUserId = String(user.id || (user as { _id?: string })._id || \"\");\r\n\r\n        const performJoin = () => {\r\n            socket.emit('join-chat', convId);\r\n            socket.emit('mark-read', { id: convId, userId: myUserId });\r\n        };\r\n\r\n        const handleNewMessage = (newMessage: IMessage) => {\r\n\r\n            const msgConvId = String(newMessage.conversationId || \"\");\r\n            const msgAppId = String(newMessage.appointmentId || \"\");\r\n\r\n\r\n            const isRelevant = msgConvId === convId || msgAppId === id;\r\n\r\n            if (!isRelevant) return;\r\n\r\n            const isFromMe = (newMessage.senderModel === 'User' && !isDoctor) || (newMessage.senderModel === 'Doctor' && isDoctor);\r\n            const senderType = isFromMe ? 'user' : 'other';\r\n\r\n            const uiMsg: Message = {\r\n                id: newMessage._id || newMessage.id || Date.now(),\r\n                sender: senderType,\r\n                text: newMessage.content,\r\n                time: new Date(newMessage.createdAt || Date.now()).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' }),\r\n                status: newMessage.read ? 'read' : 'delivered',\r\n                type: newMessage.type as 'text' | 'file' | 'image' | 'system',\r\n                isDeleted: newMessage.isDeleted,\r\n                isEdited: newMessage.isEdited,\r\n            };\r\n\r\n            setMessages(prev => {\r\n                const mId = String(uiMsg.id);\r\n\r\n                if (prev.some(m => String(m.id) === mId)) return prev;\r\n\r\n\r\n                if (senderType === 'user') {\r\n                    const tempIdx = prev.findIndex(m =>\r\n                        String(m.id).startsWith('temp-') &&\r\n                        m.text === newMessage.content &&\r\n                        m.sender === 'user'\r\n                    );\r\n\r\n                    if (tempIdx !== -1) {\r\n                        const updated = [...prev];\r\n                        updated[tempIdx] = uiMsg;\r\n                        return updated;\r\n                    }\r\n                }\r\n\r\n\r\n                return [...prev, uiMsg];\r\n            });\r\n        };\r\n\r\n        const handleSocketEdit = (updated: IMessage) => {\r\n            if (String(updated.conversationId) === convId) {\r\n                setMessages(prev => prev.map(m => String(m.id) === String(updated._id || updated.id) ? { ...m, text: updated.content, isEdited: true } : m));\r\n            }\r\n        };\r\n\r\n        const handleSocketDelete = ({ messageId, conversationId }: { messageId: string, conversationId: string }) => {\r\n            if (conversationId === convId) {\r\n                setMessages(prev => prev.map(m => String(m.id) === String(messageId) ? { ...m, isDeleted: true } : m));\r\n            }\r\n        };\r\n\r\n        const onTyping = ({ id: typingId, userId: typingUserId, isTyping }: { id: string, userId: string, isTyping: boolean }) => {\r\n            if (typingId === convId && String(typingUserId) !== myUserId) {\r\n                setIsOtherTyping(isTyping);\r\n            }\r\n\r\n            setTypingRooms(prev => ({ ...prev, [typingId]: isTyping }));\r\n        };\r\n\r\n        const onRead = ({ id: readId }: { id: string }) => {\r\n            if (readId === convId) {\r\n                setMessages(prev => prev.map(msg => ({ ...msg, status: 'read' as const })));\r\n            }\r\n        };\r\n\r\n        socket.on('receive-message', handleNewMessage);\r\n        socket.on('edit-message', handleSocketEdit);\r\n        socket.on('delete-message', handleSocketDelete);\r\n        socket.on('user-typing', onTyping);\r\n        socket.on('messages-read', onRead);\r\n\r\n        performJoin();\r\n        socket.on('connect', performJoin);\r\n\r\n        return () => {\r\n            console.log(\"[SOCKET] Cleaning up listeners for:\", currentConversationId);\r\n            socket.off('connect', performJoin);\r\n            socket.off('receive-message', handleNewMessage);\r\n            socket.off('edit-message', handleSocketEdit);\r\n            socket.off('delete-message', handleSocketDelete);\r\n            socket.off('user-typing', onTyping);\r\n            socket.off('messages-read', onRead);\r\n            socket.emit('leave-chat', convId);\r\n        };\r\n    }, [socket, currentConversationId, user, isDoctor, id]);\r\n\r\n\r\n    useEffect(() => {\r\n        if (!socket || !user) return;\r\n\r\n        const updateSidebar = (newMessage: IMessage) => {\r\n            const msgConvId = String(newMessage.conversationId || \"\");\r\n            const msgAppId = String(newMessage.appointmentId || \"\");\r\n\r\n            setConversations(prev => {\r\n\r\n                const exists = prev.some(c =>\r\n                    String(c.conversationId) === msgConvId ||\r\n                    String(c.appointmentId) === msgConvId ||\r\n                    (msgAppId && (String(c.conversationId) === msgAppId || String(c.appointmentId) === msgAppId))\r\n                );\r\n\r\n                if (!exists) return prev;\r\n\r\n                return prev.map(conv => {\r\n                    const cId = String(conv.conversationId || \"\");\r\n                    const aId = String(conv.appointmentId || \"\");\r\n\r\n                    if (cId === msgConvId || aId === msgConvId || (msgAppId && (cId === msgAppId || aId === msgAppId))) {\r\n                        return {\r\n                            ...conv,\r\n                            lastMessage: {\r\n                                content: newMessage.content,\r\n                                createdAt: newMessage.createdAt || new Date().toISOString(),\r\n                                senderModel: newMessage.senderModel,\r\n                                type: newMessage.type\r\n                            },\r\n                        };\r\n                    }\r\n                    return conv;\r\n                }).sort((a, b) => {\r\n                    const timeA = a.lastMessage?.createdAt ? new Date(a.lastMessage.createdAt).getTime() : 0;\r\n                    const timeB = b.lastMessage?.createdAt ? new Date(b.lastMessage.createdAt).getTime() : 0;\r\n                    return timeB - timeA;\r\n                });\r\n            });\r\n        };\r\n\r\n        socket.on('receive-message', updateSidebar);\r\n        return () => {\r\n            socket.off('receive-message', updateSidebar);\r\n        };\r\n    }, [socket, user]);\r\n\r\n    useEffect(() => {\r\n        const initChatContext = async () => {\r\n            if (!id || id === 'default' || !user) {\r\n                setIsLoading(false);\r\n                if (id === 'default') {\r\n                    setActiveChat({\r\n                        id: '0',\r\n                        name: 'Select a consultation',\r\n                        specialty: 'No active session',\r\n                        avatar: 'default',\r\n                        online: false,\r\n                        unread: 0\r\n                    });\r\n                }\r\n                return;\r\n            }\r\n\r\n            setIsLoading(true);\r\n            try {\r\n\r\n                const convData = await chatService.getConversation(id);\r\n                if (!convData) throw new Error(\"Conversation not found\");\r\n\r\n                const convId = convData._id || convData.id;\r\n                setCurrentConversationId(convId);\r\n\r\n                setSessionStatus(convData.sessionStatus || (convData.isLocked ? SESSION_STATUS.ENDED : SESSION_STATUS.ACTIVE));\r\n                if (convData.activeAppointmentId) {\r\n                    setCurrentAppointmentId(convData.activeAppointmentId);\r\n                    const appResponse = await chatService.getAppointment(convData.activeAppointmentId);\r\n                    setAppointment(appResponse.data);\r\n                }\r\n\r\n                const isPMe = !isDoctor;\r\n\r\n                const otherParty = isPMe ? convData.doctor : convData.patient;\r\n                const otherName = isPMe\r\n                    ? (otherParty?.userId?.name || otherParty?.name || 'Doctor')\r\n                    : (otherParty?.name || 'Patient');\r\n                const otherAvatarRaw = isPMe\r\n                    ? otherParty?.userId?.profileImage || otherParty?.profileImage\r\n                    : otherParty?.profileImage;\r\n\r\n                const getOnlineId = (party: any) => party?.userId?._id || party?._id;\r\n\r\n                setActiveChat({\r\n                    id: otherParty?._id || otherParty?.id || \"\",\r\n                    name: otherName,\r\n                    specialty: otherParty?.specialty || 'General',\r\n                    avatar: getAvatarUrl(otherAvatarRaw, otherName),\r\n                    online: onlineUsers.includes(getOnlineId(otherParty)),\r\n                    unread: 0\r\n                });\r\n\r\n                const history = await chatService.getMessages(convId);\r\n                const uiMessages: Message[] = history.map((m: IMessage) => ({\r\n                    id: m._id || m.id || Date.now(),\r\n                    sender: (m.senderModel === 'User' && !isDoctor) || (m.senderModel === 'Doctor' && isDoctor) ? 'user' : 'other',\r\n                    text: m.content,\r\n                    time: new Date(m.createdAt).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' }),\r\n                    status: m.read ? 'read' : 'delivered',\r\n                    type: m.type as 'text' | 'file' | 'image' | 'system',\r\n                    fileName: m.fileName,\r\n                    isDeleted: m.isDeleted,\r\n                    isEdited: m.isEdited,\r\n                }));\r\n                setMessages(uiMessages);\r\n\r\n            } catch (error) {\r\n                console.error(\"Failed to load chat\", error);\r\n            } finally {\r\n                setIsLoading(false);\r\n            }\r\n        };\r\n\r\n        if (user) initChatContext();\r\n    }, [id, user, isDoctor, onlineUsers]);\r\n\r\n\r\n\r\n    const scrollToBottom = () => {\r\n        messagesEndRef.current?.scrollIntoView({ behavior: \"smooth\" });\r\n    };\r\n\r\n    useEffect(() => {\r\n        scrollToBottom();\r\n    }, [messages]);\r\n\r\n\r\n    const onEmojiClick = (emojiData: EmojiClickData) => {\r\n        setInputValue((prev) => prev + emojiData.emoji);\r\n    };\r\n\r\n    const handleTyping = () => {\r\n        const roomId = currentConversationId || id;\r\n        if (!socket || !roomId || !user) return;\r\n        socket.emit('typing', { id: roomId, userId: user.id || (user as any)._id });\r\n        if (typingTimeoutRef.current) window.clearTimeout(typingTimeoutRef.current);\r\n        typingTimeoutRef.current = window.setTimeout(() => {\r\n            if (socket && roomId && user) {\r\n                socket.emit('stop-typing', { id: roomId, userId: user.id || (user as any)._id });\r\n            }\r\n        }, 2000);\r\n    };\r\n\r\n    const handleSendMessage = async () => {\r\n        const targetId = currentConversationId || id;\r\n        if (!inputValue.trim() || !targetId || !socket) return;\r\n\r\n        const currentVal = inputValue;\r\n        setInputValue(\"\");\r\n        setShowEmojiPicker(false);\r\n\r\n        const tempId = `temp-${Date.now()}`;\r\n        const newMessage: Message = {\r\n            id: tempId,\r\n            sender: 'user',\r\n            text: currentVal,\r\n            time: new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' }),\r\n            status: 'sent',\r\n            type: 'text',\r\n        };\r\n\r\n        setMessages(prev => [...prev, newMessage]);\r\n\r\n        const socketData = {\r\n            id: tempId,\r\n            conversationId: currentConversationId,\r\n            appointmentId: appointment?._id || (currentConversationId ? null : id),\r\n            content: currentVal,\r\n            senderId: user?.id || (user as any)?._id,\r\n            senderModel: isDoctor ? 'Doctor' : 'User',\r\n            type: 'text',\r\n            createdAt: new Date().toISOString(),\r\n            status: 'sent'\r\n        };\r\n\r\n        socket.emit('send-message', socketData);\r\n\r\n        try {\r\n            const savedMessage = await chatService.sendMessage(targetId, currentVal, 'text');\r\n            const permanentId = (savedMessage as any)._id || savedMessage.id;\r\n\r\n            setMessages(prev => prev.map(m =>\r\n                String(m.id) === tempId ? { ...m, id: permanentId } : m\r\n            ));\r\n        } catch (error) {\r\n            console.error(\"Failed to persist message\", error);\r\n            setMessages(prev => prev.map(m => m.id === tempId ? { ...m, status: 'failed' } : m));\r\n            toast.error(\"Failed to send message\");\r\n        }\r\n    };\r\n\r\n    const handleDeleteMessage = async (messageId: string | number) => {\r\n        const idStr = String(messageId);\r\n        if (idStr.startsWith('temp-')) {\r\n            toast.error(\"Please wait for the message to be sent before deleting\");\r\n            return;\r\n        }\r\n\r\n        console.log(`[CHAT_PAGE] Attempting to delete message: ${idStr}`);\r\n        try {\r\n            await chatService.deleteMessage(idStr);\r\n            setMessages(prev => prev.map(m =>\r\n                String(m.id) === idStr ? { ...m, isDeleted: true } : m\r\n            ));\r\n\r\n            if (socket) {\r\n                const targetId = currentConversationId || id;\r\n                socket.emit('delete-message', { messageId: idStr, conversationId: targetId });\r\n            }\r\n\r\n            toast.success(\"Message deleted\");\r\n        } catch (error) {\r\n            console.error(\"Failed to delete message\", error);\r\n            toast.error(\"Failed to delete message. Please try again.\");\r\n        } finally {\r\n            setDeleteConfirmMessageId(null);\r\n        }\r\n    };\r\n\r\n    const handleEditMessage = (msg: Message) => {\r\n        const idStr = String(msg.id);\r\n        if (idStr.startsWith('temp-')) {\r\n            toast.error(\"Please wait for the message to be sent before editing\");\r\n            return;\r\n        }\r\n        setEditingMessageId(msg.id);\r\n        setEditingContent(msg.text);\r\n    };\r\n\r\n    const handleSaveEdit = async () => {\r\n        if (!editingMessageId || !editingContent.trim()) return;\r\n\r\n        const idStr = String(editingMessageId);\r\n        const originalMessage = messages.find(m => m.id === editingMessageId);\r\n        const originalContent = originalMessage?.text || \"\";\r\n\r\n        console.log(`[CHAT_PAGE] Attempting to save edit for message: ${idStr}`);\r\n\r\n        setMessages(prev => prev.map(m =>\r\n            String(m.id) === idStr ? { ...m, text: editingContent, isEdited: true } : m\r\n        ));\r\n\r\n        setEditingMessageId(null);\r\n        setEditingContent(\"\");\r\n\r\n        try {\r\n            await chatService.editMessage(idStr, editingContent);\r\n            if (socket) {\r\n                const targetId = currentConversationId || id;\r\n                socket.emit('edit-message', {\r\n                    _id: idStr,\r\n                    conversationId: targetId,\r\n                    content: editingContent,\r\n                    senderModel: isDoctor ? 'Doctor' : 'User'\r\n                });\r\n            }\r\n        } catch (error) {\r\n            console.error(\"Failed to edit message\", error);\r\n            toast.error(\"Failed to save changes. Please try again.\");\r\n            setMessages(prev => prev.map(m =>\r\n                String(m.id) === idStr ? { ...m, text: originalContent, isEdited: originalMessage?.isEdited || false } : m\r\n            ));\r\n        }\r\n    };\r\n\r\n    const handleDownload = async (url: string, fileName: string) => {\r\n        try {\r\n            const toastId = toast.loading(`Preparing download...`);\r\n            const response = await fetch(url);\r\n            const blob = await response.blob();\r\n            const blobUrl = window.URL.createObjectURL(blob);\r\n            const link = document.createElement('a');\r\n            link.href = blobUrl;\r\n            link.download = fileName;\r\n            document.body.appendChild(link);\r\n            link.click();\r\n            document.body.removeChild(link);\r\n            window.URL.revokeObjectURL(blobUrl);\r\n            toast.dismiss(toastId);\r\n        } catch (error) {\r\n            console.error(\"Download failed\", error);\r\n            window.open(url, '_blank');\r\n        }\r\n    };\r\n\r\n    const handleFileUpload = async (e: React.ChangeEvent<HTMLInputElement>) => {\r\n        const file = e.target.files?.[0];\r\n        if (!file || !id) return;\r\n\r\n\r\n        const validTypes = ['image/jpeg', 'image/png', 'image/gif', 'image/jpg'];\r\n        if (!validTypes.includes(file.type)) {\r\n            toast.error(\"Only image files (JPG, PNG, GIF) are allowed\");\r\n            if (fileInputRef.current) fileInputRef.current.value = \"\";\r\n            return;\r\n        }\r\n\r\n        if (file.size > 4 * 1024 * 1024) {\r\n            toast.error(\"Image size must be less than 4MB\");\r\n            if (fileInputRef.current) fileInputRef.current.value = \"\";\r\n            return;\r\n        }\r\n\r\n        const reader = new FileReader();\r\n        reader.addEventListener('load', () => {\r\n            setImageToCrop(reader.result as string);\r\n            setIsCropping(true);\r\n        });\r\n        reader.readAsDataURL(file);\r\n    };\r\n\r\n    const onCropComplete = (_: Area, croppedAreaPixels: Area) => {\r\n        setCroppedAreaPixels(croppedAreaPixels);\r\n    };\r\n\r\n    const handleCropSave = async () => {\r\n        if (!imageToCrop || !croppedAreaPixels || !id) return;\r\n\r\n        setIsUploading(true);\r\n        let imageUrl = '';\r\n        try {\r\n            const croppedImageBlob = await getCroppedImg(imageToCrop, croppedAreaPixels);\r\n            if (!croppedImageBlob) throw new Error(\"Cropping failed\");\r\n\r\n\r\n            const targetId = currentConversationId || id;\r\n            const croppedFile = new File([croppedImageBlob], `cropped-image-${Date.now()}.jpg`, { type: 'image/jpeg' });\r\n            imageUrl = await chatService.uploadAttachment(targetId, croppedFile);\r\n\r\n            const socketData = {\r\n                id: `temp-${Date.now()}`,\r\n                conversationId: currentConversationId,\r\n                appointmentId: appointment?._id || (currentConversationId ? null : id),\r\n                content: imageUrl,\r\n                senderId: user?.id || (user as any)?._id,\r\n                senderModel: isDoctor ? 'Doctor' : 'User',\r\n                type: 'image' as const,\r\n                createdAt: new Date().toISOString(),\r\n                status: 'sending' as const\r\n            };\r\n            if (socket) socket.emit('send-message', socketData);\r\n\r\n            const uiMsg: Message = {\r\n                id: socketData.id,\r\n                sender: 'user',\r\n                text: socketData.content,\r\n                time: new Date(socketData.createdAt).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' }),\r\n                status: 'sending' as const,\r\n                type: 'image',\r\n            };\r\n            setMessages((prev) => [...prev, uiMsg]);\r\n\r\n            const savedMessage = await chatService.sendMessage(targetId, imageUrl, 'image');\r\n\r\n            const permanentId = (savedMessage as any)._id || savedMessage.id;\r\n            const tempId = socketData.id;\r\n\r\n            setMessages(prev => prev.map(m =>\r\n                String(m.id) === tempId ? { ...m, id: permanentId, status: 'sent' } : m\r\n            ));\r\n\r\n            setIsCropping(false);\r\n            setImageToCrop(null);\r\n            toast.success(\"Image sent\");\r\n        } catch (error) {\r\n            console.error(\"Upload failed\", error);\r\n\r\n            setMessages((prev) => prev.map(m => (String(m.id).startsWith('temp-') && m.text === imageUrl) ? { ...m, status: 'failed' as const } : m));\r\n            toast.error(\"Failed to upload image\");\r\n        } finally {\r\n            setIsUploading(false);\r\n        }\r\n    };\r\n\r\n    const formatMessageText = (text: string, isUser: boolean) => {\r\n        const urlRegex = /(https?:\\/\\/[^\\s]+)/g;\r\n        return text.split(urlRegex).map((part, i) => {\r\n            if (part.match(urlRegex)) {\r\n                return (\r\n                    <a key={i} href={part} target=\"_blank\" rel=\"noopener noreferrer\"\r\n                        className={`underline break-all ${isUser ? 'text-white' : 'text-blue-600'} font-bold`}>\r\n                        {part}\r\n                    </a>\r\n                );\r\n            }\r\n            return part;\r\n        });\r\n    };\r\n\r\n    const handleSendAttachment = (option: any) => {\r\n        if (option.id === 'image') {\r\n            if (fileInputRef.current) {\r\n                fileInputRef.current.accept = \"image/*\";\r\n                fileInputRef.current.click();\r\n            }\r\n        }\r\n        setShowAttachmentMenu(false);\r\n    };\r\n\r\n    const formatTime = (seconds: number) => {\r\n        const mins = Math.floor(seconds / 60);\r\n        const secs = seconds % 60;\r\n        return `${mins}:${secs.toString().padStart(2, '0')}`;\r\n    };\r\n\r\n    const startRecording = async () => {\r\n        try {\r\n            const stream = await navigator.mediaDevices.getUserMedia({ audio: true });\r\n            const mediaRecorder = new MediaRecorder(stream);\r\n            mediaRecorderRef.current = mediaRecorder;\r\n            audioChunksRef.current = [];\r\n\r\n            const audioContext = new (window.AudioContext || (window as any).webkitAudioContext)();\r\n            const source = audioContext.createMediaStreamSource(stream);\r\n            const analyzer = audioContext.createAnalyser();\r\n            analyzer.fftSize = 256;\r\n            source.connect(analyzer);\r\n            analyzerRef.current = analyzer;\r\n\r\n            const updateLevels = () => {\r\n                const dataArray = new Uint8Array(analyzer.frequencyBinCount);\r\n                analyzer.getByteFrequencyData(dataArray);\r\n                const avg = dataArray.reduce((p, c) => p + c, 0) / dataArray.length;\r\n                setAudioLevels(prev => [...prev.slice(-30), avg / 2]);\r\n                animationFrameRef.current = requestAnimationFrame(updateLevels);\r\n            };\r\n            updateLevels();\r\n\r\n            mediaRecorder.ondataavailable = (e) => audioChunksRef.current.push(e.data);\r\n            mediaRecorder.onstop = async () => {\r\n                console.log(\"[VOICE] Recording stopped. Chunks:\", audioChunksRef.current.length);\r\n                const audioBlob = new Blob(audioChunksRef.current, { type: mediaRecorder.mimeType || 'audio/webm' });\r\n                const finalTime = recordingTimeRef.current;\r\n\r\n                console.log(`[VOICE] Final duration: ${finalTime}s, Blob size: ${audioBlob.size} bytes`);\r\n\r\n                if (audioChunksRef.current.length > 0 && finalTime > 0) {\r\n                    try {\r\n                        const extension = (mediaRecorder.mimeType || 'audio/webm').split('/')[1].split(';')[0] || 'webm';\r\n                        const audioFile = new File([audioBlob], `voice-note-${Date.now()}.${extension}`, { type: audioBlob.type });\r\n\r\n                        console.log(\"[VOICE] Uploading file:\", audioFile.name, audioFile.type);\r\n                        const audioUrl = await chatService.uploadAttachment(id!, audioFile);\r\n                        console.log(\"[VOICE] Upload successful:\", audioUrl);\r\n\r\n                        const tempId = `temp-voice-${Date.now()}`;\r\n                        const uiMsg: Message = {\r\n                            id: tempId,\r\n                            sender: 'user',\r\n                            text: audioUrl,\r\n                            time: new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' }),\r\n                            status: 'sending',\r\n                            type: 'audio',\r\n                        };\r\n                        setMessages(prev => [...prev, uiMsg]);\r\n\r\n                        const savedMsg = await chatService.sendMessage(id!, audioUrl, 'file', audioFile.name);\r\n\r\n\r\n                        const permId = (savedMsg as any)._id || savedMsg.id;\r\n                        setMessages(prev => prev.map(m => m.id === tempId ? { ...m, id: permId, status: 'sent' } : m));\r\n\r\n                        toast.success(\"Voice note sent\");\r\n                    } catch (error) {\r\n                        console.error(\"[VOICE] Failed to send voice note:\", error);\r\n                        toast.error(\"Failed to send voice note\");\r\n                    }\r\n                } else {\r\n                    console.warn(\"[VOICE] Recording discarded: too short or no data\");\r\n                }\r\n                stream.getTracks().forEach(track => track.stop());\r\n                audioContext.close();\r\n            };\r\n\r\n            mediaRecorder.start();\r\n            setIsRecording(true);\r\n            setRecordingTime(0);\r\n            recordingTimeRef.current = 0;\r\n            timerIntervalRef.current = window.setInterval(() => {\r\n                setRecordingTime(prev => {\r\n                    const next = prev + 1;\r\n                    recordingTimeRef.current = next;\r\n                    return next;\r\n                });\r\n            }, 1000) as unknown as number;\r\n        } catch (err) {\r\n            console.error(\"Recording error:\", err);\r\n            toast.error(\"Could not access microphone\");\r\n        }\r\n    };\r\n\r\n    const stopRecording = () => {\r\n        if (mediaRecorderRef.current && isRecording) {\r\n            mediaRecorderRef.current.stop();\r\n            setIsRecording(false);\r\n            setIsPaused(false);\r\n            if (timerIntervalRef.current) window.clearInterval(timerIntervalRef.current);\r\n            if (animationFrameRef.current) cancelAnimationFrame(animationFrameRef.current);\r\n            setAudioLevels([]);\r\n        }\r\n    };\r\n\r\n    const pauseRecording = () => {\r\n        if (mediaRecorderRef.current && mediaRecorderRef.current.state === 'recording') {\r\n            mediaRecorderRef.current.pause();\r\n            setIsPaused(true);\r\n            if (timerIntervalRef.current) window.clearInterval(timerIntervalRef.current);\r\n            if (animationFrameRef.current) cancelAnimationFrame(animationFrameRef.current);\r\n        }\r\n    };\r\n\r\n    const resumeRecording = () => {\r\n        if (mediaRecorderRef.current && mediaRecorderRef.current.state === 'paused') {\r\n            mediaRecorderRef.current.resume();\r\n            setIsPaused(false);\r\n            timerIntervalRef.current = window.setInterval(() => setRecordingTime(prev => prev + 1), 1000) as any;\r\n            const updateLevels = () => {\r\n                if (analyzerRef.current) {\r\n                    const dataArray = new Uint8Array(analyzerRef.current.frequencyBinCount);\r\n                    analyzerRef.current.getByteFrequencyData(dataArray);\r\n                    const avg = dataArray.reduce((p, c) => p + c, 0) / dataArray.length;\r\n                    setAudioLevels(prev => [...prev.slice(-30), avg / 2]);\r\n                    animationFrameRef.current = requestAnimationFrame(updateLevels);\r\n                }\r\n            };\r\n            updateLevels();\r\n        }\r\n    };\r\n\r\n    const cancelRecording = () => {\r\n        if (mediaRecorderRef.current) {\r\n            audioChunksRef.current = [];\r\n            mediaRecorderRef.current.stop();\r\n            setIsRecording(false);\r\n            setIsPaused(false);\r\n            if (timerIntervalRef.current) window.clearInterval(timerIntervalRef.current);\r\n            if (animationFrameRef.current) cancelAnimationFrame(animationFrameRef.current);\r\n            setAudioLevels([]);\r\n        }\r\n    };\r\n\r\n    return (\r\n        <motion.div\r\n            initial={{ opacity: 0, scale: 0.95, filter: \"blur(4px)\" }}\r\n            animate={{ opacity: 1, scale: 1, filter: \"blur(0px)\" }}\r\n            transition={{ duration: 0.5, ease: [0.22, 1, 0.36, 1] }}\r\n            className=\"flex h-[100dvh] w-full font-sans bg-white text-slate-900 overflow-hidden\"\r\n        >\r\n            {/* Image Cropper Modal - Ultra Professional Responsive Design */}\r\n            <Dialog open={isCropping} onOpenChange={(open) => !isUploading && setIsCropping(open)}>\r\n                <DialogContent className=\"max-w-[95vw] md:max-w-3xl lg:max-w-4xl bg-gradient-to-br from-white via-white to-slate-50 border-slate-200 shadow-2xl p-0 overflow-hidden rounded-2xl md:rounded-3xl max-h-[95vh] flex flex-col\">\r\n                    {/* Header */}\r\n                    <div className=\"p-4 md:p-6 border-b border-slate-200/60 flex items-center justify-between bg-gradient-to-r from-slate-50 to-white\">\r\n                        <div className=\"flex-1\">\r\n                            <DialogTitle className=\"text-lg md:text-xl font-bold text-slate-900 tracking-tight flex items-center gap-2\">\r\n                                <Camera className=\"h-5 w-5 text-[#00A1B0]\" />\r\n                                <span>Edit Image</span>\r\n                            </DialogTitle>\r\n                            <p className=\"text-xs md:text-sm text-slate-500 font-medium mt-1\">Crop, zoom & adjust your photo</p>\r\n                        </div>\r\n                        <div className=\"flex items-center gap-2\">\r\n                            <div className=\"hidden sm:flex items-center gap-1 bg-[#00A1B0]/10 px-3 py-1.5 rounded-lg\">\r\n                                <div className=\"h-2 w-2 bg-[#00A1B0] rounded-full animate-pulse\"></div>\r\n                                <span className=\"text-[10px] font-black uppercase tracking-widest text-[#00A1B0]\">Live Preview</span>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Cropper Area */}\r\n                    <div className=\"relative flex-1 min-h-[300px] md:min-h-[400px] bg-slate-900 overflow-hidden\">\r\n                        <div className=\"absolute inset-0 bg-[radial-gradient(circle_at_center,rgba(0,161,176,0.1)_0%,transparent_70%)] opacity-50\"></div>\r\n                        {imageToCrop && (\r\n                            <Cropper\r\n                                image={imageToCrop}\r\n                                crop={crop}\r\n                                zoom={zoom}\r\n                                rotation={rotation}\r\n                                aspect={aspectRatio}\r\n                                onCropChange={setCrop}\r\n                                onCropComplete={onCropComplete}\r\n                                onZoomChange={setZoom}\r\n                                onRotationChange={setRotation}\r\n                                showGrid={true}\r\n                                objectFit=\"contain\"\r\n                                classes={{\r\n                                    containerClassName: \"h-full w-full\",\r\n                                    mediaClassName: \"max-h-full\"\r\n                                }}\r\n                            />\r\n                        )}\r\n                    </div>\r\n\r\n                    {/* Controls Panel */}\r\n                    <div className=\"p-4 md:p-5 space-y-3 md:space-y-4 bg-white border-t border-slate-100\">\r\n                        {/* Aspect Ratio Selector */}\r\n                        <div className=\"space-y-2\">\r\n                            <label className=\"text-xs font-black text-slate-600 uppercase tracking-wider\">Aspect Ratio</label>\r\n                            <div className=\"grid grid-cols-4 gap-2\">\r\n                                {[\r\n                                    { label: '1:1', value: 1, icon: 'Γûí' },\r\n                                    { label: '4:3', value: 4 / 3, icon: 'Γû¡' },\r\n                                    { label: '16:9', value: 16 / 9, icon: 'Γû¼' },\r\n                                    { label: 'Free', value: 0, icon: 'Γèí' }\r\n                                ].map((ratio) => (\r\n                                    <button\r\n                                        key={ratio.label}\r\n                                        onClick={() => { setAspectRatio(ratio.value || 1); setSelectedAspect(ratio.label); }}\r\n                                        className={`flex flex-col items-center justify-center gap-1 p-3 rounded-xl border-2 transition-all active:scale-95 ${selectedAspect === ratio.label\r\n                                            ? 'border-[#00A1B0] bg-[#00A1B0]/10 text-[#00A1B0]'\r\n                                            : 'border-slate-200 hover:border-slate-300 text-slate-600'\r\n                                            }`}\r\n                                    >\r\n                                        <span className=\"text-2xl\">{ratio.icon}</span>\r\n                                        <span className=\"text-xs font-bold\">{ratio.label}</span>\r\n                                    </button>\r\n                                ))}\r\n                            </div>\r\n                        </div>\r\n\r\n                        {/* Zoom Control */}\r\n                        <div className=\"space-y-3\">\r\n                            <div className=\"flex items-center justify-between\">\r\n                                <label className=\"text-xs font-black text-slate-600 uppercase tracking-wider\">Zoom</label>\r\n                                <span className=\"text-sm font-bold text-[#00A1B0] bg-[#00A1B0]/10 px-3 py-1 rounded-lg\">{zoom.toFixed(1)}x</span>\r\n                            </div>\r\n                            <div className=\"flex items-center gap-3\">\r\n                                <button\r\n                                    onClick={() => setZoom(Math.max(1, zoom - 0.1))}\r\n                                    className=\"p-2 rounded-xl bg-slate-100 hover:bg-slate-200 text-slate-700 transition-colors active:scale-95\"\r\n                                >\r\n                                    <span className=\"text-lg font-bold\">ΓêÆ</span>\r\n                                </button>\r\n                                <input\r\n                                    type=\"range\"\r\n                                    value={zoom}\r\n                                    min={1}\r\n                                    max={3}\r\n                                    step={0.1}\r\n                                    onChange={(e) => setZoom(Number(e.target.value))}\r\n                                    className=\"flex-1 h-2 bg-slate-200 rounded-full appearance-none cursor-pointer accent-[#00A1B0] transition-all\"\r\n                                    style={{\r\n                                        background: `linear-gradient(to right, #00A1B0 0%, #00A1B0 ${((zoom - 1) / 2) * 100}%, #e2e8f0 ${((zoom - 1) / 2) * 100}%, #e2e8f0 100%)`\r\n                                    }}\r\n                                />\r\n                                <button\r\n                                    onClick={() => setZoom(Math.min(3, zoom + 0.1))}\r\n                                    className=\"p-2 rounded-xl bg-slate-100 hover:bg-slate-200 text-slate-700 transition-colors active:scale-95\"\r\n                                >\r\n                                    <Plus className=\"h-5 w-5\" />\r\n                                </button>\r\n                            </div>\r\n                        </div>\r\n\r\n                        {/* Rotation Control */}\r\n                        <div className=\"space-y-3\">\r\n                            <div className=\"flex items-center justify-between\">\r\n                                <label className=\"text-xs font-black text-slate-600 uppercase tracking-wider\">Rotation</label>\r\n                                <span className=\"text-sm font-bold text-[#00A1B0] bg-[#00A1B0]/10 px-3 py-1 rounded-lg\">{rotation}┬░</span>\r\n                            </div>\r\n                            <div className=\"flex items-center gap-3\">\r\n                                <button\r\n                                    onClick={() => setRotation((rotation - 90) % 360)}\r\n                                    className=\"flex-1 flex items-center justify-center gap-2 p-3 rounded-xl bg-slate-100 hover:bg-slate-200 text-slate-700 transition-colors active:scale-95\"\r\n                                >\r\n                                    <span className=\"text-sm font-bold\">Γå║ 90┬░</span>\r\n                                </button>\r\n                                <button\r\n                                    onClick={() => setRotation(0)}\r\n                                    className=\"px-4 py-3 rounded-xl bg-slate-100 hover:bg-slate-200 text-slate-700 transition-colors active:scale-95\"\r\n                                >\r\n                                    <span className=\"text-sm font-bold\">Reset</span>\r\n                                </button>\r\n                                <button\r\n                                    onClick={() => setRotation((rotation + 90) % 360)}\r\n                                    className=\"flex-1 flex items-center justify-center gap-2 p-3 rounded-xl bg-slate-100 hover:bg-slate-200 text-slate-700 transition-colors active:scale-95\"\r\n                                >\r\n                                    <span className=\"text-sm font-bold\">Γå╗ 90┬░</span>\r\n                                </button>\r\n                            </div>\r\n                        </div>\r\n\r\n                        {/* Action Buttons */}\r\n                        <div className=\"flex flex-col sm:flex-row items-center gap-3 pt-2\">\r\n                            <Button\r\n                                variant=\"outline\"\r\n                                onClick={() => { setIsCropping(false); setImageToCrop(null); setRotation(0); setZoom(1); }}\r\n                                disabled={isUploading}\r\n                                className=\"w-full sm:flex-1 h-12 rounded-xl border-2 border-slate-200 text-slate-700 font-bold text-sm hover:bg-slate-50 transition-all active:scale-95\"\r\n                            >\r\n                                Cancel\r\n                            </Button>\r\n                            <Button\r\n                                onClick={handleCropSave}\r\n                                disabled={isUploading}\r\n                                className=\"w-full sm:flex-[2] h-12 rounded-xl bg-gradient-to-r from-[#00A1B0] to-[#008f9c] hover:from-[#008f9c] hover:to-[#007d88] text-white font-bold text-sm shadow-lg shadow-[#00A1B0]/30 transition-all active:scale-95 flex items-center justify-center gap-2\"\r\n                            >\r\n                                {isUploading ? (\r\n                                    <>\r\n                                        <div className=\"h-5 w-5 border-3 border-white/30 border-t-white rounded-full animate-spin\" />\r\n                                        <span>Processing...</span>\r\n                                    </>\r\n                                ) : (\r\n                                    <>\r\n                                        <Send className=\"h-4 w-4\" />\r\n                                        <span>Apply & Send</span>\r\n                                    </>\r\n                                )}\r\n                            </Button>\r\n                        </div>\r\n                    </div>\r\n                </DialogContent>\r\n            </Dialog>\r\n            {/* Sidebar */}\r\n            <aside className={`\r\n                ${isSidebarOpen ? 'w-full md:w-80' : 'w-0'} \r\n                fixed md:relative z-40 h-full bg-slate-50 border-r border-slate-100 transition-all duration-300 ease-in-out flex flex-col\r\n                ${!isSidebarOpen && 'md:w-0 overflow-hidden'}\r\n            `}>\r\n                <div className=\"p-6 pb-4 border-b border-slate-100 bg-white shadow-sm\">\r\n                    <div className=\"flex items-center justify-between mb-4\">\r\n                        <div className=\"flex flex-col\">\r\n                            <h2 className=\"text-xl font-bold text-slate-900 tracking-tight\">Messages</h2>\r\n                            <button\r\n                                onClick={handleBackToWebsite}\r\n                                className=\"flex items-center gap-1.5 text-[10px] font-bold text-[#00A1B0] hover:text-[#008f9c] transition-colors mt-1 uppercase tracking-wider\"\r\n                            >\r\n                                <ArrowLeft className=\"h-3 w-3\" />\r\n                                Back\r\n                            </button>\r\n                        </div>\r\n                        <Button variant=\"ghost\" size=\"icon\" className=\"rounded-full md:hidden text-slate-500\" onClick={() => setIsSidebarOpen(false)}>\r\n                            <ChevronLeft className=\"h-5 w-5\" />\r\n                        </Button>\r\n                    </div>\r\n\r\n                </div>\r\n\r\n                <div className=\"flex-1 overflow-y-auto p-4 space-y-2 custom-scrollbar no-scrollbar\" data-lenis-prevent>\r\n                    {isConversationsLoading ? (\r\n                        <div className=\"flex flex-col gap-4 p-4\">\r\n                            {[1, 2, 3, 4, 5].map(i => (\r\n                                <div key={i} className=\"flex items-center gap-3\">\r\n                                    <Skeleton className=\"h-12 w-12 rounded-full shrink-0 bg-slate-200/50 backdrop-blur-sm\" />\r\n                                    <div className=\"flex-1 space-y-2\">\r\n                                        <Skeleton className=\"h-3 w-2/3 bg-slate-200/50\" />\r\n                                        <Skeleton className=\"h-2 w-full bg-slate-100/50\" />\r\n                                    </div>\r\n                                </div>\r\n                            ))}\r\n                        </div>\r\n                    ) : conversations.length === 0 ? (\r\n                        <div className=\"flex flex-col items-center justify-center p-8 text-center space-y-3\">\r\n                            <Search className=\"h-10 w-10 text-slate-200\" />\r\n                            <p className=\"text-xs font-bold text-slate-400 uppercase tracking-widest\">No conversations</p>\r\n                        </div>\r\n                    ) : (\r\n                        conversations.map((conv: any) => {\r\n\r\n                            const isPMeInList = !isDoctor;\r\n\r\n                            const otherPartyInList = isPMeInList ? conv.doctor : conv.patient;\r\n\r\n\r\n                            const nameInList = isPMeInList\r\n                                ? (otherPartyInList?.userId?.name || otherPartyInList?.name || 'Doctor')\r\n                                : (otherPartyInList?.name || otherPartyInList?.userId?.name || 'Patient');\r\n\r\n\r\n                            const avatarInList = getAvatarUrl(\r\n                                isPMeInList\r\n                                    ? (otherPartyInList?.userId?.profileImage || otherPartyInList?.profileImage)\r\n                                    : (otherPartyInList?.profileImage || otherPartyInList?.userId?.profileImage),\r\n                                nameInList\r\n                            );\r\n                            const isActiveInList = id === conv.conversationId || id === conv.appointmentId;\r\n\r\n                            return (\r\n                                <div\r\n                                    key={conv.conversationId || conv.appointmentId}\r\n                                    onClick={() => {\r\n                                        const navId = conv.conversationId || conv.appointmentId;\r\n                                        navigate(isDoctor ? `/doctor/chat/${navId}` : `/patient/chat/${navId}`);\r\n                                        if (window.innerWidth < 768) setIsSidebarOpen(false);\r\n                                    }}\r\n                                    className={`flex items-center gap-4 p-3 rounded-2xl cursor-pointer transition-all border \r\n                                        ${isActiveInList ? 'bg-white border-[#00A1B0]/30 shadow-md' : 'bg-white border-slate-100 hover:bg-slate-50'}`}\r\n                                >\r\n                                    <div className=\"relative\">\r\n                                        <img src={avatarInList} alt=\"\" className=\"h-12 w-12 rounded-full object-cover bg-slate-100\" />\r\n                                        {onlineUsers.includes(otherPartyInList?.userId?._id || otherPartyInList?._id || \"\") && (\r\n                                            <span className=\"absolute bottom-0 right-0 h-3 w-3 bg-green-500 border-2 border-white rounded-full transition-all duration-300\"></span>\r\n                                        )}\r\n                                    </div>\r\n                                    <div className=\"flex-1 min-w-0\">\r\n                                        <div className=\"flex justify-between items-start\">\r\n                                            <h3 className=\"text-sm font-bold truncate\">{nameInList}</h3>\r\n                                            {conv.lastMessage?.createdAt && <span className=\"text-[10px] text-slate-400\">{new Date(conv.lastMessage.createdAt).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}</span>}\r\n                                        </div>\r\n                                        <p className=\"text-xs text-slate-500 truncate italic\">\r\n                                            {typingRooms[conv.conversationId || conv.appointmentId] ? (\r\n                                                <span className=\"text-[#00A1B0] font-bold animate-pulse\">Typing...</span>\r\n                                            ) : conv.lastMessage?.type === 'image' ? (\r\n                                                <span className=\"flex items-center gap-1.5 \"> <Camera className=\"h-3 w-3\" /> Image</span>\r\n                                            ) : (conv.lastMessage?.type === 'audio' || (conv.lastMessage?.type === 'file' && isAudioUrl(conv.lastMessage?.content || \"\"))) ? (\r\n                                                <span className=\"flex items-center gap-1.5 \"> <Mic className=\"h-3 w-3\" /> Voice Note</span>\r\n                                            ) : (\r\n                                                conv.lastMessage?.content || 'No messages'\r\n                                            )}\r\n                                        </p>\r\n                                    </div>\r\n                                </div>\r\n                            );\r\n                        })\r\n                    )}\r\n                </div>\r\n            </aside>\r\n\r\n            {/* Main Chat Area */}\r\n            <div className={`flex-1 flex flex-col min-w-0 bg-[#fafafa] h-full overflow-hidden relative ${id === 'default' ? 'chat-doodle-bg' : ''}`}>\r\n                {id !== 'default' && (\r\n                    <header className=\"flex-none z-30 flex items-center justify-between px-4 md:px-6 py-3 md:py-4 bg-white border-b border-slate-100 min-h-[64px] md:min-h-[73px]\">\r\n                        {isLoading ? (\r\n                            <div className=\"flex items-center gap-4\">\r\n                                <Skeleton className=\"h-10 w-10 rounded-full bg-slate-200/50\" />\r\n                                <div className=\"space-y-2\">\r\n                                    <Skeleton className=\"h-4 w-32 bg-slate-200/50\" />\r\n                                    <Skeleton className=\"h-3 w-20 bg-slate-100/50\" />\r\n                                </div>\r\n                            </div>\r\n                        ) : (\r\n                            <>\r\n                                <div className=\"flex items-center gap-2 md:gap-4 min-w-0 flex-1\">\r\n                                    {/* Back to Appointments (Mobile Only) */}\r\n                                    <Button\r\n                                        variant=\"ghost\"\r\n                                        size=\"icon\"\r\n                                        onClick={handleBackToWebsite}\r\n                                        className=\"md:hidden text-slate-400 hover:text-slate-900 shrink-0\"\r\n                                        title=\"Exit Chat\"\r\n                                    >\r\n                                        <ArrowLeft className=\"h-5 w-5\" />\r\n                                    </Button>\r\n\r\n                                    {/* Toggle Sidebar / Chat List */}\r\n                                    <Button\r\n                                        variant=\"ghost\"\r\n                                        size=\"icon\"\r\n                                        onClick={() => setIsSidebarOpen(true)}\r\n                                        className=\"md:hidden text-slate-400 hover:text-slate-900 shrink-0\"\r\n                                        title=\"View Chat List\"\r\n                                    >\r\n                                        <Menu className=\"h-5 w-5\" />\r\n                                    </Button>\r\n\r\n                                    {/* Desktop Toggle Sidebar */}\r\n                                    <Button variant=\"ghost\" size=\"icon\" onClick={() => setIsSidebarOpen(!isSidebarOpen)} className=\"rounded-full md:flex hidden text-slate-400 hover:text-slate-900 shrink-0\">\r\n                                        <ChevronLeft className={`transition-transform duration-300 ${!isSidebarOpen ? 'rotate-180' : ''}`} />\r\n                                    </Button>\r\n                                    <div className=\"flex items-center gap-2 sm:gap-3 min-w-0\">\r\n                                        <div className=\"relative shrink-0\">\r\n                                            <img src={activeChat.avatar} alt=\"\" className=\"h-8 w-8 sm:h-10 sm:w-10 rounded-full object-cover border border-slate-100\" />\r\n                                            {activeChat.online && <span className=\"absolute bottom-0 right-0 h-2.5 w-2.5 sm:h-3 sm:w-3 bg-green-500 border-2 border-white rounded-full\"></span>}\r\n                                        </div>\r\n                                        <div className=\"min-w-0\">\r\n                                            <h2 className=\"text-[13px] sm:text-sm font-bold text-slate-900 leading-tight truncate\">{activeChat.name}</h2>\r\n                                            <div className=\"flex items-center gap-1.5 mt-0.5 sm:mt-1 overflow-hidden\">\r\n                                                {isOtherTyping ? (\r\n                                                    <p className=\"text-[9px] sm:text-[10px] text-[#00A1B0] font-bold uppercase tracking-widest animate-pulse truncate\">Typing...</p>\r\n                                                ) : (\r\n                                                    <p className=\"text-[9px] sm:text-[11px] text-slate-500 uppercase tracking-wider font-bold truncate\">\r\n                                                        {activeChat.online ? 'Online' : 'Offline'} <span className=\"hidden xs:inline\">ΓÇó {activeChat.specialty}</span>\r\n                                                    </p>\r\n                                                )}\r\n                                            </div>\r\n                                        </div>\r\n                                    </div>\r\n                                </div>\r\n                                <div className=\"flex items-center gap-1 sm:gap-2 shrink-0\">\r\n                                    {isDoctor && sessionStatus === SESSION_STATUS.ENDED && (\r\n                                        <div className=\"flex items-center gap-1 sm:gap-2\">\r\n                                            {isPostConsultationWindowOpen && (\r\n                                                <div className=\"hidden xs:flex items-center gap-1 sm:gap-2 px-2 sm:px-4 h-8 sm:h-9 bg-amber-50 text-amber-600 rounded-xl text-[8px] sm:text-[10px] font-black uppercase tracking-widest border border-amber-200 shadow-sm\">\r\n                                                    <Clock className=\"h-3 w-3 sm:h-3.5 sm:w-3.5\" /> <span className=\"hidden sm:inline\">Follow-up Open</span>\r\n                                                </div>\r\n                                            )}\r\n                                            <div className=\"flex items-center px-2 sm:px-4 h-8 sm:h-9 bg-slate-100 text-slate-400 rounded-xl text-[8px] sm:text-[10px] font-black uppercase tracking-widest border border-slate-200\">\r\n                                                Ended\r\n                                            </div>\r\n                                        </div>\r\n                                    )}\r\n                                    {isDoctor && sessionStatus !== SESSION_STATUS.ENDED && (\r\n                                        <>\r\n                                            {(sessionStatus === SESSION_STATUS.ACTIVE || sessionStatus === SESSION_STATUS.CONTINUED_BY_DOCTOR) ? (\r\n                                                <Button\r\n                                                    onClick={() => updateSessionStatus(SESSION_STATUS.ENDED)}\r\n                                                    variant=\"destructive\"\r\n                                                    size=\"sm\"\r\n                                                    className=\"flex items-center gap-1 sm:gap-2 rounded-xl px-2 sm:px-4 h-8 sm:h-9 font-black uppercase text-[8px] sm:text-[10px] tracking-widest shadow-lg shadow-red-500/20 active:scale-95 transition-all\"\r\n                                                >\r\n                                                    <XCircle className=\"h-3.5 w-3.5 sm:h-4 sm:w-4\" />\r\n                                                    Wind Up\r\n                                                </Button>\r\n                                            ) : (\r\n                                                !isPostConsultationWindowOpen && (\r\n                                                    canStartSession ? (\r\n                                                        <Button\r\n                                                            onClick={() => updateSessionStatus(SESSION_STATUS.ACTIVE)}\r\n                                                            size=\"sm\"\r\n                                                            className=\"flex items-center gap-1 sm:gap-2 rounded-xl px-2 sm:px-4 h-8 sm:h-9 bg-[#00A1B0] hover:bg-[#008f9c] text-white font-black uppercase text-[8px] sm:text-[10px] tracking-widest shadow-lg shadow-[#00A1B0]/20 active:scale-95 transition-all\"\r\n                                                        >\r\n                                                            <Play className=\"h-3.5 w-3.5 sm:h-4 sm:w-4\" />\r\n                                                            Start\r\n                                                        </Button>\r\n                                                    ) : (\r\n                                                        <div className=\"flex items-center gap-1 sm:gap-2 px-2 sm:px-4 h-8 sm:h-9 bg-slate-100 text-slate-500 rounded-xl text-[8px] sm:text-[10px] font-black uppercase tracking-widest border border-slate-200 cursor-not-allowed\" title={`Scheduled for ${appointment?.appointmentDate ? new Date(appointment.appointmentDate).toLocaleDateString() : 'future'}`}>\r\n                                                            <Clock className=\"h-3 w-3 sm:h-3.5 sm:w-3.5\" />\r\n                                                            Date: {appointment?.appointmentDate ? new Date(appointment.appointmentDate).toLocaleDateString(undefined, { month: 'short', day: 'numeric' }) : 'Future'}\r\n                                                        </div>\r\n                                                    )\r\n                                                )\r\n                                            )}\r\n                                            {isDoctor && isPostConsultationWindowOpen && (\r\n                                                <Button\r\n                                                    onClick={handleDisableChat}\r\n                                                    variant=\"ghost\"\r\n                                                    size=\"sm\"\r\n                                                    className=\"bg-red-50 text-red-600 hover:bg-red-100 hover:text-red-700 font-black uppercase text-[8px] sm:text-[9px] tracking-widest border border-red-200 rounded-full px-2 sm:px-4 h-8 sm:h-9 shadow-sm transition-all active:scale-95\"\r\n                                                >\r\n                                                    <XCircle className=\"h-3 w-3 sm:h-3.5 sm:w-3.5 mr-1 sm:mr-1.5\" /> Close\r\n                                                </Button>\r\n                                            )}\r\n                                        </>\r\n                                    )}\r\n                                    {isDoctor && (\r\n                                        <Button\r\n                                            variant=\"ghost\"\r\n                                            size=\"icon\"\r\n                                            onClick={() => setShowClinicalNotesMobile(true)}\r\n                                            className=\"lg:hidden rounded-lg h-8 w-8 text-[#00A1B0] hover:bg-[#00A1B0]/10 shrink-0\"\r\n                                            title=\"Clinical Notes\"\r\n                                        >\r\n                                            <StickyNote className=\"h-4.5 w-4.5\" />\r\n                                        </Button>\r\n                                    )}\r\n                                    <Button variant=\"ghost\" size=\"icon\" className=\"rounded-full text-slate-400 h-8 w-8 hover:bg-slate-50 shrink-0 hidden sm:flex\"><Search className=\"h-4 w-4\" /></Button>\r\n                                    <Button variant=\"ghost\" size=\"icon\" className=\"rounded-full text-slate-400 h-8 w-8 hover:bg-slate-50 shrink-0\"><MoreVertical className=\"h-4 w-4\" /></Button>\r\n                                </div>\r\n                            </>\r\n                        )}\r\n                    </header>\r\n                )}\r\n\r\n                {id === 'default' ? (\r\n                    <div className=\"flex-1 flex flex-col items-center justify-center p-8 text-center bg-slate-50/50\">\r\n                        <div className=\"h-24 w-24 bg-white rounded-full flex items-center justify-center mb-6 shadow-sm border border-slate-100\">\r\n                            <MessagesSquare className=\"h-10 w-10 text-slate-300\" />\r\n                        </div>\r\n                        <h3 className=\"text-xl font-bold text-slate-700\">Select a conversation</h3>\r\n                        <p className=\"text-slate-400 font-medium mt-2 max-w-xs mx-auto\">Choose a chat from the sidebar to start messaging with your doctor or patient.</p>\r\n                    </div>\r\n                ) : (\r\n                    <>\r\n                        <main className=\"flex-1 min-h-0 overflow-y-auto overflow-x-hidden p-4 md:p-6 space-y-6 custom-scrollbar chat-doodle-bg scroll-smooth touch-auto relative no-scrollbar\" style={{ touchAction: 'auto' }} data-lenis-prevent>\r\n                            <div className=\"max-w-3xl mx-auto flex flex-col gap-4\">\r\n                                {isLoading ? (\r\n                                    <div className=\"space-y-6\">\r\n                                        {[1, 2, 3, 4, 5, 6].map(i => (\r\n                                            <div key={i} className={`flex ${i % 2 === 0 ? 'justify-end' : 'justify-start'}`}>\r\n                                                <div className={`flex flex-col gap-2 max-w-[70%] ${i % 2 === 0 ? 'items-end' : 'items-start'}`}>\r\n                                                    <Skeleton className={`h-11 ${i % 2 === 0 ? 'w-48 bg-[#00A1B0]/10 rounded-tr-sm' : 'w-64 bg-white/80 rounded-tl-sm'} rounded-2xl backdrop-blur-[2px]`} />\r\n                                                    <Skeleton className=\"h-2 w-12 bg-slate-200/40\" />\r\n                                                </div>\r\n                                            </div>\r\n                                        ))}\r\n                                    </div>\r\n                                ) : (\r\n                                    messages.map((msg) => (\r\n                                        <motion.div\r\n                                            key={msg.id}\r\n                                            initial={{ opacity: 0, y: 10 }}\r\n                                            animate={{ opacity: 1, y: 0 }}\r\n                                            className={`flex ${msg.type === 'system' ? 'justify-center' : msg.sender === 'user' ? 'justify-end' : 'justify-start'}`}\r\n                                        >\r\n                                            {msg.type === 'system' ? (\r\n                                                <div className=\"my-4 mx-4 px-4 py-2 bg-slate-100/50 backdrop-blur-sm rounded-2xl md:rounded-full border border-slate-200/40 shadow-sm flex items-center justify-center gap-2.5 animate-in fade-in zoom-in duration-300 max-w-[calc(100%-2rem)]\">\r\n                                                    <div className=\"h-1.5 w-1.5 bg-[#00A1B0] rounded-full animate-pulse shrink-0\" />\r\n                                                    <p className=\"text-[10px] md:text-[11px] font-black text-slate-500 uppercase tracking-[0.1em] text-center break-words whitespace-normal leading-relaxed\">\r\n                                                        {msg.text}\r\n                                                    </p>\r\n                                                    <div className=\"h-1.5 w-1.5 bg-[#00A1B0] rounded-full animate-pulse shrink-0\" />\r\n                                                </div>\r\n                                            ) : (\r\n                                                <div className={`flex flex-col gap-1 max-w-[80%] ${msg.sender === 'user' ? 'items-end' : 'items-start'}`}>\r\n                                                    <div className={`group relative ${msg.type === 'image' ? 'p-0' : `px-3 md:px-4 py-2.5 rounded-2xl text-sm leading-relaxed`} ${msg.type === 'image'\r\n                                                        ? ''\r\n                                                        : msg.sender === 'user'\r\n                                                            ? 'bg-gradient-to-br from-[#00A1B0] to-[#008f9c] text-white shadow-md shadow-[#00A1B0]/20 rounded-tr-sm'\r\n                                                            : 'bg-white text-slate-800 rounded-tl-sm border border-slate-100 shadow-sm'\r\n                                                        } ${msg.isDeleted ? 'opacity-60 bg-slate-100 text-slate-400 border-dashed' : ''}`}>\r\n\r\n                                                        {/* Message Actions - Show on Hover */}\r\n                                                        {(msg.sender === 'user' && !msg.isDeleted) && (\r\n                                                            <div className=\"absolute -left-20 top-1/2 -translate-y-1/2 opacity-0 group-hover:opacity-100 transition-opacity flex items-center gap-1 bg-white shadow-lg border border-slate-100 rounded-full px-2 py-1 z-10\">\r\n                                                                {/* Hide Edit for images */}\r\n                                                                {msg.type !== 'image' && (\r\n                                                                    <button\r\n                                                                        onClick={() => handleEditMessage(msg)}\r\n                                                                        className=\"p-1.5 hover:bg-slate-50 rounded-full text-slate-400 hover:text-[#00A1B0] transition-colors\"\r\n                                                                        title=\"Edit\"\r\n                                                                    >\r\n                                                                        <Plus className=\"h-3.5 w-3.5 rotate-45\" />\r\n                                                                    </button>\r\n                                                                )}\r\n                                                                <button\r\n                                                                    onClick={() => setDeleteConfirmMessageId(msg.id)}\r\n                                                                    className=\"p-1.5 hover:bg-slate-50 rounded-full text-slate-400 hover:text-red-500 transition-colors\"\r\n                                                                    title=\"Delete\"\r\n                                                                >\r\n                                                                    <Trash2 className=\"h-3.5 w-3.5\" />\r\n                                                                </button>\r\n                                                            </div>\r\n                                                        )}\r\n\r\n                                                        {msg.isDeleted ? (\r\n                                                            <div className=\"flex items-center gap-2 italic\">\r\n                                                                <Info className=\"h-3.5 w-3.5\" />\r\n                                                                <span>This message was deleted</span>\r\n                                                            </div>\r\n                                                        ) : String(editingMessageId) === String(msg.id) ? (\r\n                                                            <div className=\"flex flex-col gap-2 min-w-[200px]\">\r\n                                                                <textarea\r\n                                                                    value={editingContent}\r\n                                                                    onChange={(e) => setEditingContent(e.target.value)}\r\n                                                                    className=\"w-full bg-white/10 text-white border border-white/20 rounded-lg p-2 text-sm focus:outline-none focus:ring-1 focus:ring-white/40 min-h-[60px] resize-none\"\r\n                                                                    autoFocus\r\n                                                                />\r\n                                                                <div className=\"flex justify-end gap-2\">\r\n                                                                    <button\r\n                                                                        onClick={() => setEditingMessageId(null)}\r\n                                                                        className=\"px-2 py-1 text-[10px] font-bold uppercase hover:bg-white/10 rounded\"\r\n                                                                    >\r\n                                                                        Cancel\r\n                                                                    </button>\r\n                                                                    <button\r\n                                                                        onClick={handleSaveEdit}\r\n                                                                        className=\"px-2 py-1 text-[10px] font-bold uppercase bg-white text-[#00A1B0] rounded shadow-sm\"\r\n                                                                    >\r\n                                                                        Save\r\n                                                                    </button>\r\n                                                                </div>\r\n                                                            </div>\r\n                                                        ) : msg.type === 'image' ? (\r\n                                                            <div className=\"relative overflow-hidden rounded-2xl border-2 border-slate-100 bg-slate-50 shadow-lg\">\r\n                                                                <img\r\n                                                                    src={msg.text}\r\n                                                                    alt=\"Shared image\"\r\n                                                                    className=\"max-h-[300px] md:max-h-[400px] w-auto object-cover cursor-pointer hover:opacity-95 transition-all duration-300\"\r\n                                                                    onClick={() => setPreviewImage(msg.text)}\r\n                                                                    loading=\"lazy\"\r\n                                                                />\r\n                                                                {/* Image Lightbox Controls */}\r\n                                                                <div className=\"absolute inset-0 bg-gradient-to-t from-black/20 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300\"></div>\r\n                                                                <button\r\n                                                                    onClick={() => setPreviewImage(msg.text)}\r\n                                                                    className=\"absolute top-2 right-2 p-2 rounded-full bg-white/90 backdrop-blur-sm shadow-lg opacity-0 group-hover:opacity-100 transition-all duration-300 hover:bg-white active:scale-95\"\r\n                                                                >\r\n                                                                    <Search className=\"h-4 w-4 text-slate-700\" />\r\n                                                                </button>\r\n                                                            </div>\r\n                                                        ) : (msg.type === 'audio' || (msg.type === 'file' && (isAudioUrl(msg.text) || isAudioUrl(msg.fileName || \"\")))) ? (\r\n                                                            <CustomAudioPlayer src={msg.text} isUser={msg.sender === 'user'} />\r\n                                                        ) : (\r\n                                                            <div className=\"flex flex-col gap-0.5\">\r\n                                                                <p className=\"whitespace-pre-wrap font-medium\">{formatMessageText(msg.text, msg.sender === 'user')}</p>\r\n                                                                {msg.isEdited && (\r\n                                                                    <span className={`text-[9px] uppercase font-bold tracking-tighter self-end opacity-50 ${msg.sender === 'user' ? 'text-white' : 'text-slate-400'}`}>\r\n                                                                        Edited\r\n                                                                    </span>\r\n                                                                )}\r\n                                                            </div>\r\n                                                        )}\r\n                                                    </div>\r\n                                                    <div className=\"flex items-center gap-1 px-1\">\r\n                                                        <span className=\"text-[10px] text-slate-400 font-bold\">{msg.time}</span>\r\n                                                        {msg.sender === 'user' && !msg.isDeleted && (msg.status === 'read' ? <CheckCheck className=\"h-3 w-3 text-[#00A1B0]\" /> : <Check className=\"h-3 w-3 text-slate-300\" />)}\r\n                                                    </div>\r\n                                                </div>\r\n                                            )}\r\n                                        </motion.div>\r\n                                    ))\r\n                                )}\r\n                                {isOtherTyping && (\r\n                                    <div className=\"flex justify-start\">\r\n                                        <div className=\"bg-white px-4 py-2 rounded-2xl border border-slate-100 shadow-sm flex items-center gap-1\">\r\n                                            <div className=\"w-1.5 h-1.5 bg-slate-300 rounded-full animate-bounce\" />\r\n                                            <div className=\"w-1.5 h-1.5 bg-slate-300 rounded-full animate-bounce [animation-delay:0.2s]\" />\r\n                                            <div className=\"w-1.5 h-1.5 bg-slate-300 rounded-full animate-bounce [animation-delay:0.4s]\" />\r\n                                        </div>\r\n                                    </div>\r\n                                )}\r\n                                <div ref={messagesEndRef} />\r\n                            </div>\r\n                        </main>\r\n\r\n                        <footer className=\"flex-none z-30 p-4 bg-white border-t border-slate-100\">\r\n                            {((sessionStatus === SESSION_STATUS.ENDED || (sessionStatus !== \"ACTIVE\" && sessionStatus !== SESSION_STATUS.CONTINUED_BY_DOCTOR && sessionStatus !== \"TEST_NEEDED\" && !appointment?.TEST_NEEDED)) && !isPostConsultationWindowOpen) ? (\r\n                                <div className=\"max-w-3xl mx-auto py-2\">\r\n                                    <div className=\"bg-slate-50 border border-slate-100 rounded-2xl p-4 flex items-center justify-center gap-3 text-slate-500\">\r\n                                        <Lock className=\"h-5 w-5 text-[#00A1B0]\" />\r\n                                        <p className=\"font-bold text-sm tracking-tight text-center\">\r\n                                            {sessionStatus === SESSION_STATUS.ENDED\r\n                                                ? (isDoctor ? \"You have ended this session. No further messages can be sent.\" : \"The doctor has ended the session. This chat is now read-only.\")\r\n                                                : (isDoctor ? \"Please click 'Start Session' in the header to begin interaction.\" : \"Waiting for the doctor to start the session. You can view previous history until then.\")\r\n                                            }\r\n                                        </p>\r\n                                    </div>\r\n                                </div>\r\n                            ) : (\r\n                                <>\r\n                                    {isPostConsultationWindowOpen && (sessionStatus === SESSION_STATUS.ENDED || sessionStatus === SESSION_STATUS.TEST_NEEDED || appointment?.TEST_NEEDED) && (\r\n                                        <div className=\"max-w-3xl mx-auto mb-4\">\r\n                                            <div className=\"bg-gradient-to-r from-amber-50 to-orange-50 border border-amber-200/50 rounded-2xl p-4 flex items-center justify-between shadow-sm\">\r\n                                                <div className=\"flex items-center gap-3\">\r\n                                                    <div className=\"h-10 w-10 bg-amber-100 rounded-xl flex items-center justify-center text-amber-600 shrink-0\">\r\n                                                        <ClipboardList className=\"h-5 w-5 animate-pulse\" />\r\n                                                    </div>\r\n                                                    <div>\r\n                                                        <p className=\"text-[10px] font-black text-amber-800 uppercase tracking-widest leading-none mb-1\">\r\n                                                            {(sessionStatus === SESSION_STATUS.TEST_NEEDED || appointment?.TEST_NEEDED) ? \"Tests Needed - Chat Open\" : \"Follow-up Window Active\"}\r\n                                                        </p>\r\n                                                        <p className=\"text-[12px] font-bold text-amber-600/80 leading-tight\">\r\n                                                            {(sessionStatus === SESSION_STATUS.TEST_NEEDED || appointment?.TEST_NEEDED) ? \"Please upload your test results or discuss with the doctor\" : \"Chat is open for submitting test results & discussion\"}\r\n                                                        </p>\r\n                                                    </div>\r\n                                                </div>\r\n                                                <div className=\"flex items-center gap-2 bg-white/50 px-3 py-1.5 rounded-full border border-amber-100 shrink-0\">\r\n                                                    <Clock className=\"h-3 w-3 text-amber-500\" />\r\n                                                    <span className=\"text-[10px] font-black text-amber-600 uppercase tracking-tighter\">Expires in 24h</span>\r\n                                                </div>\r\n                                            </div>\r\n                                        </div>\r\n                                    )}\r\n                                    <AnimatePresence>\r\n                                        {showEmojiPicker && (\r\n                                            <div className=\"absolute bottom-24 left-6 z-50 shadow-2xl rounded-2xl overflow-hidden border border-slate-100 bg-white\">\r\n                                                <EmojiPicker onEmojiClick={onEmojiClick} width={300} height={400} />\r\n                                            </div>\r\n                                        )}\r\n                                        {showAttachmentMenu && (\r\n                                            <motion.div\r\n                                                ref={attachmentMenuRef}\r\n                                                initial={{ opacity: 0, scale: 0.9, y: 10 }}\r\n                                                animate={{ opacity: 1, scale: 1, y: 0 }}\r\n                                                exit={{ opacity: 0, scale: 0.9, y: 10 }}\r\n                                                className=\"absolute bottom-24 left-6 z-50 bg-[#1e2124] text-white rounded-2xl shadow-2xl p-2 min-w-[180px] border border-white/10\"\r\n                                            >\r\n                                                {attachmentOptions.map((opt) => (\r\n                                                    <button key={opt.id} onClick={() => handleSendAttachment(opt)} className=\"flex items-center gap-3 w-full p-3 hover:bg-white/10 rounded-xl transition-colors text-left\">\r\n                                                        <div className={`p-2 rounded-lg ${opt.color} text-white`}>{opt.icon}</div>\r\n                                                        <span className=\"text-sm font-bold\">{opt.label}</span>\r\n                                                    </button>\r\n                                                ))}\r\n                                            </motion.div>\r\n                                        )}\r\n                                    </AnimatePresence>\r\n\r\n                                    <div className=\"max-w-3xl mx-auto flex items-center gap-2\">\r\n                                        <div className=\"flex items-center gap-1\">\r\n                                            <Button variant=\"ghost\" size=\"icon\" onClick={() => setShowEmojiPicker(!showEmojiPicker)} className={`rounded-full transition-colors ${showEmojiPicker ? 'text-[#00A1B0] bg-slate-50' : 'text-slate-400'}`} disabled={isLoading || isRecording || (isTimeOver && !isDoctor && !isPostConsultationWindowOpen)}>\r\n                                                <Smile className=\"h-5 w-5\" />\r\n                                            </Button>\r\n                                            <Button variant=\"ghost\" size=\"icon\" onClick={() => setShowAttachmentMenu(!showAttachmentMenu)} className={`rounded-full transition-colors ${showAttachmentMenu ? 'text-[#00A1B0] bg-slate-50' : 'text-slate-400'}`} disabled={isLoading || isRecording || (isTimeOver && !isDoctor && !isPostConsultationWindowOpen)}>\r\n                                                <Paperclip className=\"h-5 w-5\" />\r\n                                            </Button>\r\n                                        </div>\r\n\r\n                                        <div className=\"flex-1 relative\">\r\n                                            {isRecording ? (\r\n                                                <div className=\"flex items-center justify-between h-11 px-4 bg-slate-50 border-none rounded-xl\">\r\n                                                    <div className=\"flex items-center gap-3\">\r\n                                                        <div className=\"flex items-center gap-1.5 min-w-[45px]\">\r\n                                                            <div className=\"w-2 h-2 rounded-full bg-red-500 animate-pulse\" />\r\n                                                            <span className=\"text-xs font-bold text-slate-700\">{formatTime(recordingTime)}</span>\r\n                                                        </div>\r\n                                                        <div className=\"flex items-center gap-0.5 h-4\">\r\n                                                            {audioLevels.map((lvl, i) => (\r\n                                                                <div key={i} className=\"w-0.5 bg-[#00A1B0] rounded-full transition-all duration-75\" style={{ height: `${Math.max(2, lvl)}px` }} />\r\n                                                            ))}\r\n                                                        </div>\r\n                                                    </div>\r\n                                                    <div className=\"flex items-center gap-2\">\r\n                                                        <Button variant=\"ghost\" size=\"icon\" onClick={cancelRecording} className=\"h-8 w-8 text-slate-400 hover:text-red-500 rounded-full\">\r\n                                                            <Trash2 className=\"h-4 w-4\" />\r\n                                                        </Button>\r\n                                                        <Button variant=\"ghost\" size=\"icon\" onClick={isPaused ? resumeRecording : pauseRecording} className=\"h-8 w-8 text-slate-400 hover:text-[#00A1B0] rounded-full\">\r\n                                                            {isPaused ? <Play className=\"h-4 w-4\" /> : <Pause className=\"h-4 w-4\" />}\r\n                                                        </Button>\r\n                                                        <Button variant=\"ghost\" size=\"icon\" onClick={stopRecording} className=\"h-8 w-8 bg-[#00A1B0] text-white hover:bg-[#008f9c] rounded-full shadow-lg shadow-[#00A1B0]/20\" disabled={isTimeOver && !isDoctor}>\r\n                                                            <Send className=\"h-4 w-4\" />\r\n                                                        </Button>\r\n                                                    </div>\r\n                                                </div>\r\n                                            ) : (\r\n                                                <>\r\n                                                    <Input\r\n                                                        placeholder={isTimeOver && !isDoctor && !isPostConsultationWindowOpen ? \"Session time over\" : \"Type a message...\"}\r\n                                                        className=\"pr-12 h-11 bg-slate-50 border-none rounded-xl text-sm focus-visible:ring-1 focus-visible:ring-[#00A1B0]/20 shadow-none\"\r\n                                                        value={inputValue}\r\n                                                        onChange={(e) => { setInputValue(e.target.value); handleTyping(); }}\r\n                                                        onKeyPress={(e) => e.key === 'Enter' && handleSendMessage()}\r\n                                                        disabled={isLoading || (isTimeOver && !isDoctor && !isPostConsultationWindowOpen)}\r\n                                                    />\r\n                                                    <input type=\"file\" hidden ref={fileInputRef} accept=\"image/*,application/pdf,.doc,.docx\" onChange={handleFileUpload} />\r\n                                                    <div className=\"absolute right-1 top-1/2 -translate-y-1/2 flex items-center\">\r\n                                                        {!inputValue.trim() ? (\r\n                                                            <Button variant=\"ghost\" size=\"icon\" onClick={startRecording} className=\"text-slate-400 hover:text-[#00A1B0] hover:bg-transparent\" disabled={isLoading || (isTimeOver && !isDoctor && !isPostConsultationWindowOpen)}>\r\n                                                                <Mic className=\"h-5 w-5\" />\r\n                                                            </Button>\r\n                                                        ) : (\r\n                                                            <Button size=\"icon\" onClick={handleSendMessage} className=\"bg-[#00A1B0] hover:bg-[#008f9c] h-8 w-8 rounded-lg shadow-lg shadow-[#00A1B0]/20 transition-all active:scale-95\" disabled={isLoading || (isTimeOver && !isDoctor && !isPostConsultationWindowOpen)}>\r\n                                                                <Send className=\"h-4 w-4 text-white\" />\r\n                                                            </Button>\r\n                                                        )}\r\n                                                    </div>\r\n                                                </>\r\n                                            )}\r\n                                        </div>\r\n                                    </div>\r\n                                </>\r\n                            )}\r\n                        </footer>\r\n                    </>\r\n                )\r\n                }\r\n\r\n                {/* Preview Image UI (Instead of main container content) */}\r\n                <AnimatePresence>\r\n                    {previewImage && (\r\n                        <motion.div\r\n                            initial={{ opacity: 0, scale: 0.95 }}\r\n                            animate={{ opacity: 1, scale: 1 }}\r\n                            exit={{ opacity: 0, scale: 0.95 }}\r\n                            className=\"absolute inset-0 z-[60] bg-[#111] flex flex-col\"\r\n                        >\r\n                            {/* Preview Header */}\r\n                            <div className=\"flex items-center justify-between p-4 bg-black/40 backdrop-blur-md border-b border-white/5\">\r\n                                <div className=\"flex items-center gap-3\">\r\n                                    <Button\r\n                                        variant=\"ghost\"\r\n                                        size=\"icon\"\r\n                                        onClick={() => setPreviewImage(null)}\r\n                                        className=\"text-white/70 hover:text-white hover:bg-white/10 rounded-full\"\r\n                                    >\r\n                                        <X className=\"h-5 w-5\" />\r\n                                    </Button>\r\n                                    <div className=\"flex flex-col\">\r\n                                        <span className=\"text-white text-sm font-black uppercase tracking-widest\">Image Preview</span>\r\n                                        <span className=\"text-white/40 text-[10px] font-bold uppercase tracking-tighter\">Shared via TakeCare Chat</span>\r\n                                    </div>\r\n                                </div>\r\n                                <div className=\"flex items-center gap-2\">\r\n                                    <Button\r\n                                        variant=\"ghost\"\r\n                                        size=\"icon\"\r\n                                        onClick={() => window.open(previewImage, '_blank')}\r\n                                        className=\"text-white/70 hover:text-white hover:bg-white/10 rounded-full\"\r\n                                    >\r\n                                        <ExternalLink className=\"h-4 w-4\" />\r\n                                    </Button>\r\n                                    <Button\r\n                                        variant=\"ghost\"\r\n                                        size=\"icon\"\r\n                                        onClick={() => handleDownload(previewImage!, `TakeCare-Image-${Date.now()}.jpg`)}\r\n                                        className=\"text-white/70 hover:text-white hover:bg-white/10 rounded-full\"\r\n                                        title=\"Download Locally\"\r\n                                    >\r\n                                        <Download className=\"h-4 w-4\" />\r\n                                    </Button>\r\n                                </div>\r\n                            </div>\r\n\r\n                            {/* Image Workspace */}\r\n                            <div className=\"flex-1 overflow-hidden relative flex items-center justify-center p-4\">\r\n                                <motion.img\r\n                                    drag\r\n                                    dragConstraints={{ left: 0, right: 0, top: 0, bottom: 0 }}\r\n                                    src={previewImage}\r\n                                    alt=\"Preview\"\r\n                                    className=\"max-w-full max-h-full object-contain shadow-2xl rounded-lg cursor-grab active:cursor-grabbing\"\r\n                                />\r\n                            </div>\r\n\r\n                            {/* Footer / Info Bar */}\r\n                            <div className=\"p-4 bg-black/20 backdrop-blur-sm flex justify-center border-t border-white/5\">\r\n                                <div className=\"flex items-center gap-4\">\r\n                                    <p className=\"text-white/30 text-[9px] font-black uppercase tracking-[0.2em]\">TakeCare Secure Image Viewer</p>\r\n                                </div>\r\n                            </div>\r\n                        </motion.div>\r\n                    )}\r\n                </AnimatePresence>\r\n            </div >\r\n\r\n            {/* Mobile Clinical Notes Modal */}\r\n            <Dialog open={showClinicalNotesMobile} onOpenChange={setShowClinicalNotesMobile}>\r\n                <DialogContent className=\"max-w-[95vw] sm:max-w-lg p-0 bg-slate-50 border-none overflow-hidden rounded-3xl h-[85vh] flex flex-col\">\r\n                    <div className=\"p-4 bg-white border-b border-slate-100 flex items-center justify-between\">\r\n                        <div className=\"flex items-center gap-2\">\r\n                            <div className=\"h-8 w-8 rounded-lg bg-[#00A1B0]/10 flex items-center justify-center text-[#00A1B0]\">\r\n                                <StickyNote size={18} />\r\n                            </div>\r\n                            <h3 className=\"font-bold text-slate-800 tracking-tight\">Clinical Insights</h3>\r\n                        </div>\r\n                    </div>\r\n                    <div className=\"flex-1 overflow-y-auto p-4 space-y-6 custom-scrollbar\">\r\n                        <div className=\"space-y-4\">\r\n                            <div className=\"flex items-center justify-between px-1\">\r\n                                <h4 className=\"text-[10px] font-black text-slate-400 uppercase tracking-widest\">Medical Profile</h4>\r\n                                <div className=\"px-2 py-0.5 rounded-full bg-slate-200/50 text-[8px] font-black text-slate-500 uppercase tracking-widest\">\r\n                                    Patient Data\r\n                                </div>\r\n                            </div>\r\n                            <div className=\"grid grid-cols-2 gap-2\">\r\n                                <div className=\"bg-white p-3.5 rounded-2xl border border-slate-100 shadow-sm\">\r\n                                    <p className=\"text-[9px] text-slate-400 font-black uppercase mb-1.5 tracking-tighter\">Gender / Age</p>\r\n                                    <p className=\"text-xs font-bold text-slate-700\">{appointment?.patientId?.gender} ΓÇó {appointment?.patientId?.dob ? new Date().getFullYear() - new Date(appointment.patientId.dob).getFullYear() : 'N/A'} yrs</p>\r\n                                </div>\r\n                                <div className=\"bg-white p-3.5 rounded-2xl border border-slate-100 shadow-sm\">\r\n                                    <p className=\"text-[9px] text-slate-400 font-black uppercase mb-1.5 tracking-tighter\">Blood Group</p>\r\n                                    <p className=\"text-xs font-bold text-slate-700\">{appointment?.patientId?.bloodGroup || 'N/A'}</p>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n\r\n                        <div className=\"space-y-4 pt-4 border-t border-slate-200/60\">\r\n                            <h4 className=\"text-[10px] font-black text-slate-800 uppercase tracking-widest leading-none\">Clinical Observations</h4>\r\n\r\n                            {/* Reuse Note Form Layout */}\r\n                            <div className=\"space-y-3 bg-white p-4 rounded-2xl border border-slate-100 shadow-sm\">\r\n                                <div className=\"flex flex-wrap gap-1.5 mb-1\">\r\n                                    {(['observation', 'diagnosis', 'medicine', 'lab_test'] as const).map((cat) => (\r\n                                        <button\r\n                                            key={cat}\r\n                                            onClick={() => setNoteCategory(cat)}\r\n                                            className={`px-3 py-1.5 rounded-lg text-[8px] font-black uppercase tracking-widest transition-all ${noteCategory === cat ? 'bg-[#00A1B0] text-white shadow-md' : 'bg-slate-50 text-slate-400'}`}\r\n                                        >\r\n                                            {cat.replace('_', ' ')}\r\n                                        </button>\r\n                                    ))}\r\n                                </div>\r\n                                <input\r\n                                    type=\"text\"\r\n                                    placeholder=\"Title\"\r\n                                    value={noteTitle}\r\n                                    onChange={(e) => setNoteTitle(e.target.value)}\r\n                                    className=\"w-full bg-slate-50 border border-slate-100 rounded-xl px-4 py-3 text-xs font-bold tracking-wide outline-none focus:ring-1 focus:ring-[#00A1B0]/30 transition-all\"\r\n                                />\r\n                                {noteCategory === 'medicine' ? (\r\n                                    <div className=\"grid grid-cols-3 gap-2\">\r\n                                        <input type=\"text\" placeholder=\"Dose\" value={noteDosage} onChange={(e) => setNoteDosage(e.target.value)} className=\"bg-slate-50 border border-slate-100 rounded-xl px-3 py-2 text-[10px] font-bold outline-none\" />\r\n                                        <input type=\"text\" placeholder=\"Freq\" value={noteFrequency} onChange={(e) => setNoteFrequency(e.target.value)} className=\"bg-slate-50 border border-slate-100 rounded-xl px-3 py-2 text-[10px] font-bold outline-none\" />\r\n                                        <input type=\"text\" placeholder=\"Dur\" value={noteDuration} onChange={(e) => setNoteDuration(e.target.value)} className=\"bg-slate-50 border border-slate-100 rounded-xl px-3 py-2 text-[10px] font-bold outline-none\" />\r\n                                    </div>\r\n                                ) : (\r\n                                    <textarea\r\n                                        placeholder=\"Details...\"\r\n                                        value={noteDescription}\r\n                                        onChange={(e) => setNoteDescription(e.target.value)}\r\n                                        rows={3}\r\n                                        className=\"w-full bg-slate-50 border border-slate-100 rounded-xl px-4 py-3 text-xs font-medium resize-none outline-none focus:ring-1 focus:ring-[#00A1B0]/30 transition-all\"\r\n                                    />\r\n                                )}\r\n                                <Button\r\n                                    onClick={handleSaveNote}\r\n                                    disabled={isSavingNote || !noteTitle.trim()}\r\n                                    className=\"w-full h-11 bg-[#00A1B0] hover:bg-[#008f9c] text-white rounded-xl font-black uppercase text-[10px] tracking-widest shadow-md active:scale-95 transition-all\"\r\n                                >\r\n                                    {isSavingNote ? <Loader2 className=\"h-4 w-4 animate-spin\" /> : <><Plus size={16} className=\"mr-2\" /> Save {noteCategory.replace('_', ' ')}</>}\r\n                                </Button>\r\n                            </div>\r\n\r\n                            {/* Notes List */}\r\n                            <div className=\"space-y-3 pb-4\">\r\n                                {appointment?.doctorNotes && appointment.doctorNotes.length > 0 ? (\r\n                                    [...appointment.doctorNotes].reverse().map((note: IDoctorNote, idx: number) => (\r\n                                        <div key={note.id || idx} className=\"p-4 rounded-2xl bg-white border border-slate-100 shadow-sm\">\r\n                                            <div className=\"flex items-center gap-2 mb-2\">\r\n                                                <div className=\"w-1.5 h-1.5 rounded-full bg-[#00A1B0]\"></div>\r\n                                                <span className=\"text-[10px] font-black text-slate-900 tracking-widest\">{note.title}</span>\r\n                                                <span className=\"ml-auto text-[8px] font-bold text-slate-400\">{new Date(note.createdAt).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}</span>\r\n                                            </div>\r\n                                            <p className=\"text-xs text-slate-500 font-medium leading-relaxed\">{note.description}</p>\r\n                                        </div>\r\n                                    ))\r\n                                ) : (\r\n                                    <div className=\"py-10 text-center opacity-30\">\r\n                                        <BookOpen size={24} className=\"mx-auto mb-2\" />\r\n                                        <p className=\"text-[10px] font-black uppercase tracking-widest\">No entries yet</p>\r\n                                    </div>\r\n                                )}\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </DialogContent>\r\n            </Dialog>\r\n\r\n            {/* Right Sidebar */}\r\n            {\r\n                id !== 'default' && isDoctor && (\r\n                    <aside className=\"w-80 bg-slate-50/50 border-l border-slate-100 hidden lg:flex flex-col overflow-y-auto p-6 space-y-6 custom-scrollbar\">\r\n                        {isLoading ? (\r\n                            <div className=\"space-y-6\">\r\n                                <Card className=\"shadow-none border-slate-100 bg-white/80 backdrop-blur-sm\">\r\n                                    <CardHeader className=\"p-4 flex flex-col items-center text-center space-y-3\">\r\n                                        <Skeleton className=\"h-20 w-20 rounded-full bg-slate-200/50\" />\r\n                                        <div className=\"space-y-2 w-full flex flex-col items-center\">\r\n                                            <Skeleton className=\"h-4 w-3/4 bg-slate-200/50\" />\r\n                                            <Skeleton className=\"h-3 w-1/2 bg-slate-100/50\" />\r\n                                            <Skeleton className=\"h-3 w-2/3 bg-slate-100/30\" />\r\n                                        </div>\r\n                                    </CardHeader>\r\n                                </Card>\r\n                                <div className=\"space-y-4\">\r\n                                    <Skeleton className=\"h-3 w-24 px-1 bg-slate-200/40\" />\r\n                                    <div className=\"grid grid-cols-1 gap-2\">\r\n                                        <Skeleton className=\"h-16 rounded-2xl w-full bg-white/60\" />\r\n                                        <Skeleton className=\"h-16 rounded-2xl w-full bg-white/60\" />\r\n                                    </div>\r\n                                </div>\r\n                                <div className=\"space-y-4 pt-2\">\r\n                                    <Skeleton className=\"h-3 w-24 px-1 bg-slate-200/40\" />\r\n                                    <Skeleton className=\"h-36 rounded-2xl w-full bg-white/60\" />\r\n                                    <Skeleton className=\"h-12 rounded-xl w-full bg-[#00A1B0]/10\" />\r\n                                </div>\r\n                            </div>\r\n                        ) : (\r\n                            <>\r\n                                <Card className=\"shadow-none border-slate-100 bg-white\">\r\n                                    <CardHeader className=\"p-4 flex flex-col items-center text-center space-y-3\">\r\n                                        <div className=\"h-20 w-20 rounded-full p-1 border-2 border-[#00A1B0]/10\">\r\n                                            <img src={activeChat.avatar} alt=\"\" className=\"h-full w-full rounded-full object-cover\" />\r\n                                        </div>\r\n                                        <div>\r\n                                            <h3 className=\"font-extrabold text-[#00A1B0] tracking-tight\">{appointment?.patientId?.name || 'Patient'}</h3>\r\n                                            <p className=\"text-[9px] text-slate-400 font-black uppercase tracking-[0.2em] mt-1\">Patient ID: {appointment?.patientId?.customId}</p>\r\n                                            <p className=\"text-[9px] text-slate-400 font-black uppercase tracking-[0.2em] mt-0.5\">APT ID: {appointment?.customId}</p>\r\n                                        </div>\r\n                                    </CardHeader>\r\n                                </Card>\r\n                                <div className=\"space-y-4\">\r\n                                    <div className=\"flex items-center justify-between px-1\">\r\n                                        <h4 className=\"text-[10px] font-black text-slate-400 uppercase tracking-widest\">Medical Profile</h4>\r\n                                        <Info className=\"h-3 w-3 text-slate-300\" />\r\n                                    </div>\r\n                                    <div className=\"grid grid-cols-1 gap-2\">\r\n                                        <div className=\"bg-white p-3.5 rounded-2xl border border-slate-100 shadow-sm\">\r\n                                            <p className=\"text-[9px] text-slate-400 font-black uppercase mb-1.5 tracking-tighter\">Gender / Age</p>\r\n                                            <p className=\"text-xs font-bold text-slate-700\">{appointment?.patientId?.gender} ΓÇó {appointment?.patientId?.dob ? new Date().getFullYear() - new Date(appointment.patientId.dob).getFullYear() : 'N/A'} yrs</p>\r\n                                        </div>\r\n                                        <div className=\"bg-white p-3.5 rounded-2xl border border-slate-100 shadow-sm\">\r\n                                            <p className=\"text-[9px] text-slate-400 font-black uppercase mb-1.5 tracking-tighter\">Blood Group</p>\r\n                                            <p className=\"text-xs font-bold text-slate-700\">{appointment?.patientId?.bloodGroup || 'N/A'}</p>\r\n                                        </div>\r\n                                    </div>\r\n                                </div>\r\n                            </>\r\n                        )}\r\n                        <div className=\"flex items-center gap-2 px-1 mb-2\">\r\n                            <div className=\"h-6 w-6 rounded-lg bg-[#00A1B0]/10 flex items-center justify-center text-[#00A1B0]\">\r\n                                <StickyNote size={14} />\r\n                            </div>\r\n                            <h4 className=\"text-[10px] font-black text-slate-800 uppercase tracking-widest\">Clinical Observations</h4>\r\n                        </div>\r\n\r\n                        {/* New Note Form */}\r\n                        <div className=\"space-y-3 bg-white p-4 rounded-2xl border border-slate-100 shadow-sm\">\r\n                            {/* Category Selector */}\r\n                            <div className=\"flex flex-wrap gap-1.5 mb-1\">\r\n                                {(['observation', 'diagnosis', 'medicine', 'lab_test'] as const).map((cat) => (\r\n                                    <button\r\n                                        key={cat}\r\n                                        onClick={() => setNoteCategory(cat)}\r\n                                        className={`px-2.5 py-1 rounded-lg text-[7px] font-black uppercase tracking-widest transition-all ${noteCategory === cat\r\n                                            ? 'bg-[#00A1B0] text-white shadow-md shadow-[#00A1B0]/10'\r\n                                            : 'bg-slate-50 text-slate-400 hover:bg-slate-100'\r\n                                            }`}\r\n                                    >\r\n                                        {cat.replace('_', ' ')}\r\n                                    </button>\r\n                                ))}\r\n                            </div>\r\n\r\n                            <input\r\n                                type=\"text\"\r\n                                placeholder={\r\n                                    noteCategory === 'medicine' ? \"Medicine Name\" :\r\n                                        noteCategory === 'lab_test' ? \"Test Name\" :\r\n                                            noteCategory === 'diagnosis' ? \"Diagnosis Title\" : \"Symptom / Title\"\r\n                                }\r\n                                value={noteTitle}\r\n                                onChange={(e) => setNoteTitle(e.target.value)}\r\n                                className=\"w-full bg-slate-50 border border-slate-100 rounded-xl px-4 py-2.5 text-xs text-slate-900 placeholder:text-slate-400 focus:ring-1 focus:ring-[#00A1B0]/30 outline-none font-bold tracking-wider transition-all\"\r\n                            />\r\n\r\n                            {noteCategory === 'medicine' ? (\r\n                                <div className=\"grid grid-cols-3 gap-2\">\r\n                                    <input\r\n                                        type=\"text\"\r\n                                        placeholder=\"Dosage\"\r\n                                        value={noteDosage}\r\n                                        onChange={(e) => setNoteDosage(e.target.value)}\r\n                                        className=\"bg-slate-50 border border-slate-100 rounded-xl px-4 py-2 text-[10px] text-slate-900 placeholder:text-slate-400 focus:ring-1 focus:ring-[#00A1B0]/30 outline-none font-bold transition-all\"\r\n                                    />\r\n                                    <input\r\n                                        type=\"text\"\r\n                                        placeholder=\"Freq\"\r\n                                        value={noteFrequency}\r\n                                        onChange={(e) => setNoteFrequency(e.target.value)}\r\n                                        className=\"bg-slate-50 border border-slate-100 rounded-xl px-4 py-2 text-[10px] text-slate-900 placeholder:text-slate-400 focus:ring-1 focus:ring-[#00A1B0]/30 outline-none font-bold transition-all\"\r\n                                    />\r\n                                    <input\r\n                                        type=\"text\"\r\n                                        placeholder=\"Dur\"\r\n                                        value={noteDuration}\r\n                                        onChange={(e) => setNoteDuration(e.target.value)}\r\n                                        className=\"bg-slate-50 border border-slate-100 rounded-xl px-4 py-2 text-[10px] text-slate-900 placeholder:text-slate-400 focus:ring-1 focus:ring-[#00A1B0]/30 outline-none font-bold transition-all\"\r\n                                    />\r\n                                </div>\r\n                            ) : (\r\n                                <textarea\r\n                                    placeholder={\r\n                                        noteCategory === 'lab_test' ? \"Reason for test / Details\" :\r\n                                            \"Description / Observations\"\r\n                                    }\r\n                                    value={noteDescription}\r\n                                    onChange={(e) => setNoteDescription(e.target.value)}\r\n                                    rows={3}\r\n                                    className=\"w-full bg-slate-50 border border-slate-100 rounded-xl px-4 py-2.5 text-xs text-slate-900 placeholder:text-slate-400 focus:ring-1 focus:ring-[#00A1B0]/30 outline-none font-medium leading-relaxed resize-none transition-all\"\r\n                                />\r\n                            )}\r\n                            <Button\r\n                                onClick={handleSaveNote}\r\n                                disabled={\r\n                                    isSavingNote ||\r\n                                    !noteTitle.trim() ||\r\n                                    (noteCategory === 'medicine'\r\n                                        ? (!noteDosage.trim() || !noteFrequency.trim() || !noteDuration.trim())\r\n                                        : !noteDescription.trim())\r\n                                }\r\n                                className=\"w-full h-10 bg-[#00A1B0] hover:bg-[#008f9c] text-white rounded-xl font-black uppercase tracking-widest text-[9px] shadow-md shadow-[#00A1B0]/10 disabled:opacity-50 transition-all active:scale-95\"\r\n                            >\r\n                                {isSavingNote ? (\r\n                                    <div className=\"h-4 w-4 border-2 border-white/20 border-t-white rounded-full animate-spin\"></div>\r\n                                ) : (\r\n                                    <div className=\"flex items-center gap-2\">\r\n                                        <Plus size={14} /> Save {noteCategory.replace('_', ' ')}\r\n                                    </div>\r\n                                )}\r\n                            </Button>\r\n                        </div>\r\n\r\n                        {/* Notes List */}\r\n                        <div className=\"space-y-3 mt-4\">\r\n                            {appointment?.doctorNotes && appointment.doctorNotes.length > 0 ? (\r\n                                [...appointment.doctorNotes].reverse().map((note: IDoctorNote, idx: number) => (\r\n                                    <motion.div\r\n                                        key={note.id || idx}\r\n                                        initial={{ opacity: 0, x: 20 }}\r\n                                        animate={{ opacity: 1, x: 0 }}\r\n                                        className=\"p-4 rounded-2xl bg-white border border-slate-100 shadow-sm hover:border-[#00A1B0]/30 transition-all group\"\r\n                                    >\r\n                                        <div className=\"flex items-center gap-2 mb-2\">\r\n                                            <div className=\"w-1.5 h-1.5 rounded-full bg-[#00A1B0]\"></div>\r\n                                            <span className=\"text-[10px] font-black text-slate-900 tracking-widest leading-none\">{note.title}</span>\r\n                                            {note.category && note.category !== 'observation' && (\r\n                                                <span className=\"px-1.5 py-0.5 rounded bg-[#00A1B0]/5 text-[7px] font-black text-[#00A1B0] uppercase tracking-tighter border border-[#00A1B0]/10\">\r\n                                                    {note.category.replace('_', ' ')}\r\n                                                </span>\r\n                                            )}\r\n                                            <span className=\"ml-auto text-[8px] font-bold text-slate-400\">\r\n                                                {new Date(note.createdAt).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}\r\n                                            </span>\r\n                                        </div>\r\n                                        {note.category === 'medicine' ? (\r\n                                            <div className=\"flex gap-2\">\r\n                                                <div className=\"bg-slate-50 border border-slate-100 rounded-lg px-2 py-1 text-[8px] font-black text-[#00A1B0] tracking-tighter\">\r\n                                                    {note.dosage}\r\n                                                </div>\r\n                                                <div className=\"bg-slate-50 border border-slate-100 rounded-lg px-2 py-1 text-[8px] font-black text-[#00A1B0] tracking-tighter\">\r\n                                                    {note.frequency}\r\n                                                </div>\r\n                                                <div className=\"bg-slate-50 border border-slate-100 rounded-lg px-2 py-1 text-[8px] font-black text-[#00A1B0] tracking-tighter\">\r\n                                                    {note.duration}\r\n                                                </div>\r\n                                            </div>\r\n                                        ) : (\r\n                                            <p className=\"text-xs text-slate-500 font-medium leading-relaxed whitespace-pre-wrap\">\r\n                                                {note.description}\r\n                                            </p>\r\n                                        )}\r\n                                    </motion.div>\r\n                                ))\r\n                            ) : (\r\n                                <div className=\"py-8 flex flex-col items-center justify-center text-center opacity-40\">\r\n                                    <div className=\"w-12 h-12 rounded-full bg-slate-100 flex items-center justify-center mb-3\">\r\n                                        <BookOpen size={20} className=\"text-slate-400\" />\r\n                                    </div>\r\n                                    <p className=\"text-[9px] font-black text-slate-400 uppercase tracking-widest\">No observations yet</p>\r\n                                </div>\r\n                            )}\r\n                        </div>\r\n                    </aside>\r\n                )}\r\n\r\n\r\n            {/* Deletion Confirmation Dialog */}\r\n            <Dialog open={!!deleteConfirmMessageId} onOpenChange={() => setDeleteConfirmMessageId(null)}>\r\n                <DialogContent>\r\n                    <DialogHeader>\r\n                        <DialogTitle>Delete Message</DialogTitle>\r\n                    </DialogHeader>\r\n                    <div className=\"py-4\">\r\n                        <p className=\"text-slate-600\">Are you sure you want to delete this message? This action cannot be undone.</p>\r\n                    </div>\r\n                    <DialogFooter>\r\n                        <Button variant=\"ghost\" onClick={() => setDeleteConfirmMessageId(null)}>Cancel</Button>\r\n                        <Button variant=\"destructive\" onClick={() => deleteConfirmMessageId && handleDeleteMessage(deleteConfirmMessageId)}>Delete</Button>\r\n                    </DialogFooter>\r\n                </DialogContent>\r\n            </Dialog>\r\n            {/* Time Over Modal for Patient */}\r\n            <AnimatePresence>\r\n                {isTimeOver && !isDoctor && !isPostConsultationWindowOpen && sessionStatus !== SESSION_STATUS.CONTINUED_BY_DOCTOR && sessionStatus !== SESSION_STATUS.ENDED && (\r\n                    <motion.div\r\n                        initial={{ opacity: 0 }}\r\n                        animate={{ opacity: 1 }}\r\n                        exit={{ opacity: 0 }}\r\n                        className=\"fixed inset-0 z-[100] bg-black/60 backdrop-blur-md flex items-center justify-center p-4\"\r\n                    >\r\n                        <motion.div\r\n                            initial={{ scale: 0.9, opacity: 0 }}\r\n                            animate={{ scale: 1, opacity: 1 }}\r\n                            className=\"bg-white rounded-3xl p-8 max-w-sm w-full text-center shadow-2xl\"\r\n                        >\r\n                            <div className=\"w-20 h-20 bg-amber-100 rounded-full flex items-center justify-center mx-auto mb-6\">\r\n                                <Lock className=\"h-10 w-10 text-amber-600\" />\r\n                            </div>\r\n                            <h2 className=\"text-2xl font-black text-slate-800 mb-4 tracking-tight uppercase\">Session Time Over</h2>\r\n                            <p className=\"text-slate-500 font-bold leading-relaxed mb-8 text-xs uppercase tracking-tight\">\r\n                                Your appointment time is over. Please wait for the doctor's response.\r\n                            </p>\r\n                            <div className=\"space-y-4\">\r\n                                <div className=\"flex items-center justify-center gap-2 py-2 px-4 bg-slate-50 rounded-xl\">\r\n                                    <div className=\"w-2 h-2 bg-[#00A1B0] rounded-full animate-ping\"></div>\r\n                                    <p className=\"text-[10px] font-black text-slate-400 uppercase tracking-widest\">\r\n                                        Waiting for Doctor...\r\n                                    </p>\r\n                                </div>\r\n                                <Button\r\n                                    onClick={handleBackToWebsite}\r\n                                    className=\"w-full bg-[#00A1B0] hover:bg-[#008f9c] text-white rounded-2xl h-14 font-black uppercase tracking-widest transition-all active:scale-95\"\r\n                                >\r\n                                    Exit to Dashboard\r\n                                </Button>\r\n                            </div>\r\n                        </motion.div>\r\n                    </motion.div>\r\n                )}\r\n            </AnimatePresence>\r\n\r\n            {/* Improved Doctor Session Controls (Modal Style) when time is over */}\r\n            <AnimatePresence>\r\n                {isTimeOver && isDoctor && sessionStatus === SESSION_STATUS.WAITING_FOR_DOCTOR && (\r\n                    <motion.div\r\n                        initial={{ opacity: 0 }}\r\n                        animate={{ opacity: 1 }}\r\n                        className=\"fixed inset-0 z-[90] bg-black/40 backdrop-blur-sm flex items-center justify-center p-4\"\r\n                    >\r\n                        <motion.div\r\n                            initial={{ y: 20, opacity: 0 }}\r\n                            animate={{ y: 0, opacity: 1 }}\r\n                            className=\"bg-white rounded-3xl p-8 max-w-md w-full shadow-2xl border border-slate-100\"\r\n                        >\r\n                            <div className=\"flex items-center gap-4 mb-6\">\r\n                                <div className=\"h-14 w-14 bg-amber-100 rounded-2xl flex items-center justify-center shrink-0\">\r\n                                    <Clock className=\"h-7 w-7 text-amber-600\" />\r\n                                </div>\r\n                                <div>\r\n                                    <h2 className=\"text-xl font-black text-slate-900 tracking-tight uppercase\">Session Time Completed</h2>\r\n                                    <p className=\"text-xs text-slate-500 font-bold uppercase tracking-tight\">Manage the appointment status</p>\r\n                                </div>\r\n                            </div>\r\n\r\n                            <p className=\"text-slate-600 font-medium leading-relaxed mb-8 text-sm bg-slate-50 p-4 rounded-2xl border border-slate-100\">\r\n                                The appointment time has ended. You can choose to continue the session or wind it up. Patient is currently waiting for your response.\r\n                            </p>\r\n\r\n                            <div className=\"flex flex-col gap-3\">\r\n                                <div className=\"grid grid-cols-2 gap-3\">\r\n                                    <Button\r\n                                        onClick={() => updateSessionStatus(SESSION_STATUS.CONTINUED_BY_DOCTOR)}\r\n                                        className=\"bg-green-500 hover:bg-green-600 text-white rounded-2xl h-14 font-black uppercase text-xs tracking-widest shadow-lg shadow-green-500/20\"\r\n                                    >\r\n                                        Γ£à Continue\r\n                                    </Button>\r\n                                    <Button\r\n                                        onClick={() => setShowWindUpConfirm(true)}\r\n                                        className=\"bg-red-500 hover:bg-red-600 text-white rounded-2xl h-14 font-black uppercase text-xs tracking-widest shadow-lg shadow-red-500/20\"\r\n                                    >\r\n                                        Γ¥î Wind Up\r\n                                    </Button>\r\n                                </div>\r\n                                <Button\r\n                                    onClick={async () => {\r\n                                        if (!appointment?._id) return;\r\n                                        try {\r\n                                            const res = await appointmentService.enablePostConsultationChat(appointment._id);\r\n                                            if (res.success) {\r\n                                                toast.success(\"Chat enabled for 24 hours. Request sent.\");\r\n                                                setIsTimeOver(false);\r\n                                            } else {\r\n                                                toast.error(res.message);\r\n                                            }\r\n                                        } catch (error: unknown) {\r\n                                            const errorMessage = error instanceof Error ? error.message : \"Failed to trigger tests needed\";\r\n                                            toast.error(errorMessage);\r\n                                        }\r\n                                    }}\r\n                                    className=\"w-full bg-amber-500 hover:bg-amber-600 text-white rounded-2xl h-14 font-black uppercase text-xs tracking-widest shadow-lg shadow-amber-500/20\"\r\n                                >\r\n                                    ≡ƒôï Tests Needed\r\n                                </Button>\r\n                            </div>\r\n\r\n                            {extensionCount > 0 && (\r\n                                <p className=\"mt-6 text-center text-[10px] text-[#00A1B0] font-black uppercase tracking-tighter\">\r\n                                    Previously Extended {extensionCount} Times\r\n                                </p>\r\n                            )}\r\n                        </motion.div>\r\n                    </motion.div>\r\n                )}\r\n            </AnimatePresence>\r\n\r\n            {/* Wind Up Confirmation Dialog */}\r\n            <Dialog open={showWindUpConfirm} onOpenChange={setShowWindUpConfirm}>\r\n                <DialogContent className=\"sm:max-w-md\">\r\n                    <DialogHeader>\r\n                        <DialogTitle className=\"flex items-center gap-2 text-red-600\">\r\n                            <XCircle className=\"h-5 w-5\" />\r\n                            Confirm Wind Up Session\r\n                        </DialogTitle>\r\n                    </DialogHeader>\r\n                    <div className=\"py-4\">\r\n                        <p className=\"text-sm text-slate-600 mb-3\">\r\n                            Are you sure you want to <strong className=\"text-red-600\">wind up</strong> this consultation session?\r\n                        </p>\r\n                        <div className=\"bg-red-50 border border-red-200 rounded-lg p-3 space-y-1\">\r\n                            <p className=\"text-xs text-red-800 font-semibold\">ΓÜá∩╕Å This action will:</p>\r\n                            <ul className=\"text-xs text-red-700 space-y-1 ml-4 list-disc\">\r\n                                <li>End the current consultation session</li>\r\n                                <li>Disable the chat for both you and the patient</li>\r\n                                <li>Mark the appointment as completed</li>\r\n                            </ul>\r\n                        </div>\r\n                    </div>\r\n                    <DialogFooter className=\"gap-2 sm:gap-0\">\r\n                        <Button\r\n                            variant=\"outline\"\r\n                            onClick={() => setShowWindUpConfirm(false)}\r\n                            className=\"rounded-xl\"\r\n                        >\r\n                            Cancel\r\n                        </Button>\r\n                        <Button\r\n                            onClick={() => {\r\n                                setShowWindUpConfirm(false);\r\n                                updateSessionStatus(SESSION_STATUS.ENDED);\r\n                            }}\r\n                            className=\"bg-red-500 hover:bg-red-600 text-white rounded-xl\"\r\n                        >\r\n                            Yes, Wind Up\r\n                        </Button>\r\n                    </DialogFooter>\r\n                </DialogContent>\r\n            </Dialog>\r\n        </motion.div >\r\n    );\r\n};\r\n\r\nexport default ChatPage;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\nithi\\OneDrive\\Documents\\Brototype\\Takecare\\frontend\\src\\pages\\doctor\\DoctorAppointmentRequests.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":24,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":24,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1134,1137],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1134,1137],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":28,"column":68,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":28,"endColumn":71,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1380,1383],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1380,1383],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":46,"column":30,"nodeType":null,"messageId":"unusedVar","endLine":46,"endColumn":31},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":69,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":69,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3148,3151],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3148,3151],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":103,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":103,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4642,4645],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4642,4645],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":140,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":140,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6156,6159],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6156,6159],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":146,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":146,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6351,6354],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6351,6354],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":151,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":151,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6498,6501],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6498,6501],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":167,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":167,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7373,7376],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7373,7376],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":9,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect, useCallback } from 'react';\r\nimport DoctorNavbar from '../../components/Doctor/DoctorNavbar';\r\nimport DoctorLayout from '../../components/Doctor/DoctorLayout';\r\nimport Breadcrumbs from '../../components/common/Breadcrumbs';\r\nimport { FaVideo, FaComments, FaCheck, FaTimes, FaSearch, FaCalendarAlt, FaExclamationCircle, FaChevronDown } from 'react-icons/fa';\r\nimport { appointmentService } from '../../services/appointmentService';\r\nimport RescheduleModal from '../../components/common/RescheduleModal';\r\nimport { toast } from 'sonner';\r\nimport { Skeleton } from '../../components/ui/skeleton';\r\nimport { Button } from '../../components/ui/button';\r\nimport {\r\n    Dialog,\r\n    DialogContent,\r\n    DialogDescription,\r\n    DialogFooter,\r\n    DialogHeader,\r\n    DialogTitle,\r\n} from \"../../components/ui/dialog\"\r\nimport { Textarea } from \"../../components/ui/textarea\"\r\nimport { Card, CardContent, CardHeader } from \"../../components/ui/card\"\r\n\r\nconst DoctorAppointmentRequests: React.FC = () => {\r\n    const [searchQuery, setSearchQuery] = useState('');\r\n    const [requests, setRequests] = useState<any[]>([]);\r\n    const [loading, setLoading] = useState(true);\r\n    const [error, setError] = useState('');\r\n    const [rejectDialogOpen, setRejectDialogOpen] = useState(false);\r\n    const [selectedAppointment, setSelectedAppointment] = useState<any>(null);\r\n    const [rejectionReason, setRejectionReason] = useState('');\r\n    const [rescheduleModalOpen, setRescheduleModalOpen] = useState(false);\r\n    const [page, setPage] = useState(1);\r\n    const [total, setTotal] = useState(0);\r\n    const limit = 10;\r\n\r\n    const fetchRequests = useCallback(async (isAppending: boolean = false) => {\r\n        try {\r\n            if (!isAppending) {\r\n                setLoading(true);\r\n                const cached = sessionStorage.getItem('doctor_requests_cache');\r\n                if (cached) {\r\n                    try {\r\n                        const parsed = JSON.parse(cached);\r\n                        if (Array.isArray(parsed)) {\r\n                            setRequests(parsed);\r\n                        }\r\n                    } catch (e) {\r\n                        sessionStorage.removeItem('doctor_requests_cache');\r\n                    }\r\n                }\r\n            }\r\n\r\n            const response = await appointmentService.getDoctorRequests(isAppending ? page : 1, limit);\r\n\r\n            if (response?.success) {\r\n                const nextRequests = response.data.appointments || [];\r\n                if (isAppending) {\r\n                    setRequests(prev => [...prev, ...nextRequests]);\r\n                } else {\r\n                    setRequests(nextRequests);\r\n                    sessionStorage.setItem('doctor_requests_cache', JSON.stringify(nextRequests));\r\n                }\r\n                if (typeof response?.data?.total === 'number') {\r\n                    setTotal(response.data.total);\r\n                }\r\n                setError('');\r\n            } else {\r\n                throw new Error(response?.message || 'Failed to fetch appointment requests');\r\n            }\r\n        } catch (err: any) {\r\n            console.error('Failed to fetch appointment requests:', err);\r\n            setError(err?.response?.data?.message || err?.message || 'Failed to fetch appointment requests');\r\n            toast.error('Failed to load appointment requests');\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    }, [page, limit]);\r\n\r\n    useEffect(() => {\r\n        fetchRequests(page > 1);\r\n    }, [fetchRequests, page]);\r\n\r\n    const filteredRequests = requests.filter((req) =>\r\n        (req?.status === 'pending' || req?.status === 'reschedule_requested') &&\r\n        req?.patientId?.name?.toLowerCase().includes(searchQuery.toLowerCase())\r\n    );\r\n\r\n    const handleApprove = async (id: string) => {\r\n        const appointment = requests.find(req => (req.id === id || req._id === id));\r\n        if (appointment && appointment.paymentStatus !== 'paid') {\r\n            toast.warning('Payment is pending!');\r\n            return;\r\n        }\r\n        try {\r\n            const response = await appointmentService.approveAppointment(id);\r\n            if (response?.success) {\r\n                const next = requests.filter((req) => (req.id !== id && req._id !== id));\r\n                setRequests(next);\r\n                sessionStorage.setItem('doctor_requests_cache', JSON.stringify(next));\r\n                toast.success('Appointment approved!');\r\n            } else {\r\n                throw new Error(response?.message || 'Failed to approve');\r\n            }\r\n        } catch (err: any) {\r\n            console.error(err);\r\n            toast.error(err?.response?.data?.message || err?.message || 'Failed to approve');\r\n        }\r\n    };\r\n\r\n    const handleReject = async (id: string) => {\r\n        const appointment = requests.find(req => (req.id === id || req._id === id));\r\n        if (appointment) {\r\n            setSelectedAppointment(appointment);\r\n            setRejectDialogOpen(true);\r\n            setRejectionReason('');\r\n        }\r\n    };\r\n\r\n    const confirmReject = async () => {\r\n        if (!selectedAppointment || !rejectionReason.trim()) {\r\n            toast.error('Please provide a rejection reason');\r\n            return;\r\n        }\r\n\r\n        try {\r\n            const response = await appointmentService.rejectAppointment(\r\n                selectedAppointment.id || selectedAppointment._id,\r\n                rejectionReason\r\n            );\r\n            if (response?.success) {\r\n                const next = requests.filter((req) => (req.id !== selectedAppointment.id && req._id !== selectedAppointment._id));\r\n                setRequests(next);\r\n                sessionStorage.setItem('doctor_requests_cache', JSON.stringify(next));\r\n                toast.success(`Appointment rejected: ${rejectionReason}`);\r\n                setRejectDialogOpen(false);\r\n                setSelectedAppointment(null);\r\n                setRejectionReason('');\r\n            } else {\r\n                throw new Error(response?.message || 'Failed to reject');\r\n            }\r\n        } catch (err: any) {\r\n            console.error(err);\r\n            toast.error(err?.response?.data?.message || err?.message || 'Failed to reject');\r\n        }\r\n    };\r\n\r\n    const handleReschedule = (request: any) => {\r\n        setSelectedAppointment(request);\r\n        setRescheduleModalOpen(true);\r\n    };\r\n\r\n    const onRescheduleConfirm = async (slot: any, date: Date) => {\r\n        try {\r\n            const response = await appointmentService.rescheduleAppointment(selectedAppointment.id || selectedAppointment._id, {\r\n                appointmentDate: date,\r\n                appointmentTime: `${slot.startTime} - ${slot.endTime}`,\r\n                slotId: slot.customId || slot.slotId\r\n            });\r\n\r\n            if (response.success) {\r\n                toast.success('Reschedule request sent to patient!');\r\n                const updatedRequests = requests.map(req =>\r\n                    (req.id === selectedAppointment.id || req._id === selectedAppointment._id) ? { ...req, status: 'reschedule_requested' } : req\r\n                );\r\n                setRequests(updatedRequests);\r\n                sessionStorage.setItem('doctor_requests_cache', JSON.stringify(updatedRequests));\r\n            }\r\n        } catch (error: any) {\r\n            toast.error(error.response?.data?.message || 'Failed to reschedule');\r\n        } finally {\r\n            setRescheduleModalOpen(false);\r\n            setSelectedAppointment(null);\r\n        }\r\n    };\r\n\r\n    const cancelReject = () => {\r\n        setRejectDialogOpen(false);\r\n        setSelectedAppointment(null);\r\n        setRejectionReason('');\r\n    };\r\n\r\n    const breadcrumbItems = [\r\n        { label: 'Home', path: '/doctor/dashboard' },\r\n        { label: 'Appointment Requests' },\r\n    ];\r\n\r\n    return (\r\n        <div className=\"min-h-screen bg-gray-50\">\r\n            <DoctorNavbar />\r\n\r\n            <Breadcrumbs\r\n                items={breadcrumbItems}\r\n                title=\"Appointment Requests\"\r\n                subtitle=\"Review and manage patient appointment requests\"\r\n            />\r\n\r\n            <DoctorLayout>\r\n                {loading && requests.length === 0 ? (\r\n                    <div className=\"space-y-6\">\r\n                        <Skeleton className=\"h-28 w-full rounded-xl\" />\r\n                        <Skeleton className=\"h-16 w-full rounded-xl\" />\r\n                        <div className=\"bg-white rounded-xl shadow-sm border border-gray-100\">\r\n                            <div className=\"p-4 border-b\">\r\n                                <Skeleton className=\"h-6 w-64\" />\r\n                            </div>\r\n                            <div className=\"p-4 grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                                {[1, 2, 3, 4].map(i => (\r\n                                    <Skeleton key={i} className=\"h-56 w-full rounded-xl\" />\r\n                                ))}\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                ) : error ? (\r\n                    <div className=\"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg mb-6\">{error}</div>\r\n                ) : (\r\n                    <>\r\n                        <div className=\"bg-white rounded-xl p-6 shadow-sm border border-gray-100 mb-6\">\r\n                            <div className=\"flex items-center justify-between\">\r\n                                <div><p className=\"text-sm text-gray-600 mb-1\">Total Pending</p><h3 className=\"text-3xl font-bold text-[#00A1B0]\">{total}</h3></div>\r\n                                <div className=\"w-16 h-16 bg-blue-50 rounded-xl flex items-center justify-center\"><FaVideo className=\"text-blue-600\" size={32} /></div>\r\n                            </div>\r\n                        </div>\r\n\r\n                        <div className=\"bg-white rounded-xl shadow-sm border border-gray-100 p-4 mb-6\">\r\n                            <div className=\"relative\">\r\n                                <FaSearch className=\"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400\" /><input type=\"text\" placeholder=\"Search patients...\" value={searchQuery} onChange={(e) => setSearchQuery(e.target.value)} className=\"w-full pl-10 pr-4 py-2.5 border border-gray-200 rounded-lg focus:ring-2 focus:ring-[#00A1B0]\" />\r\n                            </div>\r\n                        </div>\r\n\r\n                        <div className=\"bg-white rounded-xl shadow-sm border border-gray-100\">\r\n                            <div className=\"p-4 border-b\"><h3 className=\"text-lg font-semibold text-gray-800\">Pending Appointment Requests</h3></div>\r\n                            <div className=\"p-4\">\r\n                                {filteredRequests.length === 0 ? (\r\n                                    <div className=\"text-center py-12\">\r\n                                        <div className=\"w-20 h-20 bg-gray-100 rounded-full mx-auto mb-4 flex items-center justify-center\"><FaVideo className=\"text-gray-400\" size={32} /></div>\r\n                                        <h3 className=\"text-lg font-semibold text-gray-800 mb-2\">No pending requests</h3>\r\n                                        <p className=\"text-gray-600 text-sm\">You don't have any appointment requests at the moment.</p>\r\n                                    </div>\r\n                                ) : (\r\n                                    <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\r\n                                        {filteredRequests.map((request) => (\r\n                                            <Card key={request._id} className=\"overflow-hidden border-gray-100 hover:shadow-md transition-shadow\">\r\n                                                <CardHeader className=\"p-4 border-b border-gray-100 space-y-0\">\r\n                                                    <div className=\"flex items-start justify-between gap-3\">\r\n                                                        <div className=\"flex items-start gap-4 flex-1\">\r\n                                                            <div className=\"relative\">\r\n                                                                <img\r\n                                                                    src={request.patientId?.profileImage || '/patient-placeholder.jpg'}\r\n                                                                    alt={request.patientId?.name || 'Patient'}\r\n                                                                    className=\"w-14 h-14 rounded-full object-cover border-2 border-gray-200\"\r\n                                                                    onError={(e) => { e.currentTarget.src = 'https://via.placeholder.com/100x100?text=Patient'; }}\r\n                                                                />\r\n                                                                <div className={`absolute -bottom-1 -right-1 w-5 h-5 rounded-full flex items-center justify-center text-white text-[10px] ${request.appointmentType === 'video' ? 'bg-[#00A1B0]' : 'bg-emerald-500'}`}>\r\n                                                                    {request.appointmentType === 'video' ? <FaVideo /> : <FaComments />}\r\n                                                                </div>\r\n                                                            </div>\r\n                                                            <div className=\"flex-1 min-w-0\">\r\n                                                                <p className=\"text-[10px] text-gray-400 font-medium tracking-wider mb-0.5\">{request.customId || request.id}</p>\r\n                                                                <h3 className=\"font-bold text-gray-900 leading-tight truncate\">{request.patientId?.name || 'Unknown Patient'}</h3>\r\n                                                                <div className=\"flex items-center justify-between mt-1\">\r\n                                                                    <div className=\"flex items-center gap-1.5\">\r\n                                                                        <span className={`w-1.5 h-1.5 rounded-full ${request.paymentStatus === 'paid' ? 'bg-emerald-500' : 'bg-amber-500'}`}></span>\r\n                                                                        <span className={`text-[11px] font-medium capitalize ${request.paymentStatus === 'paid' ? 'text-emerald-600' : 'text-amber-600'}`}>\r\n                                                                            {request.paymentStatus || 'pending'}\r\n                                                                        </span>\r\n                                                                    </div>\r\n                                                                    <span className=\"text-[11px] font-bold text-[#00A1B0] bg-[#00A1B0]/10 px-2 py-0.5 rounded-full\">\r\n                                                                        Γé╣{request.consultationFees}\r\n                                                                    </span>\r\n                                                                </div>\r\n                                                            </div>\r\n                                                        </div>\r\n                                                    </div>\r\n                                                </CardHeader>\r\n                                                <CardContent className=\"p-4 bg-gray-50/50 space-y-4\">\r\n                                                    <div className=\"flex items-center justify-between gap-2 p-2.5 bg-white rounded-xl border border-gray-100 shadow-sm\">\r\n                                                        <div className=\"flex items-center gap-2 text-gray-600\">\r\n                                                            <FaCalendarAlt className=\"w-3.5 h-3.5 text-[#00A1B0]\" />\r\n                                                            <span className=\"text-xs font-semibold\">{new Date(request.appointmentDate).toLocaleDateString()}</span>\r\n                                                        </div>\r\n                                                        <div className=\"w-px h-3 bg-gray-200\" />\r\n                                                        <div className=\"flex items-center gap-2 text-gray-600\">\r\n                                                            <svg className=\"w-3.5 h-3.5 text-[#00A1B0]\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z\" /></svg>\r\n                                                            <span className=\"text-xs font-semibold\">{request.appointmentTime}</span>\r\n                                                        </div>\r\n                                                    </div>\r\n\r\n                                                    {request.status === 'reschedule_requested' && (\r\n                                                        <div className=\"p-3 bg-amber-50 border border-amber-200 rounded-xl\">\r\n                                                            <div className=\"flex items-center gap-2\">\r\n                                                                <div className=\"w-2 h-2 bg-amber-500 rounded-full animate-pulse\" />\r\n                                                                <p className=\"text-[11px] font-bold text-amber-900 uppercase tracking-wider\">Reschedule Sent</p>\r\n                                                            </div>\r\n                                                            <p className=\"text-[10px] text-amber-800 mt-1\">Waiting for patient to accept proposed time.</p>\r\n                                                        </div>\r\n                                                    )}\r\n\r\n                                                    {request.reason && (\r\n                                                        <div className=\"p-3 bg-white border border-gray-100 rounded-xl\">\r\n                                                            <p className=\"text-[10px] text-gray-400 font-bold uppercase mb-0.5\">Note from Patient</p>\r\n                                                            <p className=\"text-xs text-gray-700 leading-relaxed italic\">\"{request.reason}\"</p>\r\n                                                        </div>\r\n                                                    )}\r\n\r\n                                                    {request.rescheduleRejectReason && (\r\n                                                        <div className=\"p-3 bg-rose-50 border border-rose-200 rounded-xl space-y-1.5\">\r\n                                                            <div className=\"flex items-center gap-1.5 text-rose-700\">\r\n                                                                <FaExclamationCircle className=\"w-3.5 h-3.5\" />\r\n                                                                <p className=\"text-[11px] font-bold uppercase tracking-wider\">Patient Rejected Reschedule</p>\r\n                                                            </div>\r\n                                                            <p className=\"text-xs text-rose-800 leading-relaxed italic\">\"{request.rescheduleRejectReason}\"</p>\r\n                                                        </div>\r\n                                                    )}\r\n\r\n                                                    <div className=\"grid grid-cols-2 sm:grid-cols-3 gap-2 mt-2\">\r\n                                                        <Button\r\n                                                            size=\"sm\"\r\n                                                            variant=\"outline\"\r\n                                                            onClick={() => handleApprove(request.id || request._id)}\r\n                                                            disabled={request.status === 'reschedule_requested'}\r\n                                                            className={`h-9 gap-1.5 border-none shadow-none font-bold rounded-lg transition-all hover:scale-[1.02] active:scale-[0.98] ${request.status === 'reschedule_requested'\r\n                                                                ? 'bg-gray-100 text-gray-400 opacity-50'\r\n                                                                : request.paymentStatus === 'paid'\r\n                                                                    ? 'bg-emerald-50 hover:bg-emerald-100 text-emerald-600'\r\n                                                                    : 'bg-amber-50 hover:bg-amber-100 text-amber-600'\r\n                                                                }`}\r\n                                                            title={request.status === 'reschedule_requested' ? \"Waiting for patient response\" : request.paymentStatus !== 'paid' ? \"Payment pending\" : \"Approve appointment\"}\r\n                                                        >\r\n                                                            <FaCheck className=\"w-3.5 h-3.5\" />\r\n                                                            <span className=\"text-[10px] xs:text-xs\">Approve</span>\r\n                                                        </Button>\r\n                                                        <Button\r\n                                                            size=\"sm\"\r\n                                                            variant=\"outline\"\r\n                                                            onClick={() => handleReschedule(request)}\r\n                                                            className=\"h-9 gap-1.5 border-none shadow-none bg-[#00A1B0]/10 hover:bg-[#00A1B0]/20 text-[#00A1B0] font-bold rounded-lg transition-all hover:scale-[1.02] active:scale-[0.98]\"\r\n                                                            title=\"Propose new time\"\r\n                                                        >\r\n                                                            <FaCalendarAlt className=\"w-3.5 h-3.5\" />\r\n                                                            <span className=\"text-[10px] xs:text-xs\">Reschedule</span>\r\n                                                        </Button>\r\n                                                        <Button\r\n                                                            size=\"sm\"\r\n                                                            variant=\"outline\"\r\n                                                            onClick={() => handleReject(request.id || request._id)}\r\n                                                            className=\"col-span-2 sm:col-span-1 h-9 gap-1.5 border-none shadow-none bg-rose-50 hover:bg-rose-100 text-rose-600 font-bold rounded-lg transition-all hover:scale-[1.02] active:scale-[0.98]\"\r\n                                                            title=\"Reject appointment\"\r\n                                                        >\r\n                                                            <FaTimes className=\"w-3.5 h-3.5\" />\r\n                                                            <span className=\"text-[10px] xs:text-xs\">Reject</span>\r\n                                                        </Button>\r\n                                                    </div>\r\n                                                </CardContent>\r\n                                            </Card>\r\n                                        ))}\r\n                                    </div>\r\n                                )}\r\n\r\n                                {filteredRequests.length > 0 && requests.length < total && (\r\n                                    <div className=\"text-center mt-10 mb-4\">\r\n                                        <button\r\n                                            onClick={() => setPage(p => p + 1)}\r\n                                            disabled={loading}\r\n                                            className=\"group relative inline-flex items-center justify-center px-10 py-3 font-bold text-[#00A1B0] transition-all duration-300 bg-[#D2F1F4] hover:bg-[#b8e9ed] rounded-xl shadow-sm hover:shadow-md focus:outline-none disabled:opacity-60 disabled:cursor-not-allowed overflow-hidden\"\r\n                                        >\r\n                                            <div className=\"absolute inset-0 bg-gradient-to-r from-transparent via-white/20 to-transparent -translate-x-full group-hover:animate-[shimmer_1.5s_infinite] pointer-events-none\" />\r\n                                            {loading ? (\r\n                                                <div className=\"flex items-center gap-2.5\">\r\n                                                    <div className=\"w-4 h-4 border-2 border-current border-t-transparent rounded-full animate-spin\" />\r\n                                                    <span className=\"tracking-wide text-sm\">Fetching More...</span>\r\n                                                </div>\r\n                                            ) : (\r\n                                                <div className=\"flex items-center gap-2.5\">\r\n                                                    <span className=\"tracking-wide text-sm\">Load More Requests</span>\r\n                                                    <FaChevronDown className=\"w-3.5 h-3.5 transition-transform duration-300 group-hover:translate-y-1\" />\r\n                                                </div>\r\n                                            )}\r\n                                        </button>\r\n                                    </div>\r\n                                )}\r\n                            </div>\r\n                        </div>\r\n                    </>\r\n                )}\r\n            </DoctorLayout>\r\n\r\n            <Dialog open={rejectDialogOpen} onOpenChange={setRejectDialogOpen}>\r\n                <DialogContent className=\"sm:max-w-md\">\r\n                    <DialogHeader>\r\n                        <DialogTitle className=\"flex items-center gap-2 text-rose-600\">\r\n                            <FaExclamationCircle />\r\n                            Reject Appointment\r\n                        </DialogTitle>\r\n                        <DialogDescription>\r\n                            Please provide a reason for rejecting this appointment request.\r\n                        </DialogDescription>\r\n                    </DialogHeader>\r\n                    {selectedAppointment && (\r\n                        <div className=\"p-3 bg-gray-50 rounded-lg space-y-1 text-sm text-gray-600\">\r\n                            <p><span className=\"font-semibold\">Patient:</span> {selectedAppointment.patientId?.name || 'Unknown Patient'}</p>\r\n                            <p><span className=\"font-semibold\">Date:</span> {new Date(selectedAppointment.appointmentDate).toLocaleDateString()}</p>\r\n                            <p><span className=\"font-semibold\">Time:</span> {selectedAppointment.appointmentTime}</p>\r\n                        </div>\r\n                    )}\r\n                    <div className=\"space-y-2\">\r\n                        <label className=\"text-sm font-medium text-gray-700\">Rejection Reason *</label>\r\n                        <Textarea\r\n                            placeholder=\"Type your reason here...\"\r\n                            value={rejectionReason}\r\n                            onChange={(e) => setRejectionReason(e.target.value)}\r\n                            className=\"min-h-[100px] resize-none\"\r\n                        />\r\n                    </div>\r\n                    <DialogFooter className=\"flex gap-2 sm:gap-0\">\r\n                        <Button\r\n                            variant=\"ghost\"\r\n                            onClick={cancelReject}\r\n                            className=\"flex-1 sm:flex-none\"\r\n                        >\r\n                            Cancel\r\n                        </Button>\r\n                        <Button\r\n                            variant=\"destructive\"\r\n                            onClick={confirmReject}\r\n                            disabled={!rejectionReason.trim()}\r\n                            className=\"flex-1 sm:flex-none bg-rose-600 hover:bg-rose-700 text-white\"\r\n                        >\r\n                            Confirm Reject\r\n                        </Button>\r\n                    </DialogFooter>\r\n                </DialogContent>\r\n            </Dialog>\r\n\r\n            {rescheduleModalOpen && selectedAppointment && (\r\n                <RescheduleModal\r\n                    isOpen={rescheduleModalOpen}\r\n                    onClose={() => { setRescheduleModalOpen(false); setSelectedAppointment(null); }}\r\n                    onConfirm={onRescheduleConfirm}\r\n                    doctorId={selectedAppointment.doctorId?._id || selectedAppointment.doctorId}\r\n                    doctorName=\"You\"\r\n                    currentDate={new Date(selectedAppointment.appointmentDate)}\r\n                />\r\n            )}\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default DoctorAppointmentRequests;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\nithi\\OneDrive\\Documents\\Brototype\\Takecare\\frontend\\src\\pages\\doctor\\DoctorAppointments.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":85,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":85,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4125,4128],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4125,4128],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect, useCallback } from 'react';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport DoctorNavbar from '../../components/Doctor/DoctorNavbar';\r\nimport DoctorLayout from '../../components/Doctor/DoctorLayout';\r\nimport Breadcrumbs from '../../components/common/Breadcrumbs';\r\nimport { appointmentService } from '../../services/appointmentService';\r\nimport { toast } from 'sonner';\r\nimport { Loader2 } from 'lucide-react';\r\nimport type { PopulatedAppointment } from '../../types/appointment.types';\r\nimport { Button } from '../../components/ui/button';\r\nimport { Card, CardContent, CardHeader } from \"../../components/ui/card\"\r\nimport { Skeleton } from \"../../components/ui/skeleton\";\r\nimport { FaCalendarAlt, FaComments, FaEye, FaSearch, FaVideo, FaChevronDown } from 'react-icons/fa';\r\n\r\n\r\n\r\nconst DoctorAppointments: React.FC = () => {\r\n    const navigate = useNavigate();\r\n    const [activeTab, setActiveTab] = useState<'upcoming' | 'cancelled' | 'completed'>('upcoming');\r\n    const [searchQuery, setSearchQuery] = useState('');\r\n    const [debouncedSearch, setDebouncedSearch] = useState('');\r\n    const [appointments, setAppointments] = useState<PopulatedAppointment[]>([]);\r\n    const [tabCounts, setTabCounts] = useState<{ upcoming: number; cancelled: number; completed: number }>({\r\n        upcoming: 0,\r\n        cancelled: 0,\r\n        completed: 0,\r\n    });\r\n    const [loading, setLoading] = useState(true);\r\n    const [refreshing, setRefreshing] = useState(false);\r\n    const [hasLoadedOnce, setHasLoadedOnce] = useState(false);\r\n    const [error, setError] = useState('');\r\n    const [page, setPage] = useState(1);\r\n    const [total, setTotal] = useState(0);\r\n    const limit = 10;\r\n\r\n    const fetchCounts = useCallback(async () => {\r\n        try {\r\n            const [upcomingRes, cancelledRes, completedRes] = await Promise.all([\r\n                appointmentService.getDoctorAppointments('confirmed', 1, 1),\r\n                appointmentService.getDoctorAppointments('cancelled', 1, 1),\r\n                appointmentService.getDoctorAppointments('completed', 1, 1),\r\n            ]);\r\n\r\n            setTabCounts({\r\n                upcoming: upcomingRes?.success ? upcomingRes?.data?.total || 0 : 0,\r\n                cancelled: cancelledRes?.success ? cancelledRes?.data?.total || 0 : 0,\r\n                completed: completedRes?.success ? completedRes?.data?.total || 0 : 0,\r\n            });\r\n        } catch (err) {\r\n            console.warn('Failed to fetch counts:', err);\r\n        }\r\n    }, []);\r\n\r\n    const fetchAppointments = useCallback(async (isAppending: boolean = false) => {\r\n        try {\r\n            if (!isAppending) {\r\n                if (!hasLoadedOnce) setLoading(true);\r\n                else setRefreshing(true);\r\n            }\r\n\r\n            setError('');\r\n            const status = activeTab === 'upcoming' ? 'confirmed' : activeTab;\r\n            // Pass undefined for patientId (4th arg) and debouncedSearch for search (5th arg)\r\n            const response = await appointmentService.getDoctorAppointments(status, isAppending ? page : 1, limit, undefined, debouncedSearch);\r\n\r\n            if (response?.success) {\r\n                const nextAppointments = response.data.appointments || [];\r\n                if (isAppending) {\r\n                    setAppointments(prev => [...prev, ...nextAppointments]);\r\n                } else {\r\n                    setAppointments(nextAppointments);\r\n                }\r\n\r\n                if (typeof response?.data?.total === 'number') {\r\n                    setTotal(response.data.total);\r\n                    setTabCounts((prev) => {\r\n                        if (activeTab === 'upcoming') return { ...prev, upcoming: response.data.total };\r\n                        if (activeTab === 'cancelled') return { ...prev, cancelled: response.data.total };\r\n                        return { ...prev, completed: response.data.total };\r\n                    });\r\n                }\r\n            } else {\r\n                throw new Error(response?.message || 'Failed to fetch appointments');\r\n            }\r\n        } catch (err: any) {\r\n            console.error('Failed to fetch appointments:', err);\r\n            setError(err?.response?.data?.message || err?.message || 'Failed to fetch appointments');\r\n            toast.error('Failed to load appointments');\r\n        } finally {\r\n            setLoading(false);\r\n            setRefreshing(false);\r\n            setHasLoadedOnce(true);\r\n        }\r\n    }, [activeTab, hasLoadedOnce, page, limit, debouncedSearch]);\r\n\r\n\r\n    useEffect(() => {\r\n        const handler = setTimeout(() => {\r\n            setDebouncedSearch(searchQuery);\r\n            setPage(1);\r\n        }, 500);\r\n\r\n        return () => {\r\n            clearTimeout(handler);\r\n        };\r\n    }, [searchQuery]);\r\n\r\n\r\n\r\n    useEffect(() => {\r\n        fetchCounts();\r\n    }, [fetchCounts]);\r\n\r\n    useEffect(() => {\r\n        fetchAppointments(page > 1);\r\n    }, [fetchAppointments, page]);\r\n\r\n    const filteredAppointments = appointments;\r\n\r\n    const getTabCount = (status: string) => {\r\n        if (status === 'upcoming') return tabCounts.upcoming;\r\n        if (status === 'cancelled') return tabCounts.cancelled;\r\n        return tabCounts.completed;\r\n    };\r\n\r\n    const handleViewDetails = (id: string) => {\r\n        navigate(`/doctor/appointments/${id}`);\r\n    };\r\n\r\n    const breadcrumbItems = [\r\n        { label: 'Home', path: '/doctor/dashboard' },\r\n        { label: 'Appointments' },\r\n    ];\r\n\r\n    return (\r\n        <div className=\"min-h-screen bg-gray-50\">\r\n            <DoctorNavbar />\r\n\r\n            <Breadcrumbs\r\n                items={breadcrumbItems}\r\n                title=\"My Appointments\"\r\n                subtitle=\"Manage your patient appointments\"\r\n            />\r\n\r\n            <DoctorLayout>\r\n                {/* Loading State */}\r\n\r\n                {loading && !hasLoadedOnce && (\r\n                    <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\r\n                        {[1, 2, 3, 4, 5, 6].map((i) => (\r\n                            <div key={i} className=\"bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden\">\r\n                                <div className=\"p-4 border-b border-gray-100 flex items-start gap-3\">\r\n                                    <Skeleton className=\"w-14 h-14 rounded-full\" />\r\n                                    <div className=\"flex-1 space-y-2\">\r\n                                        <Skeleton className=\"h-3 w-16\" />\r\n                                        <Skeleton className=\"h-4 w-3/4\" />\r\n                                        <div className=\"flex justify-between items-center mt-2\">\r\n                                            <Skeleton className=\"h-4 w-20\" />\r\n                                            <Skeleton className=\"h-5 w-16 rounded-full\" />\r\n                                        </div>\r\n                                    </div>\r\n                                </div>\r\n                                <div className=\"p-4 bg-gray-50 space-y-4\">\r\n                                    <div className=\"flex items-center justify-between gap-2 p-2.5 bg-white rounded-xl border border-gray-100 shadow-sm\">\r\n                                        <Skeleton className=\"h-4 w-24\" />\r\n                                        <div className=\"w-px h-3 bg-gray-200\" />\r\n                                        <Skeleton className=\"h-4 w-20\" />\r\n                                    </div>\r\n                                    <Skeleton className=\"w-full h-10 rounded-xl\" />\r\n                                </div>\r\n                            </div>\r\n                        ))}\r\n                    </div>\r\n                )}\r\n\r\n                {/* Error State */}\r\n                {error && (\r\n                    <div className=\"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg mb-6\">\r\n                        {error}\r\n                    </div>\r\n                )}\r\n\r\n                {(!loading || hasLoadedOnce) && !error && (\r\n                    <>\r\n                        {/* Stats Cards */}\r\n                        <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6\">\r\n                            <div className=\"bg-white rounded-xl p-4 shadow-sm border border-gray-100\">\r\n                                <div className=\"flex items-center justify-between\">\r\n                                    <div>\r\n                                        <p className=\"text-sm text-gray-600 mb-1\">Upcoming</p>\r\n                                        <h3 className=\"text-2xl font-bold text-[#00A1B0]\">{getTabCount('upcoming')}</h3>\r\n                                    </div>\r\n                                    <div className=\"w-12 h-12 bg-blue-50 rounded-lg flex items-center justify-center\">\r\n                                        <FaVideo className=\"text-blue-600\" size={20} />\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n                            <div className=\"bg-white rounded-xl p-4 shadow-sm border border-gray-100\">\r\n                                <div className=\"flex items-center justify-between\">\r\n                                    <div>\r\n                                        <p className=\"text-sm text-gray-600 mb-1\">Completed</p>\r\n                                        <h3 className=\"text-2xl font-bold text-green-600\">{getTabCount('completed')}</h3>\r\n                                    </div>\r\n                                    <div className=\"w-12 h-12 bg-green-50 rounded-lg flex items-center justify-center\">\r\n                                        <svg className=\"w-5 h-5 text-green-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                                            <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M5 13l4 4L19 7\" />\r\n                                        </svg>\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n                            <div className=\"bg-white rounded-xl p-4 shadow-sm border border-gray-100\">\r\n                                <div className=\"flex items-center justify-between\">\r\n                                    <div>\r\n                                        <p className=\"text-sm text-gray-600 mb-1\">Cancelled</p>\r\n                                        <h3 className=\"text-2xl font-bold text-red-600\">{getTabCount('cancelled')}</h3>\r\n                                    </div>\r\n                                    <div className=\"w-12 h-12 bg-red-50 rounded-lg flex items-center justify-center\">\r\n                                        <svg className=\"w-5 h-5 text-red-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                                            <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M6 18L18 6M6 6l12 12\" />\r\n                                        </svg>\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n\r\n                        {/* Search Bar */}\r\n                        <div className=\"bg-white rounded-xl shadow-sm border border-gray-100 p-4 mb-6\">\r\n                            <div className=\"relative\">\r\n                                <FaSearch className=\"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400\" size={16} />\r\n                                <input\r\n                                    type=\"text\"\r\n                                    placeholder=\"Search patients...\"\r\n                                    value={searchQuery}\r\n                                    onChange={(e) => setSearchQuery(e.target.value)}\r\n                                    className=\"w-full pl-10 pr-4 py-2.5 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#00A1B0] focus:border-transparent\"\r\n                                />\r\n                            </div>\r\n                        </div>\r\n\r\n                        {/* Tabs */}\r\n                        <div className=\"bg-white rounded-xl shadow-sm border border-gray-100 mb-6\">\r\n                            <div className=\"border-b border-gray-100\">\r\n                                <div className=\"flex gap-1 p-2 bg-gray-50/50\">\r\n                                    <button\r\n                                        onClick={() => {\r\n                                            if (activeTab !== 'upcoming') {\r\n                                                setActiveTab('upcoming');\r\n                                                setPage(1);\r\n                                            }\r\n                                        }}\r\n                                        className={`flex-1 px-4 py-2.5 rounded-lg font-bold text-xs uppercase tracking-wider transition-all ${activeTab === 'upcoming'\r\n                                            ? 'bg-white text-[#00A1B0] shadow-sm border border-gray-100'\r\n                                            : 'text-gray-500 hover:text-gray-700 hover:bg-gray-100/50'\r\n                                            }`}\r\n                                    >\r\n                                        Upcoming ({getTabCount('upcoming')})\r\n                                    </button>\r\n                                    <button\r\n                                        onClick={() => {\r\n                                            if (activeTab !== 'completed') {\r\n                                                setActiveTab('completed');\r\n                                                setPage(1);\r\n                                            }\r\n                                        }}\r\n                                        className={`flex-1 px-4 py-2.5 rounded-lg font-bold text-xs uppercase tracking-wider transition-all ${activeTab === 'completed'\r\n                                            ? 'bg-white text-[#00A1B0] shadow-sm border border-gray-100'\r\n                                            : 'text-gray-500 hover:text-gray-700 hover:bg-gray-100/50'\r\n                                            }`}\r\n                                    >\r\n                                        Completed ({getTabCount('completed')})\r\n                                    </button>\r\n                                    <button\r\n                                        onClick={() => {\r\n                                            if (activeTab !== 'cancelled') {\r\n                                                setActiveTab('cancelled');\r\n                                                setPage(1);\r\n                                            }\r\n                                        }}\r\n                                        className={`flex-1 px-4 py-2.5 rounded-lg font-bold text-xs uppercase tracking-wider transition-all ${activeTab === 'cancelled'\r\n                                            ? 'bg-white text-[#00A1B0] shadow-sm border border-gray-100'\r\n                                            : 'text-gray-500 hover:text-gray-700 hover:bg-gray-100/50'\r\n                                            }`}\r\n                                    >\r\n                                        Cancelled ({getTabCount('cancelled')})\r\n                                    </button>\r\n                                </div>\r\n                            </div>\r\n\r\n                            {/* Appointments List */}\r\n                            <div className=\"p-4\">\r\n                                {refreshing && (\r\n                                    <div className=\"mb-4 flex items-center justify-center gap-2 text-sm text-gray-500\">\r\n                                        <Loader2 className=\"h-4 w-4 animate-spin\" />\r\n                                        Updating...\r\n                                    </div>\r\n                                )}\r\n                                {filteredAppointments.length === 0 ? (\r\n                                    <div className=\"text-center py-12\">\r\n                                        <div className=\"w-20 h-20 bg-gray-100 rounded-full mx-auto mb-4 flex items-center justify-center\">\r\n                                            <FaVideo className=\"text-gray-400\" size={32} />\r\n                                        </div>\r\n                                        <h3 className=\"text-lg font-semibold text-gray-800 mb-2\">\r\n                                            No {activeTab} appointments\r\n                                        </h3>\r\n                                        <p className=\"text-gray-600 text-sm\">\r\n                                            You don't have any {activeTab} appointments at the moment.\r\n                                        </p>\r\n                                    </div>\r\n                                ) : (\r\n                                    <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\r\n                                        {filteredAppointments.map((appointment) => (\r\n                                            <Card key={appointment.customId || appointment._id} className=\"overflow-hidden border-gray-100 hover:shadow-md transition-shadow\">\r\n                                                <CardHeader className=\"p-4 border-b border-gray-100 space-y-0\">\r\n                                                    <div className=\"flex items-start justify-between gap-3\">\r\n                                                        <div className=\"flex items-start gap-3 flex-1\">\r\n                                                            <div className=\"relative\">\r\n                                                                <img\r\n                                                                    src={appointment.patientId?.profileImage || '/patient-placeholder.jpg'}\r\n                                                                    alt={appointment.patientId?.name || 'Patient'}\r\n                                                                    className=\"w-14 h-14 rounded-full object-cover border-2 border-gray-200\"\r\n                                                                    onError={(e) => { e.currentTarget.src = 'https://via.placeholder.com/100x100?text=Patient'; }}\r\n                                                                />\r\n                                                                <div className={`absolute -bottom-1 -right-1 w-5 h-5 rounded-full flex items-center justify-center text-white text-[10px] ${appointment.appointmentType === 'video' ? 'bg-[#00A1B0]' : 'bg-emerald-500'}`}>\r\n                                                                    {appointment.appointmentType === 'video' ? <FaVideo /> : <FaComments />}\r\n                                                                </div>\r\n                                                            </div>\r\n                                                            <div className=\"flex-1 min-w-0\">\r\n                                                                <p className=\"text-[10px] text-gray-400 font-medium tracking-wider mb-0.5\">{appointment.customId || appointment._id}</p>\r\n                                                                <h3 className=\"font-bold text-gray-900 leading-tight truncate\">{appointment.patientId?.name || 'Unknown Patient'}</h3>\r\n                                                                <div className=\"flex items-center justify-between mt-1\">\r\n                                                                    <div className=\"flex items-center gap-1.5\">\r\n                                                                        <span className={`w-1.5 h-1.5 rounded-full ${appointment.status === 'confirmed' ? 'bg-emerald-500' : appointment.status === 'cancelled' || appointment.status === 'rejected' ? 'bg-rose-500' : 'bg-amber-500'}`}></span>\r\n                                                                        <span className=\"text-[11px] font-medium text-gray-500 capitalize\">{appointment.status.replace('_', ' ')}</span>\r\n                                                                    </div>\r\n                                                                    <span className=\"text-[11px] font-bold text-[#00A1B0] bg-[#00A1B0]/10 px-2 py-0.5 rounded-full\">\r\n                                                                        Γé╣{appointment.consultationFees}\r\n                                                                    </span>\r\n                                                                </div>\r\n                                                            </div>\r\n                                                        </div>\r\n                                                    </div>\r\n                                                </CardHeader>\r\n                                                <CardContent className=\"p-4 bg-gray-50/50 space-y-4\">\r\n                                                    <div className=\"flex items-center justify-between gap-2 p-2.5 bg-white rounded-xl border border-gray-100 shadow-sm\">\r\n                                                        <div className=\"flex items-center gap-2 text-gray-600\">\r\n                                                            <FaCalendarAlt className=\"w-3.5 h-3.5 text-[#00A1B0]\" />\r\n                                                            <span className=\"text-xs font-semibold\">{new Date(appointment.appointmentDate).toLocaleDateString()}</span>\r\n                                                        </div>\r\n                                                        <div className=\"w-px h-3 bg-gray-200\" />\r\n                                                        <div className=\"flex items-center gap-2 text-gray-600\">\r\n                                                            <svg className=\"w-3.5 h-3.5 text-[#00A1B0]\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z\" /></svg>\r\n                                                            <span className=\"text-xs font-semibold\">{appointment.appointmentTime}</span>\r\n                                                        </div>\r\n                                                    </div>\r\n\r\n                                                    <Button\r\n                                                        onClick={() => handleViewDetails(appointment._id)}\r\n                                                        className=\"w-full h-10 bg-[#D2F1F4] hover:bg-[#b8e9ed] text-[#00A1B0] font-bold rounded-xl border-none shadow-none gap-2.5 transition-all hover:scale-[1.01] active:scale-[0.99] flex items-center justify-center\"\r\n                                                    >\r\n                                                        <FaEye className=\"w-4 h-4\" />\r\n                                                        <span className=\"text-sm\">View Full Details</span>\r\n                                                    </Button>\r\n                                                </CardContent>\r\n                                            </Card>\r\n                                        ))}\r\n                                    </div>\r\n                                )}\r\n\r\n                                {filteredAppointments.length > 0 && appointments.length < total && (\r\n                                    <div className=\"text-center mt-10 mb-4\">\r\n                                        <button\r\n                                            onClick={() => setPage(p => p + 1)}\r\n                                            disabled={loading || refreshing}\r\n                                            className=\"group relative inline-flex items-center justify-center px-10 py-3 font-bold text-[#00A1B0] transition-all duration-300 bg-[#D2F1F4] hover:bg-[#b8e9ed] rounded-xl shadow-sm hover:shadow-md focus:outline-none disabled:opacity-60 disabled:cursor-not-allowed overflow-hidden\"\r\n                                        >\r\n                                            <div className=\"absolute inset-0 bg-gradient-to-r from-transparent via-white/20 to-transparent -translate-x-full group-hover:animate-[shimmer_1.5s_infinite] pointer-events-none\" />\r\n                                            {loading || refreshing ? (\r\n                                                <div className=\"flex items-center gap-2.5\">\r\n                                                    <div className=\"w-4 h-4 border-2 border-current border-t-transparent rounded-full animate-spin\" />\r\n                                                    <span className=\"tracking-wide text-sm\">Fetching More...</span>\r\n                                                </div>\r\n                                            ) : (\r\n                                                <div className=\"flex items-center gap-2.5\">\r\n                                                    <span className=\"tracking-wide text-sm\">Load More Appointments</span>\r\n                                                    <FaChevronDown className=\"w-3.5 h-3.5 transition-transform duration-300 group-hover:translate-y-1\" />\r\n                                                </div>\r\n                                            )}\r\n                                        </button>\r\n                                    </div>\r\n                                )}\r\n                            </div>\r\n                        </div>\r\n                    </>\r\n                )}\r\n            </DoctorLayout>\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default DoctorAppointments;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\nithi\\OneDrive\\Documents\\Brototype\\Takecare\\frontend\\src\\pages\\doctor\\DoctorReviews.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":51,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":51,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1858,1861],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1858,1861],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'error' is defined but never used.","line":81,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":81,"endColumn":23}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useEffect, useState, useCallback } from \"react\";\r\nimport { toast } from \"sonner\";\r\nimport { Star, MessageCircle, User, Clock, MessageSquare, X } from \"lucide-react\";\r\nimport { motion, AnimatePresence } from \"framer-motion\";\r\nimport DoctorNavbar from \"../../components/Doctor/DoctorNavbar\";\r\nimport DoctorLayout from \"../../components/Doctor/DoctorLayout\";\r\nimport Breadcrumbs from \"../../components/common/Breadcrumbs\";\r\nimport doctorService from \"../../services/doctorService\";\r\nimport { useSelector } from \"react-redux\";\r\nimport { selectCurrentUser } from \"../../redux/user/userSlice\";\r\n\r\ninterface Review {\r\n    _id: string;\r\n    patientId: {\r\n        _id: string;\r\n        name: string;\r\n        profileImage: string;\r\n        email?: string;\r\n    };\r\n    rating: number;\r\n    comment: string;\r\n    response?: string;\r\n    responseDate?: string;\r\n    createdAt: string;\r\n}\r\n\r\nconst DoctorReviews: React.FC = () => {\r\n    const [reviews, setReviews] = useState<Review[]>([]);\r\n    const [loading, setLoading] = useState(true);\r\n\r\n    // Reply Modal State\r\n    const [replyModalOpen, setReplyModalOpen] = useState(false);\r\n    const [selectedReview, setSelectedReview] = useState<Review | null>(null);\r\n    const [replyText, setReplyText] = useState(\"\");\r\n    const [isSending, setIsSending] = useState(false);\r\n\r\n    const doctor = useSelector(selectCurrentUser);\r\n\r\n    const fetchReviews = useCallback(async () => {\r\n        const docId = doctor?.doctorProfileId || doctor?.id || doctor?._id;\r\n        if (!docId) return;\r\n\r\n        setLoading(true);\r\n        try {\r\n            const res = await doctorService.getReviews(docId);\r\n            if (res.success) {\r\n                setReviews(res.data || []);\r\n            } else {\r\n                toast.error(res.message || \"Failed to fetch reviews\");\r\n            }\r\n        } catch (e: any) {\r\n            toast.error(e.message || \"Error fetching reviews\");\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    }, [doctor]);\r\n\r\n    useEffect(() => {\r\n        fetchReviews();\r\n    }, [fetchReviews]);\r\n\r\n    const handleReplyClick = (review: Review) => {\r\n        setSelectedReview(review);\r\n        setReplyText(\"\");\r\n        setReplyModalOpen(true);\r\n    };\r\n\r\n    const handleSendReply = async () => {\r\n        if (!selectedReview || !replyText.trim()) return;\r\n\r\n        setIsSending(true);\r\n        try {\r\n            const res = await doctorService.respondToReview(selectedReview._id, replyText);\r\n            if (res.success) {\r\n                toast.success(\"Response sent successfully!\");\r\n                setReplyModalOpen(false);\r\n                fetchReviews();\r\n            } else {\r\n                toast.error(res.message || \"Failed to send response\");\r\n            }\r\n        } catch (error) {\r\n            toast.error(\"Error sending response\");\r\n        } finally {\r\n            setIsSending(false);\r\n        }\r\n    };\r\n\r\n    const breadcrumbItems = [{ label: 'Reviews' }];\r\n\r\n    return (\r\n        <div className=\"min-h-screen bg-gray-50\">\r\n            <DoctorNavbar />\r\n            <Breadcrumbs items={breadcrumbItems} title=\"Patient Reviews\" subtitle=\"Manage and respond to your patient feedback\" />\r\n\r\n            <DoctorLayout>\r\n                <main className=\"max-w-4xl mx-auto py-6 px-4\">\r\n                    {loading ? (\r\n                        <div className=\"flex items-center justify-center py-20\">\r\n                            <div className=\"animate-spin rounded-full h-10 w-10 border-b-2 border-[#00A1B0]\"></div>\r\n                        </div>\r\n                    ) : reviews.length === 0 ? (\r\n                        <div className=\"bg-white rounded-3xl p-10 text-center shadow-sm border border-slate-100\">\r\n                            <div className=\"inline-flex items-center justify-center w-14 h-14 bg-slate-50 rounded-full mb-3\">\r\n                                <MessageCircle className=\"text-slate-300\" size={28} />\r\n                            </div>\r\n                            <h3 className=\"text-base font-semibold text-slate-900\">No reviews yet</h3>\r\n                            <p className=\"text-slate-500 text-sm mt-1\">When patients leave feedback, it will appear here.</p>\r\n                        </div>\r\n                    ) : (\r\n                        <div className=\"space-y-4\">\r\n                            {reviews.map((review) => (\r\n                                <motion.div\r\n                                    key={review._id}\r\n                                    initial={{ opacity: 0, y: 10 }}\r\n                                    animate={{ opacity: 1, y: 0 }}\r\n                                    className=\"bg-white rounded-xl p-4 shadow-sm border border-slate-100 hover:shadow-md transition-shadow\"\r\n                                >\r\n                                    <div className=\"flex flex-wrap items-start justify-between gap-3 mb-3\">\r\n                                        <div className=\"flex items-center gap-3\">\r\n                                            <div className=\"w-10 h-10 bg-teal-50 text-teal-600 rounded-lg flex items-center justify-center overflow-hidden\">\r\n                                                {review.patientId?.profileImage ? (\r\n                                                    <img src={review.patientId.profileImage} alt=\"\" className=\"w-full h-full object-cover\" />\r\n                                                ) : (\r\n                                                    <User size={20} />\r\n                                                )}\r\n                                            </div>\r\n                                            <div>\r\n                                                <h3 className=\"font-bold text-slate-900 text-base\">{review.patientId?.name || \"Patient\"}</h3>\r\n                                                <div className=\"flex items-center gap-2 mt-0.5\">\r\n                                                    <div className=\"flex\">\r\n                                                        {[1, 2, 3, 4, 5].map((star) => (\r\n                                                            <Star\r\n                                                                key={star}\r\n                                                                size={12}\r\n                                                                className={`${star <= review.rating ? \"text-yellow-400 fill-yellow-400\" : \"text-gray-200\"}`}\r\n                                                            />\r\n                                                        ))}\r\n                                                    </div>\r\n                                                </div>\r\n                                            </div>\r\n                                        </div>\r\n                                        <div className=\"flex items-center gap-2 px-2.5 py-1 bg-slate-50 text-slate-400 rounded-full text-[10px] font-medium border border-slate-100\">\r\n                                            <Clock size={12} />\r\n                                            {new Date(review.createdAt).toLocaleDateString()}\r\n                                        </div>\r\n                                    </div>\r\n\r\n                                    <div className=\"bg-slate-50/80 backdrop-blur-sm rounded-lg p-4 border border-slate-100/50\">\r\n                                        <div className=\"flex items-center gap-2 text-slate-900 font-semibold mb-1.5 text-xs\">\r\n                                            <MessageSquare size={14} className=\"text-[#00A1B0]\" />\r\n                                            Patient Feedback\r\n                                        </div>\r\n                                        <p className=\"text-slate-600 leading-relaxed italic text-xs\">\r\n                                            \"{review.comment}\"\r\n                                        </p>\r\n                                    </div>\r\n\r\n                                    {review.response && (\r\n                                        <div className=\"mt-3 pl-4 border-l-4 border-[#00A1B0]/30 transition-all\">\r\n                                            <div className=\"flex items-center gap-2 mb-1.5 text-[#00A1B0]\">\r\n                                                <span className=\"font-bold text-[10px] uppercase tracking-wider\">Your Response</span>\r\n                                                <span className=\"text-[9px] text-gray-400\">\r\n                                                    {review.responseDate && new Date(review.responseDate).toLocaleDateString()}\r\n                                                </span>\r\n                                            </div>\r\n                                            <p className=\"text-slate-600 text-xs leading-relaxed\">\r\n                                                {review.response}\r\n                                            </p>\r\n                                        </div>\r\n                                    )}\r\n\r\n                                    <div className=\"mt-4 flex items-center justify-between border-t border-slate-50 pt-3\">\r\n                                        <span className={`px-2.5 py-1 rounded-full text-[9px] font-bold uppercase tracking-wider ${!review.response ? 'bg-amber-100 text-amber-700' : 'bg-blue-100 text-blue-700'}`}>\r\n                                            {review.response ? 'Responded' : 'Pending'}\r\n                                        </span>\r\n\r\n                                        {!review.response && (\r\n                                            <button\r\n                                                onClick={() => handleReplyClick(review)}\r\n                                                className=\"px-4 py-1.5 bg-[#00A1B0] text-white rounded-lg font-bold hover:bg-teal-600 transition-all shadow-lg shadow-teal-500/10 text-xs active:scale-95\"\r\n                                            >\r\n                                                Reply\r\n                                            </button>\r\n                                        )}\r\n                                    </div>\r\n                                </motion.div>\r\n                            ))}\r\n                        </div>\r\n                    )}\r\n                </main>\r\n\r\n                {/* Reply Modal */}\r\n                <AnimatePresence>\r\n                    {replyModalOpen && (\r\n                        <div className=\"fixed inset-0 z-[100] flex items-center justify-center p-4\">\r\n                            <motion.div\r\n                                initial={{ opacity: 0 }}\r\n                                animate={{ opacity: 1 }}\r\n                                exit={{ opacity: 0 }}\r\n                                onClick={() => setReplyModalOpen(false)}\r\n                                className=\"absolute inset-0 bg-slate-900/60 backdrop-blur-sm\"\r\n                            />\r\n                            <motion.div\r\n                                initial={{ scale: 0.95, opacity: 0, y: 20 }}\r\n                                animate={{ scale: 1, opacity: 1, y: 0 }}\r\n                                exit={{ scale: 0.95, opacity: 0, y: 20 }}\r\n                                className=\"relative w-full max-w-lg bg-white rounded-3xl shadow-2xl overflow-hidden border border-slate-100\"\r\n                            >\r\n                                <div className=\"p-6 border-b border-slate-50 flex items-center justify-between bg-white\">\r\n                                    <div className=\"flex items-center gap-4\">\r\n                                        <div className=\"w-10 h-10 bg-teal-50 text-teal-600 rounded-xl flex items-center justify-center\">\r\n                                            <MessageSquare size={20} />\r\n                                        </div>\r\n                                        <div>\r\n                                            <h3 className=\"text-lg font-bold text-slate-900\">Reply to Review</h3>\r\n                                            <p className=\"text-xs text-slate-500\">Patient: {selectedReview?.patientId?.name}</p>\r\n                                        </div>\r\n                                    </div>\r\n                                    <button\r\n                                        onClick={() => setReplyModalOpen(false)}\r\n                                        className=\"p-2 text-slate-400 hover:text-slate-600 hover:bg-slate-50 rounded-full transition-colors\"\r\n                                    >\r\n                                        <X size={20} />\r\n                                    </button>\r\n                                </div>\r\n\r\n                                <div className=\"p-6\">\r\n                                    <div className=\"mb-6 bg-slate-50 p-4 rounded-2xl text-sm italic text-slate-600 border border-slate-100\">\r\n                                        <div className=\"text-[10px] font-bold text-slate-400 uppercase tracking-widest mb-1.5 flex items-center gap-1.5\">\r\n                                            <Clock size={10} />\r\n                                            Original Feedback\r\n                                        </div>\r\n                                        \"{selectedReview?.comment}\"\r\n                                    </div>\r\n                                    <div className=\"space-y-2\">\r\n                                        <label className=\"block text-xs font-bold text-slate-700 uppercase tracking-wider\">Your Response</label>\r\n                                        <textarea\r\n                                            value={replyText}\r\n                                            onChange={(e) => setReplyText(e.target.value)}\r\n                                            placeholder=\"Write a thoughtful response to your patient...\"\r\n                                            className=\"w-full h-40 p-4 border border-slate-200 rounded-2xl focus:ring-2 focus:ring-[#00A1B0]/20 focus:border-[#00A1B0] outline-none transition-all resize-none text-sm bg-slate-50/30\"\r\n                                        />\r\n                                    </div>\r\n                                </div>\r\n\r\n                                <div className=\"p-6 bg-slate-50/50 border-t border-slate-50 flex items-center justify-end gap-3 backdrop-blur-sm\">\r\n                                    <button\r\n                                        onClick={() => setReplyModalOpen(false)}\r\n                                        className=\"px-6 py-2 text-slate-500 font-bold hover:text-slate-900 transition-colors text-sm\"\r\n                                    >\r\n                                        Cancel\r\n                                    </button>\r\n                                    <button\r\n                                        onClick={handleSendReply}\r\n                                        disabled={!replyText.trim() || isSending}\r\n                                        className=\"px-8 py-2.5 bg-[#00A1B0] text-white rounded-xl font-bold hover:bg-teal-600 transition-all shadow-xl shadow-teal-500/20 disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2 text-sm active:scale-95\"\r\n                                    >\r\n                                        {isSending ? (\r\n                                            <>\r\n                                                <div className=\"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin\" />\r\n                                                Sending...\r\n                                            </>\r\n                                        ) : (\r\n                                            <>\r\n                                                Send Response\r\n                                                <X className=\"rotate-45\" size={14} />\r\n                                            </>\r\n                                        )}\r\n                                    </button>\r\n                                </div>\r\n                            </motion.div>\r\n                        </div>\r\n                    )}\r\n                </AnimatePresence>\r\n            </DoctorLayout>\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default DoctorReviews;\r\n","usedDeprecatedRules":[]}]
